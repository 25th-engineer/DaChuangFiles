下图/n,github/en,地址/n,：/w,mask/en,_,rcnnmask/en,_,rcnn/en,_,keypoints/en,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,论文/n,学习/v,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,项目/n,文档/n,翻译/v,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其一/r,：/w,总览/nw,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其/r,二/m,：/w,基于/p,renet/en,101/m,的/u,fpn/en,共享/v,网络/n,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其/r,三/m,：/w,rpn/en,锚框/nw,处理/v,和/c,proposal/en,生成/vn,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其/r,四/m,：/w,fpn/en,和/c,roialign/en,的/u,耦合/vn,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其/r,五/m,：/w,目标/n,检测/vn,结果/n,精炼/a,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其/r,六/m,：/w,mask/en,生成/vn,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,终篇/nw,：/w,使用/v,detect/en,方法/n,进行/v,推断/vn,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,锚框/nw,生成/vn,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,训练/vn,网络/n,其一/r,：/w,数据集/nw,与/p,dataset/en,类/q,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,训练/vn,网络/n,其/r,二/m,：/w,train/en,网络结构/l,&/w,损失/n,函数/n,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,训练/vn,网络/n,其/r,三/m,：/w,训练/vn,model/en,原/b,论文/n,中/f,提到/v,过/u,mask/en,_,rcnn/en,是/v,可以/v,进行/v,关键点/n,检测/vn,的/u,，/w,不过/c,我们/r,学习/v,的/u,这个/r,工程/n,并/c,没有/v,添加/vn,关键点/n,检测/vn,分支/n,，/w,而/c,有人/r,基于/p,本/r,工程/n,进行/v,了/u,完善/v,；/w,mask/en,_,rcnn/en,_,humanpose/en,，/w,本文/r,我们/r,将/d,简要/ad,的/u,了解/v,如何/r,将/d,关键点/n,识别/v,分支/n,添加/vn,进/v,模型/n,，/w,更进一步/l,的/u,，/w,我们/r,将/d,尝试/vn,使用/v,mask/en,_,rcnn/en,对/p,实际/n,数据/n,进行/v,识别/v,。/w,零/m,、/w,配置/vn,相关/v,import/en, ,os/en, ,import/en, ,numpy/en, ,as/en, ,np/en, ,import/en, ,pandas/en, ,as/en, ,pd/en, ,from/en, ,pil/en, ,import/en, ,image/en, ,import/en, ,utils/en, ,as/en, ,utils/en, ,import/en, ,model/en, ,as/en, ,modellib/en, ,from/en, ,config/en, ,import/en, ,config/en, ,part/en,_,index/en, ,=/w, ,{/w,'/w,blouse/en,'/w,:/w, ,[/w,0/m,,/w, ,1/m,,/w, ,2/m,,/w, ,3/m,,/w, ,4/m,,/w, ,5/m,,/w, ,6/m,,/w, ,9/m,,/w, ,10/m,,/w, ,11/m,,/w, ,12/m,,/w, ,13/m,,/w, ,14/m,]/w,,/w, ,'/w,outwear/en,'/w,:/w, ,[/w,0/m,,/w, ,1/m,,/w, ,3/m,,/w, ,4/m,,/w, ,5/m,,/w, ,6/m,,/w, ,7/m,,/w, ,8/m,,/w, ,9/m,,/w, ,10/m,,/w, ,11/m,,/w, ,12/m,,/w, ,13/m,,/w, ,14/m,]/w,,/w, ,'/w,dress/en,'/w,:/w, ,[/w,0/m,,/w, ,1/m,,/w, ,2/m,,/w, ,3/m,,/w, ,4/m,,/w, ,5/m,,/w, ,6/m,,/w, ,7/m,,/w, ,8/m,,/w, ,9/m,,/w, ,10/m,,/w, ,11/m,,/w, ,12/m,,/w, ,17/m,,/w, ,18/m,]/w,,/w, ,'/w,skirt/en,'/w,:/w, ,[/w,15/m,,/w, ,16/m,,/w, ,17/m,,/w, ,18/m,]/w,,/w, ,'/w,trousers/en,'/w,:/w, ,[/w,15/m,,/w, ,16/m,,/w, ,19/m,,/w, ,20/m,,/w, ,21/m,,/w, ,22/m,,/w, ,23/m,]/w,}/w, ,part/en,_,str/en, ,=/w, ,[/w,'/w,neckline/en,_,left/en,'/w,,/w, ,'/w,neckline/en,_,right/en,'/w,,/w, ,'/w,center/en,_,front/en,'/w,,/w, ,'/w,shoulder/en,_,left/en,'/w,,/w, ,'/w,shoulder/en,_,right/en,'/w,,/w, ,'/w,armpit/en,_,left/en,'/w,,/w, ,'/w,armpit/en,_,right/en,'/w,,/w, ,'/w,waistline/en,_,left/en,'/w,,/w, ,'/w,waistline/en,_,right/en,'/w,,/w, ,'/w,cuff/en,_,left/en,_,in/en,'/w,,/w, ,'/w,cuff/en,_,left/en,_,out/en,'/w,,/w, ,'/w,cuff/en,_,right/en,_,in/en,'/w,,/w, ,'/w,cuff/en,_,right/en,_,out/en,'/w,,/w, ,'/w,top/en,_,hem/en,_,left/en,'/w,,/w, ,'/w,top/en,_,hem/en,_,right/en,'/w,,/w, ,'/w,waistband/en,_,left/en,'/w,,/w, ,'/w,waistband/en,_,right/en,'/w,,/w, ,'/w,hemline/en,_,left/en,'/w,,/w, ,'/w,hemline/en,_,right/en,'/w,,/w, ,'/w,crotch/en,'/w,,/w, ,'/w,bottom/en,_,left/en,_,in/en,'/w,,/w, ,'/w,bottom/en,_,left/en,_,out/en,'/w,,/w, ,'/w,bottom/en,_,right/en,_,in/en,'/w,,/w, ,'/w,bottom/en,_,right/en,_,out/en,'/w,]/w, ,image/en,_,category/en, ,=/w, ,[/w,'/w,blouse/en,'/w,,/w, ,'/w,outwear/en,'/w,,/w, ,'/w,dress/en,'/w,,/w, ,'/w,skirt/en,'/w,,/w, ,'/w,trousers/en,'/w,]/w,[/w,0/m,]/w, ,class/en, ,ficonfig/en,(/w,config/en,)/w,:/w, ,"/w,"/w,"/w, ,configuration/en, ,for/en, ,training/en, ,on/en, ,the/en, ,toy/en, ,shapes/en, ,dataset/en,./w, ,derives/en, ,from/en, ,the/en, ,base/en, ,config/en, ,class/en, ,and/en, ,overrides/en, ,values/en, ,specific/en, ,to/en, ,the/en, ,toy/en, ,shapes/en, ,dataset/en,./w, ,"/w,"/w,"/w, ,#, ,give/en, ,the/en, ,configuration/en, ,a/en, ,recognizable/en, ,name/en, ,name/en, ,=/w, ,"/w,fi/en,"/w, ,#, ,</w,-----/nrf,数据集/nw,名/q, ,#, ,train/en, ,on/en, ,1/m, ,gpu/en, ,and/en, ,8/m, ,images/en, ,per/en, ,gpu/en,./w, ,we/en, ,can/en, ,put/en, ,multiple/en, ,images/en, ,on/en, ,each/en, ,#, ,gpu/en, ,because/en, ,the/en, ,images/en, ,are/en, ,small/en,./w, ,batch/en, ,size/en, ,is/en, ,8/m, ,(/w,gpus/en, ,*/w, ,images/en,//w,gpu/en,)/w,./w, ,gpu/en,_,count/en, ,=/w, ,1/m, ,images/en,_,per/en,_,gpu/en, ,=/w, ,1/m, ,num/en,_,keypoints/en, ,=/w, ,len/en,(/w,part/en,_,index/en,[/w,image/en,_,category/en,]/w,)/w, ,#, ,</w,-----/nrf,关键点/n,数目/n, ,keypoint/en,_,mask/en,_,shape/en, ,=/w, ,[/w,56/m,,/w, ,56/m,]/w, ,#, ,number/en, ,of/en, ,classes/en, ,(/w,including/en, ,background/en,)/w, ,num/en,_,classes/en, ,=/w, ,1/m, ,+/w, ,1/m, ,rpn/en,_,train/en,_,anchors/en,_,per/en,_,image/en, ,=/w, ,100/m, ,validation/en,_,stpes/en, ,=/w, ,100/m, ,steps/en,_,per/en,_,epoch/en, ,=/w, ,1000/m, ,mini/en,_,mask/en,_,shape/en, ,=/w, ,(/w,56/m,,/w, ,56/m,)/w, ,keypoint/en,_,mask/en,_,pool/en,_,size/en, ,=/w, ,7/m, ,#, ,pooled/en, ,rois/en, ,pool/en,_,size/en, ,=/w, ,7/m, ,mask/en,_,pool/en,_,size/en, ,=/w, ,14/m, ,mask/en,_,shape/en, ,=/w, ,[/w,28/m,,/w, ,28/m,]/w, ,weight/en,_,loss/en, ,=/w, ,true/en, ,keypoint/en,_,threshold/en, ,=/w, ,0.005/m,常量/n,配置/vn,记录/v,：/w,数据/n,类/q,、/w,关键点/n,类/q,、/w,数据/n,类/q,和/c,关键点/n,类/q,的/u,对应/v,关系/n,config/en,类/q,记录/v,的/u,大部分/m,为/p,model/en,设置/v,，/w,无需/v,改动/v,，/w,注意/v,设置/v,一下/m,name/en,、/w,num/en,_,keypoints/en,匹配/vn,上/f,数据集/nw,。/w,一/m,、/w,数据/n,类/q,建立/v,1/m,、/w,关键点/n,标注/v,形式/n,回顾/v,一下/m,之前/f,的/u,数据集/nw,介绍/v,，/w,在/p,非/h,关键点/n,检测/vn,任务/n,中/f,，/w,我们/r,需要/v,的/u,数据/n,有/v,两种/mq,：/w,a/en,、/w,原始/a,的/u,图片/n,文件/n,b/en,、/w,图片/n,上/f,每个/r,instance/en,的/u,掩码/nw,但是/c,由于/c,mask/en,_,rcnn/en,会/v,对/p,掩码/nw,进行/v,一次/mq,加工/vn,，/w,获取/v,每个/r,instance/en,的/u,坐标框/nw,，/w,即/v,实际上/d,还/d,需要/v,：/w,c/en,、/w,每个/r,instance/en,的/u,坐标框/nw,既然/c,这里/r,要/v,检测/vn,关键点/n,，/w,那/r,我们/r,就/d,需要/v,：/w,d/en,、/w,图像/n,的/u,关键点/n,标注/v,key/en,_,points/en,:/w, ,num/en,_,keypoints/en, ,coordinates/en, ,and/en, ,visibility/en, ,(/w,x/en,,/w,y/en,,/w,v/en,)/w, ,[/w,num/en,_,person/en,,/w,num/en,_,keypoints/en,,/w,3/m,]/w, ,of/en, ,num/en,_,person/en,首先/d,我们/r,需要/v,明确/ad,，/w,keypoints/en,从属/vn,于/p,某个/r,instance/en,，/w,即/v,上面/f,的/u,num/en,_,person/en,的/u,由来/n,（/w,人体/n,关键点/n,检测/vn,为/p,例/n,，/w,一个/m,instance/en,就/d,是/v,一个/m,人/n,）/w,，/w,而/c,一个/m,instance/en,有/v,num/en,_,keypoints/en,个/q,关键点/n,，/w,每/r,一个/m,点/q,由/p,3个/m,值/n,组成/v,：/w,横坐标/n,，/w,纵坐标/n,，/w,状态/n,。/w,其中/r,状态/n,有/v,三种/mq,：/w,该/r,类/q,不/d,存在/v,此/r,关键点/n,，/w,被/p,遮挡/v,，/w,可见/v,。/w,对于/p,coco/en,而言/u,，/w,0/m,表示/v,这个/r,关键点/n,没有/v,标注/v,（/w,这种/r,情况/n,下/f,x/en,=/w,y/en,=/w,v/en,=/w,0/m,）/w,，/w,1/m,表示/v,这个/r,关键点/n,标注/v,了/u,但是/c,不可/v,见/v,（/w,被/p,遮挡/v,了/u,）/w,，/w,2/m,表示/v,这个/r,关键点/n,标注/v,了/u,同时/c,也/d,可见/v,。/w,在/p,不同/a,的/u,数据集/nw,上/f,，/w,可能/v,有/v,不同/a,的/u,数字/n,来/v,表达/v,这/r,三个点/mq,，/w,但是/c,在/p,此/r,框架/n,训练/vn,中/f,，/w,建议/n,统一/vn,到/v,coco/en,的/u,标准/n,，/w,避免/v,过多/d,的/u,修改/v,model/en,代码/n,（/w,主要/b,是/v,避免/v,修改/v,关键点/n,损失/n,函数/n,中/f,的/u,代码/n,，/w,带来/v,不必要/v,的/u,意外/a,）/w,。/w,2/m,、/w,服装/n,关键点/n,标注/v,有/v,了/u,这些/r,基础/n,，/w,我们/r,以/p,天池/ns,的/u,服饰/n,关键点/n,定位/vn,数据/n,为/p,例/n,，/w,看/v,一/m,看/v,如何/r,设计/vn,dataset/en, ,class/en,。/w,具体/a,数据/n,说明/v,自行/d,查阅/v,上面/f,说明/v,，/w,本节/t,重点/n,在/p,介绍/v,mask/en, ,rcnn/en,关键点/n,加测/nw,思路/n,而/c,非/h,数据/n,本身/r,，/w,其/r,文档/n,如下/v,，/w,我们/r,设计/vn,的/u,dataset/en, ,class/en,（/w,见/v,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,训练/vn,网络/n,其一/r,：/w,数据集/nw,与/p,dataset/en,类/q,）/w,目的/n,就/d,是/v,基于/p,文档/n,信息/n,为/p,网络结构/l,输送/v,数据/n,。/w,a/en,、/w,服装/n,类别/n,和/c,mask/en, ,rcnn/en,值得/v,注意/v,的/u,是/v,，/w,mask/en, ,rcnn/en,的/u,分类/vn,、/w,检测/vn,、/w,mask/en,生成/vn,任务/n,都/d,是/v,多/a,分类/vn,，/w,但是/c,关键点/n,识别/v,由于/c,其/r,本身/r,难度/n,更/d,高/a,（/w,一个/m,类别/n,有/v,众多/m,关键点/n,，/w,不同/a,类别/n,关键点/n,类型/n,之间/f,关系/n,不/d,大/a,甚至/d,完全/ad,不同/a,）/w,，/w,所以/c,建议/n,每/r,一个/m,大/a,类/q,单独/d,训练/vn,一个/m,model/en,检测/vn,其/r,关键点/n,，/w,实际上/d,pose/en,关键点/n,检测/vn,对应/v,过来/v,就/d,是/v,：/w,检测/vn,person/en,这/r,一个/m,类/q,的/u,框/q,、/w,mask/en,，/w,以及/c,每/r,一个/m,instance/en,（/w,每/r,一个/m,人/n,）/w,的/u,不同/a,部位/n,的/u,关键点/n,，/w,实际/n,的/u,class/en,分类/vn,值/n,有/v,person/en,和/c,背景/n,两个类/mq,。/w,对应/v,到/v,服饰/n,数据集/nw,，/w,我们/r,需要/v,训练/vn,5次/mq,，/w,对/p,框/q,应/v,五种/mq,服装/n,。/w,b/en,、/w,服装/n,检测框/nw,服装/n,数据/n,标注/v,仅/d,有/v,关键点/n,，/w,但是/c,检测框/nw,对于/p,mask/en, ,rcnn/en,来说/u,是/v,必要/a,的/u,，/w,因为/c,rpn/en,网络/n,需要/v,它/r,（/w,rpn/en,之后/f,的/u,回归/v,网络/n,分支/n,可以/v,注释/vn,掉/v,，/w,但是/c,rpn/en,是/v,网络/n,的/u,主干/n,部分/n,，/w,不能/v,注释/vn,）/w,，/w,所以/c,我们/r,采取/v,mask/en, ,rcnn/en,工程/n,的/u,检测框/nw,生成/vn,思路/n,，/w,利用/v,关键点/n,生成/vn,检测框/nw,，/w,由于/c,关键点/n,未必/d,在/p,服装/n,边缘/n,（/w,一般/a,是/v,在/p,的/u,）/w,，/w,我们/r,的/u,检测/vn,框取/nw,大/a,一点/m,，/w,尽量/d,完全/ad,包含/v,服装/n,，/w,下面/f,的/u,函数/n,见/v,utils/en,./w,py/en,脚本/n,（/w,暂/d,不/d,涉及/v,这个/r,函数/n,，/w,只是/d,说/v,到/v,了/u,贴/v,上来/v,而已/y,）/w,。/w,def/en, ,extract/en,_,keypoint/en,_,bboxes/en,(/w,keypoints/en,,/w, ,image/en,_,size/en,)/w,:/w, ,"/w,"/w,"/w, ,:/w,param/en, ,keypoints/en,:/w, ,[/w,instances/en,,/w, ,keypoints/en,_,per/en,_,instance/en,,/w, ,3/m,]/w, ,:/w,param/en, ,image/en,_,size/en,:/w, ,[/w,w/en,,/w, ,h/en,]/w, ,:/w,return/en,:/w, ,"/w,"/w,"/w, ,bboxes/en, ,=/w, ,np/en,./w,zeros/en,(/w,[/w,keypoints/en,./w,shape/en,[/w,0/m,]/w,,/w, ,4/m,]/w,,/w, ,dtype/en,=/w,np/en,./w,int/en,32/m,)/w, ,for/en, ,i/en, ,in/en, ,range/en,(/w,keypoints/en,./w,shape/en,[/w,0/m,]/w,)/w,:/w, ,x/en, ,=/w, ,keypoints/en,[/w,i/en,,/w, ,:/w,,/w, ,0/m,]/w,[/w,keypoints/en,[/w,i/en,,/w, ,:/w,,/w, ,0/m,]/w,>,0/m,]/w, ,y/en, ,=/w, ,keypoints/en,[/w,i/en,,/w, ,:/w,,/w, ,1/m,]/w,[/w,keypoints/en,[/w,i/en,,/w, ,:/w,,/w, ,1/m,]/w,>,0/m,]/w, ,x/en,1/m, ,=/w, ,x/en,./w,min/en,(/w,)/w,-/w,10/m, ,if/en, ,x/en,./w,min/en,(/w,)/w,-/w,10/m,>,0/m, ,else/en, ,0/m, ,y/en,1/m, ,=/w, ,y/en,./w,min/en,(/w,)/w,-/w,10/m, ,if/en, ,y/en,./w,min/en,(/w,)/w,-/w,10/m,>,0/m, ,else/en, ,0/m, ,x/en,2/m, ,=/w, ,x/en,./w,max/en,(/w,)/w,+/w,11/m, ,if/en, ,x/en,./w,max/en,(/w,)/w,+/w,11/m,</w,image/en,_,size/en,[/w,0/m,]/w, ,else/en, ,image/en,_,size/en,[/w,0/m,]/w, ,y/en,2/m, ,=/w, ,y/en,./w,max/en,(/w,)/w,+/w,11/m, ,if/en, ,y/en,./w,max/en,(/w,)/w,+/w,11/m,</w,image/en,_,size/en,[/w,1/m,]/w, ,else/en, ,image/en,_,size/en,[/w,1/m,]/w, ,bboxes/en,[/w,i/en,]/w, ,=/w, ,np/en,./w,array/en,(/w,[/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,]/w,,/w, ,np/en,./w,int/en,32/m,)/w, ,return/en, ,bboxesc/en,、/w,mask/en,说明/v,服装/n,数据/n,是/v,没有/v,mask/en,信息/n,的/u,，/w,按照/p,mask/en, ,rcnn/en,论文/n,的/u,说法/n,，/w,掩码/nw,使用/v,关键点/n,位置/n,为/p,1/m,其他/r,位置/n,为/p,0/m,的/u,形式/n,即可/v,，/w,感觉/n,不/d,太/d,靠谱/nw,，/w,而/c,在/p,coco/en,数据集/nw,里/f,（/w,即/v,本文/r,参考/v,工程/n,mask/en,_,rcnn/en,_,humanpose/en,）/w,，/w,掩码/nw,信息/n,使用/v,的/u,是/v,人/n,的/u,掩码/nw,（/w,见/v,下/f,图/n,）/w,，/w,我/r,在/p,dataset/en, ,class/en,中/f,生成/vn,了/u,掩码/nw,信息/n,作为/v,演示/vn,，/w,在/p,build/en,网络/n,中/f,取消/v,了/u,mask/en,分支/n,，/w,下/f,图/n,摘自/v,李沐/nr,博士/n,的/u,《/w,手动/b,学习/v,深度/n,学习/v,》/w,，/w,可以/v,很/d,直观/a,的/u,理解/v,我们/r,为什么/r,可以/v,把/p,mask/en,分支/n,取消/v,掉/v,。/w,3/m,、/w,class/en, ,fidataset/en,正如/v,dataset/en,注释/vn,所/u,说/v,，/w,要/v,想/v,运行/vn,自己/r,的/u,数据集/nw,，/w,我们/r,首先/d,要/v,实现/v,一个/m,方法/n,（/w,load/en,_,shapes/en,，/w,根据/p,数据集/nw,取名/v,即可/v,）/w,收集/v,原始/a,图像/n,、/w,类别/n,信息/n,，/w,然后/c,实现/v,两个/m,方法/n,（/w,load/en,_,image/en,、/w,load/en,_,mask/en,）/w,分别/d,实现/v,获取/v,单/d,张/q,图片/n,数据/n,、/w,获取/v,单/d,张/q,图片/n,对应/v,的/u,objs/en,的/u,masks/en,和/c,classes/en,，/w,这样/r,基本/a,完成/v,了/u,数据集/nw,类/q,的/u,构建/v,。/w,对于/p,本/r,数据集/nw,，/w,我们/r,使用/v,load/en,_,fi/en,方法/n,代替/v,load/en,_,shapes/en,，/w,调用/v,self/en,./w,add/en,_,class/en,和/c,self/en,./w,add/en,_,image/en,，/w,记录/v,图片/n,、/w,类别/n,信息/n,父/ng,类/q,的/u,load/en,_,image/en,会/v,去/v,读/v,取/v,self/en,./w,image/en,_,info/en,中/f,每张/r,图片/n,的/u,"/w,path/en,"/w,路径/n,，/w,载入/v,图片/n,，/w,我们/r,不必/d,重写/v,，/w,保证/v,在/p,load/en,_,fi/en,中/f,录入/v,了/u,即可/v,load/en,_,mask/en,被/p,load/en,_,keupoints/en,取代/v,（/w,mask/en,_,rcnn/en,_,humanpose/en,做/v,了/u,这个/r,改动/v,，/w,并/c,已经/d,捋顺/nw,了/u,相关/v,调用/v,）/w,，/w,其/r,注释/vn,如下/v,，/w,我们/r,不/d,需要/v,mask/en,信息/n,，/w,返回/v,none/en,占位/v,即可/v,，/w,后面/f,需要/v,将/d,网络/n,中/f,有关/vn,mask/en,信息/n,的/u,调用/v,注释/vn,处理/v,掉/v,，/w,这里/r,先/d,不/d,介绍/v,：/w,"/w,"/w,"/w,returns/en,:/w,key/en,_,points/en,:/w, ,num/en,_,keypoints/en, ,coordinates/en, ,and/en, ,visibility/en, ,(/w,x/en,,/w,y/en,,/w,v/en,)/w, ,[/w,num/en,_,person/en,,/w,num/en,_,keypoints/en,,/w,3/m,]/w, ,of/en, ,num/en,_,personmasks/en,:/w, ,a/en, ,bool/en, ,array/en, ,of/en, ,shape/en, ,[/w,height/en,,/w, ,width/en,,/w, ,instance/en, ,count/en,]/w, ,withone/en, ,mask/en, ,per/en, ,instance/en,./w,class/en,_,ids/en,:/w, ,a/en, ,1/m,d/en, ,array/en, ,of/en, ,class/en, ,ids/en, ,of/en, ,the/en, ,instance/en, ,masks/en,,/w, ,here/en, ,is/en, ,always/en, ,equal/en, ,to/en, ,[/w,num/en,_,person/en,,/w, ,1/m,]/w,"/w,"/w,"/w,至此/d,我们/r,介绍/v,了/u,dataset/en, ,class/en,的/u,目的/n,，/w,下面/f,给/p,出/v,实现/v,见/v,fi/en,_,train/en,./w,py/en, ,，/w,由于/c,训练/vn,时/ng,需要/v,验证/vn,集/vg,，/w,而/c,我/r,截至/v,撰文/v,时/ng,没有/v,实现/v,验证/vn,集/vg,划分/v,（/w,用/p,训练/vn,集/vg,冒充/v,验证/vn,集/vg,）/w,，/w,所以/c,load/en,_,fi/en,的/u,参数/n,train/en,_,data/en,没有/v,意义/n,，/w,更新/v,会/v,在/p,github/en,上/f,进行/v,，/w,后续/vn,本文/r,不予/v,修改/v,：/w,class/en, ,fidataset/en,(/w,utils/en,./w,dataset/en,)/w,:/w, ,"/w,"/w,"/w,generates/en, ,the/en, ,shapes/en, ,synthetic/en, ,dataset/en,./w, ,the/en, ,dataset/en, ,consists/en, ,of/en, ,simple/en, ,shapes/en, ,(/w,triangles/en,,/w, ,squares/en,,/w, ,circles/en,)/w, ,placed/en, ,randomly/en, ,on/en, ,a/en, ,blank/en, ,surface/en,./w, ,the/en, ,images/en, ,are/en, ,generated/en, ,on/en, ,the/en, ,fly/en,./w, ,no/en, ,file/en, ,access/en, ,required/en,./w, ,"/w,"/w,"/w, ,def/en, ,load/en,_,fi/en,(/w,self/en,,/w, ,train/en,_,data/en,=/w,true/en,)/w,:/w, ,"/w,"/w,"/w,generate/en, ,the/en, ,requested/en, ,number/en, ,of/en, ,synthetic/en, ,images/en,./w, ,count/en,:/w, ,number/en, ,of/en, ,images/en, ,to/en, ,generate/en,./w, ,height/en,,/w, ,width/en,:/w, ,the/en, ,size/en, ,of/en, ,the/en, ,generated/en, ,images/en,./w, ,"/w,"/w,"/w, ,if/en, ,train/en,_,data/en,:/w, ,csv/en,_,data/en, ,=/w, ,pd/en,./w,concat/en,(/w,[/w,pd/en,./w,read/en,_,csv/en,(/w,'/w,./w,./w,//w,keypoint/en,_,data/en,//w,train/en,1/m,./w,csv/en,'/w,)/w,,/w, ,pd/en,./w,read/en,_,csv/en,(/w,'/w,./w,./w,//w,keypoint/en,_,data/en,//w,train/en,2/m,./w,csv/en,'/w,)/w,]/w,,/w, ,axis/en,=/w,0/m,,/w, ,ignore/en,_,index/en,=/w,true/en, ,#, ,忽略/v,索引/n,表示/v,不/d,会/v,直接/ad,拼/v,接/v,索引/n,，/w,会/v,重新/d,计算/v,行数/n,索引/n, ,)/w, ,class/en,_,data/en, ,=/w, ,csv/en,_,data/en,[/w,csv/en,_,data/en,./w,image/en,_,category/en,./w,isin/en,(/w,[/w,'/w,blouse/en,'/w,]/w,)/w,]/w, ,#, ,add/en, ,classes/en, ,self/en,./w,add/en,_,class/en,(/w,source/en,=/w,"/w,fi/en,"/w,,/w, ,class/en,_,id/en,=/w,1/m,,/w, ,class/en,_,name/en,=/w,'/w,blouse/en,'/w,)/w, ,#, ,add/en, ,images/en, ,for/en, ,i/en, ,in/en, ,range/en,(/w,class/en,_,data/en,./w,shape/en,[/w,0/m,]/w,)/w,:/w, ,annotation/en, ,=/w, ,class/en,_,data/en,./w,iloc/en,[/w,i/en,]/w, ,img/en,_,path/en, ,=/w, ,os/en,./w,path/en,./w,join/en,(/w,"/w,./w,./w,//w,keypoint/en,_,data/en,"/w,,/w, ,annotation/en,./w,image/en,_,id/en,)/w, ,keypoints/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,p/en,./w,split/en,(/w,'/w,_,'/w,)/w, ,for/en, ,p/en, ,in/en, ,class/en,_,data/en,./w,iloc/en,[/w,i/en,]/w,[/w,2/m,:/w,]/w,]/w,,/w, ,dtype/en,=/w,int/en,)/w,[/w,part/en,_,index/en,[/w,image/en,_,category/en,]/w,,/w, ,:/w,]/w, ,keypoints/en,[/w,:/w,,/w, ,-/w,1/m,]/w, ,+/w,=/w, ,1/m, ,self/en,./w,add/en,_,image/en,(/w,source/en,=/w,"/w,fi/en,"/w,,/w, ,image/en,_,id/en,=/w,i/en,,/w, ,path/en,=/w,img/en,_,path/en,,/w, ,annotations/en,=/w,keypoints/en,)/w, ,def/en, ,load/en,_,keypoints/en,(/w,self/en,,/w, ,image/en,_,id/en,,/w, ,with/en,_,mask/en,=/w,true/en,)/w,:/w, ,"/w,"/w,"/w, ,returns/en,:/w, ,key/en,_,points/en,:/w, ,num/en,_,keypoints/en, ,coordinates/en, ,and/en, ,visibility/en, ,(/w,x/en,,/w,y/en,,/w,v/en,)/w, ,[/w,num/en,_,person/en,,/w,num/en,_,keypoints/en,,/w,3/m,]/w, ,of/en, ,num/en,_,person/en, ,masks/en,:/w, ,a/en, ,bool/en, ,array/en, ,of/en, ,shape/en, ,[/w,height/en,,/w, ,width/en,,/w, ,instance/en, ,count/en,]/w, ,with/en, ,one/en, ,mask/en, ,per/en, ,instance/en,./w, ,class/en,_,ids/en,:/w, ,a/en, ,1/m,d/en, ,array/en, ,of/en, ,class/en, ,ids/en, ,of/en, ,the/en, ,instance/en, ,masks/en,,/w, ,here/en, ,is/en, ,always/en, ,equal/en, ,to/en, ,[/w,num/en,_,person/en,,/w, ,1/m,]/w, ,"/w,"/w,"/w, ,key/en,_,points/en, ,=/w, ,np/en,./w,expand/en,_,dims/en,(/w,self/en,./w,image/en,_,info/en,[/w,image/en,_,id/en,]/w,[/w,"/w,annotations/en,"/w,]/w,,/w, ,0/m,)/w, ,#, ,已知/nz,图中/nrf,仅/d,有/v,一个/m,对象/n, ,class/en,_,ids/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,1/m,]/w,)/w, ,if/en, ,with/en,_,mask/en,:/w, ,annotations/en, ,=/w, ,self/en,./w,image/en,_,info/en,[/w,image/en,_,id/en,]/w,[/w,"/w,annotations/en,"/w,]/w, ,w/en,,/w, ,h/en, ,=/w, ,image/en,_,size/en,(/w,self/en,./w,image/en,_,info/en,[/w,image/en,_,id/en,]/w,[/w,"/w,path/en,"/w,]/w,)/w, ,mask/en, ,=/w, ,np/en,./w,zeros/en,(/w,[/w,w/en,,/w, ,h/en,]/w,,/w, ,dtype/en,=/w,int/en,)/w, ,mask/en,[/w,annotations/en,[/w,:/w,,/w, ,1/m,]/w,,/w, ,annotations/en,[/w,:/w,,/w, ,0/m,]/w,]/w, ,=/w, ,1/m, ,return/en, ,key/en,_,points/en,./w,copy/en,(/w,)/w,,/w, ,np/en,./w,expand/en,_,dims/en,(/w,mask/en,,/w, ,-/w,1/m,)/w,,/w, ,class/en,_,ids/en, ,return/en, ,key/en,_,points/en,./w,copy/en,(/w,)/w,,/w, ,none/en,,/w, ,class/en,_,ids/en,二/m,、/w,数据/n,类/q,读取/v,为了/p,验证/vn,数据/n,类/q,构建/v,的/u,正确性/n,，/w,我们/r,可以/v,直接/ad,调用/v,接口/n,model/en,./w,py/en,中/f,的/u,load/en,_,image/en,_,gt/en,_,keypoints/en,获取/v,original/en,_,image/en,,/w, ,image/en,_,meta/en,,/w, ,gt/en,_,class/en,_,id/en,,/w, ,gt/en,_,bbox/en,,/w, ,gt/en,_,keypoint/en,等/u,信息/n,，/w,实际上/d,在/p,真正/d,的/u,训练/vn,中/f,，/w,程序/n,也/d,是/v,通过/p,这个/r,函数/n,完成/v,dataset/en, ,class/en,中/f,的/u,数据/n,到/v,model/en,模型/n,之间/f,的/u,传递/v,。/w,def/en, ,load/en,_,image/en,_,gt/en,_,keypoints/en,(/w,dataset/en,,/w, ,config/en,,/w, ,image/en,_,id/en,,/w, ,augment/en,=/w,true/en,,/w,use/en,_,mini/en,_,mask/en,=/w,false/en,)/w,:/w,"/w,"/w,"/w,load/en, ,and/en, ,return/en, ,ground/en, ,truth/en, ,data/en, ,for/en, ,an/en, ,image/en, ,(/w,image/en,,/w, ,keypoint/en,_,mask/en,,/w, ,keypoint/en,_,weight/en,,/w, ,mask/en,,/w, ,bounding/en, ,boxes/en,)/w,./w,augment/en,:/w, ,if/en, ,true/en,,/w, ,apply/en, ,random/en, ,image/en, ,augmentation/en,./w, ,currently/en,,/w, ,onlyhorizontal/en, ,flipping/en, ,is/en, ,offered/en,./w,use/en,_,mini/en,_,mask/en,:/w, ,if/en, ,false/en,,/w, ,returns/en, ,full/en,-/w,size/en, ,masks/en, ,and/en, ,keypoints/en, ,that/en, ,are/en, ,the/en, ,same/en, ,heightand/en, ,width/en, ,as/en, ,the/en, ,original/en, ,image/en,./w, ,these/en, ,can/en, ,be/en, ,big/en,,/w, ,for/en, ,example/en,1024/m,x/en,1024/m,x/en,100/m, ,(/w,for/en, ,100/m, ,instances/en,)/w,./w, ,mini/en, ,masks/en, ,are/en, ,smaller/en,,/w, ,typically/en,,/w,224/m,x/en,224/m, ,and/en, ,are/en, ,generated/en, ,by/en, ,extracting/en, ,the/en, ,bounding/en, ,box/en, ,of/en, ,theobject/en, ,and/en, ,resizing/en, ,it/en, ,to/en, ,mini/en,_,mask/en,_,shape/en,./w,returns/en,:/w,image/en,:/w, ,[/w,height/en,,/w, ,width/en,,/w, ,3/m,]/w,shape/en,:/w, ,the/en, ,original/en, ,shape/en, ,of/en, ,the/en, ,image/en, ,before/en, ,resizing/en, ,and/en, ,cropping/en,./w,keypoints/en,:/w,[/w,num/en,_,person/en,,/w, ,num/en,_,keypoint/en,,/w, ,3/m,]/w, ,(/w,x/en,,/w, ,y/en,,/w, ,v/en,)/w, ,v/en, ,value/en, ,is/en, ,as/en, ,belows/en,:/w,0/m,:/w, ,not/en, ,visible/en, ,and/en, ,without/en, ,annotations/en,1/m,:/w, ,not/en, ,visible/en, ,but/en, ,with/en, ,annotations/en,2/m,:/w, ,visible/en, ,and/en, ,with/en, ,annotationsclass/en,_,ids/en,:/w, ,[/w,instance/en,_,count/en,]/w, ,integer/en, ,class/en, ,idsbbox/en,:/w, ,[/w,instance/en,_,count/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w,mask/en,:/w, ,[/w,height/en,,/w, ,width/en,,/w, ,instance/en,_,count/en,]/w,./w, ,the/en, ,height/en, ,and/en, ,width/en, ,are/en, ,thoseof/en, ,the/en, ,image/en, ,unless/en, ,use/en,_,mini/en,_,mask/en, ,is/en, ,true/en,,/w, ,in/en, ,which/en, ,case/en, ,they/en, ,aredefined/en, ,in/en, ,mini/en,_,mask/en,_,shape/en,./w,"/w,"/w,"/w,在/p,visualize/en,./w,py/en,模块/n,中/f,，/w,函数/n,display/en,_,keypoints/en,可以/v,对接/v,上面/f,函数/n,的/u,输出/v,，/w,直接/ad,可视化/nz,dataset/en, ,class/en,经由/p,load/en,_,image/en,_,gt/en,_,keypoints/en,提取/v,的/u,结果/n,（/w,当然/d,，/w,并/c,不/d,是/v,直接/ad,提取/v,，/w,该/r,函数/n,实际上/d,进行/v,了/u,一系列/mq,的/u,图像/n,预/d,处理/v,，/w,这/r,也/d,增加/v,了/u,我们/r,可视化/nz,验证/vn,正确性/n,的/u,必要/a,）/w,，/w,流程/n,代码/n,如下/v,，/w,见/v,fi/en,_,train/en,./w,py/en,：/w,config/en, ,=/w, ,ficonfig/en,(/w,)/w, ,import/en, ,visualize/en, ,from/en, ,model/en, ,import/en, ,log/en, ,dataset/en, ,=/w, ,fidataset/en,(/w,)/w, ,dataset/en,./w,load/en,_,fi/en,(/w,)/w, ,dataset/en,./w,prepare/en,(/w,)/w, ,original/en,_,image/en,,/w, ,image/en,_,meta/en,,/w, ,gt/en,_,class/en,_,id/en,,/w, ,gt/en,_,bbox/en,,/w, ,gt/en,_,keypoint/en, ,=/w,\/w, ,modellib/en,./w,load/en,_,image/en,_,gt/en,_,keypoints/en,(/w,dataset/en,,/w, ,ficonfig/en,,/w, ,0/m,)/w, ,log/en,(/w,"/w,original/en,_,image/en,"/w,,/w, ,original/en,_,image/en,)/w, ,log/en,(/w,"/w,image/en,_,meta/en,"/w,,/w, ,image/en,_,meta/en,)/w, ,log/en,(/w,"/w,gt/en,_,class/en,_,id/en,"/w,,/w, ,gt/en,_,class/en,_,id/en,)/w, ,log/en,(/w,"/w,gt/en,_,bbox/en,"/w,,/w, ,gt/en,_,bbox/en,)/w, ,log/en,(/w,"/w,gt/en,_,keypoint/en,"/w,,/w, ,gt/en,_,keypoint/en,)/w, ,visualize/en,./w,display/en,_,keypoints/en,(/w,original/en,_,image/en,,/w,gt/en,_,bbox/en,,/w,gt/en,_,keypoint/en,,/w,gt/en,_,class/en,_,id/en,,/w,dataset/en,./w,class/en,_,names/en,)/w,输出/v,图片/n,见/v,下/f,，/w,可以/v,明确/ad,的/u,看见/v,至少/d,进行/v,了/u,padding/en,个/q,flip/en,两个/m,预处理/vn,，/w,并非/v,重点/n,，/w,不/d,提/v,：/w,实现/v,了/u,自己/r,的/u,dataset/en, ,class/en,之后/f,，/w,使用/v,model/en,./w,load/en,_,image/en,_,gt/en,_,keypoints/en,和/c,visualize/en,./w,display/en,_,keypoints/en,进行/v,验证/vn,，/w,保证/v,dataset/en, ,class/en,的/u,正确性/n,。/w,三/m,、/w,修改/v,及/c,运行/vn,模型/n,1/m,、/w,运行/vn,模型/n,步骤/n,data/en,_,tra/en, ,=/w, ,fidataset/en,(/w,)/w, ,data/en,_,tra/en,./w,load/en,_,fi/en,(/w,)/w, ,data/en,_,tra/en,./w,prepare/en,(/w,)/w, ,data/en,_,val/en, ,=/w, ,fidataset/en,(/w,)/w, ,data/en,_,val/en,./w,load/en,_,fi/en,(/w,)/w, ,data/en,_,val/en,./w,prepare/en,(/w,)/w, ,model/en, ,=/w, ,modellib/en,./w,maskrcnn/en,(/w,mode/en,=/w,'/w,training/en,'/w,,/w, ,config/en,=/w,config/en,,/w, ,model/en,_,dir/en,=/w,'/w,./w,//w,'/w,)/w, ,model/en,./w,load/en,_,weights/en,(/w,'/w,./w,//w,mask/en,_,rcnn/en,_,coco/en,./w,h/en,5/m,'/w,,/w, ,by/en,_,name/en,=/w,true/en,,/w, ,exclude/en,=/w,[/w,"/w,mrcnn/en,_,class/en,_,logits/en,"/w,,/w, ,"/w,mrcnn/en,_,bbox/en,_,fc/en,"/w,,/w, ,"/w,mrcnn/en,_,bbox/en,"/w,,/w, ,"/w,mrcnn/en,_,mask/en,"/w,]/w,)/w, ,model/en,./w,train/en,(/w,data/en,_,tra/en,,/w, ,data/en,_,val/en,,/w, ,learning/en,_,rate/en,=/w,config/en,./w,learning/en,_,rate/en,//w,10/m,,/w, ,epochs/en,=/w,400/m,,/w, ,layers/en,=/w,'/w,heads/en,'/w,)/w,2/m,、/w,网络/n,细节/n,修改/v,服装/n,关键点/n,和/c,humanpose/en,数据/n,最/d,大/a,的/u,不同/a,就/d,在于/v,我们/r,没有/v,mask/en,掩码/nw,数据/n,，/w,所以/c,我们/r,需要/v,对/p,原/b,model/en,进行/v,修改/v,，/w,取消/v,掉/v,设计/vn,mask/en,的/u,分支/n,（/w,注意/v,指/v,的/u,是/v,humanpose/en,代码/n,，/w,而/c,非/h,原版/n,的/u,mask/en, ,rcnn/en,，/w,那个/r,改动/v,起来/v,变化/vn,太/d,大/a,：/w,1/m,、/w,需要/v,添加/vn,keypoint/en,标注/v,数据/n,的/u,整个/b,预/d,处理/v,分支/n,；/w,2/m,、/w,需要/v,实现/v,model/en,有关/vn,keypoint/en,的/u,损失/n,函数/n,在内/u,的/u,全部/m,处理/v,步骤/n,）/w,。/w,下面/f,给/p,出/v,修改/v,之后/f,的/u,build/en,方法/n,，/w,由于/c,mask/en, ,rcnn/en,将/d,各个/r,分支/n,损失/n,函数/n,直接/ad,相加/v,，/w,所以/c,我们/r,直接/ad,注释/vn,掉/v,mask/en,分支/n,即可/v,，/w,不/d,会/v,影响/vn,代码/n,逻辑/n,（/w,程序/n,可以/v,直接/ad,正常/a,运行/vn,）/w,。/w,def/en, ,build/en,(/w,self/en,,/w, ,mode/en,,/w, ,config/en,)/w,:/w, ,"/w,"/w,"/w,build/en, ,mask/en, ,r/en,-/w,cnn/en, ,architecture/en,./w, ,input/en,_,shape/en,:/w, ,the/en, ,shape/en, ,of/en, ,the/en, ,input/en, ,image/en,./w, ,mode/en,:/w, ,either/en, ,"/w,training/en,"/w, ,or/en, ,"/w,inference/en,"/w,./w, ,the/en, ,inputs/en, ,and/en, ,outputs/en, ,of/en, ,the/en, ,model/en, ,differ/en, ,accordingly/en,./w, ,"/w,"/w,"/w, ,assert/en, ,mode/en, ,in/en, ,[/w,'/w,training/en,'/w,,/w, ,'/w,inference/en,'/w,]/w, ,#, ,image/en, ,size/en, ,must/en, ,be/en, ,dividable/en, ,by/en, ,2/m, ,multiple/en, ,times/en, ,h/en,,/w, ,w/en, ,=/w, ,config/en,./w,image/en,_,shape/en,[/w,:/w,2/m,]/w, ,if/en, ,h/en, ,//w, ,2/m,*/w,*/w,6/m, ,!/w,=/w, ,int/en,(/w,h/en, ,//w, ,2/m,*/w,*/w,6/m,)/w, ,or/en, ,w/en, ,//w, ,2/m,*/w,*/w,6/m, ,!/w,=/w, ,int/en,(/w,w/en, ,//w, ,2/m,*/w,*/w,6/m,)/w,:/w, ,raise/en, ,exception/en,(/w,"/w,image/en, ,size/en, ,must/en, ,be/en, ,dividable/en, ,by/en, ,2/m, ,at/en, ,least/en, ,6/m, ,times/en, ,"/w, ,"/w,to/en, ,avoid/en, ,fractions/en, ,when/en, ,downscaling/en, ,and/en, ,upscaling/en,./w,"/w, ,"/w,for/en, ,example/en,,/w, ,use/en, ,256/m,,/w, ,320/m,,/w, ,384/m,,/w, ,448/m,,/w, ,512/m,,/w, ,./w,./w,./w, ,etc/en,./w, ,"/w,)/w, ,#, ,inputs/en, ,input/en,_,image/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,config/en,./w,image/en,_,shape/en,./w,tolist/en,(/w,)/w,,/w, ,name/en,=/w,"/w,input/en,_,image/en,"/w,)/w, ,input/en,_,image/en,_,meta/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,image/en,_,meta/en,"/w,)/w, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,#, ,rpn/en, ,gt/en, ,input/en,_,rpn/en,_,match/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,1/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,rpn/en,_,match/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,input/en,_,rpn/en,_,bbox/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,rpn/en,_,bbox/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,detection/en, ,gt/en, ,(/w,class/en, ,ids/en,,/w, ,bounding/en, ,boxes/en,,/w, ,and/en, ,masks/en,)/w, ,#, ,1/m,./w, ,gt/en, ,class/en, ,ids/en, ,(/w,zero/en, ,padded/en,)/w, ,input/en,_,gt/en,_,class/en,_,ids/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,class/en,_,ids/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,#, ,2/m,./w, ,gt/en, ,boxes/en, ,in/en, ,pixels/en, ,(/w,zero/en, ,padded/en,)/w, ,#, ,[/w,batch/en,,/w, ,max/en,_,gt/en,_,instances/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,image/en, ,coordinates/en, ,input/en,_,gt/en,_,boxes/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,boxes/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,normalize/en, ,coordinates/en, ,h/en,,/w, ,w/en, ,=/w, ,k/en,./w,shape/en,(/w,input/en,_,image/en,)/w,[/w,1/m,]/w,,/w, ,k/en,./w,shape/en,(/w,input/en,_,image/en,)/w,[/w,2/m,]/w, ,image/en,_,scale/en, ,=/w, ,k/en,./w,cast/en,(/w,k/en,./w,stack/en,(/w,[/w,h/en,,/w, ,w/en,,/w, ,h/en,,/w, ,w/en,]/w,,/w, ,axis/en,=/w,0/m,)/w,,/w, ,tf/en,./w,float/en,32/m,)/w, ,gt/en,_,boxes/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en, ,//w, ,image/en,_,scale/en,,/w,name/en,=/w,"/w,gt/en,_,boxes/en,"/w,)/w,(/w,input/en,_,gt/en,_,boxes/en,)/w, ,keypoint/en,_,scale/en, ,=/w, ,k/en,./w,cast/en,(/w,k/en,./w,stack/en,(/w,[/w,w/en,,/w, ,h/en,,/w, ,1/m,]/w,,/w, ,axis/en,=/w,0/m,)/w,,/w, ,tf/en,./w,float/en,32/m,)/w, ,input/en,_,gt/en,_,keypoints/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,none/en,,/w, ,config/en,./w,num/en,_,keypoints/en,,/w, ,3/m,]/w,)/w, ,gt/en,_,keypoints/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en, ,//w, ,keypoint/en,_,scale/en,,/w, ,name/en,=/w,"/w,gt/en,_,keypoints/en,"/w,)/w,(/w,input/en,_,gt/en,_,keypoints/en,)/w, ,#, ,3/m,./w, ,gt/en, ,masks/en, ,(/w,zero/en, ,padded/en,)/w, ,#, ,[/w,batch/en,,/w, ,height/en,,/w, ,width/en,,/w, ,max/en,_,gt/en,_,instances/en,]/w, ,#, ,if/en, ,config/en,./w,use/en,_,mini/en,_,mask/en,:/w, ,#, ,input/en,_,gt/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,#, ,shape/en,=/w,[/w,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,0/m,]/w,,/w, ,#, ,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,]/w,,/w, ,#, ,name/en,=/w,"/w,input/en,_,gt/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,#, ,#, ,input/en,_,gt/en,_,keypoint/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,#, ,#, ,shape/en,=/w,[/w,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,0/m,]/w,,/w, ,#, ,#, ,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,,/w, ,config/en,./w,num/en,_,keypoints/en,]/w,,/w, ,#, ,#, ,name/en,=/w,"/w,input/en,_,gt/en,_,keypoint/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,#, ,else/en,:/w, ,#, ,input/en,_,gt/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,#, ,shape/en,=/w,[/w,config/en,./w,image/en,_,shape/en,[/w,0/m,]/w,,/w, ,config/en,./w,image/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,]/w,,/w, ,#, ,name/en,=/w,"/w,input/en,_,gt/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,#, ,input/en,_,gt/en,_,keypoint/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,#, ,shape/en,=/w,[/w,config/en,./w,image/en,_,shape/en,[/w,0/m,]/w,,/w, ,config/en,./w,image/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,,/w, ,config/en,./w,num/en,_,keypoints/en,]/w,,/w, ,#, ,name/en,=/w,"/w,input/en,_,gt/en,_,keypoint/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,#, ,input/en,_,gt/en,_,keypoint/en,_,weigths/en, ,=/w, ,kl/en,./w,input/en,(/w, ,#, ,shape/en,=/w,[/w,none/en,,/w,config/en,./w,num/en,_,keypoints/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,keypoint/en,_,weights/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,#, ,build/en, ,the/en, ,shared/en, ,convolutional/en, ,layers/en,./w, ,#, ,bottom/en,-/w,up/en, ,layers/en, ,#, ,returns/en, ,a/en, ,list/en, ,of/en, ,the/en, ,last/en, ,layers/en, ,of/en, ,each/en, ,stage/en,,/w, ,5/m, ,in/en, ,total/en,./w, ,#, ,don/en,'/w,t/en, ,create/en, ,the/en, ,thead/en, ,(/w,stage/en, ,5/m,)/w,,/w, ,so/en, ,we/en, ,pick/en, ,the/en, ,4/m,th/en, ,item/en, ,in/en, ,the/en, ,list/en,./w, ,_,,/w, ,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m, ,=/w, ,resnet/en,_,graph/en,(/w,input/en,_,image/en,,/w, ,"/w,resnet/en,101/m,"/w,,/w, ,stage/en,5/m,=/w,true/en,)/w, ,#, ,top/en,-/w,down/en, ,layers/en, ,#, ,todo/en,:/w, ,add/en, ,assert/en, ,to/en, ,varify/en, ,feature/en, ,map/en, ,sizes/en, ,match/en, ,what/en,'/w,s/en, ,in/en, ,config/en, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,5/m,p/en,5/m,'/w,)/w,(/w,c/en,5/m,)/w, ,p/en,4/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,4/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,upsampled/en,"/w,)/w,(/w,p/en,5/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,4/m,p/en,4/m,'/w,)/w,(/w,c/en,4/m,)/w,]/w,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,3/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,upsampled/en,"/w,)/w,(/w,p/en,4/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,3/m,p/en,3/m,'/w,)/w,(/w,c/en,3/m,)/w,]/w,)/w, ,p/en,2/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,2/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,3/m,upsampled/en,"/w,)/w,(/w,p/en,3/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,2/m,p/en,2/m,'/w,)/w,(/w,c/en,2/m,)/w,]/w,)/w, ,#, ,attach/en, ,3/m,x/en,3/m, ,conv/en, ,to/en, ,all/en, ,p/en, ,layers/en, ,to/en, ,get/en, ,the/en, ,final/en, ,feature/en, ,maps/en,./w, ,p/en,2/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,2/m,"/w,)/w,(/w,p/en,2/m,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,3/m,"/w,)/w,(/w,p/en,3/m,)/w, ,p/en,4/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,"/w,)/w,(/w,p/en,4/m,)/w, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,p/en,6/m, ,is/en, ,used/en, ,for/en, ,the/en, ,5/m,th/en, ,anchor/en, ,scale/en, ,in/en, ,rpn/en,./w, ,generated/en, ,by/en, ,#, ,subsampling/en, ,from/en, ,p/en,5/m, ,with/en, ,stride/en, ,of/en, ,2/m,./w, ,p/en,6/m, ,=/w, ,kl/en,./w,maxpooling/en,2/m,d/en,(/w,pool/en,_,size/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,strides/en,=/w,2/m,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,6/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,note/en, ,that/en, ,p/en,6/m, ,is/en, ,used/en, ,in/en, ,rpn/en,,/w, ,but/en, ,not/en, ,in/en, ,the/en, ,classifier/en, ,heads/en,./w, ,rpn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,,/w, ,p/en,6/m,]/w, ,mrcnn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,]/w, ,#, ,generate/en, ,anchors/en, ,self/en,./w,anchors/en, ,=/w, ,utils/en,./w,generate/en,_,pyramid/en,_,anchors/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,scales/en,,/w, ,config/en,./w,rpn/en,_,anchor/en,_,ratios/en,,/w, ,config/en,./w,backbone/en,_,shapes/en,,/w, ,config/en,./w,backbone/en,_,strides/en,,/w, ,config/en,./w,rpn/en,_,anchor/en,_,stride/en,)/w, ,#, ,rpn/en, ,model/en, ,rpn/en, ,=/w, ,build/en,_,rpn/en,_,model/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,stride/en,,/w, ,len/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,ratios/en,)/w,,/w, ,256/m,)/w, ,#, ,loop/en, ,through/en, ,pyramid/en, ,layers/en, ,layer/en,_,outputs/en, ,=/w, ,[/w,]/w, ,#, ,list/en, ,of/en, ,lists/en, ,for/en, ,p/en, ,in/en, ,rpn/en,_,feature/en,_,maps/en,:/w, ,layer/en,_,outputs/en,./w,append/en,(/w,rpn/en,(/w,[/w,p/en,]/w,)/w,)/w, ,#, ,concatenate/en, ,layer/en, ,outputs/en, ,#, ,convert/en, ,from/en, ,list/en, ,of/en, ,lists/en, ,of/en, ,level/en, ,outputs/en, ,to/en, ,list/en, ,of/en, ,lists/en, ,#, ,of/en, ,outputs/en, ,across/en, ,levels/en,./w, ,#, ,e/en,./w,g/en,./w, ,[/w,[/w,a/en,1/m,,/w, ,b/en,1/m,,/w, ,c/en,1/m,]/w,,/w, ,[/w,a/en,2/m,,/w, ,b/en,2/m,,/w, ,c/en,2/m,]/w,]/w, ,=/w,>, ,[/w,[/w,a/en,1/m,,/w, ,a/en,2/m,]/w,,/w, ,[/w,b/en,1/m,,/w, ,b/en,2/m,]/w,,/w, ,[/w,c/en,1/m,,/w, ,c/en,2/m,]/w,]/w, ,output/en,_,names/en, ,=/w, ,[/w,"/w,rpn/en,_,class/en,_,logits/en,"/w,,/w, ,"/w,rpn/en,_,class/en,"/w,,/w, ,"/w,rpn/en,_,bbox/en,"/w,]/w, ,outputs/en, ,=/w, ,list/en,(/w,zip/en,(/w,*/w,layer/en,_,outputs/en,)/w,)/w, ,outputs/en, ,=/w, ,[/w,kl/en,./w,concatenate/en,(/w,axis/en,=/w,1/m,,/w, ,name/en,=/w,n/en,)/w,(/w,list/en,(/w,o/en,)/w,)/w, ,for/en, ,o/en,,/w, ,n/en, ,in/en, ,zip/en,(/w,outputs/en,,/w, ,output/en,_,names/en,)/w,]/w, ,rpn/en,_,class/en,_,logits/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en, ,=/w, ,outputs/en, ,#, ,generate/en, ,proposals/en, ,#, ,proposals/en, ,are/en, ,[/w,batch/en,,/w, ,n/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,normalized/en, ,coordinates/en, ,#, ,and/en, ,zero/en, ,padded/en,./w, ,proposal/en,_,count/en, ,=/w, ,config/en,./w,post/en,_,nms/en,_,rois/en,_,training/en, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,\/w, ,else/en, ,config/en,./w,post/en,_,nms/en,_,rois/en,_,inference/en, ,rpn/en,_,rois/en, ,=/w, ,proposallayer/en,(/w,proposal/en,_,count/en,=/w,proposal/en,_,count/en,,/w, ,nms/en,_,threshold/en,=/w,config/en,./w,rpn/en,_,nms/en,_,threshold/en,,/w, ,name/en,=/w,"/w,roi/en,"/w,,/w, ,anchors/en,=/w,self/en,./w,anchors/en,,/w, ,config/en,=/w,config/en,)/w,(/w,[/w,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,]/w,)/w, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,#, ,class/en, ,id/en, ,mask/en, ,to/en, ,mark/en, ,class/en, ,ids/en, ,supported/en, ,by/en, ,the/en, ,dataset/en, ,the/en, ,image/en, ,#, ,came/en, ,from/en,./w, ,_,,/w, ,_,,/w, ,_,,/w, ,active/en,_,class/en,_,ids/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,parse/en,_,image/en,_,meta/en,_,graph/en,(/w,x/en,)/w,,/w, ,mask/en,=/w,[/w,none/en,,/w, ,none/en,,/w, ,none/en,,/w, ,none/en,]/w,)/w,(/w,input/en,_,image/en,_,meta/en,)/w, ,if/en, ,not/en, ,config/en,./w,use/en,_,rpn/en,_,rois/en,:/w, ,#, ,ignore/en, ,predicted/en, ,rois/en, ,and/en, ,use/en, ,rois/en, ,provided/en, ,as/en, ,an/en, ,input/en,./w, ,input/en,_,rois/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,config/en,./w,post/en,_,nms/en,_,rois/en,_,training/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,roi/en,"/w,,/w, ,dtype/en,=/w,np/en,./w,int/en,32/m,)/w, ,#, ,normalize/en, ,coordinates/en, ,to/en, ,0/m,-/w,1/m, ,range/en,./w, ,target/en,_,rois/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,k/en,./w,cast/en,(/w, ,x/en,,/w, ,tf/en,./w,float/en,32/m,)/w, ,//w, ,image/en,_,scale/en,[/w,:/w,4/m,]/w,)/w,(/w,input/en,_,rois/en,)/w, ,else/en,:/w, ,target/en,_,rois/en, ,=/w, ,rpn/en,_,rois/en, ,#, ,generate/en, ,detection/en, ,targets/en, ,#, ,subsamples/en, ,proposals/en, ,and/en, ,generates/en, ,target/en, ,outputs/en, ,for/en, ,training/en, ,#, ,note/en, ,that/en, ,proposal/en, ,class/en, ,ids/en,,/w, ,gt/en,_,boxes/en, ,and/en, ,gt/en,_,masks/en, ,are/en, ,zero/en, ,#, ,padded/en,./w, ,equally/en,,/w, ,returned/en, ,rois/en, ,and/en, ,targets/en, ,are/en, ,zero/en, ,padded/en,./w, ,#,every/en, ,rois/en, ,corresond/en, ,to/en, ,one/en, ,target/en, ,#, ,rois/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,target/en,_,bbox/en,,/w, ,target/en,_,mask/en, ,=/w,\/w, ,#, ,detectiontargetlayer/en,(/w,config/en,,/w, ,name/en,=/w,"/w,proposal/en,_,targets/en,"/w,)/w,(/w,[/w, ,#, ,target/en,_,rois/en,,/w, ,input/en,_,gt/en,_,class/en,_,ids/en,,/w, ,gt/en,_,boxes/en,,/w, ,input/en,_,gt/en,_,masks/en,]/w,)/w, ,#, ,generate/en, ,detection/en, ,targets/en, ,#, ,subsamples/en, ,proposals/en, ,and/en, ,generates/en, ,target/en, ,outputs/en, ,for/en, ,training/en, ,#, ,note/en, ,that/en, ,proposal/en, ,class/en, ,ids/en,,/w, ,gt/en,_,boxes/en,,/w, ,gt/en,_,keypoint/en,_,masks/en, ,and/en, ,gt/en,_,keypoint/en,_,weights/en, ,are/en, ,zero/en, ,#, ,padded/en,./w, ,equally/en,,/w, ,returned/en, ,rois/en, ,and/en, ,targets/en, ,are/en, ,zero/en, ,padded/en,./w, ,rois/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,target/en,_,bbox/en,,/w, ,target/en,_,keypoint/en,,/w, ,target/en,_,keypoint/en,_,weight/en, ,=/w, ,\/w, ,detectionkeypointtargetlayer/en,(/w,config/en,,/w, ,name/en,=/w,"/w,proposal/en,_,targets/en,"/w,)/w,\/w, ,(/w,[/w,target/en,_,rois/en,,/w, ,input/en,_,gt/en,_,class/en,_,ids/en,,/w, ,gt/en,_,boxes/en,,/w, ,gt/en,_,keypoints/en,]/w,)/w, ,#, ,network/en, ,heads/en, ,#, ,todo/en,:/w, ,verify/en, ,that/en, ,this/en, ,handles/en, ,zero/en, ,padded/en, ,rois/en, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en, ,=/w,\/w, ,fpn/en,_,classifier/en,_,graph/en,(/w,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,config/en,./w,image/en,_,shape/en,,/w, ,config/en,./w,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,)/w, ,#, ,mrcnn/en,_,mask/en, ,=/w, ,build/en,_,fpn/en,_,mask/en,_,graph/en,(/w,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,#, ,config/en,./w,image/en,_,shape/en,,/w, ,#, ,config/en,./w,mask/en,_,pool/en,_,size/en,,/w, ,#, ,config/en,./w,num/en,_,classes/en,)/w, ,#, ,shape/en,:/w, ,batch/en,_,size/en,,/w, ,num/en,_,roi/en,,/w, ,num/en,_,keypoint/en,,/w, ,56/m,*/w,56/m, ,keypoint/en,_,mrcnn/en,_,mask/en, ,=/w, ,build/en,_,fpn/en,_,keypoint/en,_,graph/en,(/w,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,config/en,./w,image/en,_,shape/en,,/w, ,config/en,./w,keypoint/en,_,mask/en,_,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,keypoints/en,)/w, ,#, ,todo/en,:/w, ,clean/en, ,up/en, ,(/w,use/en, ,tf/en,./w,identify/en, ,if/en, ,necessary/en,)/w, ,output/en,_,rois/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en, ,*/w, ,1/m,,/w, ,name/en,=/w,"/w,output/en,_,rois/en,"/w,)/w,(/w,rois/en,)/w, ,#, ,keypoint/en,_,mrcnn/en,_,mask/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en, ,*/w, ,1/m,,/w, ,name/en,=/w,"/w,keypoint/en,_,mrcnn/en,_,mask/en,"/w,)/w,(/w,keypoint/en,_,mrcnn/en,_,mask/en,)/w, ,#, ,losses/en, ,rpn/en,_,class/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,rpn/en,_,class/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,rpn/en,_,class/en,_,loss/en,"/w,)/w,(/w, ,[/w,input/en,_,rpn/en,_,match/en,,/w, ,rpn/en,_,class/en,_,logits/en,]/w,)/w, ,rpn/en,_,bbox/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,rpn/en,_,bbox/en,_,loss/en,_,graph/en,(/w,config/en,,/w, ,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,rpn/en,_,bbox/en,_,loss/en,"/w,)/w,(/w, ,[/w,input/en,_,rpn/en,_,bbox/en,,/w, ,input/en,_,rpn/en,_,match/en,,/w, ,rpn/en,_,bbox/en,]/w,)/w, ,class/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,mrcnn/en,_,class/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,_,loss/en,"/w,)/w,(/w, ,[/w,target/en,_,class/en,_,ids/en,,/w, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,active/en,_,class/en,_,ids/en,]/w,)/w, ,bbox/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,mrcnn/en,_,bbox/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,bbox/en,_,loss/en,"/w,)/w,(/w, ,[/w,target/en,_,bbox/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,mrcnn/en,_,bbox/en,]/w,)/w, ,#, ,mask/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,mrcnn/en,_,mask/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,#, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,loss/en,"/w,)/w,(/w, ,#, ,[/w,target/en,_,mask/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,mrcnn/en,_,mask/en,]/w,)/w, ,keypoint/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,keypoint/en,_,mrcnn/en,_,mask/en,_,loss/en,_,graph/en,(/w,*/w,x/en,,/w, ,weight/en,_,loss/en,=/w,config/en,./w,weight/en,_,loss/en,)/w,,/w, ,name/en,=/w,"/w,keypoint/en,_,mrcnn/en,_,mask/en,_,loss/en,"/w,)/w,(/w, ,[/w,target/en,_,keypoint/en,,/w, ,target/en,_,keypoint/en,_,weight/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,keypoint/en,_,mrcnn/en,_,mask/en,]/w,)/w, ,"/w,"/w,"/w, ,target/en,_,keypoints/en,:/w, ,[/w,batch/en,,/w, ,train/en,_,rois/en,_,per/en,_,image/en,,/w, ,num/en,_,keypoints/en,)/w, ,keypoint/en, ,labels/en, ,cropped/en, ,to/en, ,bbox/en, ,boundaries/en, ,and/en, ,resized/en, ,to/en, ,neural/en, ,network/en, ,output/en, ,size/en,./w, ,maps/en, ,keypoints/en, ,from/en, ,the/en, ,half/en,-/w,open/en, ,interval/en, ,[/w,x/en,1/m,,/w, ,x/en,2/m,)/w, ,on/en, ,continuous/en, ,image/en, ,coordinates/en, ,to/en, ,the/en, ,closed/en, ,interval/en, ,[/w,0/m,,/w, ,heatmap/en,_,size/en, ,-/w, ,1/m,]/w, ,target/en,_,keypoint/en,_,weights/en,:/w, ,[/w,batch/en,,/w, ,train/en,_,rois/en,_,per/en,_,image/en,,/w, ,num/en,_,keypoints/en,)/w,,/w, ,bool/en, ,type/en, ,keypoint/en,_,weights/en,,/w, ,0/m,:/w, ,isn/en,'/w,t/en, ,visible/en,,/w, ,1/m,:/w, ,visilble/en, ,"/w,"/w,"/w, ,#, ,test/en,_,target/en,_,keypoint/en,_,mask/en, ,=/w, ,test/en,_,keypoint/en,_,mrcnn/en,_,mask/en,_,loss/en,_,graph/en,(/w,target/en,_,keypoint/en,,/w, ,target/en,_,keypoint/en,_,weight/en,,/w, ,#, ,target/en,_,class/en,_,ids/en,,/w, ,keypoint/en,_,mrcnn/en,_,mask/en,)/w, ,#, ,keypoint/en,_,weight/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,keypoint/en,_,weight/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,keypoint/en,_,weight/en,_,loss/en,"/w,)/w,(/w, ,#, ,[/w,target/en,_,keypoint/en,_,weight/en,,/w, ,keypoint/en,_,weight/en,_,logits/en,,/w, ,target/en,_,class/en,_,ids/en,]/w,)/w, ,#, ,model/en, ,generated/en, ,#, ,batch/en,_,images/en,,/w, ,batch/en,_,image/en,_,meta/en,,/w, ,batch/en,_,rpn/en,_,match/en,,/w, ,batch/en,_,rpn/en,_,bbox/en,,/w, ,batch/en,_,gt/en,_,class/en,_,ids/en,,/w, ,\/w, ,#, ,batch/en,_,gt/en,_,boxes/en,,/w, ,batch/en,_,gt/en,_,keypoint/en,,/w, ,batch/en,_,gt/en,_,masks/en, ,inputs/en, ,=/w, ,[/w,input/en,_,image/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,input/en,_,rpn/en,_,match/en,,/w, ,input/en,_,rpn/en,_,bbox/en,,/w, ,input/en,_,gt/en,_,class/en,_,ids/en,,/w, ,input/en,_,gt/en,_,boxes/en,,/w, ,input/en,_,gt/en,_,keypoints/en,]/w, ,if/en, ,not/en, ,config/en,./w,use/en,_,rpn/en,_,rois/en,:/w, ,inputs/en,./w,append/en,(/w,input/en,_,rois/en,)/w, ,#, ,add/en, ,"/w,test/en,_,target/en,_,keypoint/en,_,mask/en,"/w, ,in/en, ,the/en, ,output/en, ,for/en, ,test/en, ,the/en, ,keypoint/en, ,loss/en, ,function/en, ,outputs/en, ,=/w, ,[/w,rpn/en,_,class/en,_,logits/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,,/w, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w, ,keypoint/en,_,mrcnn/en,_,mask/en,,/w, ,rpn/en,_,rois/en,,/w, ,output/en,_,rois/en,,/w, ,rpn/en,_,class/en,_,loss/en,,/w, ,rpn/en,_,bbox/en,_,loss/en,,/w, ,class/en,_,loss/en,,/w, ,bbox/en,_,loss/en,,/w, ,keypoint/en,_,loss/en,]/w, ,#, ,+/w, ,test/en,_,target/en,_,keypoint/en,_,mask/en, ,for/en, ,test/en, ,the/en, ,keypoint/en, ,loss/en, ,graph/en, ,model/en, ,=/w, ,km/en,./w,model/en,(/w,inputs/en,,/w, ,outputs/en,,/w, ,name/en,=/w,'/w,mask/en,_,keypoint/en,_,mrcnn/en,'/w,)/w, ,else/en,:/w, ,#, ,network/en, ,heads/en, ,#, ,proposal/en, ,classifier/en, ,and/en, ,bbox/en, ,regressor/en, ,heads/en, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en, ,=/w,\/w, ,fpn/en,_,classifier/en,_,graph/en,(/w,rpn/en,_,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,config/en,./w,image/en,_,shape/en,,/w, ,config/en,./w,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,)/w, ,#, ,detections/en, ,#, ,output/en, ,is/en, ,#, ,detections/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w, ,in/en, ,image/en, ,coordinates/en, ,#, ,keypoint/en,_,weights/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,num/en,_,keypoints/en,]/w, ,detections/en, ,=/w, ,detectionlayer/en,(/w,config/en,,/w, ,name/en,=/w,"/w,mrcnn/en,_,detection/en,"/w,)/w,(/w, ,[/w,rpn/en,_,rois/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w,input/en,_,image/en,_,meta/en,]/w,)/w, ,#, ,convert/en, ,boxes/en, ,to/en, ,normalized/en, ,coordinates/en, ,#, ,todo/en,:/w, ,let/en, ,detectionlayer/en, ,return/en, ,normalized/en, ,coordinates/en, ,to/en, ,avoid/en, ,#, ,unnecessary/en, ,conversions/en, ,h/en,,/w, ,w/en, ,=/w, ,config/en,./w,image/en,_,shape/en,[/w,:/w,2/m,]/w, ,detection/en,_,boxes/en, ,=/w, ,kl/en,./w,lambda/en,(/w, ,lambda/en, ,x/en,:/w, ,x/en,[/w,./w,./w,./w,,/w, ,:/w,4/m,]/w, ,//w, ,np/en,./w,array/en,(/w,[/w,h/en,,/w, ,w/en,,/w, ,h/en,,/w, ,w/en,]/w,)/w,)/w,(/w,detections/en,)/w, ,#, ,create/en, ,masks/en, ,for/en, ,detections/en, ,mrcnn/en,_,mask/en, ,=/w, ,build/en,_,fpn/en,_,mask/en,_,graph/en,(/w,detection/en,_,boxes/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,config/en,./w,image/en,_,shape/en,,/w, ,config/en,./w,mask/en,_,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,)/w, ,keypoint/en,_,mrcnn/en, ,=/w, ,build/en,_,fpn/en,_,keypoint/en,_,graph/en,(/w,detection/en,_,boxes/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,config/en,./w,image/en,_,shape/en,,/w, ,config/en,./w,keypoint/en,_,mask/en,_,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,keypoints/en,)/w, ,#,shape/en,:/w, ,batch/en,,/w, ,n/en,_,roi/en,,/w, ,number/en,_,keypoint/en,,/w, ,height/en,*/w,width/en, ,keypoint/en,_,mcrcnn/en,_,prob/en, ,=/w, ,kl/en,./w,activation/en,(/w,"/w,softmax/en,"/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,prob/en,"/w,)/w,(/w,keypoint/en,_,mrcnn/en,)/w, ,model/en, ,=/w, ,km/en,./w,model/en,(/w,[/w,input/en,_,image/en,,/w, ,input/en,_,image/en,_,meta/en,]/w,,/w, ,[/w,detections/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w, ,rpn/en,_,rois/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,,/w, ,mrcnn/en,_,mask/en,,/w, ,keypoint/en,_,mcrcnn/en,_,prob/en,]/w,,/w, ,name/en,=/w,'/w,keypoint/en,_,mask/en,_,rcnn/en,'/w,)/w, ,#, ,add/en, ,multi/en,-/w,gpu/en, ,support/en,./w, ,if/en, ,config/en,./w,gpu/en,_,count/en, ,>, ,1/m,:/w, ,from/en, ,parallel/en,_,model/en, ,import/en, ,parallelmodel/en, ,model/en, ,=/w, ,parallelmodel/en,(/w,model/en,,/w, ,config/en,./w,gpu/en,_,count/en,)/w, ,return/en, ,model/en,在/p,model/en,./w,compile/en,方法/n,中/f,，/w,我们/r,可以/v,看到/v,有关/vn,损失/n,函数/n,添加/vn,的/u,细节/n,：/w,#, ,add/en, ,losses/en, ,#, ,first/en,,/w, ,clear/en, ,previously/en, ,set/en, ,losses/en, ,to/en, ,avoid/en, ,duplication/en, ,self/en,./w,keras/en,_,model/en,./w,_,losses/en, ,=/w, ,[/w,]/w, ,self/en,./w,keras/en,_,model/en,./w,_,per/en,_,input/en,_,losses/en, ,=/w, ,{/w,}/w, ,loss/en,_,names/en, ,=/w, ,[/w,"/w,rpn/en,_,class/en,_,loss/en,"/w,,/w, ,"/w,rpn/en,_,bbox/en,_,loss/en,"/w,,/w, ,"/w,mrcnn/en,_,class/en,_,loss/en,"/w,,/w, ,"/w,mrcnn/en,_,bbox/en,_,loss/en,"/w,,/w, ,"/w,keypoint/en,_,mrcnn/en,_,mask/en,_,loss/en,"/w,]/w, ,for/en, ,name/en, ,in/en, ,loss/en,_,names/en,:/w, ,layer/en, ,=/w, ,self/en,./w,keras/en,_,model/en,./w,get/en,_,layer/en,(/w,name/en,)/w, ,if/en, ,layer/en,./w,output/en, ,in/en, ,self/en,./w,keras/en,_,model