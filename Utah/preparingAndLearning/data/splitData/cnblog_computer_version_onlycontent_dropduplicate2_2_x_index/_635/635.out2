背景/n,在/p,实际/n,项目/n,中/f,，/w,利用/v,深度/n,学习/v,在/p,检测/vn,道路/n,车辆/n,并/c,分析/vn,车辆/n,行为/n,时/ng,，/w,需要/v,按照/p,事先/d,规定/n,的/u,方法/n,绘制/v,检测区/ns,（/w,包含/v,道路/n,方向/n,、/w,车道/n,区域/n,等/u,）/w,。/w,由于/c,各种/r,原因/n,（/w,人为/d,、/w,天气/n,）/w,，/w,获取/v,视频/n,数据/n,的/u,摄像/vn,角度/n,容易/a,偏移/vn,原来/d,设定/v,的/u,位置/n,，/w,造成/v,检测/vn,区域/n,和/c,实际/n,画面/n,不/d,匹配/vn,，/w,系统/n,容易/a,产生/v,误检/nw,误/v,报/n,等/u,错误/n,数据/n,。/w,因此/c,需要/v,在/p,摄像机/n,位置/n,偏移/vn,第一/m,时间/n,告诉/v,系统/n,检测/vn,模块/n,停止/v,工作/vn,，/w,直到/v,摄像机/n,归位/v,后/f,再/d,进行/v,检测/vn,。/w,摄像机/n,角度/n,偏移/vn,告警/v,属于/v,‘/w,视频/n,诊断/v,’/w,中/f,的/u,一类/b,，/w,本文/r,利用/v,提取/v,图片/n,特征点/nw,实现/v,摄像机/n,偏移/vn,告警/v,，/w,demo/en,全部/m,python/en,代码/n,不足/a,200行/mq,。/w,前面/f,有/v,几/m,篇/q,博客/n,文字/n,太/d,少/a,，/w,发/v,不/d,了/u,首页/nw,：/w,[/w,ai/en,分享/v,]/w,零/m,高数/nw,理解/v,人工智能/n,和/c,深度/n,学习/v,[/w,ai/en,开发/v,]/w,基于/p,深度/n,学习/v,的/u,卡口车型/nw,、/w,车牌/n,识别/v,这里/r,是/v,[/w,ai/en,+/w,计算机/n,视觉/n,]/w,的/u,所有/b,文章/n,，/w,需要/v,的/u,朋友/n,可以/v,点/q,一/m,波/j,关注/v,或者/c,收藏/v,一下/m,。/w,图像/n,特征点/nw,对于/p,任何/r,一张/mq,二维/nr,图片/n,，/w,从/p,像素/n,级别/n,上/f,看/v,，/w,都/d,存在/v,一些/m,我们/r,肉眼/n,看/v,不/d,到/v,的/u,比较/d,独特/a,的/u,像素/n,单元/n,（/w,可以/v,理解/v,为/p,像/v,素块/nr,）/w,，/w,就/d,像/v,我们/r,每个/r,人/n,的/u,脸/n,都/d,会/v,与众不同/i,一样/u,，/w,我们/r,称/v,这些/r,具有/v,特点/n,的/u,像素/n,区域/n,为/p,“/w,图像/n,特征点/nw,”/w,。/w,已经/d,有/v,非常/d,成熟/a,的/u,算法/n,来/v,提取/v,图片/n,的/u,特征点/nw,：/w,（/w,1/m,）/w,harris/en,：/w,用于/v,检测/vn,角点/nw,；/w,（/w,2/m,）/w,sift/en,：/w,用于/v,检测/vn,斑点/n,；/w,（/w,3/m,）/w,surf/en,：/w,用于/v,检测/vn,斑点/n,；/w,（/w,4/m,）/w,fast/en,：/w,用于/v,检测/vn,角点/nw,；/w,（/w,5/m,）/w,brief/en,：/w,用于/v,检测/vn,斑点/n,；/w,（/w,6/m,）/w,orb/en,：/w,表示/v,带/v,方向/n,的/u,fast/en,算法/n,与/p,具有/v,旋转/v,不/d,变性/vn,的/u,brief/en,算法/n,；/w,详细/ad,算法/n,原理/n,上网/v,搜/v,一下/m,（/w,我/r,也/d,不/d,是/v,很/d,清楚/a,:/w,)/w,）/w,，/w,opencv/en,中/f,包含/v,以上/f,几/m,种/q,算法/n,实现/v,。/w,角点/nw,：/w,图像/n,中/f,涉及/v,到/v,拐角/n,的/u,区域/n,，/w,比如/v,物体/n,有/v,轮廓/n,，/w,图像/n,中/f,的/u,物体/n,有/v,边缘/n,区分/v,。/w,斑点/n,：/w,一块/mq,有/v,特别/d,规律/n,的/u,像素/n,区域/n,。/w,方向/n,、/w,尺寸不变性/nw,：/w,指特/nw,征点/nw,不/d,会/v,受/v,图片/n,尺寸/n,、/w,旋转/v,而/c,改变/v,，/w,比如/v,同一/b,张/q,图/n,，/w,你/r,缩小/v,一倍/mq,旋转/v,90度/mq,后/f,，/w,特征点/nw,还是/c,一样/u,的/u,。/w,图像/n,匹配/vn,提取/v,两张/mq,图片/n,的/u,特征点/nw,，/w,然后/c,将/d,这些/r,特征点/nw,进行/v,匹配/vn,关联/vn,。/w,如果/c,匹配/vn,程度/n,满足/v,某/r,一/m,阈值/n,，/w,则/d,认为/v,这/r,两张/mq,图/n,满足/v,匹配/vn,条件/n,。/w,注意/v,，/w,对于/p,同一/b,个/q,物体/n,，/w,拍摄/v,角度/n,不同/a,，/w,亮度/n,不同/a,都/d,应该/v,满足/v,匹配/vn,条件/n,。/w,可以/v,看到/v,，/w,对于/p,同一个/r,场景/n,的/u,不同/a,拍摄/v,角度/n,的/u,两张/mq,图片/n,，/w,能/v,找到/v,匹配/vn,到/v,的/u,特征点/nw,，/w,但是/c,误差/n,非常/d,大/a,。/w,我们/r,设置/v,一个/m,阈值/n,，/w,满足/v,该/r,条件/n,才/d,认为/v,两个点/mq,匹配/vn,：/w,误差/n,少/a,很/d,多/a,了/u,，/w,匹配/vn,到/v,的/u,特征点/nw,也/d,非常/d,正确/a,。/w,换/v,一组/mq,摄像机/n,的/u,照片/n,，/w,前/f,一张/mq,和/c,后/f,一张/mq,在/p,拍摄/v,时/ng,，/w,摄像机/n,角度/n,往/p,左下角/nw,有/v,偏移/vn,，/w,所以/c,对应/v,匹配/vn,到/v,的/u,特征点/nw,往/p,右上方/nw,移动/vn,了/u,：/w,我们/r,可以/v,看到/v,，/w,虽然/c,拍摄/v,角度/n,不同/a,，/w,但是/c,由于/c,场景/n,类似/v,，/w,仍然/d,能/v,匹配/vn,到/v,特征点/nw,（/w,为了/p,减少/v,绘图/vn,方便/a,看/v,清楚/a,，/w,阈值/n,设置/v,非常/d,严格/ad,，/w,如果/c,放宽/v,一点/m,还/d,能/v,看到/v,更/d,多/a,匹配/vn,到/v,的/u,点/q,）/w,，/w,而且/c,这些/r,匹配/vn,到/v,的/u,点/q,几乎/d,都/d,正确/a,。/w,对于/p,两张/mq,完全/ad,不同/a,的/u,场景/n,照片/n,，/w,匹配/vn,到/v,的/u,特征点/nw,非常/d,少/a,或者/c,为/p,零/m,（/w,具体/a,看/v,设置/v,的/u,阈值/n,）/w,场景/n,不同/a,，/w,匹配/vn,到/v,的/u,特征点/nw,只/d,有/v,视频/n,上/f,的/u,文字/n,。/w,角度/n,偏移/vn,告警/v,如果/c,摄像机/n,位置/n,不/d,变/v,，/w,前后/f,拍摄/v,两张/mq,照片/n,，/w,那么/r,这/r,两张/mq,照片/n,匹配/vn,到/v,的/u,特征点/nw,的/u,二维/nr,物理/n,坐标/n,应该/v,是/v,一样/u,的/u,（/w,可能/v,有/v,轻微/a,偏移/vn,，/w,两张/mq,照片/n,尺寸/n,一致/a,）/w,。/w,那么/r,我们/r,可以/v,根据/p,摄像机/n,前后/f,两帧/mq,（/w,或/c,间隔/n,时间/n,内/f,取得/v,的/u,两帧/mq,）/w,的/u,匹配/vn,点/q,物理/n,位置/n,是否/v,有/v,偏移/vn,，/w,设置/v,一个/m,偏移/vn,阈值/n,，/w,大于/v,该/r,阈值/n,时/ng,则/d,认为/v,偏移/vn,，/w,否则/c,认为/v,没/d,偏移/vn,（/w,或/c,轻微/a,偏移/vn,）/w,，/w,当然/d,，/w,如果/c,两帧/mq,匹配/vn,到/v,的/u,特征点/nw,非常/d,少/a,（/w,低于/v,一个/m,阈值/n,）/w,，/w,那么/r,我们/r,认为/v,这/r,俩/m,帧/q,完全/ad,不/d,一样/u,了/u,（/w,场景/n,不/d,一样/u,了/u,）/w,，/w,这时候/r,摄像机/n,完全/ad,偏移/vn,了/u,原来/d,的/u,角度/n,。/w,注意/v,点/q,：/w,1/m,）/w,阈值/n,非常/d,重要/a,；/w,2/m,）/w,前后/f,帧/q,匹配/vn,时/ng,，/w,要/v,去掉/v,类似/v,摄像机/n,自动/d,加/v,上去/v,的/u,“/w,视频/n,位置/n,”/w,、/w,“/w,当前/t,时间/n,”/w,等等/u,区域/n,，/w,因为/c,这些/r,区域/n,很多/m,时候/n,能够/v,匹配/vn,到/v,特征点/nw,，/w,并且/c,物理/n,位置/n,坐标/n,不/d,会/v,发生/v,变化/vn,，/w,造成/v,误差/n,；/w,3/m,）/w,在/p,计算/v,特征点/nw,物理/n,位置/n,偏移量/nz,时/ng,，/w,取/v,所有/b,特征点/nw,物理/n,位置/n,偏移/vn,的/u,平均值/n,。/w,最终/d,效果/n,间隔/n,时间/n,取/v,视频/n,中/f,的/u,帧/q,，/w,进行/v,特征点/nw,对比/v,。/w,根据/p,前面/f,的/u,思路/n,分为/v,4个/m,等级/n,：/w,“/w,无/v,偏移/vn,”/w,、/w,“/w,轻度/d,偏移/vn,（/w,抖动/vn,）/w,”/w,、/w,“/w,严重/a,偏移/vn,”/w,、/w,“/w,完全/ad,偏移/vn,”/w,。/w,源代码/n,最/d,重要/a,的/u,是/v,代码/n,，/w,很/d,简单/a,，/w,直接/ad,贴/v,上来/v,即可/v,。/w,加/v,起来/v,不/d,到/v,160行/mq,。/w,测试/vn,很多/m,场景/n,，/w,效果/n,都/d,不错/a,。/w,1/m, ,'/w,'/w,'/w, ,2/m, ,视频/n,帧/q,匹配/vn,脚本/n, ,3/m, ,'/w,'/w,'/w, ,4/m, ,import/en, ,numpy/en, ,as/en, ,np/en, ,5/m, ,import/en, ,cv/en,2/m, ,6/m, ,7/m, ,#,至少/d,10个点/mq,匹配/vn, ,8/m, ,min/en,_,match/en,_,count/en, ,=/w, ,10/m, ,9/m, ,#,完全/ad,匹配/vn,偏移/vn, ,d/en,</w,4/m, ,10/m, ,best/en,_,distance/en, ,=/w, ,4/m, ,11/m, ,#,微量/b,偏移/vn, ,4/m,</w,d/en,</w,10/m, ,12/m, ,good/en,_,distance/en, ,=/w, ,10/m, ,13/m, ,14/m, ,15/m, ,#, ,特征点/nw,提取/v,方法/n,，/w,内置/vn,很多/m,种/q, ,16/m, ,algorithms/en,_,all/en, ,=/w, ,{/w, ,17/m, ,"/w,sift/en,"/w,:/w, ,cv/en,2/m,./w,xfeatures/en,2/m,d/en,./w,sift/en,_,create/en,(/w,)/w,,/w, ,18/m, ,"/w,surf/en,"/w,:/w, ,cv/en,2/m,./w,xfeatures/en,2/m,d/en,./w,surf/en,_,create/en,(/w,8000/m,)/w,,/w, ,19/m, ,"/w,orb/en,"/w,:/w, ,cv/en,2/m,./w,orb/en,_,create/en,(/w,)/w, ,20/m, ,}/w, ,21/m, ,22/m, ,'/w,'/w,'/w, ,23/m, ,#, ,图像/n,匹配/vn, ,24/m, ,#, ,0/m,完全/ad,不/d,匹配/vn, ,1/m,场景/n,匹配/vn, ,2/m,角度/n,轻微/a,偏移/vn, ,3/m,完全/ad,匹配/vn, ,25/m, ,'/w,'/w,'/w, ,26/m, ,def/en, ,match/en,2/m,frames/en,(/w,image/en,1/m,,/w, ,image/en,2/m,)/w,:/w, ,27/m, ,img/en,1/m, ,=/w, ,cv/en,2/m,./w,cvtcolor/en,(/w,image/en,1/m,,/w, ,cv/en,2/m,./w,color/en,_,bgr/en,2/m,gray/en,)/w, ,28/m, ,img/en,2/m, ,=/w, ,cv/en,2/m,./w,cvtcolor/en,(/w,image/en,2/m,,/w, ,cv/en,2/m,./w,color/en,_,bgr/en,2/m,gray/en,)/w, ,29/m, ,30/m, ,size/en,1/m, ,=/w, ,img/en,1/m,./w,shape/en, ,31/m, ,size/en,2/m, ,=/w, ,img/en,2/m,./w,shape/en, ,32/m, ,33/m, ,img/en,1/m, ,=/w, ,cv/en,2/m,./w,resize/en,(/w,img/en,1/m,,/w, ,(/w,int/en,(/w,size/en,1/m,[/w,1/m,]/w,*/w,0.3/m,)/w,,/w, ,int/en,(/w,size/en,1/m,[/w,0/m,]/w,*/w,0.3/m,)/w,)/w,,/w, ,cv/en,2/m,./w,inter/en,_,linear/en,)/w, ,34/m, ,img/en,2/m, ,=/w, ,cv/en,2/m,./w,resize/en,(/w,img/en,2/m,,/w, ,(/w,int/en,(/w,size/en,2/m,[/w,1/m,]/w,*/w,0.3/m,)/w,,/w, ,int/en,(/w,size/en,2/m,[/w,0/m,]/w,*/w,0.3/m,)/w,)/w,,/w, ,cv/en,2/m,./w,inter/en,_,linear/en,)/w, ,35/m, ,36/m, ,sift/en, ,=/w, ,algorithms/en,_,all/en,[/w,"/w,sift/en,"/w,]/w, ,37/m, ,38/m, ,kp/en,1/m,,/w, ,des/en,1/m, ,=/w, ,sift/en,./w,detectandcompute/en,(/w,img/en,1/m,,/w, ,none/en,)/w, ,39/m, ,kp/en,2/m,,/w, ,des/en,2/m, ,=/w, ,sift/en,./w,detectandcompute/en,(/w,img/en,2/m,,/w, ,none/en,)/w, ,40/m, ,41/m, ,flann/en,_,index/en,_,kdtree/en, ,=/w, ,0/m, ,42/m, ,index/en,_,params/en, ,=/w, ,dict/en,(/w,algorithm/en, ,=/w, ,flann/en,_,index/en,_,kdtree/en,,/w, ,trees/en, ,=/w, ,5/m,)/w, ,43/m, ,search/en,_,params/en, ,=/w, ,dict/en,(/w,checks/en, ,=/w, ,50/m,)/w, ,44/m, ,45/m, ,flann/en, ,=/w, ,cv/en,2/m,./w,flannbasedmatcher/en,(/w,index/en,_,params/en,,/w, ,search/en,_,params/en,)/w, ,46/m, ,47/m, ,matches/en, ,=/w, ,flann/en,./w,knnmatch/en,(/w,des/en,1/m,,/w, ,des/en,2/m,,/w, ,k/en,=/w,2/m,)/w, ,48/m, ,49/m, ,#, ,过滤/v, ,50/m, ,good/en, ,=/w, ,[/w,]/w, ,51/m, ,for/en, ,m/en,,/w,n/en, ,in/en, ,matches/en,:/w, ,52/m, ,if/en, ,m/en,./w,distance/en, ,</w, ,0.7/m,*/w,n/en,./w,distance/en,:/w, ,53/m, ,good/en,./w,append/en,(/w,m/en,)/w, ,54/m, ,55/m, ,if/en, ,len/en,(/w,good/en,)/w, ,</w,=/w, ,min/en,_,match/en,_,count/en,:/w, ,56/m, ,return/en, ,0/m, ,#, ,完全/ad,不/d,匹配/vn, ,57/m, ,else/en,:/w, ,58/m, ,distance/en,_,sum/en, ,=/w, ,0/m, ,#, ,特征点/nw,2/m,d/en,物理/n,坐标/n,偏移/vn,总和/n, ,59/m, ,for/en, ,m/en, ,in/en, ,good/en,:/w, ,60/m, ,distance/en,_,sum/en, ,+/w,=/w, ,get/en,_,distance/en,(/w,kp/en,1/m,[/w,m/en,./w,queryidx/en,]/w,./w,pt/en,,/w, ,kp/en,2/m,[/w,m/en,./w,trainidx/en,]/w,./w,pt/en,)/w, ,61/m, ,distance/en, ,=/w, ,distance/en,_,sum/en, ,//w, ,len/en,(/w,good/en,)/w, ,#,单个/b,特征点/nw,2/m,d/en,物理/n,位置/n,平均/a,偏移量/nz, ,62/m, ,63/m, ,if/en, ,distance/en, ,</w, ,best/en,_,distance/en,:/w, ,64/m, ,return/en, ,3/m, ,#,完全/ad,匹配/vn, ,65/m, ,elif/en, ,distance/en, ,</w, ,good/e