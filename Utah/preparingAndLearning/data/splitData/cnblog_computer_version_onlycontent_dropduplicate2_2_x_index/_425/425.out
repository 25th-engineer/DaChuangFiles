在/p,前面/f,两篇/mq,文章/n,介绍/v,了/u,深度/n,学习/v,的/u,一些/m,基本/a,概念/n,，/w,本文/r,则/d,使用/v,python/en,实现/v,一个/m,简单/a,的/u,深度/n,神经/n,网络/n,，/w,并/c,使用/v,mnist/en,数据库/n,进行/v,测试/vn,。/w,神经/n,网络/n,的/u,实现/v,，/w,包括/v,以下/f,内容/n,：/w,神经/n,网络/n,权值/nw,的/u,初始化/v,正/d,向/p,传播/vn,误差/n,评估/vn,反向/f,传播/vn,更新/v,权值/nw,主要/b,是/v,根据/p,反向/f,传播/vn,的/u,4个/m,基本/a,方程/nr,，/w,利用/v,python/en,实现/v,神经/n,网络/n,的/u,反向/f,传播/vn,。/w,初始化/v,首先/d,定义/n,代表/n,神经/n,网络/n,的/u,类/q,neuralnetwork/en,,/w,class/en, ,neuralnetwork/en,:/w, ,def/en, ,_,_,init/en,_,_,(/w,self/en,,/w,layers/en,,/w,alpha/en,=/w,0.1/m,)/w,:/w, ,self/en,./w,w/en, ,=/w, ,[/w,]/w, ,self/en,./w,layers/en, ,=/w, ,layers/en, ,self/en,./w,alpha/en, ,=/w, ,alpha/en,有/v,三个/m,属性/n,，/w,w/en,存储/vn,各个/r,层/q,之间/f,的/u,权值/nw,矩阵/n,，/w,也/d,是/v,神经/n,网络/n,要/v,更新/v,学习/v,的/u,layers/en, ,神经/n,网络/n,的/u,结构/n,，/w,例如/v,：/w, ,[/w,2/m,,/w,2/m,,/w,1/m,]/w,表示/v,输入层/nw,有/v,2个/m,神经元/n,，/w,隐藏层/nw,2个/m,神经元/n,，/w,输出/v,层/q,只/d,有/v,1个/m,神经元/n,。/w,alpha/en, ,学习/v,速率/n,接下来/l,初始化/v,各个/r,层/q,之间/f,的/u,权值/nw,矩阵/n,for/en, ,i/en, ,in/en, ,np/en,./w,arange/en,(/w,0/m,,/w,len/en,(/w,layers/en,)/w, ,-/w, ,2/m,)/w,:/w, ,w/en, ,=/w, ,np/en,./w,random/en,./w,randn/en,(/w,layers/en,[/w,i/en,]/w, ,+/w, ,1/m,,/w,layers/en,[/w,i/en, ,+/w, ,1/m,]/w, ,+/w, ,1/m,)/w, ,self/en,./w,w/en,./w,append/en,(/w,w/en, ,//w, ,np/en,./w,sqrt/en,(/w,layers/en,[/w,i/en,]/w,)/w,)/w,注意/v,上面/f,生成/vn,权值/nw,矩阵/n,的/u,大小/n,layers/en,[/w,i/en,]/w, ,+/w, ,1/m,,/w,layers/en,[/w,i/en, ,+/w, ,1/m,]/w, ,+/w, ,1/m,，/w,都/d,加/v,了/u,1/m,。/w, ,这/r,是/v,将/d,神经元/n,的/u,偏置/nw,和/c,权值/nw,统一/vn,的/u,放到/v,了/u,权值/nw,矩阵/n,里面/f,。/w,\/w,[/w, ,\/w,left/en,[/w, ,\/w,begin/en,{/w,array/en,}/w,{/w,c/en,}/w,w/en,_,{/w,11/m,}/w, ,&/w, ,w/en,_,{/w,12/m,}/w, ,\/w,\/w, ,w/en,_,{/w,21/m,}/w, ,&/w, ,w/en,_,{/w,22/m,}/w,\/w,end/en,{/w,array/en,}/w, ,\/w,right/en,]/w, ,\/w,cdot/en, ,\/w,left/en,[/w,\/w,begin/en,{/w,array/en,}/w,{/w,c/en,}/w,x/en,_,1/m, ,\/w,\/w, ,x/en,_,2/m,\/w,end/en,{/w,array/en,}/w,\/w,right/en,]/w, ,+/w, ,\/w,left/en,[/w,\/w,begin/en,{/w,array/en,}/w,{/w,c/en,}/w,b/en,_,1/m, ,\/w,\/w, ,b/en,_,2/m,\/w,end/en,{/w,array/en,}/w,\/w,right/en,]/w, ,=/w, ,\/w,left/en,[/w,\/w,begin/en,{/w,array/en,}/w,{/w,c/en,}/w,w/en,_,{/w,11/m,}/w,x/en,_,1/m, ,+/w, ,w/en,{/w,12/m,}/w,x/en,_,2/m, ,+/w, ,b/en,_,1/m, ,\/w,\/w, ,w/en,_,{/w,21/m,}/w,x/en,_,1/m, ,+/w, ,w/en,_,{/w,22/m,}/w,x/en,_,2/m, ,+/w, ,b/en,_,2/m, ,\/w,end/en,{/w,array/en,}/w,\/w,right/en,]/w, ,\/w,]/w,可以/v,将/d,上式/nw,写成/v,齐次/nrf,的/u,形式/n,\/w,[/w, ,\/w,left/en,[/w, ,\/w,begin/en,{/w,array/en,}/w,{/w,c/en,}/w,w/en,_,{/w,11/m,}/w, ,&/w, ,w/en,_,{/w,12/m,}/w, ,&/w, ,b/en,_,1/m, ,\/w,\/w, ,w/en,_,{/w,21/m,}/w, ,&/w, ,w/en,_,{/w,22/m,}/w, ,&/w,b/en,_,2/m, ,\/w,end/en,{/w,array/en,}/w, ,\/w,right/en,]/w, ,\/w,cdot/en, ,\/w,left/en,[/w,\/w,begin/en,{/w,array/en,}/w,{/w,c/en,}/w,x/en,_,1/m, ,\/w,\/w, ,x/en,_,2/m, ,\/w,\/w, ,1/m,\/w,end/en,{/w,array/en,}/w,\/w,right/en,]/w, ,\/w,]/w,使用/v,统一/vn,的/u,矩阵/n,运算/vn,，/w,在/p,正/d,向/p,反向/f,传播/vn,的/u,时候/n,更/d,方便/a,。/w,在/p,输出/v,层/q,的/u,神经元/n,并/c,没有/v,偏置/nw,，/w,所以/c,要/v,单独/d,初始化/v,输出/v,层/q,的/u,权值/nw,矩阵/n,w/en, ,=/w, ,np/en,./w,random/en,./w,randn/en,(/w,layers/en,[/w,-/w,2/m,]/w, ,+/w, ,1/m,,/w,layers/en,[/w,-/w,1/m,]/w,)/w, ,self/en,./w,w/en,./w,append/en,(/w,w/en, ,//w, ,np/en,./w,sqrt/en,(/w,layers/en,[/w,-/w,2/m,]/w,)/w,)/w,下面/f,实现/v,python/en,的/u,magic/en, ,function/en, ,_,_,repr/en,_,_,输出/v,神经/n,网络结构/l,def/en, ,_,_,repr/en,_,_,(/w,self/en,)/w,:/w, ,return/en, ,"/w,neuralnetwork/en,:/w,{/w,}/w,"/w,./w,format/en,(/w,"/w,-/w,"/w,./w,join/en,(/w,str/en,(/w,l/en,)/w, ,for/en, ,l/en, ,in/en, ,self/en,./w,layers/en,)/w,)/w,激活/vn,函数/n,在/p,神经/n,网络/n,中/f,使用/v,sigmoid/en,作为/v,激活/vn,函数/n,，/w,实现/v,sigmoid/en,及其/c,导数/n,def/en, ,sigmoid/en,(/w,self/en,,/w,x/en,)/w,:/w, ,return/en, ,1.0/m, ,//w, ,(/w,1/m, ,+/w, ,np/en,./w,exp/en,(/w,-/w,x/en,)/w,)/w, ,def/en, ,sigmoid/en,_,deriv/en,(/w,self/en,,/w,x/en,)/w,:/w, ,return/en, ,x/en, ,*/w, ,(/w,1/m, ,-/w, ,x/en,)/w,正/d,向/p,反向/f,传播/vn,这/r,一部分/m,是/v,神经/n,的/u,网络/n,的/u,核心/n,了/u,。/w,下面/f,实现/v,fit/en,方法/n,，/w,在/p,方法/n,中/f,完成/v,神经/n,网络/n,权值/nw,更新/v,（/w,训练/vn,）/w,的/u,过程/n,。/w,def/en, ,fit/en,(/w,self/en,,/w,x/en,,/w,y/en,,/w,epochs/en,=/w,1000/m,,/w,displayupdate/en,=/w,100/m,)/w,:/w, ,x/en, ,=/w, ,np/en,./w,c/en,_,[/w,x/en,,/w,np/en,./w,ones/en,(/w,(/w,x/en,./w,shape/en,[/w,0/m,]/w,)/w,)/w,]/w, ,for/en, ,epoch/en, ,in/en, ,np/en,./w,arange/en,(/w,0/m,,/w,epochs/en,)/w,:/w, ,for/en,(/w,x/en,,/w,target/en,)/w, ,in/en, ,zip/en,(/w,x/en,,/w,y/en,)/w,:/w, ,self/en,./w,fit/en,_,partial/en,(/w,x/en,,/w,target/en,)/w, ,#, ,check/en, ,to/en, ,see/en, ,if/en, ,we/en, ,should/en, ,display/en, ,a/en, ,training/en, ,update/en, ,if/en, ,epoch/en, ,=/w,=/w, ,0/m, ,or/en, ,(/w,epoch/en, ,+/w, ,1/m,)/w, ,%/w, ,displayupdate/en, ,=/w,=/w, ,0/m,:/w, ,loss/en, ,=/w, ,self/en,./w,calculate/en,_,loss/en,(/w,x/en,,/w,y/en,)/w, ,print/en,(/w,"/w,[/w,info/en,]/w, ,epoch/en,=/w,{/w,}/w,,/w,loss/en,=/w,{/w,:/w,./w,7/m,f/en,}/w,"/w,./w,format/en,(/w,epoch/en, ,+/w, ,1/m,,/w,loss/en,)/w,)/w,该/r,函数/n,有/v,4个/m,参数/n,：/w,x/en,是/v,输入/v,的/u,样本/n,数据/n,y/en,是/v,样本/n,的/u,真/d,是/v,值/n,epochs/en,训练/vn,的/u,轮数/nw,displayupdate/en, ,输出/v,训练/vn,的/u,loss/en,值/n,。/w,x/en, ,=/w, ,np/en,./w,c/en,_,[/w,x/en,,/w,np/en,./w,ones/en,(/w,(/w,x/en,./w,shape/en,[/w,0/m,]/w,)/w,)/w,]/w,将/d,输入/v,训练/vn,的/u,样本/n,表示/v,为/p,齐次/nrf,向量/n,（/w,也/d,就是/d,在/p,末尾/n,添/v,1/m,）/w,。/w,fit/en,_,partial/en,是/v,对/p,输入/v,的/u,每个/r,样本/n,进行/v,训练/vn,，/w,包括/v,正/d,向/p,传播/vn,，/w,反向/f,传播/vn,以及/c,权值/nw,的/u,更新/v,。/w,def/en, ,fit/en,_,partial/en,(/w,self/en,,/w,x/en,,/w,y/en,)/w,:/w, ,a/en, ,=/w, ,[/w,np/en,./w,atleast/en,_,2/m,d/en,(/w,x/en,)/w,]/w, ,#, ,正/d,向/p,传播/vn, ,#, ,层层/q,之间/f,的/u,数据/n,传递/v, ,for/en, ,layer/en, ,in/en, ,np/en,./w,arange/en,(/w,0/m,,/w,len/en,(/w,self/en,./w,w/en,)/w,)/w,:/w, ,#, ,输入/v,经过/p,加权/v,以及/c,偏置/nw,后/f,的/u,值/n, ,net/en, ,=/w, ,a/en,[/w,layer/en,]/w,./w,dot/en,(/w,self/en,./w,w/en,[/w,layer/en,]/w,)/w, ,#, ,神经元/n,的/u,输出/v, ,out/en, ,=/w, ,self/en,./w,sigmoid/en,(/w,net/en,)/w, ,#, ,保存/v,下来/v,，/w,反向/f,传播/vn,的/u,时候/n,使用/v, ,a/en,./w,append/en,(/w,out/en,)/w,上面/f,完成/v,了/u,神经/n,玩/v,过/u,的/u,正/d,向/p,传播/vn,过程/n,，/w,下面/f,根据/p,反向/f,传播/vn,的/u,4个/m,基本/a,方程/n,进行/v,反向/f,传播/vn,。/w,首先/d,根据/p,\/w,(/w,bp/en,1/m,\/w,)/w,,/w,\/w,[/w, ,\/w,delta/en,^,l/en, ,=/w, ,\/w,frac/en,{/w,\/w,partial/en, ,e/en,}/w,{/w,\/w,partial/en, ,a/en,^,l/en,}/w, ,\/w,odot/en, ,\/w,sigma/en,'/w,(/w,z/en,^,l/en,)/w, ,\/w,tag/en,{/w,bp/en,1/m,}/w, ,\/w,]/w,计算/v,输出/v,层/q,的/u,误差/n,\/w,(/w,\/w,delta/en,^,l/en,\/w,)/w,error/en, ,=/w, ,a/en,[/w,-/w,1/m,]/w, ,-/w, ,y/en, ,#, ,输出/v,层/q,的/u,误差/n,，/w,均/d,值方/nw,差/a,作为/v,损失/n,函数/n, ,d/en, ,=/w, ,[/w,error/en, ,*/w, ,self/en,./w,sigmoid/en,_,deriv/en,(/w,a/en,[/w,-/w,1/m,]/w,)/w,]/w,得到/v,输出/v,层/q,的/u,误差/n,d/en,后/f,，/w,根据/p,\/w,(/w,bp/en,2/m,\/w,)/w,计算/v,各个/r,层/q,的/u,误差/n,\/w,[/w, ,\/w,delta/en,^,{/w,l/en,-/w,1/m,}/w, ,=/w, ,(/w,w/en,^,l/en,)/w,^,t/en,\/w,delta/en,^,l/en, ,\/w,odot/en, ,\/w,sigma/en,'/w,(/w,z/en,^,{/w,l/en,-/w,1/m,}/w,)/w, ,\/w,tag/en,{/w,bp/en,2/m,}/w, ,\/w,]/w,for/en, ,layer/en, ,in/en, ,np/en,./w,arange/en,(/w,len/en,(/w,a/en,)/w, ,-/w, ,2/m,,/w,0/m, ,,/w,-/w,1/m,)/w,:/w, ,delta/en, ,=/w, ,d/en,[/w,-/w,1/m,]/w,./w,dot/en,(/w,self/en,./w,w/en,[/w,layer/en,]/w,./w,t/en,)/w, ,delta/en, ,=/w, ,delta/en, ,*/w, ,self/en,./w,sigmoid/en,_,deriv/en,(/w,a/en,[/w,layer/en,]/w,)/w, ,d/en,./w,append/en,(/w,delta/en,)/w, ,d/en, ,=/w, ,d/en,[/w,:/w,:/w,-/w,1/m,]/w,将/d,d/en,反转/v,，/w,和/c,各个/r,层/q,的/u,索引/n,对应/v,起来/v,，/w,下面/f,根据/p,\/w,(/w,bp/en,3/m,,/w,bp/en,4/m,\/w,)/w,计算/v,权值/nw,矩阵/n,和/c,偏置/nw,的/u,导数/n,\/w,[/w, ,\/w,frac/en,{/w,\/w,partial/en, ,e/en,}/w,{/w,b/en,_,j/en,^,l/en,}/w, ,=/w, ,\/w,delta/en,_,j/en,^,l/en, ,\/w,tag/en,{/w,bp/en,3/m,}/w, ,\/w,]/w,\/w,[/w, ,\/w,frac/en,{/w,\/w,partial/en, ,e/en,}/w,{/w,w/en,_,{/w,jk/en,}/w,^,l/en,}/w, ,=/w, ,\/w,delta/en,_,j/en,^,l/en, ,a/en,_,k/en,^,{/w,l/en,-/w,1/m,}/w, ,\/w,tag/en,{/w,bp/en,4/m,}/w, ,\/w,]/w,for/en, ,layer/en, ,in/en, ,np/en,./w,arange/en,(/w,0/m,,/w,len/en,(/w,self/en,./w,w/en,)/w,)/w,:/w, ,self/en,./w,w/en,[/w,layer/en,]/w, ,+/w,=/w, ,-/w,self/en,./w,alpha/en, ,*/w, ,a/en,[/w,layer/en,]/w,./w,t/en,./w,dot/en,(/w,d/en,[/w,layer/en,]/w,)/w,首先/d,求得/v,权值/nw,和/c,偏置/nw,的/u,导数/n,（/w,权值/nw,和/c,偏置/nw,统一/vn,到/v,同一个/r,矩阵/n,中/f,）/w,a/en,[/w