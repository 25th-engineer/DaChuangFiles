作者 魏秀参/nr 链接 https / / zhuanlan . zhihu . 
com / p / 21824299 来源 知乎 著作权 归 作者 
所有 商业 转载 请 联系 作者 获得 授权 非商业 转载 
请 注明 出处 说起 特斯拉 大家 可能 立马 会 想到 
今年 5 月份 发生 在 特斯拉 Model 自动驾驶 上 的 
一宗 夺命 车祸 初步 的 调查 表明 在 强烈 的 
日照 条件 下 驾驶员/n 和/c 自动/vn 驾驶/v 系统/n 都/d 未能/v 
注意到/i 牵引式/nz 挂车/v 的/uj 白色/n 车身/n 因此 未能 及时 启动 
刹车 系统 而 由于 牵引式 挂车 正在 横穿 公路 且 
车身 较高 这一 特殊 情况 导致 Model 从 挂车 底部 
通过 时 其 前 挡风 玻璃 与 挂车 底部 发生 
撞击 导致 驾驶员 不幸遇难 无独有偶 8月 8日 美国 密苏里州 的 
一名 男子 特斯拉 Model X 车主 约书亚 尼 利 Joshua 
Neally 在 上班 途中 突发 肺栓塞 在 Model X 的 
Autopilot 自动驾驶 功能 的 帮助 下 他 安全 抵达 了 
医院 这 一 抑 一 扬 着实 让 人 回味无穷 
略 有些 败也萧何 成也萧何 之意 好奇 的 读者 一定会 有 
疑问 这 一成 一 败 背后 的 原理 到底 是 
什么 是 自动 驾驶 系统 中 的 哪个 部分 发生 
了 失误 而 造成 车祸 又是 哪 部分 技术 支撑 
了 自动 驾驶 过程 呢 今天 我们 就 来 谈谈 
自动 驾驶 系统 中 的 一项 重要 核心技术 图像 语义 
分割 Semantic image segmentation 图像 语义 分割 作为 计算机 视觉 
Computer vision 中 图像 理解 Image understanding 的 重要 一环 
不仅 在 工业界 的 需求 日益 凸显 同时 语义 分割 
也是 当下 学术界 的 研究 热点 之一 什么 是 图像 
语义 分割 图像 语义 分割 可以说 是 图像 理解 的 
基石 性 技术 在 自动 驾驶 系统 具体 为 街景 
识别 与 理解 无人机 应用 着陆点 判断 以及 穿戴 式 
设备 应用 中 举足轻重 我们 都 知道 图像 是 由 
许多 像素 Pixel 组成 而 「 语义 分割 」 顾名思义 
就是 将 像素 按照 图像 中 表达 语义 含义 的 
不同 进行 分组 Grouping ／ 分割 Segmentation 下图 取自 图像 
分割 领域 的 标准 数据集 之一 PASCAL VOC 其中 左图 
为 原始 图像 右 图为 分割 任务 的 真实 标记 
Ground truth 红色 区域 表示 语义 为 person 的 图像 
像素 区域 蓝绿色 代表 motorbike 语义 区域 黑色 表示 background 
白色 边 则 表示 未 标记 区域 显然 在 图像 
语义 分割 任务 中 其 输入 为 一张 的 三 
通道 彩色图像 输出 则是 对应 的 一个 矩阵 矩阵 的 
每一个 元素 表明 了 原图 中 对应 位置 像素 所 
表示 的 语义 类别 Semantic label 因此 图像 语义 分割 
也 称为 图像 语义 标注 Image semantic labeling 像素 语义 
标注 Semantic pixel labeling 或 像素 语义 分组 Semantic pixel 
grouping 从/p 上图/v 和题/nr 图中/i 大家 可以 明显 看出 图像 
语义 分割 任务 的 难点 便 在于 这 语义 二字 
在 真实 图像 中 表达 某一 语义 的 同一 物体 
常由/nr 不同 部件 组成 如 building motorbike person 等 同时 
这些 部分 往往 有着 不同 的 颜色 纹理 甚至 亮度 
如 building 这 给 图像 语义 的 精确 分割 带来 
了 困难 和 挑战 前 DL 时代 的 语义 分割 
从 最简单 的 像素 级别 阈值 法 Thresholding methods 基于 
像素 聚 类 的 分割 方法 Clustering based segmentation methods 
到 图 划分 的 分割 方法 Graph partitioning segmentation methods 
在 深度 学习 Deep learning DL 一统江湖 之前 图像 语义 
分割 方面 的 工作 可谓 百花齐放 在此 我们 仅以 Normalized 
cut 1 和 Grab cut 2 这 两个 基于 图 
划分 的 经典 分割 方法 为例 介绍 一下 前 DL 
时代 语义 分割 方面 的 研究 Normalized cut N cut 
方法 是 基于 图 划分 Graph partitioning 的 语义 分割 
方法 中 最 著名 的 方法 之一 于 2000年 Jianbo 
Shi 和 Jitendra Malik 发表 于 相关 领域 顶级 期刊 
TPAMI 通常 传统 基于 图 划分 的 语义 分割 方法 
都是 将 图像 抽象 为图 Graph 的 形式 为图 节点 
为图 的 边 然后 借助 图 理论 Graph theory 中 
的 理论 和 算法 进行 图像 的 语义 分割 常用 
的 方法 为 经典 的 最小 割 算法 Min cut 
algorithm 不过 在 边的/nr 权重 计算 时 经典 min cut 
算法 只 考虑 了 局部 信息 如下 图 所示 以 
二分 图 为例 将 分为 不 相交 的 两部分 若 
只 考虑 局部 信息 那么 分离出 一个点 显然 是 一个 
min cut 因此 图 划分 的 结果 便 是 类似 
或 这样 离群 点 而从 全局 来看 实际 想 分成 
的 组 却是 左右 两 大部分 针对 这一 情形 N 
cut 则 提出 了 一种 考虑 全局 信息 的 方法 
来 进行 图 划分 Graph partitioning 即 将 两个 分割部分 
与 全图 节点 的 连接 权重 和 考虑 进去 . 
如此一来 在 离群 点 划分 中 中的 某一 项会/nr 接近 
1 而 这样 的 图 划分 显然 不能 使得 是 
一个 较小 的 值 故 达到 考虑 全局 信息 而 
摒弃 划分 离群 点 的 目的 这样 的 操作 类似于 
机器学习 中 特征 的 规范化 Normalization 操作 故 称为 Normalized 
cut N cut 不仅 可以 处理 二类 语义 分割 而且 
将 二分 图 扩展 为 路 way 图 划分 即可 
完成 多 语义 的 图像 语义 分割 如下 图例 Grab 
cut 是 微软 剑桥 研究院 于 2004年 提出 的 著名 
交互式 图像 语义 分割 方法 与 N cut 一样 grab 
cut 同样 也 是 基于 图 划分 不过 grab cut 
是 其 改进 版本 可以 看作 迭代 式 的 语义 
分割 算法 Grab cut 利用 了 图像 中 的 纹理 
颜色 信息 和 边界 反差 信息 只要 少量 的 用户 
交互 操作 即可 得到 比较 好 的 前后 背景 分割 
结果 在 Grab cut 中 RGB 图像 的 前景 和 
背景 分别 用 一个 高斯 混合模型 Gaussian mixture model GMM 
来 建模 两个 GMM 分别 用以 刻画 某 像素 属于 
前景 或 背景 的 概率 每个 GMM 高斯 部件 Gaussian 
component 个数 一般 设为 接下来 利用 吉布斯 能量 方程 Gibbs 
energy function 对 整张 图像 进行 全局 刻画 而后 迭代 
求取 使得 能量 方程 达到 最优 值 的 参数 作为 
两个 GMM 的 最优 参数 GMM 确定 后 某 像素 
属于 前景 或 背景 的 概率 就 随之 确定 下来 
在与 用户 交互 的 过程 中 Grab cut 提供 两种 
交互方式 一种 以 包围 框 Bounding box 为 辅助 信息 
另一种 以 涂写 的 线条 Scribbled line 作为 辅助 信息 
以 下图 为例 用户 在 开始 时 提供 一个 包围 
框 grab cut 默认 的 认为 框 中 像素 中 
包含 主要 物体 ／ 前景 此后 经过 迭代 图 划分 
求解 即可 返回 扣出 的 前景 结果 可以 发现 即使 
是 对于 背景 稍微 复杂 一些 的 图像 grab cut 
仍有 不俗 表现 不过 在 处理 下图 时 grab cut 
的 分割 效果 则 不能 令人满意 此时 需要 额外 人为 
的 提供 更强 的 辅助 信息 用 红色 线条 ／ 
点 标明 背景 区域 同时 用 白色 线条 标明 前景 
区域 在此 基础 上 再次 运行 grab cut 算法 求取 
最优 解 即可 得到 较为 满意 的 语义 分割 结果 
Grab cut 虽 效果 优良 但 缺点 也 非常 明显 
一是 仅能 处理 二类 语义 分割 问题 二 是 需要 
人 为 干预 而 不能 做到 完全 自动化 DL 时代 
的 语义 分割 其实 大家 不难看出 前 DL 时代 的 
语义 分割 工作 多 是 根据 图像 像素 自身 的 
低阶 视觉 信息 Low level visual cues 来 进行 图像 
分割 由于 这样 的 方法 没有 算法 训练 阶段 因此 
往往 计算 复杂度 不高 但是 在 较 困难 的 分割 
任务 上 如果 不 提供 人为 的 辅助 信息 其 
分割 效果 并 不能 令人满意 在/p 计算机/n 视觉/n 步入/n 深度/ns 
学习/v 时代/nr 之后/f 语义 分割 同样 也 进入 了 全新 
的 发展 阶段 以 全 卷积 神经网络 Fully convolutional networks 
FCN 为 代表 的 一系列 基于 卷积 神经网络 训练 的 
语义 分割 方法 相继 提出 屡屡 刷新 图像 语义 分割 
精度 下面 就 介绍 三 种在 DL 时代 语义 分割 
领域 的 代表性 做法 全 卷积 神经网络 3 全 卷积 
神经网络 FCN 可以说 是 深度 学习 在 图像 语义 分割 
任务 上 的 开创性 工作 出自 UC Berkeley 的 Trevor 
Darrell 组 发表 于 计算机 视觉 领域 顶级 会议 CVPR 
2015 并 荣获 best paper honorable mention FCN 的 思想 
很 直观 即 直接 进行 像素 级别 端 到 端 
end to end 的 语义 分割 它 可以 基于 主流 
的 深度 卷积 神经网络 模型 CNN 来 实现 正所谓 全 
卷积 神经网络 在 FCN 中 传统/n 的/uj 全/a 连接/v 层/q 
fc6/i 和/c fc7/i 均是由/n 卷积/n 层/q 实现/v 而 最后 的 
fc8 层 则 被 替代 为 一个 21 通道 channel 
的 1x1 卷积 层 作为 网络 的 最终 输出 之所以 
有 21个 通道 是 因为 PASCAL VOC 的 数据 中 
包含 21个 类别 20个 object 类别 和 一个 background 类别 
下图 为 FCN 的 网络结构 若 原 图为 在/p 经过/p 
若干/m 堆叠/v 的/uj 卷积/n 和池化/nr 层/q 操作/v 后/f 可以/c 得到/v 
原图/n 对应/vn 的/uj 响应/v 张量/nr Activation tensor 其中 为 第 
层 的 通道 数 可以 发现 由 于池 化 层 
的 下 采样 作用 使得/v 响应/v 张量/nr 的/uj 长/a 和宽远/nr 
小于/v 原图/n 的/uj 长/a 和宽/nr 这 便给 像素 级别 的 
直接 训练 带来 问题 为了 解决 下 采样 带来 的 
问题 FCN 利用 双 线性插值 将 响应 张亮 的 长宽 
上 采样 到 原图 大小 另外 为了 更好 的 预测 
图像 中 的 细节 部分 FCN 还将 网络 中 浅层 
的 响应 也 考虑 进来 具体来说 就是 将 Pool4 和 
Pool3 的 响应 也 拿来 分别 作为 模型 FCN 16s 
和 FCN 8s 的 输出 与 原来 FCN 32s 的 
输出 结合 在 一起 做 最终 的 语义 分割 预测 
如下 图 所示 下图 是 不同 层 作为 输出 的 
语义 分割 结果 可以 明显 看出 由 于池 化 层 
的 下 采样 倍数 的 不同 导致 不同 的 语义 
分割 精细 程度 如 FCN 32s 由于/c 是/v FCN/w 的/uj 
最后/f 一层/m 卷积/n 和/c 池化的/nr 输出/v 该 模型 的 下 
采样 倍数 最高 其 对应 的 语义 分割 结果 最为 
粗略 而 FCN 8s 则 因 下 采样 倍数 较小 
可以 取得 较为 精细 的 分割 结果 Dilated Convolutions 4 
FCN 的 一个 不足 之 处 在于 由 于池 化 
层 的 存在 响应 张量 的 大小 长 和宽/nr 越来越 
小 但是 FCN 的 设计 初衷 则 需要 和 输入 
大小 一致 的 输出 因此 FCN 做了 上 采样 但是 
上 采样 并 不能 将 丢失 的 信息 全部 无损 
地 找回来 对此 dilated convolution 是 一种 很好 的 解决方案 
既然 池化的/nr 下 采样 操作 会 带来 信息 损失 那么 
就把 池化层/nr 去掉 但是 池化层/nr 去掉 随之 带来 的 是 
网络 各层 的 感受 野 Receptive field 变小 这样 会 
降低 整个 模型 的 预测 精度 Dilated convolution 的 主要 
贡献 就是 如何 在 去掉 池化下/nr 采样 操作 的 同时 
而不 降低 网络 的 感受 野 以 的 卷积 核 
为例 传统 卷积 核 在做 卷积 操作 时 是 将 
卷积 核 与 输入 张量 中 连续 的 的 patch 
逐点 相乘 再 求和 如 下图 a 红色 圆点 为 
卷积 核 对应 的 输入 像素 绿色 为其 在 原 
输入 中的 感知 野 而 dilated convolution 中的 卷积 核 
则是 将 输入 张量 的 patch 隔 一定 的 像素 
进行 卷积 运算 如 下图 b 所示 在 去掉 一层 
池化层/nr 后 需要/v 在/p 去掉/v 的/uj 池化层/nr 后将/nr 传统/n 卷积/n 
层/q 换/nz 做一个/i dilation = 2 的 dilated convolution 层 
此时 卷积 核 将 输入 张量 每隔 一个 像素 的 
位置 作为 输入 patch 进行 卷积 计算 可以 发现 这 
时 对应 到 原 输入 的 感知 野 已经 扩大 
dilate 为 同理 如果 再 去掉 一个 池化层/nr 就要 将其 
之后 的 卷积 层 换成 dilation = 4 的 dilated 
convolution 层 如图 c 所示 这样一来 即使 去掉 池化层/nr 也能 
保证 网络 的 感受 野 从而 确保 图像 语义 分割 
的 精度 从 下面 的 几个 图像 语义 分割 效果图 
可以 看出 在 使用 了 dilated convolution 这一 技术 后 
可以 大幅 提高 语义 类别 的 辨识度 以及 分割 细节 
的 精细 度 以 条件 随 机场 为 代表 的 
后处理 操作 当下 许多 以 深度 学习 为 框架 的 
图像 语义 分割 工作 都是 用了 条件 随 机场 Conditional 
random field CRF 作为 最后 的 后处理 操作 来 对 
语义 预测 结果 进行 优化 一般来讲 CRF 将 图像 中 
每个 像素点 所属 的 类别 都 看作 一个 变量 然后 
考虑 任意 两个 变量 之间 的 关系 建立 一个 完全 
图 如下 图 所示 在 全 链接 的 CRF 模型 
中 对应 的 能量 函数 为 其中 是 一元 项 
表示 像素 对应 的 语义 类别 其 类别 可以 由 
FCN 或者 其他 语义 分割 模型 的 预测 结果 得到 
而 第二 项为/nr 二元 项 二元 项 可将 像素 之间 
的 语义 联系 ／ 关系 考虑 进去 例如 天空 和 
鸟 这样 的 像素 在 物理 空间 是 相邻 的 
概率 应该 要比 天空 和 鱼 这样 像素 的 相邻 
概率 大 最后 通过 对 CRF 能量 函数 的 优化 
求解 得到 对 FCN 的 图像 语义 预测 结果 进行 
优化 得到 最终 的 语义 分割 结果 值得一提的是 已经 有 
工作 5 将 原本 与 深度 模型 训练 割 裂开 
的 CRF 过程 嵌入 到 神经网络 内部 即 将 FCN 
+ CRF 的 过程 整合 到 一个 端 到 端的 
系统 中 这样 做 的 好处 是 CRF 最后 预测 
结果 的 能量 函数 可以 直接 用来 指导 FCN 模型 
参数 的 训练 而 取得 更好 的 图像 语义 分割 
结果 展望 俗话说 没有 免费 的 午餐 No free lunch 
基于 深度 学习 的 图像 语义 分割 技术 虽然 可以 
取得 相比 传统 方法 突飞猛进 的 分割 效果 但是 其 
对 数据 标注 的 要求 过高 不仅 需要 海量 图像 
数据 同时 这些 图像 还需 提供 精确 到 像素 级别 
的 标记 信息 Semantic labels 因此 越来越 多 的 研究 
者 开始 将 注意力 转移 到 弱 监督 Weakly supervised 
条件 下 的 图像 语义 分割 问题 上 在 这类 
问题 中 图像 仅 需 提供 图像 级别 标注 如 
有 人 有 车 无 电视 而 不 需要 昂贵 
的 像素 级别 信息 即可 取得 与 现有 方法 可比 
的 语义 分割 精度 另外 示例 级别 Instance level 的 
图像 语义 分割 问题 也 同样 热门 该类 问题 不仅 
需要 对 不同 语义 物体 进行 图像 分割 同时 还 
要求 对 同一 语义 的 不同 个体 进行 分割 例如 
需要 对 图 中 出现 的 九把 椅子 的 像素 
用 不同 颜色 分别 标示 出来 最后 基于 视频 的 
前景 ／ 物体 分割 Video segmentation 也是 今后 计算机 视觉 
语义 分割 领域 的 新 热点 之一 这一 设定 其实 
更加 贴合 自动 驾驶 系统 的 真实 应用环境 首 发于 
机器 之心 公众 号 链接 请 戳 专栏 | 从 
特斯拉 到 计算机 视觉 之 「 图像 语义 分割 」 
作者 魏秀参/nr 谢晨 伟 References 1 Jianbo Shi and Jitendra 
Malik . Normalized Cuts and Image Segmentation IEEE Transactions on 
Pattern Analysis and Machine Intelligence Vol . 22 No . 
8 2000 . 2 Carsten Rother Vladimir Kolmogorov and Andrew 
Blake . GrabCut Interactive Foreground Extraction using Iterated Graph Cuts 
ACM Transactions on Graphics 2004 . 3 Jonathan Long Evan 
Shelhamer and Trevor Darrell . Fully Convolutional Networks for Semantic 
Segmentation . IEEE Conference on Computer Vision and Pattern Recognition 
2015 . 4 Fisher Yu and Vladlen Koltun . Multi 
scale Context Aggregation by Dilated Convolutions . International Conference on 
Representation Learning 2016 . 5 Shuai Zheng Sadeep Jayasumana Bernardino 
Romera Paredes Vibhav Vineet Zhizhong Su Dalong Du Chang Huang 
and Philip H . . Torr . Conditional Random Fields 
as Recurrent Neural Networks . International Conference on Computer Vision 
2015 . 作者 魏秀参/nr 链接 https / / zhuanlan . zhihu . 
com / p / 21824299 来源 知乎 著作权 归 作者 
所有 商业 转载 请 联系 作者 获得 授权 非商业 转载 
请 注明 出处 说起 特斯拉 大家 可能 立马 会 想到 
今年 5 月份 发生 在 特斯拉 Model 自动驾驶 上 的 
一宗 夺命 车祸 初步 的 调查 表明 在 强烈 的 
日照 条件 下 驾驶员/n 和/c 自动/vn 驾驶/v 系统/n 都/d 未能/v 
注意到/i 牵引式/nz 挂车/v 的/uj 白色/n 车身/n 因此 未能 及时 启动 
刹车 系统 而 由于 牵引式 挂车 正在 横穿 公路 且 
车身 较高 这一 特殊 情况 导致 Model 从 挂车 底部 
通过 时 其 前 挡风 玻璃 与 挂车 底部 发生 
撞击 导致 驾驶员 不幸遇难 无独有偶 8月 8日 美国 密苏里州 的 
一名 男子 特斯拉 Model X 车主 约书亚 尼 利 Joshua 
Neally 在 上班 途中 突发 肺栓塞 在 Model X 的 
Autopilot 自动驾驶 功能 的 帮助 下 他 安全 抵达 了 
医院 这 一 抑 一 扬 着实 让 人 回味无穷 
略 有些 败也萧何 成也萧何 之意 好奇 的 读者 一定会 有 
疑问 这 一成 一 败 背后 的 原理 到底 是 
什么 是 自动 驾驶 系统 中 的 哪个 部分 发生 
了 失误 而 造成 车祸 又是 哪 部分 技术 支撑 
了 自动 驾驶 过程 呢 今天 我们 就 来 谈谈 
自动 驾驶 系统 中 的 一项 重要 核心技术 图像 语义 
分割 Semantic image segmentation 图像 语义 分割 作为 计算机 视觉 
Computer vision 中 图像 理解 Image understanding 的 重要 一环 
不仅 在 工业界 的 需求 日益 凸显 同时 语义 分割 
也是 当下 学术界 的 研究 热点 之一 什么 是 图像 
语义 分割 图像 语义 分割 可以说 是 图像 理解 的 
基石 性 技术 在 自动 驾驶 系统 具体 为 街景 
识别 与 理解 无人机 应用 着陆点 判断 以及 穿戴 式 
设备 应用 中 举足轻重 我们 都 知道 图像 是 由 
许多 像素 Pixel 组成 而 「 语义 分割 」 顾名思义 
就是 将 像素 按照 图像 中 表达 语义 含义 的 
不同 进行 分组 Grouping ／ 分割 Segmentation 下图 取自 图像 
分割 领域 的 标准 数据集 之一 PASCAL VOC 其中 左图 
为 原始 图像 右 图为 分割 任务 的 真实 标记 
Ground truth 红色 区域 表示 语义 为 person 的 图像 
像素 区域 蓝绿色 代表 motorbike 语义 区域 黑色 表示 background 
白色 边 则 表示 未 标记 区域 显然 在 图像 
语义 分割 任务 中 其 输入 为 一张 的 三 
通道 彩色图像 输出 则是 对应 的 一个 矩阵 矩阵 的 
每一个 元素 表明 了 原图 中 对应 位置 像素 所 
表示 的 语义 类别 Semantic label 因此 图像 语义 分割 
也 称为 图像 语义 标注 Image semantic labeling 像素 语义 
标注 Semantic pixel labeling 或 像素 语义 分组 Semantic pixel 
grouping 从/p 上图/v 和题/nr 图中/i 大家 可以 明显 看出 图像 
语义 分割 任务 的 难点 便 在于 这 语义 二字 
在 真实 图像 中 表达 某一 语义 的 同一 物体 
常由/nr 不同 部件 组成 如 building motorbike person 等 同时 
这些 部分 往往 有着 不同 的 颜色 纹理 甚至 亮度 
如 building 这 给 图像 语义 的 精确 分割 带来 
了 困难 和 挑战 前 DL 时代 的 语义 分割 
从 最简单 的 像素 级别 阈值 法 Thresholding methods 基于 
像素 聚 类 的 分割 方法 Clustering based segmentation methods 
到 图 划分 的 分割 方法 Graph partitioning segmentation methods 
在 深度 学习 Deep learning DL 一统江湖 之前 图像 语义 
分割 方面 的 工作 可谓 百花齐放 在此 我们 仅以 Normalized 
cut 1 和 Grab cut 2 这 两个 基于 图 
划分 的 经典 分割 方法 为例 介绍 一下 前 DL 
时代 语义 分割 方面 的 研究 Normalized cut N cut 
方法 是 基于 图 划分 Graph partitioning 的 语义 分割 
方法 中 最 著名 的 方法 之一 于 2000年 Jianbo 
Shi 和 Jitendra Malik 发表 于 相关 领域 顶级 期刊 
TPAMI 通常 传统 基于 图 划分 的 语义 分割 方法 
都是 将 图像 抽象 为图 Graph 的 形式 为图 节点 
为图 的 边 然后 借助 图 理论 Graph theory 中 
的 理论 和 算法 进行 图像 的 语义 分割 常用 
的 方法 为 经典 的 最小 割 算法 Min cut 
algorithm 不过 在 边的/nr 权重 计算 时 经典 min cut 
算法 只 考虑 了 局部 信息 如下 图 所示 以 
二分 图 为例 将 分为 不 相交 的 两部分 若 
只 考虑 局部 信息 那么 分离出 一个点 显然 是 一个 
min cut 因此 图 划分 的 结果 便 是 类似 
或 这样 离群 点 而从 全局 来看 实际 想 分成 
的 组 却是 左右 两 大部分 针对 这一 情形 N 
cut 则 提出 了 一种 考虑 全局 信息 的 方法 
来 进行 图 划分 Graph partitioning 即 将 两个 分割部分 
与 全图 节点 的 连接 权重 和 考虑 进去 . 
如此一来 在 离群 点 划分 中 中的 某一 项会/nr 接近 
1 而 这样 的 图 划分 显然 不能 使得 是 
一个 较小 的 值 故 达到 考虑 全局 信息 而 
摒弃 划分 离群 点 的 目的 这样 的 操作 类似于 
机器学习 中 特征 的 规范化 Normalization 操作 故 称为 Normalized 
cut N cut 不仅 可以 处理 二类 语义 分割 而且 
将 二分 图 扩展 为 路 way 图 划分 即可 
完成 多 语义 的 图像 语义 分割 如下 图例 Grab 
cut 是 微软 剑桥 研究院 于 2004年 提出 的 著名 
交互式 图像 语义 分割 方法 与 N cut 一样 grab 
cut 同样 也 是 基于 图 划分 不过 grab cut 
是 其 改进 版本 可以 看作 迭代 式 的 语义 
分割 算法 Grab cut 利用 了 图像 中 的 纹理 
颜色 信息 和 边界 反差 信息 只要 少量 的 用户 
交互 操作 即可 得到 比较 好 的 前后 背景 分割 
结果 在 Grab cut 中 RGB 图像 的 前景 和 
背景 分别 用 一个 高斯 混合模型 Gaussian mixture model GMM 
来 建模 两个 GMM 分别 用以 刻画 某 像素 属于 
前景 或 背景 的 概率 每个 GMM 高斯 部件 Gaussian 
component 个数 一般 设为 接下来 利用 吉布斯 能量 方程 Gibbs 
energy function 对 整张 图像 进行 全局 刻画 而后 迭代 
求取 使得 能量 方程 达到 最优 值 的 参数 作为 
两个 GMM 的 最优 参数 GMM 确定 后 某 像素 
属于 前景 或 背景 的 概率 就 随之 确定 下来 
在与 用户 交互 的 过程 中 Grab cut 提供 两种 
交互方式 一种 以 包围 框 Bounding box 为 辅助 信息 
另一种 以 涂写 的 线条 Scribbled line 作为 辅助 信息 
以 下图 为例 用户 在 开始 时 提供 一个 包围 
框 grab cut 默认 的 认为 框 中 像素 中 
包含 主要 物体 ／ 前景 此后 经过 迭代 图 划分 
求解 即可 返回 扣出 的 前景 结果 可以 发现 即使 
是 对于 背景 稍微 复杂 一些 的 图像 grab cut 
仍有 不俗 表现 不过 在 处理 下图 时 grab cut 
的 分割 效果 则 不能 令人满意 此时 需要 额外 人为 
的 提供 更强 的 辅助 信息 用 红色 线条 ／ 
点 标明 背景 区域 同时 用 白色 线条 标明 前景 
区域 在此 基础 上 再次 运行 grab cut 算法 求取 
最优 解 即可 得到 较为 满意 的 语义 分割 结果 
Grab cut 虽 效果 优良 但 缺点 也 非常 明显 
一是 仅能 处理 二类 语义 分割 问题 二 是 需要 
人 为 干预 而 不能 做到 完全 自动化 DL 时代 
的 语义 分割 其实 大家 不难看出 前 DL 时代 的 
语义 分割 工作 多 是 根据 图像 像素 自身 的 
低阶 视觉 信息 Low level visual cues 来 进行 图像 
分割 由于 这样 的 方法 没有 算法 训练 阶段 因此 
往往 计算 复杂度 不高 但是 在 较 困难 的 分割 
任务 上 如果 不 提供 人为 的 辅助 信息 其 
分割 效果 并 不能 令人满意 在/p 计算机/n 视觉/n 步入/n 深度/ns 
学习/v 时代/nr 之后/f 语义 分割 同样 也 进入 了 全新 
的 发展 阶段 以 全 卷积 神经网络 Fully convolutional networks 
FCN 为 代表 的 一系列 基于 卷积 神经网络 训练 的 
语义 分割 方法 相继 提出 屡屡 刷新 图像 语义 分割 
精度 下面 就 介绍 三 种在 DL 时代 语义 分割 
领域 的 代表性 做法 全 卷积 神经网络 3 全 卷积 
神经网络 FCN 可以说 是 深度 学习 在 图像 语义 分割 
任务 上 的 开创性 工作 出自 UC Berkeley 的 Trevor 
Darrell 组 发表 于 计算机 视觉 领域 顶级 会议 CVPR 
2015 并 荣获 best paper honorable mention FCN 的 思想 
很 直观 即 直接 进行 像素 级别 端 到 端 
end to end 的 语义 分割 它 可以 基于 主流 
的 深度 卷积 神经网络 模型 CNN 来 实现 正所谓 全 
卷积 神经网络 在 FCN 中 传统/n 的/uj 全/a 连接/v 层/q 
fc6/i 和/c fc7/i 均是由/n 卷积/n 层/q 实现/v 而 最后 的 
fc8 层 则 被 替代 为 一个 21 通道 channel 
的 1x1 卷积 层 作为 网络 的 最终 输出 之所以 
有 21个 通道 是 因为 PASCAL VOC 的 数据 中 
包含 21个 类别 20个 object 类别 和 一个 background 类别 
下图 为 FCN 的 网络结构 若 原 图为 在/p 经过/p 
若干/m 堆叠/v 的/uj 卷积/n 和池化/nr 层/q 操作/v 后/f 可以/c 得到/v 
原图/n 对应/vn 的/uj 响应/v 张量/nr Activation tensor 其中 为 第 
层 的 通道 数 可以 发现 由 于池 化 层 
的 下 采样 作用 使得/v 响应/v 张量/nr 的/uj 长/a 和宽远/nr 
小于/v 原图/n 的/uj 长/a 和宽/nr 这 便给 像素 级别 的 
直接 训练 带来 问题 为了 解决 下 采样 带来 的 
问题 FCN 利用 双 线性插值 将 响应 张亮 的 长宽 
上 采样 到 原图 大小 另外 为了 更好 的 预测 
图像 中 的 细节 部分 FCN 还将 网络 中 浅层 
的 响应 也 考虑 进来 具体来说 就是 将 Pool4 和 
Pool3 的 响应 也 拿来 分别 作为 模型 FCN 16s 
和 FCN 8s 的 输出 与 原来 FCN 32s 的 
输出 结合 在 一起 做 最终 的 语义 分割 预测 
如下 图 所示 下图 是 不同 层 作为 输出 的 
语义 分割 结果 可以 明显 看出 由 于池 化 层 
的 下 采样 倍数 的 不同 导致 不同 的 语义 
分割 精细 程度 如 FCN 32s 由于/c 是/v FCN/w 的/uj 
最后/f 一层/m 卷积/n 和/c 池化的/nr 输出/v 该 模型 的 下 
采样 倍数 最高 其 对应 的 语义 分割 结果 最为 
粗略 而 FCN 8s 则 因 下 采样 倍数 较小 
可以 取得 较为 精细 的 分割 结果 Dilated Convolutions 4 
FCN 的 一个 不足 之 处 在于 由 于池 化 
层 的 存在 响应 张量 的 大小 长 和宽/nr 越来越 
小 但是 FCN 的 设计 初衷 则 需要 和 输入 
大小 一致 的 输出 因此 FCN 做了 上 采样 但是 
上 采样 并 不能 将 丢失 的 信息 全部 无损 
地 找回来 对此 dilated convolution 是 一种 很好 的 解决方案 
既然 池化的/nr 下 采样 操作 会 带来 信息 损失 那么 
就把 池化层/nr 去掉 但是 池化层/nr 去掉 随之 带来 的 是 
网络 各层 的 感受 野 Receptive field 变小 这样 会 
降低 整个 模型 的 预测 精度 Dilated convolution 的 主要 
贡献 就是 如何 在 去掉 池化下/nr 采样 操作 的 同时 
而不 降低 网络 的 感受 野 以 的 卷积 核 
为例 传统 卷积 核 在做 卷积 操作 时 是 将 
卷积 核 与 输入 张量 中 连续 的 的 patch 
逐点 相乘 再 求和 如 下图 a 红色 圆点 为 
卷积 核 对应 的 输入 像素 绿色 为其 在 原 
输入 中的 感知 野 而 dilated convolution 中的 卷积 核 
则是 将 输入 张量 的 patch 隔 一定 的 像素 
进行 卷积 运算 如 下图 b 所示 在 去掉 一层 
池化层/nr 后 需要/v 在/p 去掉/v 的/uj 池化层/nr 后将/nr 传统/n 卷积/n 
层/q 换/nz 做一个/i dilation = 2 的 dilated convolution 层 
此时 卷积 核 将 输入 张量 每隔 一个 像素 的 
位置 作为 输入 patch 进行 卷积 计算 可以 发现 这 
时 对应 到 原 输入 的 感知 野 已经 扩大 
dilate 为 同理 如果 再 去掉 一个 池化层/nr 就要 将其 
之后 的 卷积 层 换成 dilation = 4 的 dilated 
convolution 层 如图 c 所示 这样一来 即使 去掉 池化层/nr 也能 
保证 网络 的 感受 野 从而 确保 图像 语义 分割 
的 精度 从 下面 的 几个 图像 语义 分割 效果图 
可以 看出 在 使用 了 dilated convolution 这一 技术 后 
可以 大幅 提高 语义 类别 的 辨识度 以及 分割 细节 
的 精细 度 以 条件 随 机场 为 代表 的 
后处理 操作 当下 许多 以 深度 学习 为 框架 的 
图像 语义 分割 工作 都是 用了 条件 随 机场 Conditional 
random field CRF 作为 最后 的 后处理 操作 来 对 
语义 预测 结果 进行 优化 一般来讲 CRF 将 图像 中 
每个 像素点 所属 的 类别 都 看作 一个 变量 然后 
考虑 任意 两个 变量 之间 的 关系 建立 一个 完全 
图 如下 图 所示 在 全 链接 的 CRF 模型 
中 对应 的 能量 函数 为 其中 是 一元 项 
表示 像素 对应 的 语义 类别 其 类别 可以 由 
FCN 或者 其他 语义 分割 模型 的 预测 结果 得到 
而 第二 项为/nr 二元 项 二元 项 可将 像素 之间 
的 语义 联系 ／ 关系 考虑 进去 例如 天空 和 
鸟 这样 的 像素 在 物理 空间 是 相邻 的 
概率 应该 要比 天空 和 鱼 这样 像素 的 相邻 
概率 大 最后 通过 对 CRF 能量 函数 的 优化 
求解 得到 对 FCN 的 图像 语义 预测 结果 进行 
优化 得到 最终 的 语义 分割 结果 值得一提的是 已经 有 
工作 5 将 原本 与 深度 模型 训练 割 裂开 
的 CRF 过程 嵌入 到 神经网络 内部 即 将 FCN 
+ CRF 的 过程 整合 到 一个 端 到 端的 
系统 中 这样 做 的 好处 是 CRF 最后 预测 
结果 的 能量 函数 可以 直接 用来 指导 FCN 模型 
参数 的 训练 而 取得 更好 的 图像 语义 分割 
结果 展望 俗话说 没有 免费 的 午餐 No free lunch 
基于 深度 学习 的 图像 语义 分割 技术 虽然 可以 
取得 相比 传统 方法 突飞猛进 的 分割 效果 但是 其 
对 数据 标注 的 要求 过高 不仅 需要 海量 图像 
数据 同时 这些 图像 还需 提供 精确 到 像素 级别 
的 标记 信息 Semantic labels 因此 越来越 多 的 研究 
者 开始 将 注意力 转移 到 弱 监督 Weakly supervised 
条件 下 的 图像 语义 分割 问题 上 在 这类 
问题 中 图像 仅 需 提供 图像 级别 标注 如 
有 人 有 车 无 电视 而 不 需要 昂贵 
的 像素 级别 信息 即可 取得 与 现有 方法 可比 
的 语义 分割 精度 另外 示例 级别 Instance level 的 
图像 语义 分割 问题 也 同样 热门 该类 问题 不仅 
需要 对 不同 语义 物体 进行 图像 分割 同时 还 
要求 对 同一 语义 的 不同 个体 进行 分割 例如 
需要 对 图 中 出现 的 九把 椅子 的 像素 
用 不同 颜色 分别 标示 出来 最后 基于 视频 的 
前景 ／ 物体 分割 Video segmentation 也是 今后 计算机 视觉 
语义 分割 领域 的 新 热点 之一 这一 设定 其实 
更加 贴合 自动 驾驶 系统 的 真实 应用环境 首 发于 
机器 之心 公众 号 链接 请 戳 专栏 | 从 
特斯拉 到 计算机 视觉 之 「 图像 语义 分割 」 
作者 魏秀参/nr 谢晨 伟 References 1 Jianbo Shi and Jitendra 
Malik . Normalized Cuts and Image Segmentation IEEE Transactions on 
Pattern Analysis and Machine Intelligence Vol . 22 No . 
8 2000 . 2 Carsten Rother Vladimir Kolmogorov and Andrew 
Blake . GrabCut Interactive Foreground Extraction using Iterated Graph Cuts 
ACM Transactions on Graphics 2004 . 3 Jonathan Long Evan 
Shelhamer and Trevor Darrell . Fully Convolutional Networks for Semantic 
Segmentation . IEEE Conference on Computer Vision and Pattern Recognition 
2015 . 4 Fisher Yu and Vladlen Koltun . Multi 
scale Context Aggregation by Dilated Convolutions . International Conference on 
Representation Learning 2016 . 5 Shuai Zheng Sadeep Jayasumana Bernardino 
Romera Paredes Vibhav Vineet Zhizhong Su Dalong Du Chang Huang 
and Philip H . . Torr . Conditional Random Fields 
as Recurrent Neural Networks . International Conference on Computer Vision 
2015 . 作者 魏秀参/nr 链接 https / / zhuanlan . zhihu . 
com / p / 21824299 来源 知乎 著作权 归 作者 
所有 商业 转载 请 联系 作者 获得 授权 非商业 转载 
请 注明 出处 说起 特斯拉 大家 可能 立马 会 想到 
今年 5 月份 发生 在 特斯拉 Model 自动驾驶 上 的 
一宗 夺命 车祸 初步 的 调查 表明 在 强烈 的 
日照 条件 下 驾驶员/n 和/c 自动/vn 驾驶/v 系统/n 都/d 未能/v 
注意到/i 牵引式/nz 挂车/v 的/uj 白色/n 车身/n 因此 未能 及时 启动 
刹车 系统 而 由于 牵引式 挂车 正在 横穿 公路 且 
车身 较高 这一 特殊 情况 导致 Model 从 挂车 底部 
通过 时 其 前 挡风 玻璃 与 挂车 底部 发生 
撞击 导致 驾驶员 不幸遇难 无独有偶 8月 8日 美国 密苏里州 的 
一名 男子 特斯拉 Model X 车主 约书亚 尼 利 Joshua 
Neally 在 上班 途中 突发 肺栓塞 在 Model X 的 
Autopilot 自动驾驶 功能 的 帮助 下 他 安全 抵达 了 
医院 这 一 抑 一 扬 着实 让 人 回味无穷 
略 有些 败也萧何 成也萧何 之意 好奇 的 读者 一定会 有 
疑问 这 一成 一 败 背后 的 原理 到底 是 
什么 是 自动 驾驶 系统 中 的 哪个 部分 发生 
了 失误 而 造成 车祸 又是 哪 部分 技术 支撑 
了 自动 驾驶 过程 呢 今天 我们 就 来 谈谈 
自动 驾驶 系统 中 的 一项 重要 核心技术 图像 语义 
分割 Semantic image segmentation 图像 语义 分割 作为 计算机 视觉 
Computer vision 中 图像 理解 Image understanding 的 重要 一环 
不仅 在 工业界 的 需求 日益 凸显 同时 语义 分割 
也是 当下 学术界 的 研究 热点 之一 什么 是 图像 
语义 分割 图像 语义 分割 可以说 是 图像 理解 的 
基石 性 技术 在 自动 驾驶 系统 具体 为 街景 
识别 与 理解 无人机 应用 着陆点 判断 以及 穿戴 式 
设备 应用 中 举足轻重 我们 都 知道 图像 是 由 
许多 像素 Pixel 组成 而 「 语义 分割 」 顾名思义 
就是 将 像素 按照 图像 中 表达 语义 含义 的 
不同 进行 分组 Grouping ／ 分割 Segmentation 下图 取自 图像 
分割 领域 的 标准 数据集 之一 PASCAL VOC 其中 左图 
为 原始 图像 右 图为 分割 任务 的 真实 标记 
Ground truth 红色 区域 表示 语义 为 person 的 图像 
像素 区域 蓝绿色 代表 motorbike 语义 区域 黑色 表示 background 
白色 边 则 表示 未 标记 区域 显然 在 图像 
语义 分割 任务 中 其 输入 为 一张 的 三 
通道 彩色图像 输出 则是 对应 的 一个 矩阵 矩阵 的 
每一个 元素 表明 了 原图 中 对应 位置 像素 所 
表示 的 语义 类别 Semantic label 因此 图像 语义 分割 
也 称为 图像 语义 标注 Image semantic labeling 像素 语义 
标注 Semantic pixel labeling 或 像素 语义 分组 Semantic pixel 
grouping 从/p 上图/v 和题/nr 图中/i 大家 可以 明显 看出 图像 
语义 分割 任务 的 难点 便 在于 这 语义 二字 
在 真实 图像 中 表达 某一 语义 的 同一 物体 
常由/nr 不同 部件 组成 如 building motorbike person 等 同时 
这些 部分 往往 有着 不同 的 颜色 纹理 甚至 亮度 
如 building 这 给 图像 语义 的 精确 分割 带来 
了 困难 和 挑战 前 DL 时代 的 语义 分割 
从 最简单 的 像素 级别 阈值 法 Thresholding methods 基于 
像素 聚 类 的 分割 方法 Clustering based segmentation methods 
到 图 划分 的 分割 方法 Graph partitioning segmentation methods 
在 深度 学习 Deep learning DL 一统江湖 之前 图像 语义 
分割 方面 的 工作 可谓 百花齐放 在此 我们 仅以 Normalized 
cut 1 和 Grab cut 2 这 两个 基于 图 
划分 的 经典 分割 方法 为例 介绍 一下 前 DL 
时代 语义 分割 方面 的 研究 Normalized cut N cut 
方法 是 基于 图 划分 Graph partitioning 的 语义 分割 
方法 中 最 著名 的 方法 之一 于 2000年 Jianbo 
Shi 和 Jitendra Malik 发表 于 相关 领域 顶级 期刊 
TPAMI 通常 传统 基于 图 划分 的 语义 分割 方法 
都是 将 图像 抽象 为图 Graph 的 形式 为图 节点 
为图 的 边 然后 借助 图 理论 Graph theory 中 
的 理论 和 算法 进行 图像 的 语义 分割 常用 
的 方法 为 经典 的 最小 割 算法 Min cut 
algorithm 不过 在 边的/nr 权重 计算 时 经典 min cut 
算法 只 考虑 了 局部 信息 如下 图 所示 以 
二分 图 为例 将 分为 不 相交 的 两部分 若 
只 考虑 局部 信息 那么 分离出 一个点 显然 是 一个 
min cut 因此 图 划分 的 结果 便 是 类似 
或 这样 离群 点 而从 全局 来看 实际 想 分成 
的 组 却是 左右 两 大部分 针对 这一 情形 N 
cut 则 提出 了 一种 考虑 全局 信息 的 方法 
来 进行 图 划分 Graph partitioning 即 将 两个 分割部分 
与 全图 节点 的 连接 权重 和 考虑 进去 . 
如此一来 在 离群 点 划分 中 中的 某一 项会/nr 接近 
1 而 这样 的 图 划分 显然 不能 使得 是 
一个 较小 的 值 故 达到 考虑 全局 信息 而 
摒弃 划分 离群 点 的 目的 这样 的 操作 类似于 
机器学习 中 特征 的 规范化 Normalization 操作 故 称为 Normalized 
cut N cut 不仅 可以 处理 二类 语义 分割 而且 
将 二分 图 扩展 为 路 way 图 划分 即可 
完成 多 语义 的 图像 语义 分割 如下 图例 Grab 
cut 是 微软 剑桥 研究院 于 2004年 提出 的 著名 
交互式 图像 语义 分割 方法 与 N cut 一样 grab 
cut 同样 也 是 基于 图 划分 不过 grab cut 
是 其 改进 版本 可以 看作 迭代 式 的 语义 
分割 算法 Grab cut 利用 了 图像 中 的 纹理 
颜色 信息 和 边界 反差 信息 只要 少量 的 用户 
交互 操作 即可 得到 比较 好 的 前后 背景 分割 
结果 在 Grab cut 中 RGB 图像 的 前景 和 
背景 分别 用 一个 高斯 混合模型 Gaussian mixture model GMM 
来 建模 两个 GMM 分别 用以 刻画 某 像素 属于 
前景 或 背景 的 概率 每个 GMM 高斯 部件 Gaussian 
component 个数 一般 设为 接下来 利用 吉布斯 能量 方程 Gibbs 
energy function 对 整张 图像 进行 全局 刻画 而后 迭代 
求取 使得 能量 方程 达到 最优 值 的 参数 作为 
两个 GMM 的 最优 参数 GMM 确定 后 某 像素 
属于 前景 或 背景 的 概率 就 随之 确定 下来 
在与 用户 交互 的 过程 中 Grab cut 提供 两种 
交互方式 一种 以 包围 框 Bounding box 为 辅助 信息 
另一种 以 涂写 的 线条 Scribbled line 作为 辅助 信息 
以 下图 为例 用户 在 开始 时 提供 一个 包围 
框 grab cut 默认 的 认为 框 中 像素 中 
包含 主要 物体 ／ 前景 此后 经过 迭代 图 划分 
求解 即可 返回 扣出 的 前景 结果 可以 发现 即使 
是 对于 背景 稍微 复杂 一些 的 图像 grab cut 
仍有 不俗 表现 不过 在 处理 下图 时 grab cut 
的 分割 效果 则 不能 令人满意 此时 需要 额外 人为 
的 提供 更强 的 辅助 信息 用 红色 线条 ／ 
点 标明 背景 区域 同时 用 白色 线条 标明 前景 
区域 在此 基础 上 再次 运行 grab cut 算法 求取 
最优 解 即可 得到 较为 满意 的 语义 分割 结果 
Grab cut 虽 效果 优良 但 缺点 也 非常 明显 
一是 仅能 处理 二类 语义 分割 问题 二 是 需要 
人 为 干预 而 不能 做到 完全 自动化 DL 时代 
的 语义 分割 其实 大家 不难看出 前 DL 时代 的 
语义 分割 工作 多 是 根据 图像 像素 自身 的 
低阶 视觉 信息 Low level visual cues 来 进行 图像 
分割 由于 这样 的 方法 没有 算法 训练 阶段 因此 
往往 计算 复杂度 不高 但是 在 较 困难 的 分割 
任务 上 如果 不 提供 人为 的 辅助 信息 其 
分割 效果 并 不能 令人满意 在/p 计算机/n 视觉/n 步入/n 深度/ns 
学习/v 时代/nr 之后/f 语义 分割 同样 也 进入 了 全新 
的 发展 阶段 以 全 卷积 神经网络 Fully convolutional networks 
FCN 为 代表 的 一系列 基于 卷积 神经网络 训练 的 
语义 分割 方法 相继 提出 屡屡 刷新 图像 语义 分割 
精度 下面 就 介绍 三 种在 DL 时代 语义 分割 
领域 的 代表性 做法 全 卷积 神经网络 3 全 卷积 
神经网络 FCN 可以说 是 深度 学习 在 图像 语义 分割 
任务 上 的 开创性 工作 出自 UC Berkeley 的 Trevor 
Darrell 组 发表 于 计算机 视觉 领域 顶级 会议 CVPR 
2015 并 荣获 best paper honorable mention FCN 的 思想 
很 直观 即 直接 进行 像素 级别 端 到 端 
end to end 的 语义 分割 它 可以 基于 主流 
的 深度 卷积 神经网络 模型 CNN 来 实现 正所谓 全 
卷积 神经网络 在 FCN 中 传统/n 的/uj 全/a 连接/v 层/q 
fc6/i 和/c fc7/i 均是由/n 卷积/n 层/q 实现/v 而 最后 的 
fc8 层 则 被 替代 为 一个 21 通道 channel 
的 1x1 卷积 层 作为 网络 的 最终 输出 之所以 
有 21个 通道 是 因为 PASCAL VOC 的 数据 中 
包含 21个 类别 20个 object 类别 和 一个 background 类别 
下图 为 FCN 的 网络结构 若 原 图为 在/p 经过/p 
若干/m 堆叠/v 的/uj 卷积/n 和池化/nr 层/q 操作/v 后/f 可以/c 得到/v 
原图/n 对应/vn 的/uj 响应/v 张量/nr Activation tensor 其中 为 第 
层 的 通道 数 可以 发现 由 于池 化 层 
的 下 采样 作用 使得/v 响应/v 张量/nr 的/uj 长/a 和宽远/nr 
小于/v 原图/n 的/uj 长/a 和宽/nr 这 便给 像素 级别 的 
直接 训练 带来 问题 为了 解决 下 采样 带来 的 
问题 FCN 利用 双 线性插值 将 响应 张亮 的 长宽 
上 采样 到 原图 大小 另外 为了 更好 的 预测 
图像 中 的 细节 部分 FCN 还将 网络 中 浅层 
的 响应 也 考虑 进来 具体来说 就是 将 Pool4 和 
Pool3 的 响应 也 拿来 分别 作为 模型 FCN 16s 
和 FCN 8s 的 输出 与 原来 FCN 32s 的 
输出 结合 在 一起 做 最终 的 语义 分割 预测 
如下 图 所示 下图 是 不同 层 作为 输出 的 
语义 分割 结果 可以 明显 看出 由 于池 化 层 
的 下 采样 倍数 的 不同 导致 不同 的 语义 
分割 精细 程度 如 FCN 32s 由于/c 是/v FCN/w 的/uj 
最后/f 一层/m 卷积/n 和/c 池化的/nr 输出/v 该 模型 的 下 
采样 倍数 最高 其 对应 的 语义 分割 结果 最为 
粗略 而 FCN 8s 则 因 下 采样 倍数 较小 
可以 取得 较为 精细 的 分割 结果 Dilated Convolutions 4 
FCN 的 一个 不足 之 处 在于 由 于池 化 
层 的 存在 响应 张量 的 大小 长 和宽/nr 越来越 
小 但是 FCN 的 设计 初衷 则 需要 和 输入 
大小 一致 的 输出 因此 FCN 做了 上 采样 但是 
上 采样 并 不能 将 丢失 的 信息 全部 无损 
地 找回来 对此 dilated convolution 是 一种 很好 的 解决方案 
既然 池化的/nr 下 采样 操作 会 带来 信息 损失 那么 
就把 池化层/nr 去掉 但是 池化层/nr 去掉 随之 带来 的 是 
网络 各层 的 感受 野 Receptive field 变小 这样 会 
降低 整个 模型 的 预测 精度 Dilated convolution 的 主要 
贡献 就是 如何 在 去掉 池化下/nr 采样 操作 的 同时 
而不 降低 网络 的 感受 野 以 的 卷积 核 
为例 传统 卷积 核 在做 卷积 操作 时 是 将 
卷积 核 与 输入 张量 中 连续 的 的 patch 
逐点 相乘 再 求和 如 下图 a 红色 圆点 为 
卷积 核 对应 的 输入 像素 绿色 为其 在 原 
输入 中的 感知 野 而 dilated convolution 中的 卷积 核 
则是 将 输入 张量 的 patch 隔 一定 的 像素 
进行 卷积 运算 如 下图 b 所示 在 去掉 一层 
池化层/nr 后 需要/v 在/p 去掉/v 的/uj 池化层/nr 后将/nr 传统/n 卷积/n 
层/q 换/nz 做一个/i dilation = 2 的 dilated convolution 层 
此时 卷积 核 将 输入 张量 每隔 一个 像素 的 
位置 作为 输入 patch 进行 卷积 计算 可以 发现 这 
时 对应 到 原 输入 的 感知 野 已经 扩大 
dilate 为 同理 如果 再 去掉 一个 池化层/nr 就要 将其 
之后 的 卷积 层 换成 dilation = 4 的 dilated 
convolution 层 如图 c 所示 这样一来 即使 去掉 池化层/nr 也能 
保证 网络 的 感受 野 从而 确保 图像 语义 分割 
的 精度 从 下面 的 几个 图像 语义 分割 效果图 
可以 看出 在 使用 了 dilated convolution 这一 技术 后 
可以 大幅 提高 语义 类别 的 辨识度 以及 分割 细节 
的 精细 度 以 条件 随 机场 为 代表 的 
后处理 操作 当下 许多 以 深度 学习 为 框架 的 
图像 语义 分割 工作 都是 用了 条件 随 机场 Conditional 
random field CRF 作为 最后 的 后处理 操作 来 对 
语义 预测 结果 进行 优化 一般来讲 CRF 将 图像 中 
每个 像素点 所属 的 类别 都 看作 一个 变量 然后 
考虑 任意 两个 变量 之间 的 关系 建立 一个 完全 
图 如下 图 所示 在 全 链接 的 CRF 模型 
中 对应 的 能量 函数 为 其中 是 一元 项 
表示 像素 对应 的 语义 类别 其 类别 可以 由 
FCN 或者 其他 语义 分割 模型 的 预测 结果 得到 
而 第二 项为/nr 二元 项 二元 项 可将 像素 之间 
的 语义 联系 ／ 关系 考虑 进去 例如 天空 和 
鸟 这样 的 像素 在 物理 空间 是 相邻 的 
概率 应该 要比 天空 和 鱼 这样 像素 的 相邻 
概率 大 最后 通过 对 CRF 能量 函数 的 优化 
求解 得到 对 FCN 的 图像 语义 预测 结果 进行 
优化 得到 最终 的 语义 分割 结果 值得一提的是 已经 有 
工作 5 将 原本 与 深度 模型 训练 割 裂开 
的 CRF 过程 嵌入 到 神经网络 内部 即 将 FCN 
+ CRF 的 过程 整合 到 一个 端 到 端的 
系统 中 这样 做 的 好处 是 CRF 最后 预测 
结果 的 能量 函数 可以 直接 用来 指导 FCN 模型 
参数 的 训练 而 取得 更好 的 图像 语义 分割 
结果 展望 俗话说 没有 免费 的 午餐 No free lunch 
基于 深度 学习 的 图像 语义 分割 技术 虽然 可以 
取得 相比 传统 方法 突飞猛进 的 分割 效果 但是 其 
对 数据 标注 的 要求 过高 不仅 需要 海量 图像 
数据 同时 这些 图像 还需 提供 精确 到 像素 级别 
的 标记 信息 Semantic labels 因此 越来越 多 的 研究 
者 开始 将 注意力 转移 到 弱 监督 Weakly supervised 
条件 下 的 图像 语义 分割 问题 上 在 这类 
问题 中 图像 仅 需 提供 图像 级别 标注 如 
有 人 有 车 无 电视 而 不 需要 昂贵 
的 像素 级别 信息 即可 取得 与 现有 方法 可比 
的 语义 分割 精度 另外 示例 级别 Instance level 的 
图像 语义 分割 问题 也 同样 热门 该类 问题 不仅 
需要 对 不同 语义 物体 进行 图像 分割 同时 还 
要求 对 同一 语义 的 不同 个体 进行 分割 例如 
需要 对 图 中 出现 的 九把 椅子 的 像素 
用 不同 颜色 分别 标示 出来 最后 基于 视频 的 
前景 ／ 物体 分割 Video segmentation 也是 今后 计算机 视觉 
语义 分割 领域 的 新 热点 之一 这一 设定 其实 
更加 贴合 自动 驾驶 系统 的 真实 应用环境 首 发于 
机器 之心 公众 号 链接 请 戳 专栏 | 从 
特斯拉 到 计算机 视觉 之 「 图像 语义 分割 」 
作者 魏秀参/nr 谢晨 伟 References 1 Jianbo Shi and Jitendra 
Malik . Normalized Cuts and Image Segmentation IEEE Transactions on 
Pattern Analysis and Machine Intelligence Vol . 22 No . 
8 2000 . 2 Carsten Rother Vladimir Kolmogorov and Andrew 
Blake . GrabCut Interactive Foreground Extraction using Iterated Graph Cuts 
ACM Transactions on Graphics 2004 . 3 Jonathan Long Evan 
Shelhamer and Trevor Darrell . Fully Convolutional Networks for Semantic 
Segmentation . IEEE Conference on Computer Vision and Pattern Recognition 
2015 . 4 Fisher Yu and Vladlen Koltun . Multi 
scale Context Aggregation by Dilated Convolutions . International Conference on 
Representation Learning 2016 . 5 Shuai Zheng Sadeep Jayasumana Bernardino 
Romera Paredes Vibhav Vineet Zhizhong Su Dalong Du Chang Huang 
and Philip H . . Torr . Conditional Random Fields 
as Recurrent Neural Networks . International Conference on Computer Vision 
2015 . 