课时 26 图像 分割 与 注意力 模型 上 语义 分割 
我们/r 有/v 输入/v 图像/n 和/c 固定/a 的/uj 几个/m 图像/n 分类/n 
任务 是 我们 想 要 输入 一个 图像 然后 我们 
要 标记 每个 像素 所属 的 标签 为 固定 数据 
类 中 的 一个 使用 卷积 神经 网络 为 每个 
小区 块 进行 分类 对在 区块 的 中间 打上 标签 
对 图像 的 全部 区块 分类 完毕 我们 就 可以 
得到 每个 像素 所 对应 的 标签 这个 操作 实际上 
非常 耗时 因为 一张 图片 将会 被 分割 非常多 的 
小块 如果 这些 神经网络 具有 相关 的 结构 通过 这个 
图像 金字塔 方法 的话 这些 图像 的 输出 将会 有 
不同 的 感受 野 语义 分割 的 迭代 精化 我们 
有一个 输入 图像 他们 被 分割 成 三个 通道 我们 
把 输出 从 卷积 神经 网络 中 拿出 来 同时 
把 对应 的 下 采样 版本 的 图像 拿出来 然后 
我们 再 重复 这 一 过程 所以 这个 过程 其实 
是 有点 增加 输出 有效 的 感受 野 同时 也 
对 输入 图像 有 更多 的 处理 即时 分割 或者 
实时 检测 和 分割 我们 有 一些 分类 需要 去 
识别 给定 一张 图像 需要 输出 对应 图像 的 不同 
分类 实例 而 分 实例 我们 也 需要 分割 到 
具体 每个 像素 是 属于 哪个 实例 实例 分割 我们 
给 他 一副 输入 图像 CNN 还要 依赖 于 外部 
的 候选 区域 就是 计算机 视觉 中低层 次 信息 得 
离线 处理 操作 预测 物体 在 图像 中 的 具体 
的 位置 每个 分割 候选 我们 可以 抽 取出 一个 
bounding box 来 提取 边界 框 裁剪 输入 图像 喂给 
卷积 神经网络 去 抽取 特征 同时 并行 的 执行 RCNN 
再一次 我们 拿到 相应 的 块 图像 进行 裁剪 但 
这里 我们 实际 上有 候选 的 分割 我们 为 图像 
区域 背景 使用 平均 颜色 做 掩码 现在 我们 拿到 
这些 掩 过 的 输入 图像 并 运行 在 独立 
的 RCNN 中 我们 得到 两个 特征向量 一个 是 从 
原始 图 像框 来 的 而 另一个 是 去除 了 
背景 颜色 的 图像 框 我们 把 这 两个 结果 
联合 起来 就是 我们 在 CNN 做 的 一样 预测 
这 个 图像 是 属于 哪个 分类 同时 还有 一个 
区域 细化 的 步骤 如果 我们 想 要 细化 候选 
区域 的话 课时 27 图像 分割 与 注意力 模型 下 
语义分析 通常 使用 这种 深度 卷积 的 实现 方式 而 
实例 分割 使用 的 一 整个 处理 流程 更 像是 
物体 检测 RNN 只有 一次 机会 去看 输入 图像 当 
他 开始 工作 时 他 是 把 整个 图像 作为 
输入 的 并且 只 操作 一次 如果 他们 可以 看 
输入 图像 多次 这 可能 会 更好 或者/c 他/r 每次/r 
曹锁时/nr 可以/c 关注/v 到/v 原始/v 的/uj 输入/v 图像/n 的/uj 不同/a 
部分/n 也/d 是/v 更好/d 的/uj 我们 有 一个 输入 图像 
并把 他 喂给 卷积 神经网络 但是 代替 原来 使用 全 
连接 层 我们 改 使用 全 卷积 层 来 抽取 
特征 这将 给予 我们 L * D 的 特征 而 
不是 原来 的 单 特征向量 因为 这个 是从 卷积 层 
来 的 你 可以 想象 他 是 2D 的 特征向量 
在 这个 2D 向量 中的 每一个 特征 都 对应 了 
原始 输入 图像 的 某一 部分 现在 我们 用 这些 
特征 以 某种 方式 来 初始化 神经 网络 的 隐 
层 他 现在 是 计算 分布 的 不同 位置 在 
我们 的 卷积 特征 图中 我们 最终 得到 这个 L 
维 向量 给予 我们 一个 不同 位置 可能 的 分布 
现在 我们 拿着 这个 概率分布 并且 拿着 他 去 得到 
这些 特征向量 在 不同 点 的 权重 和 所以 我们 
拿到 这个 特征 权重 的 合集 然后 拿着 我们 的 
2D 向量 并对 之 进行 汇总 到 一个 单 向量 
由于 概率分布 给予 了 网络 予 能力 去 聚集 图像 
的 不同 部分 概率分布 我们 每次 生成 两种 类型 的 
概率分布 第一个 是 D 向量 就像 我们 在 普通 的 
图片 处理 一样 第二 个 就是 也会 生成 一个 在 
原图 中 位置 的 概率分布 他们 告诉 我们 下 一次 
我们 要 看 图片 的 哪个 部分 使用 注意力 的 
两个 动机 首先 使用 注意力 模型 可以 得到 可 解释 
的 结果 另一个 动机 是 可以 缓解 计算 压力 特别 
是 你 的 输入 非常 非常 大 的 时候 你 
可能 需要 大 量计算 并且 每 次 计算 都是 输入 
整个 图像 如果 使用 注意力 模型 每次 只 需要 关注 
需要 关注 的 那 一块 hard attention 有做/nr 计算 保存 
并且 使用 的 强 学习 化 soft attention 这个 模型 
的 特征 图 有点 固定 限制 他 只 允许 以 
一种 固定 大小 的 网络 去看 空间 变换 网络 有点像 
纹理 映射 这个 网络 允许 我们 在 输入 图像 中 
访问 任意 大小 的 部分 以 一种 可微 的 方式 
我们 的 网络 只需要 预测 转换 坐标 数据 这个 就 
可以 允许 我们 以 任意 大 小区域 去 访问 输入 
图像 空间 转换器 接受 一些 输入 这 可以 是 一个 
原始 的 输入 图像 实际上 执行 了 这个 小 的 
本地化 网络 将会 生成 输出 作为 一个 仿射变换 坐标 的 
数据 现在 这个 仿射变换 坐标 将会 被 用来 计算 采样 
网络 现在 我们 从 本地化 网络 中 预测 这个 仿射变换 
我们 映射 输出 中的 每一个 像素 输出 中 每一个 像素 
的 坐标 把 他 作为 一个 输入 这 是 一个 
很好 的 平滑 可微 的 函数 一旦 我们 有了/nr 这个 
采样 网络 我们 可以 使用 双 线性插值 去 计算 输出 
中 每个 像素 的 值 课时 26 图像 分割 与 注意力 模型 上 语义 分割 
我们/r 有/v 输入/v 图像/n 和/c 固定/a 的/uj 几个/m 图像/n 分类/n 
任务 是 我们 想 要 输入 一个 图像 然后 我们 
要 标记 每个 像素 所属 的 标签 为 固定 数据 
类 中 的 一个 使用 卷积 神经 网络 为 每个 
小区 块 进行 分类 对在 区块 的 中间 打上 标签 
对 图像 的 全部 区块 分类 完毕 我们 就 可以 
得到 每个 像素 所 对应 的 标签 这个 操作 实际上 
非常 耗时 因为 一张 图片 将会 被 分割 非常多 的 
小块 如果 这些 神经网络 具有 相关 的 结构 通过 这个 
图像 金字塔 方法 的话 这些 图像 的 输出 将会 有 
不同 的 感受 野 语义 分割 的 迭代 精化 我们 
有一个 输入 图像 他们 被 分割 成 三个 通道 我们 
把 输出 从 卷积 神经 网络 中 拿出 来 同时 
把 对应 的 下 采样 版本 的 图像 拿出来 然后 
我们 再 重复 这 一 过程 所以 这个 过程 其实 
是 有点 增加 输出 有效 的 感受 野 同时 也 
对 输入 图像 有 更多 的 处理 即时 分割 或者 
实时 检测 和 分割 我们 有 一些 分类 需要 去 
识别 给定 一张 图像 需要 输出 对应 图像 的 不同 
分类 实例 而 分 实例 我们 也 需要 分割 到 
具体 每个 像素 是 属于 哪个 实例 实例 分割 我们 
给 他 一副 输入 图像 CNN 还要 依赖 于 外部 
的 候选 区域 就是 计算机 视觉 中低层 次 信息 得 
离线 处理 操作 预测 物体 在 图像 中 的 具体 
的 位置 每个 分割 候选 我们 可以 抽 取出 一个 
bounding box 来 提取 边界 框 裁剪 输入 图像 喂给 
卷积 神经网络 去 抽取 特征 同时 并行 的 执行 RCNN 
再一次 我们 拿到 相应 的 块 图像 进行 裁剪 但 
这里 我们 实际 上有 候选 的 分割 我们 为 图像 
区域 背景 使用 平均 颜色 做 掩码 现在 我们 拿到 
这些 掩 过 的 输入 图像 并 运行 在 独立 
的 RCNN 中 我们 得到 两个 特征向量 一个 是 从 
原始 图 像框 来 的 而 另一个 是 去除 了 
背景 颜色 的 图像 框 我们 把 这 两个 结果 
联合 起来 就是 我们 在 CNN 做 的 一样 预测 
这 个 图像 是 属于 哪个 分类 同时 还有 一个 
区域 细化 的 步骤 如果 我们 想 要 细化 候选 
区域 的话 课时 27 图像 分割 与 注意力 模型 下 
语义分析 通常 使用 这种 深度 卷积 的 实现 方式 而 
实例 分割 使用 的 一 整个 处理 流程 更 像是 
物体 检测 RNN 只有 一次 机会 去看 输入 图像 当 
他 开始 工作 时 他 是 把 整个 图像 作为 
输入 的 并且 只 操作 一次 如果 他们 可以 看 
输入 图像 多次 这 可能 会 更好 或者/c 他/r 每次/r 
曹锁时/nr 可以/c 关注/v 到/v 原始/v 的/uj 输入/v 图像/n 的/uj 不同/a 
部分/n 也/d 是/v 更好/d 的/uj 我们 有 一个 输入 图像 
并把 他 喂给 卷积 神经网络 但是 代替 原来 使用 全 
连接 层 我们 改 使用 全 卷积 层 来 抽取 
特征 这将 给予 我们 L * D 的 特征 而 
不是 原来 的 单 特征向量 因为 这个 是从 卷积 层 
来 的 你 可以 想象 他 是 2D 的 特征向量 
在 这个 2D 向量 中的 每一个 特征 都 对应 了 
原始 输入 图像 的 某一 部分 现在 我们 用 这些 
特征 以 某种 方式 来 初始化 神经 网络 的 隐 
层 他 现在 是 计算 分布 的 不同 位置 在 
我们 的 卷积 特征 图中 我们 最终 得到 这个 L 
维 向量 给予 我们 一个 不同 位置 可能 的 分布 
现在 我们 拿着 这个 概率分布 并且 拿着 他 去 得到 
这些 特征向量 在 不同 点 的 权重 和 所以 我们 
拿到 这个 特征 权重 的 合集 然后 拿着 我们 的 
2D 向量 并对 之 进行 汇总 到 一个 单 向量 
由于 概率分布 给予 了 网络 予 能力 去 聚集 图像 
的 不同 部分 概率分布 我们 每次 生成 两种 类型 的 
概率分布 第一个 是 D 向量 就像 我们 在 普通 的 
图片 处理 一样 第二 个 就是 也会 生成 一个 在 
原图 中 位置 的 概率分布 他们 告诉 我们 下 一次 
我们 要 看 图片 的 哪个 部分 使用 注意力 的 
两个 动机 首先 使用 注意力 模型 可以 得到 可 解释 
的 结果 另一个 动机 是 可以 缓解 计算 压力 特别 
是 你 的 输入 非常 非常 大 的 时候 你 
可能 需要 大 量计算 并且 每 次 计算 都是 输入 
整个 图像 如果 使用 注意力 模型 每次 只 需要 关注 
需要 关注 的 那 一块 hard attention 有做/nr 计算 保存 
并且 使用 的 强 学习 化 soft attention 这个 模型 
的 特征 图 有点 固定 限制 他 只 允许 以 
一种 固定 大小 的 网络 去看 空间 变换 网络 有点像 
纹理 映射 这个 网络 允许 我们 在 输入 图像 中 
访问 任意 大小 的 部分 以 一种 可微 的 方式 
我们 的 网络 只需要 预测 转换 坐标 数据 这个 就 
可以 允许 我们 以 任意 大 小区域 去 访问 输入 
图像 空间 转换器 接受 一些 输入 这 可以 是 一个 
原始 的 输入 图像 实际上 执行 了 这个 小 的 
本地化 网络 将会 生成 输出 作为 一个 仿射变换 坐标 的 
数据 现在 这个 仿射变换 坐标 将会 被 用来 计算 采样 
网络 现在 我们 从 本地化 网络 中 预测 这个 仿射变换 
我们 映射 输出 中的 每一个 像素 输出 中 每一个 像素 
的 坐标 把 他 作为 一个 输入 这 是 一个 
很好 的 平滑 可微 的 函数 一旦 我们 有了/nr 这个 
采样 网络 我们 可以 使用 双 线性插值 去 计算 输出 
中 每个 像素 的 值 课时 26 图像 分割 与 注意力 模型 上 语义 分割 
我们/r 有/v 输入/v 图像/n 和/c 固定/a 的/uj 几个/m 图像/n 分类/n 
任务 是 我们 想 要 输入 一个 图像 然后 我们 
要 标记 每个 像素 所属 的 标签 为 固定 数据 
类 中 的 一个 使用 卷积 神经 网络 为 每个 
小区 块 进行 分类 对在 区块 的 中间 打上 标签 
对 图像 的 全部 区块 分类 完毕 我们 就 可以 
得到 每个 像素 所 对应 的 标签 这个 操作 实际上 
非常 耗时 因为 一张 图片 将会 被 分割 非常多 的 
小块 如果 这些 神经网络 具有 相关 的 结构 通过 这个 
图像 金字塔 方法 的话 这些 图像 的 输出 将会 有 
不同 的 感受 野 语义 分割 的 迭代 精化 我们 
有一个 输入 图像 他们 被 分割 成 三个 通道 我们 
把 输出 从 卷积 神经 网络 中 拿出 来 同时 
把 对应 的 下 采样 版本 的 图像 拿出来 然后 
我们 再 重复 这 一 过程 所以 这个 过程 其实 
是 有点 增加 输出 有效 的 感受 野 同时 也 
对 输入 图像 有 更多 的 处理 即时 分割 或者 
实时 检测 和 分割 我们 有 一些 分类 需要 去 
识别 给定 一张 图像 需要 输出 对应 图像 的 不同 
分类 实例 而 分 实例 我们 也 需要 分割 到 
具体 每个 像素 是 属于 哪个 实例 实例 分割 我们 
给 他 一副 输入 图像 CNN 还要 依赖 于 外部 
的 候选 区域 就是 计算机 视觉 中低层 次 信息 得 
离线 处理 操作 预测 物体 在 图像 中 的 具体 
的 位置 每个 分割 候选 我们 可以 抽 取出 一个 
bounding box 来 提取 边界 框 裁剪 输入 图像 喂给 
卷积 神经网络 去 抽取 特征 同时 并行 的 执行 RCNN 
再一次 我们 拿到 相应 的 块 图像 进行 裁剪 但 
这里 我们 实际 上有 候选 的 分割 我们 为 图像 
区域 背景 使用 平均 颜色 做 掩码 现在 我们 拿到 
这些 掩 过 的 输入 图像 并 运行 在 独立 
的 RCNN 中 我们 得到 两个 特征向量 一个 是 从 
原始 图 像框 来 的 而 另一个 是 去除 了 
背景 颜色 的 图像 框 我们 把 这 两个 结果 
联合 起来 就是 我们 在 CNN 做 的 一样 预测 
这 个 图像 是 属于 哪个 分类 同时 还有 一个 
区域 细化 的 步骤 如果 我们 想 要 细化 候选 
区域 的话 课时 27 图像 分割 与 注意力 模型 下 
语义分析 通常 使用 这种 深度 卷积 的 实现 方式 而 
实例 分割 使用 的 一 整个 处理 流程 更 像是 
物体 检测 RNN 只有 一次 机会 去看 输入 图像 当 
他 开始 工作 时 他 是 把 整个 图像 作为 
输入 的 并且 只 操作 一次 如果 他们 可以 看 
输入 图像 多次 这 可能 会 更好 或者/c 他/r 每次/r 
曹锁时/nr 可以/c 关注/v 到/v 原始/v 的/uj 输入/v 图像/n 的/uj 不同/a 
部分/n 也/d 是/v 更好/d 的/uj 我们 有 一个 输入 图像 
并把 他 喂给 卷积 神经网络 但是 代替 原来 使用 全 
连接 层 我们 改 使用 全 卷积 层 来 抽取 
特征 这将 给予 我们 L * D 的 特征 而 
不是 原来 的 单 特征向量 因为 这个 是从 卷积 层 
来 的 你 可以 想象 他 是 2D 的 特征向量 
在 这个 2D 向量 中的 每一个 特征 都 对应 了 
原始 输入 图像 的 某一 部分 现在 我们 用 这些 
特征 以 某种 方式 来 初始化 神经 网络 的 隐 
层 他 现在 是 计算 分布 的 不同 位置 在 
我们 的 卷积 特征 图中 我们 最终 得到 这个 L 
维 向量 给予 我们 一个 不同 位置 可能 的 分布 
现在 我们 拿着 这个 概率分布 并且 拿着 他 去 得到 
这些 特征向量 在 不同 点 的 权重 和 所以 我们 
拿到 这个 特征 权重 的 合集 然后 拿着 我们 的 
2D 向量 并对 之 进行 汇总 到 一个 单 向量 
由于 概率分布 给予 了 网络 予 能力 去 聚集 图像 
的 不同 部分 概率分布 我们 每次 生成 两种 类型 的 
概率分布 第一个 是 D 向量 就像 我们 在 普通 的 
图片 处理 一样 第二 个 就是 也会 生成 一个 在 
原图 中 位置 的 概率分布 他们 告诉 我们 下 一次 
我们 要 看 图片 的 哪个 部分 使用 注意力 的 
两个 动机 首先 使用 注意力 模型 可以 得到 可 解释 
的 结果 另一个 动机 是 可以 缓解 计算 压力 特别 
是 你 的 输入 非常 非常 大 的 时候 你 
可能 需要 大 量计算 并且 每 次 计算 都是 输入 
整个 图像 如果 使用 注意力 模型 每次 只 需要 关注 
需要 关注 的 那 一块 hard attention 有做/nr 计算 保存 
并且 使用 的 强 学习 化 soft attention 这个 模型 
的 特征 图 有点 固定 限制 他 只 允许 以 
一种 固定 大小 的 网络 去看 空间 变换 网络 有点像 
纹理 映射 这个 网络 允许 我们 在 输入 图像 中 
访问 任意 大小 的 部分 以 一种 可微 的 方式 
我们 的 网络 只需要 预测 转换 坐标 数据 这个 就 
可以 允许 我们 以 任意 大 小区域 去 访问 输入 
图像 空间 转换器 接受 一些 输入 这 可以 是 一个 
原始 的 输入 图像 实际上 执行 了 这个 小 的 
本地化 网络 将会 生成 输出 作为 一个 仿射变换 坐标 的 
数据 现在 这个 仿射变换 坐标 将会 被 用来 计算 采样 
网络 现在 我们 从 本地化 网络 中 预测 这个 仿射变换 
我们 映射 输出 中的 每一个 像素 输出 中 每一个 像素 
的 坐标 把 他 作为 一个 输入 这 是 一个 
很好 的 平滑 可微 的 函数 一旦 我们 有了/nr 这个 
采样 网络 我们 可以 使用 双 线性插值 去 计算 输出 
中 每个 像素 的 值 