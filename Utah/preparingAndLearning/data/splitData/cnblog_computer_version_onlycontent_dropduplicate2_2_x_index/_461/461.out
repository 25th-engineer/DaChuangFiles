对/p,用/p,卷积/nw,神经/n,网络/n,进行/v,目标/n,检测/vn,方法/n,的/u,一种/mq,改进/v,，/w,通过/p,提取/v,多/a,尺度/n,的/u,特征/n,信息/n,进行/v,融合/v,，/w,进而/c,提高/v,目标/n,检测/vn,的/u,精度/n,，/w,特别/d,是/v,在/p,小/a,物体/n,检测/vn,上/f,的/u,精度/n,。/w,fpn/en,是/v,resnet/en,或/c,densenet/en,等/u,通用/vn,特征/n,提取/v,网络/n,的/u,附加/vn,组件/n,，/w,可以/v,和/c,经典/n,网络/n,组合/v,提升/v,原/b,网络/n,效果/n,。/w,一/m,、/w,问题/n,背景/n,网络/n,的/u,深度/n,（/w,对应/v,到/v,感受/v,野/b,）/w,与/p,总/b,stride/en,通常/d,是/v,一对/m,矛盾/an,的/u,东西/n,，/w,常用/a,的/u,网络结构/l,对应/v,的/u,总/b,stride/en,一般/a,会/v,比较/d,大/a,（/w,如/v,32/m,）/w,，/w,而/c,图像/n,中/f,的/u,小/a,物体/n,甚至/d,会/v,小于/v,stride/en,的/u,大小/n,，/w,造成/v,的/u,结果/n,就/d,是/v,小/a,物体/n,的/u,检测/vn,性能/n,急剧/d,下降/v,。/w,传统/n,解决/v,这个/r,问题/n,的/u,思路/n,包括/v,：/w,（/w,1/m,）/w,多/a,尺度/n,训练/vn,和/c,测试/vn,，/w,又/d,称/v,图像/n,金字塔/n,，/w,如/v,下/f,图/n,(/w,a/en,)/w,所示/nz,。/w,目前/t,几乎/d,所有/b,在/p,imagenet/en,和/c,coco/en,检测/vn,任务/n,上/f,取得/v,好/a,成绩/n,的/u,方法/n,都/d,使用/v,了/u,图像/n,金字塔/n,方法/n,。/w,然而/c,这样/r,的/u,方法/n,由于/c,很/d,高/a,的/u,时间/n,及/c,计算量/nw,消耗/v,，/w,难以/d,在/p,实际/n,中/f,应用/vn,。/w,（/w,2/m,）/w,特征/n,分层/v,，/w,即/v,每/r,层/q,分别/d,预测/v,对应/v,的/u,scale/en,分辨率/n,的/u,检测/vn,结果/n,。/w,如/v,下/f,图/n,(/w,c/en,)/w,所示/nz,。/w,ssd/en,检测/vn,框架/n,采用/v,了/u,类似/v,的/u,思想/n,。/w,这样/r,的/u,方法/n,问题/n,在于/v,直接/ad,强行/d,让/v,不同/a,层/q,学习/v,同样/d,的/u,语义/n,信息/n,。/w,而/c,对于/p,卷积/nw,神经/n,网络/n,而言/u,，/w,不同/a,深度/n,对应/v,着/u,不同/a,层次/n,的/u,语义/n,特征/n,，/w,浅层/nz,网络/n,分辨率/n,高/a,，/w,学/v,的/u,更/d,多/a,是/v,细节/n,特征/n,，/w,深层/b,网络/n,分辨率/n,低/a,，/w,学/v,的/u,更/d,多/a,是/v,语义/n,特征/n,。/w,因而/c,，/w,目前/t,多/a,尺度/n,的/u,物体/n,检测/vn,主要/b,面临/v,的/u,挑战/vn,为/p,：/w,1/m,./w, ,如何/r,学习/v,具有/v,强/a,语义/n,信息/n,的/u,多/a,尺度/n,特征/n,表示/v,？/w,2/m,./w, ,如何/r,设计/vn,通用/vn,的/u,特征/n,表示/v,来/v,解决/v,物体/n,检测/vn,中/f,的/u,多个子/nw,问题/n,？/w,如/v,object/en, ,proposal/en,,/w, ,box/en, ,localization/en,,/w, ,instance/en, ,segmentation/en,./w,3/m,./w, ,如何/r,高效/b,计算/v,多/a,尺度/n,的/u,特征/n,表示/v,？/w,二/m,、/w,特征/n,金字塔/n,网络/n,（/w,feature/en, ,pyramid/en, ,networks/en,）/w,作者/n,提/v,出/v,了/u,fpn/en,算法/n,。/w,做法/n,很/d,简单/a,，/w,如/v,下/f,图/n,所/u,示/vg,。/w,把/p,低/a,分辨率/n,、/w,高语义信息/nt,的/u,高层/n,特征/n,和/c,高/a,分辨率/n,、/w,低语/vn,义/ng,信息/n,的/u,低层/n,特征/n,进行/v,自上而下/l,的/u,侧边/nz,连接/v,，/w,使得/v,所有/b,尺度/n,下/f,的/u,特征/n,都/d,有/v,丰富/a,的/u,语义/n,信息/n,。/w,图/n,中/f,未/d,注明/v,的/u,是/v,融合/v,之后/f,的/u,feat/en,还/d,需要/v,进行/v,一次/mq,3/m,*/w,3卷/mq,积/v,作者/n,的/u,算法/n,结构/n,可以/v,分为/v,三个/m,部分/n,：/w,自下而上/l,的/u,卷积/nw,神经/n,网络/n,（/w,上图/n,左/f,）/w,，/w,自上而下/l,过程/n,（/w,上图/n,右/f,）/w,和/c,特征/n,与/p,特征/n,之间/f,的/u,侧边/nz,连接/v,。/w,自下而上/l,的/u,部分/n,其实/d,就/d,是/v,卷积/nw,神经/n,网络/n,的/u,前/f,向/p,过程/n,。/w,在/p,前/f,向/p,过程/n,中/f,，/w,特征/n,图/n,的/u,大小/n,在/p,经过/p,某些/r,层/q,后/f,会/v,改变/v,，/w,而/c,在/p,经过/p,其他/r,一些/m,层/q,的/u,时候/n,不/d,会/v,改变/v,，/w,作者/n,将/d,不/d,改变/v,特征/n,图/n,大小/n,的/u,层/q,归/v,为/p,一个/m,阶段/n,，/w,因此/c,每次/r,抽取/vn,的/u,特征/n,都/d,是/v,每个/r,阶段/n,的/u,最后/f,一个/m,层/q,的/u,输出/v,，/w,这样/r,就/d,能/v,构成/v,特征/n,金字塔/n,。/w,具体来说/nw,，/w,对于/p,resnets/en,，/w,作者/n,使用/v,了/u,每个/r,阶段/n,的/u,最后/f,一个/m,残差/nw,结构/n,的/u,特征/n,激活/vn,输出/v,。/w,将/d,这些/r,残差/nw,模块/n,输出/v,表示/v,为/p,{/w,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m,}/w,，/w,对应/v,于/p,conv/en,2/m,，/w,conv/en,3/m,，/w,conv/en,4/m,和/c,conv/en,5/m,的/u,输出/v,。/w,自上而下/l,的/u,过程/n,采用/v,上/f,采样/v,进行/v,。/w,上/f,采样/v,几乎/d,都/d,是/v,采用/v,内/f,插值/nw,方法/n,，/w,即/v,在/p,原有/v,图像/n,像素/n,的/u,基础/n,上/f,在/p,像素/n,点/q,之间/f,采用/v,合适/a,的/u,插值/nw,算法/n,插入/v,新/a,的/u,元素/n,，/w,从而/c,扩大/v,原/b,图像/n,的/u,大小/n,。/w,通过/p,对/p,特征/n,图/n,进行/v,上/f,采样/v,，/w,使得/v,上/f,采样/v,后/f,的/u,特征/n,图/n,具有/v,和/c,下/f,一层/mq,的/u,特征/n,图/n,相同/a,的/u,大小/n,。/w,根本/a,上/f,来说/u,，/w,侧边/nz,之间/f,的/u,横向/n,连接/v,是/v,将/d,上/f,采样/v,的/u,结果/n,和/c,自下而上/l,生成/vn,的/u,特征/n,图/n,进行/v,融合/v,。/w,我们/r,将/d,卷积/nw,神经/n,网络/n,中/f,生成/vn,的/u,对应/v,层/q,的/u,特征/n,图/n,进行/v,1/m,×/w,1/m,的/u,卷积/nw,操作/v,，/w,将/d,之/u,与/p,经过/p,上/f,采样/v,的/u,特征/n,图/n,融合/v,，/w,得到/v,一个/m,新/a,的/u,特征/n,图/n,，/w,这个/r,特征/n,图/n,融合/v,了/u,不同/a,层/q,的/u,特征/n,，/w,具有/v,更/d,丰富/a,的/u,信息/n,。/w, ,这里/r,1/m,×/w,1/m,的/u,卷积/nw,操作/v,目的/n,是/v,改变/v,channels/en,，/w,要求/v,和/c,后/f,一层/mq,的/u,channels/en,相同/a,。/w,在/p,融合/v,之后/f,还/d,会/v,再/d,采用/v,3/m,*/w,3/m,的/u,卷积/nw,核对/v,每个/r,融合/v,结果/n,进行/v,卷积/nw,，/w,目的/n,是/v,消除/v,上/f,采样/v,的/u,混叠/nw,效应/n,，/w,如此/r,就/d,得到/v,了/u,一个/m,新/a,的/u,特征/n,图/n,。/w,这样/r,一层/mq,一层/mq,地/u,迭代/vn,下去/v,，/w,就/d,可以/v,得到/v,多/a,个/q,新/a,的/u,特征/n,图/n,。/w,假设/v,生成/vn,的/u,特征/n,图/n,结果/n,是/v,p/en,2/m,，/w,p/en,3/m,，/w,p/en,4/m,，/w,p/en,5/m,，/w,它们/r,和/c,原来/d,自底/nw,向上/v,的/u,卷积/nw,结果/n,c/en,2/m,，/w,c/en,3/m,，/w,c/en,4/m,，/w,c/en,5/m,一一对应/l,。/w,金字塔/n,结构/n,中/f,所有/b,层级/n,共享/v,分类/vn,层/q,（/w,回归层/nw,）/w,。/w,三/m,、/w,fast/en, ,rcnn/en,中/f,的/u,特征/n,金字塔/n,fast/en, ,rcnn/en,中/f,的/u,roi/en, ,pooling/en,层/q,使用/v,region/en, ,proposal/en,的/u,结果/n,和/c,特征/n,图/n,作为/v,输入/v,。/w,经过/p,特征/n,金字塔/n,，/w,我们/r,得到/v,了/u,许多/m,特征/n,图/n,，/w,作者/n,认为/v,，/w,不同/a,层次/n,的/u,特征/n,图/n,上/f,包含/v,的/u,物体/n,大小/n,也/d,不同/a,，/w,因此/c,，/w,不同/a,尺度/n,的/u,roi/en,，/w,使用/v,不同/a,特征/n,层/q,作为/v,roi/en, ,pooling/en,层/q,的/u,输入/v,。/w,大/a,尺度/n,roi/en,就/d,用/p,后面/f,一些/m,的/u,金字塔/n,层/q,，/w,比如/v,p/en,5/m,；/w,小/a,尺度/n,roi/en,就/d,用/p,前面/f,一点/m,的/u,特征/n,层/q,，/w,比如/v,p/en,4/m,。/w,但是/c,如何/r,确定/v,不同/a,的/u,roi/en,对应/v,的/u,不同/a,特征/n,层/q,呢/y,？/w,作者/n,提/v,出/v,了/u,一种/mq,方法/n,：/w,，/w,224/m,是/v,imagenet/en,的/u,标准/n,输入/v,，/w,k/en,0/m,是/v,基准值/nw,，/w,设置/v,为/p,5/m,，/w,代表/n,p/en,5层/mq,的/u,输出/v,（/w,原/b,图/n,大小/n,就/d,用/p,p/en,5层/mq,）/w,，/w,w/en,和/c,h/en,是/v,roi/en,区域/n,的/u,长/a,和/c,宽/a,，/w,假设/v,roi/en,是/v,112/m, ,*/w, ,112/m,的/u,大小/n,，/w,那么/r,k/en, ,=/w, ,k/en,0/m,-/w,1/m, ,=/w, ,5/m,-/w,1/m, ,=/w, ,4/m,，/w,意味着/v,该/r,roi/en,应该/v,使用/v,p/en,4/m,的/u,特征/n,层/q,。/w,k/en,值/n,做/v,取整/nw,处理/v,。/w,这/r,意味/n,着/u,如果/c,roi/en,的/u,尺度/n,变/v,小/a,（/w,比如/v,224/m,的/u,1/m,//w,2/m,）/w,，/w,那么/r,它/r,应该/v,被/p,映射/v,到/v,一个/m,精细/a,的/u,分辨率/n,水平/n,。/w,与/p,rpn/en,一样/u,，/w,fpn/en,每层/d,feature/en, ,map/en,加入/v,3/m,*/w,3/m,的/u,卷积/nw,及/c,两个/m,相邻/v,的/u,1/m,*/w,1卷/mq,积/v,分别/d,做/v,分类/vn,和/c,回归/v,的/u,预测/v,。/w,在/p,rpn/en,中/f,，/w,实验/vn,对比/v,了/u,fpn/en,不同/a,层/q,feature/en, ,map/en,卷积/nw,参数/n,共享/v,与否/u,，/w,发现/v,共享/v,仍然/d,能/v,达到/v,很/d,好/a,性能/n,，/w,说明/v,特征/n,金字塔/n,使得/v,不同/a,层/q,学/v,到/v,了/u,相同/a,层次/n,的/u,语义/n,特征/n,。/w,用于/v,rpn/en,的/u,fpn/en,：/w,用/p,fpn/en,替换/v,单一/a,尺度/n,的/u,fmap/en,。/w,它们/r,对/p,每个/r,级/q,都/d,有/v,一个/m,单一/a,尺度/n,的/u,anchor/en,（/w,不/d,需要/v,多级/b,作为/v,其/r,fpn/en,）/w,。/w,它们/r,还/d,表明/v,，/w,金字塔/n,的/u,所有/b,层级/n,都/d,有/v,相似/a,的/u,语义/n,层级/n,。/w,faster/en, ,rcnn/en,：/w,他们/r,以/p,类似/v,于/p,图像/n,金字塔/n,输出/v,的/u,方式/n,观察/v,金字塔/n,。/w,因此/c,，/w,使用/v,下面/f,这个/r,公式/n,将/d,roi/en,分配/vn,到/v,特定/b,level/en,。/w,其中/r,w/en,，/w,h/en,分别/d,表示/v,宽度/n,和/c,高度/d,。/w,k/en,是/v,分配/vn,roi/en,的/u,level/en,。/w,是/v,w/en,,/w,h/en,=/w,224/m,,/w,224时/t,映射/v,的/u,level/en,。/w,四/m,、/w,其他/r,问题/n,q/en,1/m,：/w,不同/a,深度/n,的/u,feature/en, ,map/en,为什么/r,可以/v,经过/p,upsample/en,后/f,直接/ad,相加/v,？/w,答/v,：/w,作者/n,解释/v,说/v,这个/r,原因/n,在于/v,我们/r,做/v,了/u,end/en,-/w,to/en,-/w,end/en,的/u,training/en,，/w,因为/c,不同/a,层/q,的/u,参数/n,不/d,是/v,固定/a,的/u,，/w,不同/a,层/q,同时/c,给/p,监督/vn,做/v,end/en,-/w,to/en,-/w,end/en, ,training/en,，/w,所以/c,相加/v,训练/vn,出来/v,的/u,东西/n,能够/v,更/d,有效/a,地/u,融合/v,浅层/nz,和/c,深层/b,的/u,信息/n,。/w,q/en,2/m,：/w,为什么/r,fpn/en,相比/v,去掉/v,深层/b,特征/n,upsample/en,(/w,bottom/en,-/w,up/en, ,pyramid/en,)/w,对于/p,小/a,物体/n,检测/vn,提升/v,明显/a,？/w,（/w,rpn/en,步骤/n,ar/en,从/p,30.5/m,到/v,44.9/m,，/w,fast/en, ,rcnn/en,步骤/n,ap/en,从/p,24.9/m,到/v,33.9/m,）/w,答/v,：/w,作者/n,在/p,poster/en,里/f,给/p,出/v,了/u,这个/r,问题/n,的/u,答案/n,对于/p,小/a,物体/n,，/w,一方面/c,我们/r,需要/v,高/a,分辨率/n,的/u,feature/en, ,map/en,更/d,多/a,关注/v,小/a,区域/n,信息/n,，/w,另一方面/c,，/w,如/v,图/n,中/f,的/u,挎包/n,一样/u,，/w,需要/v,更/d,全局/n,的/u,信息/n,更/d,准确/a,判断/v,挎包/n,的/u,存在/v,及/c,位置/n,。/w,q/en,3/m,：/w,如果/c,不/d,考虑/v,时间/n,情况/n,下/f,，/w,image/en, ,pyramid/en,是否/v,可能/v,会/v,比/p,feature/en, ,pyramid/en,的/u,性能/n,更/d,高/a,？/w,答/v,：/w,作者/n,觉得/v,经过/p,精细/a,调整/vn,训练/vn,是/v,可能/v,的/u,，/w,但是/c,image/en, ,pyramid/en,（/w,金字塔/n,）/w,主要/b,的/u,问题/n,在于/v,时间/n,和/c,空间/n,占用/v,太/d,大/a,，/w,而/c,feature/en, ,pyramid/en,可以/v,在/p,几乎/d,不/d,增加/v,额外/b,计算量/nw,情况/n,下/f,解决/v,多/a,尺度/n,检测/vn,问题/n,。/w,五/m,、/w,代码/n,层面/n,看/v,fpn/en,本/r,部分/n,截/v,取/v,自/p,知乎/nw,文章/n,：/w,从/p,代码/n,细节/n,理解/v, ,fpn/en,，/w,作者/n,使用/v,mask/en,-/w,rcnn/en,的/u,源码/nw,辅助/vn,理解/v,fpn/en,结构/n,，/w,项目/n,地址/n,见/v,mrcnn/en,，/w,关于/p,mrcnn/en,，/w,文章/n,『/w,计算机/n,视觉/n,』/w,rcnn/en,学习/v,_,其三/r,：/w,mask/en,-/w,rcnn/en,会/v,介绍/v,。/w,1/m,、/w, ,怎么/r,做/v,的/u,上/f,采样/v,？/w,高层/n,特征/n,怎么/r,上/f,采样/v,和/c,下/f,一层/mq,的/u,特征/n,融合/v,的/u,，/w,代码/n,里面/f,可以/v,看到/v,:/w,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,5/m,p/en,5/m,'/w,)/w,(/w,c/en,5/m,)/w,c/en,5/m,是/v, ,resnet/en,最/d,顶层/f,的/u,输出/v,，/w,它/r,会/v,先/d,通过/p,一个/m,1/m,*/w,1/m,的/u,卷积层/nw,，/w,同时/c,把/p,通道/n,数/m,转为/v,256/m,，/w,得到/v,fpn/en, ,的/u,最/d,上面/f,的/u,一层/mq, ,p/en,5/m,。/w,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w,name/en,=/w,"/w,fpn/en,_,p/en,5/m,upsampled/en,"/w,)/w,(/w,p/en,5/m,)/w,keras/en, ,的/u, ,api/en, ,说明/v,告诉/v,我们/r,：/w,也就是说/l,，/w,这里/r,的/u,实现/v,使用/v,的/u,是/v,最/d,简单/a,的/u,上/f,采样/v,，/w,没有/v,使用/v,线性/n,插值/nw,，/w,没有/v,使用/v,反/v,卷积/nw,，/w,而是/c,直接/ad,复制/v,。/w,2/m,、/w, ,怎么/r,做/v,的/u,横向/n,连接/v,？/w,p/en,4/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,4/m,add/en,"/w,)/w, ,(/w,[/w,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,upsampled/en,"/w,)/w,(/w,p/en,5/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,4/m,p/en,4/m,'/w,)/w,(/w,c/en,4/m,)/w,]/w,)/w,这里/r,可以/v,很/d,明显/a,的/u,看到/v,，/w,p/en,4/m,就/d,是/v,上/f,采样/v,之后/f,的/u, ,p/en,5/m,加上/v,1/m,*/w,1/m, ,卷积/nw,之后/f,的/u, ,c/en,4/m,，/w,这里/r,的/u,横向/n,连接/v,实际上/d,就是/d,像素/n,加法/n,，/w,先/d,把/p, ,p/en,5/m,和/c,c/en,4/m,转换/v,到/v,一样/u,的/u,尺寸/n,，/w,再/d,直接/ad,进行/v,相加/v,。/w,注意/v,这里/r,对/p,从/p, ,resnet/en,抽取/vn,的/u,特征/n,图/n,做/v,的/u,是/v, ,1/m,*/w,1/m, ,的/u,卷积/nw,：/w,1/m,x/en,1/m,的/u,卷积/nw,我/r,认为/v,有/v,三个/m,作用/n,：/w,使/v,bottom/en,-/w,up/en,对应/v,层/q,降维/nw,至/p,256/m,；/w,缓冲/vn,作用/n,，/w,防止/v,梯度/n,直接/ad,影响/vn,bottom/en,-/w,up/en,主干/n,网络/n,，/w,更/d,稳定/a,；/w,组合/v,特征/n,。/w,3/m,、/w, ,fpn/en,自上而下/l,的/u,网络结构/l,代码/n,怎么/r,实现/v,？/w,#, ,先/d,从/p, ,resnet/en, ,抽取/vn,四个/m,不同/a,阶段/n,的/u,特征/n,图/n, ,c/en,2/m,-/w,c/en,5/m,。/w, ,_,,/w, ,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m, ,=/w, ,resnet/en,_,graph/en,(/w,input/en,_,image/en,,/w, ,config/en,./w,backbone/en,,/w,stage/en,5/m,=/w,true/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,#, ,top/en,-/w,down/en, ,layers/en, ,构建/v,自上而下/l,的/u,网络结构/l, ,#, ,从/p, ,c/en,5/m,开始/v,处理/v,，/w,先/d,卷积/nw,来/v,转换/v,特征/n,图/n,尺寸/n, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,5/m,p/en,5/m,'/w,)/w,(/w,c/en,5/m,)/w, ,#, ,上/f,采样/v,之后/f,的/u,p/en,5/m,和/c,卷积/nw,之后/f,的/u, ,c/en,4/m,像素/n,相加/v,得到/v, ,p/en,4/m,，/w,后续/vn,的/u,过程/n,就/d,类似/v,了/u, ,p/en,4/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,4/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,upsampled/en,"/w,)/w,(/w,p/en,5/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w,name/en,=/w,'/w,fpn/en,_,c/en,4/m,p/en,4/m,'/w,)/w,(/w,c/en,4/m,)/w,]/w,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,3/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,upsampled/en,"/w,)/w,(/w,p/en,4/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,3/m,p/en,3/m,'/w,)/w,(/w,c/en,3/m,)/w,]/w,)/w, ,p/en,2/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,2/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w,name/en,=/w,"/w,fpn/en,_,p/en,3/m,upsampled/en,"/w,)/w,(/w,p/en,3/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,2/m,p/en,2/m,'/w,)/w,(/w,c/en,2/m,)/w,]/w,)/w, ,#, ,p/en,2/m,-/w,p/en,5/m,最后/f,又/d,做/v,了/u,一次/mq,3/m,*/w,3/m,的/u,卷积/nw,，/w,作用/n,是/v,消除/v,上/f,采样/v,带来/v,的/u,混叠/nw,效应/n, ,#, ,attach/en, ,3/m,x/en,3/m, ,conv/en, ,to/en, ,all/en, ,p/en, ,layers/en, ,to/en, ,get/en, ,the/en, ,final/en, ,feature/en, ,maps/en,./w, ,p/en,2/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,2/m,"/w,)/w,(/w,p/en,2/m,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w,name/en,=/w,"/w,fpn/en,_,p/en,3/m,"/w,)/w,(/w,p/en,3/m,)/w, ,p/en,4/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w,name/en,=/w,"/w,fpn/en,_,p/en,4/m,"/w,)/w,(/w,p/en,4/m,)/w, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w,name/en,=/w,"/w,fpn/en,_,p/en,5/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,p/en,6/m, ,is/en, ,used/en, ,for/en, ,the/en, ,5/m,th/en, ,anchor/en, ,scale/en, ,in/en, ,rpn/en,./w, ,generated/en, ,by/en, ,#, ,subsampling/en, ,from/en, ,p/en,5/m, ,with/en, ,stride/en, ,of/en, ,2/m,./w, ,p/en,6/m, ,=/w, ,kl/en,./w,maxpooling/en,2/m,d/en,(/w,pool/en,_,size/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,strides/en,=/w,2/m,,/w,name/en,=/w,"/w,fpn/en,_,p/en,6/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,注意/v, ,p/en,6/m,是/v,用/p,在/p, ,rpn/en, ,目标/n,区域/n,提取/v,网络/n,里面/f,的/u,，/w,而/c,不/d,是/v,用/p,在/p, ,fpn/en, ,网络/n, ,#, ,note/en, ,that/en, ,p/en,6/m, ,is/en, ,used/en, ,in/en, ,rpn/en,,/w, ,but/en, ,not/en, ,in/en, ,the/en, ,classifier/en, ,heads/en,./w, ,rpn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,,/w, ,p/en,6/m,]/w, ,#, ,最后/f,得到/v,了/u,5个/m,融合/v,了/u,不同/a,层级/n,特征/n,的/u,特征/n,图列表/nw,；/w,注意/v, ,p/en,6/m,是/v,用/p,在/p, ,rpn/en, ,目标/n,区域/n,提取/v,网络/n,里面/f,的/u,，/w,而/c,不/d,是/v,用/p,在/p, ,fpn/en, ,网络/n,；/w,另外/c,这里/r, ,p/en,2/m,-/w,p/en,5/m,最后/f,又/d,做/v,了/u,一次/mq,3/m,*/w,3/m,的/u,卷积/nw,，/w,作用/n,是/v,消除/v,上/f,采样/v,带来/v,的/u,混叠/nw,效应/n,。/w,4/m,、/w, ,如何/r,确定/v,某个/r, ,roi/en, ,使用/v,哪/r,一层/mq,特征/n,图/n,进行/v, ,roipooling/en, ,?/w,看/v,代码/n,：/w,#, ,assign/en, ,each/en, ,roi/en, ,to/en, ,a/en, ,level/en, ,in/en, ,the/en, ,pyramid/en, ,based/en, ,on/en, ,the/en, ,roi/en, ,area/en,./w, ,#, ,这里/r,的/u, ,boxes/en, ,是/v, ,roi/en, ,的/u,框/q,，/w,用/p,来/v,计算/v,得到/v,每个/r, ,roi/en, ,框/q,的/u,面积/n, ,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m, ,=/w, ,tf/en,./w,split/en,(/w,boxes/en,,/w, ,4/m,,/w, ,axis/en,=/w,2/m,)/w, ,h/en, ,=/w, ,y/en,2/m, ,-/w, ,y/en,1/m, ,w/en, ,=/w, ,x/en,2/m, ,-/w, ,x/en,1/m, ,#, ,use/en, ,shape/en, ,of/en, ,first/en, ,image/en,./w, ,images/en, ,in/en, ,a/en, ,batch/en, ,must/en, ,have/en, ,the/en, ,same/en, ,size/en,./w, ,#, ,这里/r,得到/v,原/b,图/n,的/u,尺寸/n,，/w,计算/v,原/b,图/n,的/u,面积/n, ,image/en,_,shape/en, ,=/w, ,parse/en,_,image/en,_,meta/en,_,graph/en,(/w,image/en,_,meta/en,)/w,[/w,'/w,image/en,_,shape/en,'/w,]/w,[/w,0/m,]/w, ,#, ,equation/en, ,1/m, ,in/en, ,the/en, ,feature/en, ,pyramid/en, ,networks/en, ,paper/en,./w, ,account/en, ,for/en, ,#, ,the/en, ,fact/en, ,that/en, ,our/en, ,coordinates/en, ,are/en, ,normalized/en, ,here/en,./w, ,#, ,e/en,./w,g/en,./w, ,a/en, ,224/m,x/en,224/m, ,roi/en, ,(/w,in/en, ,pixels/en,)/w, ,maps/en, ,to/en, ,p/en,4/m, ,#, ,原/b,图/n,面积/n, ,image/en,_,area/en, ,=/w, ,tf/en,./w,cast/en,(/w,image/en,_,shape/en,[/w,0/m,]/w, ,*/w, ,image/en,_,shape/en,[/w,1/m,]/w,,/w, ,tf/en,./w,float/en,32/m,)/w, ,#, ,分/q,两步/mq,计算/v,每个/r, ,roi/en, ,框/q,需要/v,在/p,哪个/r,层/q,的/u,特征/n,图中/nrf,进行/v, ,pooling/en, ,roi/en,_,level/en, ,=/w, ,log/en,2/m,_,graph/en,(/w,tf/en,./w,sqrt/en,(/w,h/en, ,*/w, ,w/en,)/w, ,//w, ,(/w,224.0/m, ,//w, ,tf/en,./w,sqrt/en,(/w,image/en,_,area/en,)/w,)/w,)/w, ,roi/en,_,level/en, ,=/w, ,tf/en,./w,minimum/en,(/w,5/m,,/w, ,tf/en,./w,maximum/en,(/w, ,2/m,,/w, ,4/m, ,+/w, ,tf/en,./w,cast/en,(/w,tf/en,./w,round/en,(/w,roi/en,_,level/en,)/w,,/w, ,tf/en,./w,int/en,32/m,)/w,)/w,)/w,不同/a,尺度/n,的/u,roi/en,，/w,使用/v,不同/a,特征/n,层/q,作为/v,roi/en, ,pooling/en,层/q,的/u,输入/v,，/w,大/a,尺度/n,roi/en,就/d,用/p,后面/f,一些/m,的/u,金字塔/n,层/q,，/w,比如/v,p/en,5/m,；/w,小/a,尺度/n,roi/en,就/d,用/p,前面/f,一点/m,的/u,特征/n,层/q,，/w,比如/v,p/en,4/m,。/w,那/r,怎么/r,判断/v,roi/en,改用/v,那个/r,层/q,的/u,输出/v,呢/y,？/w,论文/n,的/u, ,k/en, ,使用/v,如下/v,公式/n,，/w,代码/n,做/v,了/u,一点/m,更改/v,，/w,替换/v,为/p,roi/en,_,level/en,：/w,#, ,代码/n,里面/f,的/u,计算/v,替换/v,为/p,以下/f,计算/v,方式/n,：/w, ,roi/en,_,level/en, ,=/w, ,min/en,(/w,5/m,,/w, ,max/en,(/w,2/m,,/w, ,4/m, ,+/w, ,log/en,2/m,(/w,sqrt/en,(/w,w/en, ,*/w, ,h/en,)/w, ,//w, ,(/w, ,224/m, ,//w, ,sqrt/en,(/w,image/en,_,area/en,)/w,)/w, ,)/w, ,)/w, ,)/w,224/m,是/v,imagenet/en,的/u,标准/n,输入/v,，/w,k/en,0/m,是/v,基准值/nw,，/w,设置/v,为/p