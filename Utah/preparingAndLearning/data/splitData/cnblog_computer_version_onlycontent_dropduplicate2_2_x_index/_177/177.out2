一/m,、/w,模块/n,概述/v,上节/t,的/u,最后/f,，/w,我们/r,进行/v,了/u,如下/v,操作/v,获取/v,了/u,有限/a,的/u,proposal/en,，/w,#, ,[/w,images/en,_,per/en,_,gpu/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,#, ,images/en,_,per/en,_,gpu/en,取代/v,了/u,batch/en,，/w,之后/f,说/v,的/u,batch/en,都/d,是/v,images/en,_,per/en,_,gpu/en, ,rpn/en,_,rois/en, ,=/w, ,proposallayer/en,(/w, ,proposal/en,_,count/en,=/w,proposal/en,_,count/en,,/w, ,nms/en,_,threshold/en,=/w,config/en,./w,rpn/en,_,nms/en,_,threshold/en,,/w, ,#, ,0.7/m, ,name/en,=/w,"/w,roi/en,"/w,,/w, ,config/en,=/w,config/en,)/w,(/w,[/w,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,,/w, ,anchors/en,]/w,)/w,总结/v,一下/m,：/w,与/p, ,gt/en, ,的/u, ,iou/en, ,大于/v,0.7/m,与/p,某/r,一个/m, ,gt/en, ,的/u, ,iou/en, ,最大/a,的/u,那个/r, ,anchor/en,进一步/d,，/w,我们/r,需要/v,按照/p,rcnn/en,的/u,思路/n,，/w,使用/v,proposal/en,对/p,共享/v,特征/n,进行/v,roi/en,操作/v,，/w,在/p,mask/en,-/w,rcnn/en,中/f,这里/r,有/v,两个/m,创新/v,：/w,roi/en,使用/v,roi/en, ,align/en,取代/v,了/u,之前/f,的/u,roi/en, ,pooling/en,共享/v,特征/n,由/p,之前/f,的/u,单层/nw,变换/v,为了/p,fpn/en,得到/v,的/u,金字塔/n,多/a,层/q,特征/n,，/w,即/v,：/w,mrcnn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,]/w,其中/r,创新/v,点/q,2/m,意味/n,着/u,我们/r,不同/a,的/u,proposal/en,对应/v,去/v,roi/en,的/u,特征/n,层/q,并/c,不/d,相同/a,，/w,所以/c,，/w,我们/r,需要/v,：/w,按照/p,proposal/en,的/u,长宽/v,，/w,将/d,不同/a,的/u,proposal/en,对应/v,给/p,不同/a,的/u,特征/n,层/q,在/p,对应/v,特征/n,层/q,上/f,进行/v,roi/en,操作/v,二/m,、/w,实现/v,分析/vn,下面/f,会/v,用/p,到/v,高维/nr,切片/v,函数/n,，/w,这里/r,先行/v,给/p,出/v,讲解/v,链接/n,：/w,『/w,tensorflow/en,』/w,高级/a,高维/nr,切片/v,gather/en,_,nd/en,接/v,前/f,文/ng,bulid/en,函数/n,代码/n,，/w,我们/r,如下/v,调入/v,实现/v,本节/t,的/u,功能/n,，/w,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,……/w, ,else/en,:/w, ,#, ,network/en, ,heads/en, ,#, ,proposal/en, ,classifier/en, ,and/en, ,bbox/en, ,regressor/en, ,heads/en, ,#, ,output/en, ,shapes/en,:/w, ,#, ,mrcnn/en,_,class/en,_,logits/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,logits/en, ,(/w,before/en, ,softmax/en,)/w, ,#, ,mrcnn/en,_,class/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,probabilities/en, ,#, ,mrcnn/en,_,bbox/en,(/w,deltas/en,)/w,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en, ,=/w,\/w, ,fpn/en,_,classifier/en,_,graph/en,(/w,rpn/en,_,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,config/en,./w,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,,/w, ,fc/en,_,layers/en,_,size/en,=/w,config/en,./w,fpn/en,_,classif/en,_,fc/en,_,layers/en,_,size/en,)/w,fpn/en,特征/n,层/q,分类/vn,函数/n,纵览/v,如下/v,，/w,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#, ,#, ,feature/en, ,pyramid/en, ,network/en, ,heads/en, ,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#, ,def/en, ,fpn/en,_,classifier/en,_,graph/en,(/w,rois/en,,/w, ,feature/en,_,maps/en,,/w, ,image/en,_,meta/en,,/w, ,pool/en,_,size/en,,/w, ,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,true/en,,/w, ,fc/en,_,layers/en,_,size/en,=/w,1024/m,)/w,:/w, ,"/w,"/w,"/w,builds/en, ,the/en, ,computation/en, ,graph/en, ,of/en, ,the/en, ,feature/en, ,pyramid/en, ,network/en, ,classifier/en, ,and/en, ,regressor/en, ,heads/en,./w, ,rois/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,proposal/en, ,boxes/en, ,in/en, ,normalized/en, ,coordinates/en,./w, ,feature/en,_,maps/en,:/w, ,list/en, ,of/en, ,feature/en, ,maps/en, ,from/en, ,different/en, ,layers/en, ,of/en, ,the/en, ,pyramid/en,,/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,]/w,./w, ,each/en, ,has/en, ,a/en, ,different/en, ,resolution/en,./w, ,image/en,_,meta/en,:/w, ,[/w,batch/en,,/w, ,(/w,meta/en, ,data/en,)/w,]/w, ,image/en, ,details/en,./w, ,see/en, ,compose/en,_,image/en,_,meta/en,(/w,)/w, ,pool/en,_,size/en,:/w, ,the/en, ,width/en, ,of/en, ,the/en, ,square/en, ,feature/en, ,map/en, ,generated/en, ,from/en, ,roi/en, ,pooling/en,./w, ,num/en,_,classes/en,:/w, ,number/en, ,of/en, ,classes/en,,/w, ,which/en, ,determines/en, ,the/en, ,depth/en, ,of/en, ,the/en, ,results/en, ,train/en,_,bn/en,:/w, ,boolean/en,./w, ,train/en, ,or/en, ,freeze/en, ,batch/en, ,norm/en, ,layers/en, ,fc/en,_,layers/en,_,size/en,:/w, ,size/en, ,of/en, ,the/en, ,2/m, ,fc/en, ,layers/en, ,returns/en,:/w, ,logits/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,logits/en, ,(/w,before/en, ,softmax/en,)/w, ,probs/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,probabilities/en, ,bbox/en,_,deltas/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,deltas/en, ,to/en, ,apply/en, ,to/en, ,proposal/en, ,boxes/en, ,"/w,"/w,"/w, ,#, ,roi/en, ,pooling/en, ,#, ,shape/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,pool/en,_,size/en,,/w, ,pool/en,_,size/en,,/w, ,channels/en,]/w, ,x/en, ,=/w, ,pyramidroialign/en,(/w,[/w,pool/en,_,size/en,,/w, ,pool/en,_,size/en,]/w,,/w, ,name/en,=/w,"/w,roi/en,_,align/en,_,classifier/en,"/w,)/w,(/w,[/w,rois/en,,/w, ,image/en,_,meta/en,]/w, ,+/w, ,feature/en,_,maps/en,)/w, ,#, ,two/en, ,1024/m, ,fc/en, ,layers/en, ,(/w,implemented/en, ,with/en, ,conv/en,2/m,d/en, ,for/en, ,consistency/en,)/w, ,#, ,timedistributed/en,拆分/v,了/u,输入/v,数据/n,的/u,第/m,1维/mq,（/w,从/p,0/m,开始/v,）/w,，/w,将/d,完全/ad,一样/u,的/u,模型/n,独立/v,的/u,应用/vn,于/p,拆/v,分/q,后/f,的/u,输入/v,数据/n,，/w,具体/a,到/v,下行/v,，/w, ,#, ,就是/d,将/d,num/en,_,rois/en,个/q,卷积/nw,应用/vn,到/v,num/en,_,rois/en,个/q,维度/n,为/p,[/w,batch/en,,/w, ,pool/en,_,size/en,,/w, ,pool/en,_,size/en,,/w, ,channels/en,]/w,的/u,输入/v,，/w,结果/n,合并/v, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,fc/en,_,layers/en,_,size/en,,/w, ,(/w,pool/en,_,size/en,,/w, ,pool/en,_,size/en,)/w,,/w, ,padding/en,=/w,"/w,valid/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,_,conv/en,1/m,"/w,)/w,(/w,x/en,)/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,1/m,,/w, ,1/m,,/w, ,1024/m,]/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,class/en,_,bn/en,1/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,fc/en,_,layers/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,_,conv/en,2/m,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,class/en,_,bn/en,2/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,shared/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,k/en,./w,squeeze/en,(/w,k/en,./w,squeeze/en,(/w,x/en,,/w, ,3/m,)/w,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,pool/en,_,squeeze/en,"/w,)/w,(/w,x/en,)/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,1024/m,]/w, ,#, ,classifier/en, ,head/en, ,mrcnn/en,_,class/en,_,logits/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,dense/en,(/w,num/en,_,classes/en,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,class/en,_,logits/en,'/w,)/w,(/w,shared/en,)/w, ,mrcnn/en,_,probs/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,activation/en,(/w,"/w,softmax/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,"/w,)/w,(/w,mrcnn/en,_,class/en,_,logits/en,)/w, ,#, ,bbox/en, ,head/en, ,#, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en, ,*/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,dense/en,(/w,num/en,_,classes/en, ,*/w, ,4/m,,/w, ,activation/en,=/w,'/w,linear/en,'/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,bbox/en,_,fc/en,'/w,)/w,(/w,shared/en,)/w, ,#, ,reshape/en, ,to/en, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,s/en, ,=/w, ,k/en,./w,int/en,_,shape/en,(/w,x/en,)/w, ,#, ,下行/v,源码/nw,：/w,k/en,./w,reshape/en,(/w,inputs/en,,/w, ,(/w,k/en,./w,shape/en,(/w,inputs/en,)/w,[/w,0/m,]/w,,/w,)/w, ,+/w, ,self/en,./w,target/en,_,shape/en,)/w, ,mrcnn/en,_,bbox/en, ,=/w, ,kl/en,./w,reshape/en,(/w,(/w,s/en,[/w,1/m,]/w,,/w, ,num/en,_,classes/en,,/w, ,4/m,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,bbox/en,"/w,)/w,(/w,x/en,)/w, ,return/en, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,probs/en,,/w, ,mrcnn/en,_,bbox/en,下面/f,我们/r,来/v,分析/vn,一下/m,该/r,函数/n,。/w,进入/v,函数/n,，/w,首先/d,调用/v,了/u,pyramidroi/en,，/w,#, ,roi/en, ,pooling/en, ,#, ,shape/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,pool/en,_,size/en,,/w, ,pool/en,_,size/en,,/w, ,channels/en,]/w, ,x/en, ,=/w, ,pyramidroialign/en,(/w,[/w,pool/en,_,size/en,,/w, ,pool/en,_,size/en,]/w,,/w, ,name/en,=/w,"/w,roi/en,_,align/en,_,classifier/en,"/w,)/w,(/w,[/w,rois/en,,/w, ,image/en,_,meta/en,]/w, ,+/w, ,feature/en,_,maps/en,)/w,这个/r,class/en,基本/a,实现/v,了/u,我们/r,开篇/n,所/u,说/v,的/u,全部/m,功能/n,，/w,即/v,特征/n,层/q,分类/vn,并/c,roi/en,。/w,roialign/en,类/q,首先/d,我们/r,依据/n,『/w,计算机/n,视觉/n,』/w,fpn/en,特征/n,金字塔/n,网络/n,中/f,第三/nw,节/n,所/u,讲/v,，/w,对/p,proposal/en,进行/v,分类/vn,，/w,注意/v,的/u,是/v,我们/r,使用/v,于/p,网络/n,中/f,的/u,hw/en,是/v,归/v,一化/nw,了/u,的/u,（/w,以/p,原/b,图/n,hw/en,为/p,单位/n,长度/n,）/w,，/w,所以/c,计算/v,时/ng,需要/v,还原/v,（/w,对于/p,公式/n,而言/u,：/w,w/en,，/w,h/en,分别/d,表示/v,宽度/n,和/c,高度/d,；/w,k/en,是/v,分配/vn,roi/en,的/u,level/en,；/w,是/v,w/en,,/w,h/en,=/w,224/m,,/w,224时/t,映射/v,的/u,level/en,）/w,。/w,注意/v,两个/m,操作/v,节点/n,：/w,level/en,_,boxes/en,和/c,box/en,_,indices/en,，/w,第一/m,个/q,记录/v,了/u,对应/v,的/u,level/en,特征/n,层/q,中/f,分配/vn,到/v,的/u,每个/r,box/en,的/u,坐标/n,，/w,第二/m,个/q,则/d,记录/v,了/u,每个/r,box/en,对应/v,的/u,图片/n,在/p,batch/en,中/f,的/u,索引/n,（/w,一个/m,记录/v,了/u,候选框/nw,索引/n,对应/v,的/u,图片/n,即/v,下/f,文/ng,中/f,的/u,两个/m,大块/n,，/w,一个/m,记录/v,了/u,候选框/nw,的/u,索引/n,对应/v,其/r,坐标/n,即/v,小黑/nz,框/q,的/u,坐标/n,）/w,，/w,两者/r,结合/v,可以/v,索引/n,到/v,下面/f,每个/r,黑色/n,小框/nw,的/u,坐标/n,信息/n,。/w,至于/p,roi/en, ,align/en,本身/r,，/w,实际/n,就/d,是/v,双线性/nw,插值/nw,，/w,使用/v,内置/vn,api/en,实现/v,即可/v,。/w,这里/r,属于/v,rpn/en,网络/n,和/c,rcnn/en,网络/n,的/u,分界线/n,，/w,level/en,_,boxes/en,和/c,box/en,_,indices/en,本身/r,属于/v,rpn/en,计算/v,出来/v,结果/n,，/w,但是/c,两者/r,作用/n,于/p,feature/en,后/f,的/u,输出/v,tensor/en,却是/d,rcnn/en,部分/n,的/u,输入/v,，/w,但是/c,两/m,部分/n,的/u,梯度/n,不/d,能/v,相互/d,流通/vn,的/u,，/w,所以/c,需要/v,tf/en,./w,stop/en,_,gradient/en,(/w,)/w,截断/v,梯度/n,传播/vn,。/w,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#, ,#, ,roialign/en, ,layer/en, ,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#, ,def/en, ,log/en,2/m,_,graph/en,(/w,x/en,)/w,:/w, ,"/w,"/w,"/w,implementation/en, ,of/en, ,log/en,2/m,./w, ,tf/en, ,doesn/en,'/w,t/en, ,have/en, ,a/en, ,native/en, ,implementation/en,./w,"/w,"/w,"/w, ,return/en, ,tf/en,./w,log/en,(/w,x/en,)/w, ,//w, ,tf/en,./w,log/en,(/w,2.0/m,)/w, ,class/en, ,pyramidroialign/en,(/w,ke/en,./w,layer/en,)/w,:/w, ,"/w,"/w,"/w,implements/en, ,roi/en, ,pooling/en, ,on/en, ,multiple/en, ,levels/en, ,of/en, ,the/en, ,feature/en, ,pyramid/en,./w, ,params/en,:/w, ,-/w, ,pool/en,_,shape/en,:/w, ,[/w,pool/en,_,height/en,,/w, ,pool/en,_,width/en,]/w, ,of/en, ,the/en, ,output/en, ,pooled/en, ,regions/en,./w, ,usually/en, ,[/w,7/m,,/w, ,7/m,]/w, ,inputs/en,:/w, ,-/w, ,boxes/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,boxes/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,normalized/en, ,coordinates/en,./w, ,possibly/en, ,padded/en, ,with/en, ,zeros/en, ,if/en, ,not/en, ,enough/en, ,boxes/en, ,to/en, ,fill/en, ,the/en, ,array/en,./w, ,-/w, ,image/en,_,meta/en,:/w, ,[/w,batch/en,,/w, ,(/w,meta/en, ,data/en,)/w,]/w, ,image/en, ,details/en,./w, ,see/en, ,compose/en,_,image/en,_,meta/en,(/w,)/w, ,-/w, ,feature/en,_,maps/en,:/w, ,list/en, ,of/en, ,feature/en, ,maps/en, ,from/en, ,different/en, ,levels/en, ,of/en, ,the/en, ,pyramid/en,./w, ,each/en, ,is/en, ,[/w,batch/en,,/w, ,height/en,,/w, ,width/en,,/w, ,channels/en,]/w, ,output/en,:/w, ,pooled/en, ,regions/en, ,in/en, ,the/en, ,shape/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,boxes/en,,/w, ,pool/en,_,height/en,,/w, ,pool/en,_,width/en,,/w, ,channels/en,]/w,./w, ,the/en, ,width/en, ,and/en, ,height/en, ,are/en, ,those/en, ,specific/en, ,in/en, ,the/en, ,pool/en,_,shape/en, ,in/en, ,the/en, ,layer/en, ,constructor/en,./w, ,"/w,"/w,"/w, ,def/en, ,_,_,init/en,_,_,(/w,self/en,,/w, ,pool/en,_,shape/en,,/w, ,*/w,*/w,kwargs/en,)/w,:/w, ,super/en,(/w,pyramidroialign/en,,/w, ,self/en,)/w,./w,_,_,init/en,_,_,(/w,*/w,*/w,kwargs/en,)/w, ,self/en,./w,pool/en,_,shape/en, ,=/w, ,tuple/en,(/w,pool/en,_,shape/en,)/w, ,def/en, ,call/en,(/w,self/en,,/w, ,inputs/en,)/w,:/w, ,#, ,num/en,_,boxes/en,指/v,的/u,是/v,proposal/en,数目/n,，/w,它们/r,均/d,会/v,作用/n,于/p,每张/r,图片/n,上/f,，/w,只是/d,不同/a,的/u,proposal/en,作用/n,于/p,图片/n, ,#, ,的/u,特征/n,级别/n,不同/a,，/w,我/r,通过/p,循环/vn,特征/n,层/q,寻找/v,符合/v,的/u,proposal/en,，/w,应用/vn,roialign/en, ,#, ,crop/en, ,boxes/en, ,[/w,batch/en,,/w, ,num/en,_,boxes/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,normalized/en, ,coords/en, ,boxes/en, ,=/w, ,inputs/en,[/w,0/m,]/w, ,#, ,image/en, ,meta/en, ,#, ,holds/en, ,details/en, ,about/en, ,the/en, ,image/en,./w, ,see/en, ,compose/en,_,image/en,_,meta/en,(/w,)/w, ,image/en,_,meta/en, ,=/w, ,inputs/en,[/w,1/m,]/w, ,#, ,feature/en, ,maps/en,./w, ,list/en, ,of/en, ,feature/en, ,maps/en, ,from/en, ,different/en, ,level/en, ,of/en, ,the/en, ,#, ,feature/en, ,pyramid/en,./w, ,each/en, ,is/en, ,[/w,batch/en,,/w, ,height/en,,/w, ,width/en,,/w, ,channels/en,]/w, ,feature/en,_,maps/en, ,=/w, ,inputs/en,[/w,2/m,:/w,]/w, ,#, ,assign/en, ,each/en, ,roi/en, ,to/en, ,a/en, ,level/en, ,in/en, ,the/en, ,pyramid/en, ,based/en, ,on/en, ,the/en, ,roi/en, ,area/en,./w, ,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m, ,=/w, ,tf/en,./w,split/en,(/w,boxes/en,,/w, ,4/m,,/w, ,axis/en,=/w,2/m,)/w, ,h/en, ,=/w, ,y/en,2/m, ,-/w, ,y/en,1/m, ,w/en, ,=/w, ,x/en,2/m, ,-/w, ,x/en,1/m, ,#, ,use/en, ,shape/en, ,of/en, ,first/en, ,image/en,./w, ,images/en, ,in/en, ,a/en, ,batch/en, ,must/en, ,have/en, ,the/en, ,same/en, ,size/en,./w, ,image/en,_,shape/en, ,=/w, ,parse/en,_,image/en,_,meta/en,_,graph/en,(/w,image/en,_,meta/en,)/w,[/w,'/w,image/en,_,shape/en,'/w,]/w,[/w,0/m,]/w, ,#, ,h/en,,/w, ,w/en,,/w, ,c/en, ,#, ,equation/en, ,1/m, ,in/en, ,the/en, ,feature/en, ,pyramid/en, ,networks/en, ,paper/en,./w, ,account/en, ,for/en, ,#, ,the/en, ,fact/en, ,that/en, ,our/en, ,coordinates/en, ,are/en, ,normalized/en, ,here/en,./w, ,#, ,e/en,./w,g/en,./w, ,a/en, ,224/m,x/en,224/m, ,roi/en, ,(/w,in/en, ,pixels/en,)/w, ,maps/en, ,to/en, ,p/en,4/m, ,image/en,_,area/en, ,=/w, ,tf/en,./w,cast/en,(/w,image/en,_,shape/en,[/w,0/m,]/w, ,*/w, ,image/en,_,shape/en,[/w,1/m,]/w,,/w, ,tf/en,./w,float/en,32/m,)/w, ,roi/en,_,level/en, ,=/w, ,log/en,2/m,_,graph/en,(/w,tf/en,./w,sqrt/en,(/w,h/en, ,*/w, ,w/en,)/w, ,//w, ,(/w,224.0/m, ,//w, ,tf/en,./w,sqrt/en,(/w,image/en,_,area/en,)/w,)/w,)/w, ,#, ,h/en,、/w,w/en,已经/d,归/v,一化/nw, ,roi/en,_,level/en, ,=/w, ,tf/en,./w,minimum/en,(/w,5/m,,/w, ,tf/en,./w,maximum/en,(/w, ,2/m,,/w, ,4/m, ,+/w, ,tf/en,./w,cast/en,(/w,tf/en,./w,round/en,(/w,roi/en,_,level/en,)/w,,/w, ,tf/en,./w,int/en,32/m,)/w,)/w,)/w, ,#, ,确保/v,值位/nw,于/p,2/m,到/v,5/m,之间/f, ,roi/en,_,level/en, ,=/w, ,tf/en,./w,squeeze/en,(/w,roi/en,_,level/en,,/w, ,2/m,)/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,boxes/en,]/w, ,#, ,loop/en, ,through/en, ,levels/en, ,and/en, ,apply/en, ,roi/en, ,pooling/en, ,to/en, ,each/en,./w, ,p/en,2/m, ,to/en, ,p/en,5/m,./w, ,pooled/en, ,=/w, ,[/w,]/w, ,box/en,_,to/en,_,level/en, ,=/w, ,[/w,]/w, ,for/en, ,i/en,,/w, ,level/en, ,in/en, ,enumerate/en,(/w,range/en,(/w,2/m,,/w, ,6/m,)/w,)/w,:/w, ,#, ,tf/en,./w,where/en, ,返回/v,值/n,格式/n, ,[/w,坐标/n,1/m,,/w, ,坐标/n,2/m,……/w,]/w, ,#, ,np/en,./w,where/en, ,返回/v,值/n,格式/n, ,[/w,[/w,坐标/n,1/m,./w,x/en,,/w, ,坐标/n,2/m,./w,x/en,……/w,]/w,,/w, ,[/w,坐标/n,1/m,./w,y/en,,/w, ,坐标/n,2/m,./w,y/en,……/w,]/w,]/w, ,ix/en, ,=/w, ,tf/en,./w,where/en,(/w,tf/en,./w,equal/en,(/w,roi/en,_,level/en,,/w, ,level/en,)/w,)/w, ,#, ,返回/v,坐标/n,表示/v,：/w,第/m,n/en,张/q,图片/n,的/u,第/m,i/en,个/q,proposal/en, ,level/en,_,boxes/en, ,=/w, ,tf/en,./w,gather/en,_,nd/en,(/w,boxes/en,,/w, ,ix/en,)/w, ,#, ,[/w,本/r,level/en,的/u,proposal/en,数目/n,,/w, ,4/m,]/w, ,#, ,box/en, ,indices/en, ,for/en, ,crop/en,_,and/en,_,resize/en,./w, ,box/en,_,indices/en, ,=/w, ,tf/en,./w,cast/en,(/w,ix/en,[/w,:/w,,/w, ,0/m,]/w,,/w, ,tf/en,./w,int/en,32/m,)/w, ,#, ,记录/v,每个/r,propose/en,对应/v,图片/n,序号/n, ,#, ,keep/en, ,track/en, ,of/en, ,which/en, ,box/en, ,is/en, ,mapped/en, ,to/en, ,which/en, ,level/en, ,box/en,_,to/en,_,level/en,./w,append/en,(/w,ix/en,)/w, ,#, ,stop/en, ,gradient/en, ,propogation/en, ,to/en, ,roi/en, ,proposals/en, ,level/en,_,boxes/en, ,=/w, ,tf/en,./w,stop/en,_,gradient/en,(/w,level/en,_,boxes/en,)/w, ,box/en,_,indices/en, ,=/w, ,tf/en,./w,stop/en,_,gradient/en,(/w,box/en,_,indices/en,)/w, ,#, ,crop/en, ,and/en, ,resize/en, ,#, ,from/en, ,mask/en, ,r/en,-/w,cnn/en, ,paper/en,:/w, ,"/w,we/en, ,sample/en, ,four/en, ,regular/en, ,locations/en,,/w, ,so/en, ,#, ,that/en, ,we/en, ,can/en, ,evaluate/en, ,either/en, ,max/en, ,or/en, ,average/en, ,pooling/en,./w, ,in/en, ,fact/en,,/w, ,#, ,interpolating/en, ,only/en, ,a/en, ,single/en, ,value/en, ,at/en, ,each/en, ,bin/en, ,center/en, ,(/w,without/en, ,#, ,pooling/en,)/w, ,is/en, ,nearly/en, ,as/en, ,effective/en,./w,"/w, ,#, ,#, ,here/en, ,we/en, ,use/en, ,the/en, ,simplified/en, ,approach/en, ,of/en, ,a/en, ,single/en, ,value/en, ,per/en, ,bin/en,,/w, ,#, ,which/en, ,is/en, ,how/en, ,it/en,'/w,s/en, ,done/en, ,in/en, ,tf/en,./w,crop/en,_,and/en,_,resize/en,(/w,)/w, ,#, ,result/en,:/w, ,[/w,this/en,_,level/en,_,num/en,_,boxes/en,,/w, ,pool/en,_,height/en,,/w, ,pool/en,_,width/en,,/w, ,channels/en,]/w, ,pooled/en,./w,append/en,(/w,tf/en,./w,image/en,./w,crop/en,_,and/en,_,resize/en,(/w, ,feature/en,_,maps/en,[/w,i/en,]/w,,/w, ,level/en,_,boxes/en,,/w, ,box/en,_,indices/en,,/w, ,self/en,./w,pool/en,_,shape/en,,/w, ,method/en,=/w,"/w,bilinear/en,"/w,)/w,)/w, ,#, ,输入/v,参数/n,shape/en,:/w, ,#, ,[/w,batch/en,,/w, ,image/en,_,height/en,,/w, ,image/en,_,width/en,,/w, ,channels/en,]/w, ,#, ,[/w,this/en,_,level/en,_,num/en,_,boxes/en,,/w, ,4/m,]/w, ,#, ,[/w,this/en,_,level/en,_,num/en,_,boxes/en,]/w, ,#, ,[/w,height/en,,/w, ,pool/en,_,width/en,]/w, ,#, ,pack/en, ,pooled/en, ,features/en, ,into/en, ,one/en, ,tensor/en, ,pooled/en, ,=/w, ,tf/en,./w,concat/en,(/w,pooled/en,,/w, ,axis/en,=/w,0/m,)/w, ,#, ,[/w,batch/en,*/w,num/en,_,boxes/en,,/w, ,pool/en,_,height/en,,/w, ,pool/en,_,width/en,,/w, ,channels/en,]/w, ,#, ,pack/en, ,box/en,_,to/en,_,level/en, ,mapping/en, ,into/en, ,one/en, ,array/en, ,and/en, ,add/en, ,another/en, ,#, ,column/en, ,representing/en, ,the/en, ,order/en, ,of/en, ,pooled/en, ,boxes/en, ,box/en,_,to/en,_,level/en, ,=/w, ,tf/en,./w,concat/en,(/w,box/en,_,to/en,_,level/en,,/w, ,axis/en,=/w,0/m,)/w, ,#, ,[/w,batch/en,*/w,num/en,_,boxes/en,,/w, ,2/m,]/w, ,box/en,_,range/en, ,=/w, ,tf/en,./w,expand/en,_,dims/en,(/w,tf/en,./w,range/en,(/w,tf/en,./w,shape/en,(/w,box/en,_,to/en,_,level/en,)/w,[/w,0/m,]/w,)/w,,/w, ,1/m,)/w, ,#, ,[/w,batch/en,*/w,num/en,_,boxes/en,,/w, ,1/m,]/w, ,box/en,_,to/en,_,level/en, ,=/w, ,tf/en,./w,concat/en,(/w,[/w,tf/en,./w,cast/en,(/w,box/en,_,to/en,_,level/en,,/w, ,tf/en,./w,int/en,32/m,)/w,,/w, ,box/en,_,range/en,]/w,,/w, ,axis/en,=/w,1/m,)/w, ,#, ,[/w,batch/en,*/w,num/en,_,boxes/en,,/w, ,3/m,]/w, ,#, ,截止/vn,到/v,目前/t,，/w,我们/r,获取/v,了/u,记录/v,全部/m,roialign/en,结果/n,feat/en,集合/v,的/u,张量/nr,pooled/en,，/w,和/c,记录/v,这些/r,feat/en,相关/v,信息/n,的/u,张量/nr,box/en,_,to/en,_,level/en,，/w, ,#, ,由于/c,提取/v,方法/n,的/u,原因/n,，/w,此时/r,的/u,feat/en,并/c,不/d,是/v,按照/p,原始/a,顺序/n,排序/vn,（/w,先/d,按/p,batch/en,然后/c,按/p,box/en, ,index/en,排序/vn,）/w,，/w,下面/f,我们/r,设法/v,将/d,之/u,恢复/v,顺/a, ,#, ,序/n,（/w,roialign/en,作用/n,于/p,对应/v,图片/n,的/u,对应/v,proposal/en,生成/vn,feat/en,）/w, ,#, ,rearrange/en, ,pooled/en, ,features/en, ,to/en, ,match/en, ,the/en, ,order/en, ,of/en, ,the/en, ,original/en, ,boxes/en, ,#, ,sort/en, ,box/en,_,to/en,_,level/en, ,by/en, ,batch/en, ,then/en, ,box/en, ,index/en, ,#, ,tf/en, ,doesn/en,'/w,t/en, ,have/en, ,a/en, ,way/en, ,to/en, ,sort/en, ,by/en, ,two/en, ,columns/en,,/w, ,so/en, ,merge/en, ,them/en, ,and/en, ,sort/en,./w, ,#, ,box/en,_,to/en,_,level/en,[/w,i/en,,/w, ,0/m,]/w,表示/v,的/u,是/v,当前/t,feat/en,隶属/v,的/u,图片/n,索引/n,，/w,box/en,_,to/en,_,level/en,[/w,i/en,,/w, ,1/m,]/w,表示/v,的/u,是/v,其/r,box/en,序号/n, ,sorting/en,_,tensor/en, ,=/w, ,box/en,_,to/en,_,level/en,[/w,:/w,,/w, ,0/m,]/w, ,*/w, ,100000/m, ,+/w, ,box/en,_,to/en,_,level/en,[/w,:/w,,/w, ,1/m,]/w, ,#, ,[/w,batch/en,*/w,num/en,_,boxes/en,]/w, ,ix/en, ,=/w, ,tf/en,./w,nn/en,./w,top/en,_,k/en,(/w,sorting/en,_,tensor/en,,/w, ,k/en,=/w,tf/en,./w,shape/en,(/w, ,box/en,_,to/en,_,level/en,)/w,[/w,0/m,]/w,)/w,./w,indices/en,[/w,:/w,:/w,-/w,1/m,]/w, ,ix/en, ,=/w, ,tf/en,./w,gather/en,(/w,box/en,_,to/en,_,level/en,[/w,:/w,,/w, ,2/m,]/w,,/w, ,ix/en,)/w, ,pooled/en, ,=/w, ,tf/en,./w,gather/en,(/w,pooled/en,,/w, ,ix/en,)/w, ,#, ,re/en,-/w,add/en, ,the/en, ,batch/en, ,dimension/en, ,#, ,[/w,batch/en,,/w, ,num/en,_,boxes/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w,,/w, ,[/w,batch/en,*/w,num/en,_,boxes/en,,/w, ,pool/en,_,height/en,,/w, ,pool/en,_,width/en,,/w, ,channels/en,]/w, ,shape/en, ,=/w, ,tf/en,./w,concat/en,(/w,[/w,tf/en,./w,shape/en,(/w,boxes/en,)/w,[/w,:/w,2/m,]/w,,/w, ,tf/en,./w,shape/en,(/w,pooled/en,)/w,[/w,1/m,:/w,]/w,]/w,,/w, ,axis/en,=/w,0/m,)/w, ,pooled/en, ,=/w, ,tf/en,./w,reshape/en,(/w,pooled/en,,/w, ,shape/en,)/w, ,return/en, ,pooled/en, ,#, ,[/w,batch/en,,/w, ,num/en,_,boxes/en,,/w, ,pool/en,_,height/en,,/w, ,pool/en,_,width/en,,/w, ,channels/en,]/w,初步/d,分类/vn,//w,回归/v,经过/p,roi/en,之后/f,，/w,我们/r,获取/v,了/u,众多/m,shape/en,一致/a,的/u,小/a,feat/en,，/w,为了/p,获取/v,他们/r,的/u,分类/vn,回归/v,信息/n,，/w,我们/r,构建/v,一系列/mq,并行/v,的/u,网络/n,进行/v,处理/v,，/w,#, ,two/en, ,1024/m, ,fc/en, ,layers/en, ,(/w,implemented/en, ,with/en, ,conv/en,2/m,d/en, ,for/en, ,consistency/en,)/w, ,#, ,timedistributed/en,拆分/v,了/u,输入/v,数据/n,的/u,第/m,1维/mq,（/w,从/p,0/m,开始/v,）/w,，/w,将/d,完全/ad,一样/u,的/u,模型/n,独立/v,的/u,应用/vn,于/p,拆/v,分/q,后/f,的/u,输入/v,数据/n,，/w,具体/a,到/v,下行/v,，/w, ,#, ,就是/d,将/d,num/en,_,rois/en,个/q,卷积/nw,应用/vn,到/v,num/en,_,rois/en,个/q,维度/n,为/p,[/w,batch/en,,/w, ,pool/en,_,size/en,,/w, ,pool/en,_,size/en,,/w, ,channels/en,]/w,的/u,输入/v,，/w,结果/n,合并/v, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,fc/en,_,layers/en,_,size/en,,/w, ,(/w,pool/en,_,size/en,,/w, ,pool/en,_,size/en,)/w,,/w, ,padding/en,=/w,"/w,valid/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,_,conv/en,1/m,"/w,)/w,(/w,x/en,)/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,1/m,,/w, ,1/m,,/w, ,1024/m,]/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,class/en,_,bn/en,1/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,fc/en,_,layers/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,_,conv/en,2/m,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,class/en,_,bn/en,2/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,shared/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,k/en,./w,squeeze/en,(/w,k/en,./w,squeeze/en,(/w,x/en,,/w, ,3/m,)/w,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,pool/en,_,squeeze/en,"/w,)/w,(/w,x/en,)/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,1024/m,]/w, ,#, ,classifier/en, ,head/en, ,mrcnn/en,_,class/en,_,logits/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,dense/en,(/w,num/en,_,classes/en,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,class/en,_,logits/en,'/w,)/w,(/w,shared/en,)/w, ,mrcnn/en,_,probs/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,activation/en,(/w,"/w,softmax/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,"/w,)/w,(/w,mrcnn/en,_,class/en,_,logits/en,)/w, ,#, ,bbox/en, ,head/en, ,#, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en, ,*/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,dense/en,(/w,num/en,_,classes/en, ,*/w, ,4/m,,/w, ,activation/en,=/w,'/w,linear/en,'/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,bbox/en,_,fc/en,'/w,)/w,(/w,shared/en,)/w, ,#, ,reshape/en, ,to/en, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,s/en, ,=/w, ,k/en,./w,int/en,_,shape/en,(/w,x/en,)/w, ,#, ,下行/v,源码/nw,：/w,k/en,./w,reshape/en,(/w,inputs/en,,/w, ,(/w,k/en,./w,shape/en,(/w,inputs/en,)/w,[/w,0/m,]/w,,/w,)/w, ,+/w, ,self/en,./w,target/en,_,shape/en,)/w, ,mrcnn/en,_,bbox/en, ,=/w, ,kl/en,./w,reshape/en,(/w,(/w,s/en,[/w,1/m,]/w,,/w, ,num/en,_,classes/en,,/w, ,4/m,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,bbox/en,"/w,)/w,(/w,x/en,)/w, ,return/en, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,probs/en,,/w, ,mrcnn/en,_,bbox/en,返回/v,如下/v,：/w,mrcnn/en,_,class/en,_,logits/en,:/w, , , , , , ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, , , , ,classifier/en, ,logits/en, ,(/w,before/en, ,softmax/en,)/w,mrcnn/en,_,class/en,:/w, , , , , , , , , , , , , , , , ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, , , , ,classifier/en, ,probabilitiesmrcnn/en,_,bbox/en,(/w,deltas/en,)/w,:/w, , , , ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w,kl/en,./w,timedistributed/en,实现/v,建立/v,一系列/mq,同样/d,架构/n,的/u,的/u,并行/v,网络结构/l,（/w,dim/en,0个/m,）/w,，/w,将/d,[/w,dim/en,0/m,,/w, ,dim/en,1/m,,/w, ,……/w,]/w,中/f,的/u,每个/r,[/w,dim/en,1/m,,/w, ,……/w,]/w,作为/v,输入/v,，/w,并行/v,的/u,计算/v,输出/v,。/w,附/v,、/w,build/en,函数/n,总览/nw,def/en, ,build/en,(/w,self/en,,/w, ,mode/en,,/w, ,config/en,)/w,:/w, ,"/w,"/w,"/w,build/en, ,mask/en, ,r/en,-/w,cnn/en, ,architecture/en,./w, ,input/en,_,shape/en,:/w, ,the/en, ,shape/en, ,of/en, ,the/en, ,input/en, ,image/en,./w, ,mode/en,:/w, ,either/en, ,"/w,training/en,"/w, ,or/en, ,"/w,inference/en,"/w,./w, ,the/en, ,inputs/en, ,and/en, ,outputs/en, ,of/en, ,the/en, ,model/en, ,differ/en, ,accordingly/en,./w, ,"/w,"/w,"/w, ,assert/en, ,mode/en, ,in/en, ,[/w,'/w,training/en,'/w,,/w, ,'/w,inference/en,'/w,]/w, ,#, ,image/en, ,size/en, ,must/en, ,be/en, ,dividable/en, ,by/en, ,2/m, ,multiple/en, ,times/en, ,h/en,,/w, ,w/en, ,=/w, ,config/en,./w,image/en,_,shape/en,[/w,:/w,2/m,]/w, ,#, ,[/w,1024/m, ,1024/m, ,3/m,]/w, ,if/en, ,h/en, ,//w, ,2/m,*/w,*/w,6/m, ,!/w,=/w, ,int/en,(/w,h/en, ,//w, ,2/m,*/w,*/w,6/m,)/w, ,or/en, ,w/en, ,//w, ,2/m,*/w,*/w,6/m, ,!/w,=/w, ,int/en,(/w,w/en, ,//w, ,2/m,*/w,*/w,6/m,)/w,:/w, ,#, ,这里/r,就/d,限定/v,了/u,下/f,采样/v,不/d,会/v,产生/v,坐标/n,误差/n, ,raise/en, ,exception/en,(/w,"/w,image/en, ,size/en, ,must/en, ,be/en, ,dividable/en, ,by/en, ,2/m, ,at/en, ,least/en, ,6/m, ,times/en, ,"/w, ,"/w,to/en, ,avoid/en, ,fractions/en, ,when/en, ,downscaling/en, ,and/en, ,upscaling/en,./w,"/w, ,"/w,for/en, ,example/en,,/w, ,use/en, ,256/m,,/w, ,320/m,,/w, ,384/m,,/w, ,448/m,,/w, ,512/m,,/w, ,./w,./w,./w, ,etc/en,./w, ,"/w,)/w, ,#, ,inputs/en, ,input/en,_,image/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,none/en,,/w, ,config/en,./w,image/en,_,shape/en,[/w,2/m,]/w,]/w,,/w, ,name/en,=/w,"/w,input/en,_,image/en,"/w,)/w, ,input/en,_,image/en,_,meta/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,config/en,./w,image/en,_,meta/en,_,size/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,image/en,_,meta/en,"/w,)/w, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,#, ,rpn/en, ,gt/en, ,input/en,_,rpn/en,_,match/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,1/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,rpn/en,_,match/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,input/en,_,rpn/en,_,bbox/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,rpn/en,_,bbox/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,detection/en, ,gt/en, ,(/w,class/en, ,ids/en,,/w, ,bounding/en, ,boxes/en,,/w, ,and/en, ,masks/en,)/w, ,#, ,1/m,./w, ,gt/en, ,class/en, ,ids/en, ,(/w,zero/en, ,padded/en,)/w, ,input/en,_,gt/en,_,class/en,_,ids/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,class/en,_,ids/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,#, ,2/m,./w, ,gt/en, ,boxes/en, ,in/en, ,pixels/en, ,(/w,zero/en, ,padded/en,)/w, ,#, ,[/w,batch/en,,/w, ,max/en,_,gt/en,_,instances/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,image/en, ,coordinates/en, ,input/en,_,gt/en,_,boxes/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,boxes/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,normalize/en, ,coordinates/en, ,gt/en,_,boxes/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,norm/en,_,boxes/en,_,graph/en,(/w, ,x/en,,/w, ,k/en,./w,shape/en,(/w,input/en,_,image/en,)/w,[/w,1/m,:/w,3/m,]/w,)/w,)/w,(/w,input/en,_,gt/en,_,boxes/en,)/w, ,#, ,3/m,./w, ,gt/en, ,masks/en, ,(/w,zero/en, ,padded/en,)/w, ,#, ,[/w,batch/en,,/w, ,height/en,,/w, ,width/en,,/w, ,max/en,_,gt/en,_,instances/en,]/w, ,if/en, ,config/en,./w,use/en,_,mini/en,_,mask/en,:/w, ,input/en,_,gt/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,0/m,]/w,,/w, ,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,else/en,:/w, ,input/en,_,gt/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,config/en,./w,image/en,_,shape/en,[/w,0/m,]/w,,/w, ,config/en,./w,image/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,elif/en, ,mode/en, ,=/w,=/w, ,"/w,inference/en,"/w,:/w, ,#, ,anchors/en, ,in/en, ,normalized/en, ,coordinates/en, ,input/en,_,anchors/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,anchors/en,"/w,)/w, ,#, ,build/en, ,the/en, ,shared/en, ,convolutional/en, ,layers/en,./w, ,#, ,bottom/en,-/w,up/en, ,layers/en, ,#, ,returns/en, ,a/en, ,list/en, ,of/en, ,the/en, ,last/en, ,layers/en, ,of/en, ,each/en, ,stage/en,,/w, ,5/m, ,in/en, ,total/en,./w, ,#, ,don/en,'/w,t/en, ,create/en, ,the/en, ,thead/en, ,(/w,stage/en, ,5/m,)/w,,/w, ,so/en, ,we/en, ,pick/en, ,the/en, ,4/m,th/en, ,item/en, ,in/en, ,the/en, ,list/en,./w, ,if/en, ,callable/en,(/w,config/en,./w,backbone/en,)/w,:/w, ,_,,/w, ,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m, ,=/w, ,config/en,./w,backbone/en,(/w,input/en,_,image/en,,/w, ,stage/en,5/m,=/w,true/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,else/en,:/w, ,_,,/w, ,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m, ,=/w, ,resnet/en,_,graph/en,(/w,input/en,_,image/en,,/w, ,config/en,./w,backbone/en,,/w, ,stage/en,5/m,=/w,true/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,#, ,top/en,-/w,down/en, ,layers/en, ,#, ,todo/en,:/w, ,add/en, ,assert/en, ,to/en, ,varify/en, ,feature/en, ,map/en, ,sizes/en, ,match/en, ,what/en,'/w,s/en, ,in/en, ,config/en, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,5/m,p/en,5/m,'/w,)/w,(/w,c/en,5/m,)/w, ,#, ,256/m, ,p/en,4/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,4/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,upsampled/en,"/w,)/w,(/w,p/en,5/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,4/m,p/en,4/m,'/w,)/w,(/w,c/en,4/m,)/w,]/w,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,3/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,upsampled/en,"/w,)/w,(/w,p/en,4/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,3/m,p/en,3/m,'/w,)/w,(/w,c/en,3/m,)/w,]/w,)/w, ,p/en,2/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,2/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,3/m,upsampled/en,"/w,)/w,(/w,p/en,3/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,2/m,p/en,2/m,'/w,)/w,(/w,c/en,2/m,)/w,]/w,)/w, ,#, ,attach/en, ,3/m,x/en,3/m, ,conv/en, ,to/en, ,all/en, ,p/en, ,layers/en, ,to/en, ,get/en, ,the/en, ,final/en, ,feature/en, ,maps/en,./w, ,p/en,2/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,2/m,"/w,)/w,(/w,p/en,2/m,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,3/m,"/w,)/w,(/w,p/en,3/m,)/w, ,p/en,4/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,"/w,)/w,(/w,p/en,4/m,)/w, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,p/en,6/m, ,is/en, ,used/en, ,for/en, ,the/en, ,5/m,th/en, ,anchor/en, ,scale/en, ,in/en, ,rpn/en,./w, ,generated/en, ,by/en, ,#, ,subsampling/en, ,from/en, ,p/en,5/m, ,with/en, ,stride/en, ,of/en, ,2/m,./w, ,p/en,6/m, ,=/w, ,kl/en,./w,maxpooling/en,2/m,d/en,(/w,pool/en,_,size/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,strides/en,=/w,2/m,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,6/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,note/en, ,that/en, ,p/en,6/m, ,is/en, ,used/en, ,in/en, ,rpn/en,,/w, ,but/en, ,not/en, ,in/en, ,the/en, ,classifier/en, ,heads/en,./w, ,rpn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,,/w, ,p/en,6/m,]/w, ,mrcnn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,]/w, ,#, ,anchors/en, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,anchors/en, ,=/w, ,self/en,./w,get/en,_,anchors/en,(/w,config/en,./w,image/en,_,shape/en,)/w, ,#, ,duplicate/en, ,across/en, ,the/en, ,batch/en, ,dimension/en, ,because/en, ,keras/en, ,requires/en, ,it/en, ,#, ,todo/en,:/w, ,can/en, ,this/en, ,be/en, ,optimized/en, ,to/en, ,avoid/en, ,duplicating/en, ,the/en, ,anchors/en,?/w, ,anchors/en, ,=/w, ,np/en,./w,broadcast/en,_,to/en,(/w,anchors/en,,/w, ,(/w,config/en,./w,batch/en,_,size/en,,/w,)/w, ,+/w, ,anchors/en,./w,shape/en,)/w, ,#, ,a/en, ,hack/en, ,to/en, ,get/en, ,around/en, ,keras/en,'/w,s/en, ,bad/en, ,support/en, ,for/en, ,constants/en, ,anchors/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,tf/en,./w,variable/en,(/w,anchors/en,)/w,,/w, ,name/en,=/w,"/w,anchors/en,"/w,)/w,(/w,input/en,_,image/en,)/w, ,else/en,:/w, ,anchors/en, ,=/w, ,input/en,_,anchors/en, ,#, ,rpn/en, ,model/en,,/w, ,返回/v,的/u,是/v,keras/en,的/u,module/en,对象/n,,/w, ,注意/v,keras/en,中/f,的/u,module/en,对象/n,是/v,可/v,call/en,的/u, ,rpn/en, ,=/w, ,build/en,_,rpn/en,_,model/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,stride/en,,/w, ,#, ,1/m, ,3/m, ,256/m, ,len/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,ratios/en,)/w,,/w, ,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,)/w, ,#, ,loop/en, ,through/en, ,pyramid/en, ,layers/en, ,layer/en,_,outputs/en, ,=/w, ,[/w,]/w, ,#, ,list/en, ,of/en, ,lists/en, ,for/en, ,p/en, ,in/en, ,rpn/en,_,feature/en,_,maps/en,:/w, ,layer/en,_,outputs/en,./w,append/en,(/w,rpn/en,(/w,[/w,p/en,]/w,)/w,)/w, ,#, ,保存/v,各/r,pyramid/en,特征/n,经过/p,rpn/en,之后/f,的/u,结果/n, ,#, ,concatenate/en, ,layer/en, ,outputs/en, ,#, ,convert/en, ,from/en, ,list/en, ,of/en, ,lists/en, ,of/en, ,level/en, ,outputs/en, ,to/en, ,list/en, ,of/en, ,lists/en, ,#, ,of/en, ,outputs/en, ,across/en, ,levels/en,./w, ,#, ,e/en,./w,g/en,./w, ,[/w,[/w,a/en,1/m,,/w, ,b/en,1/m,,/w, ,c/en,1/m,]/w,,/w, ,[/w,a/en,2/m,,/w, ,b/en,2/m,,/w, ,c/en,2/m,]/w,]/w, ,=/w,>, ,[/w,[/w,a/en,1/m,,/w, ,a/en,2/m,]/w,,/w, ,[/w,b/en,1/m,,/w, ,b/en,2/m,]/w,,/w, ,[/w,c/en,1/m,,/w, ,c/en,2/m,]/w,]/w, ,output/en,_,names/en, ,=/w, ,[/w,"/w,rpn/en,_,class/en,_,logits/en,"/w,,/w, ,"/w,rpn/en,_,class/en,"/w,,/w, ,"/w,rpn/en,_,bbox/en,"/w,]/w, ,outputs/en, ,=/w, ,list/en,(/w,zip/en,(/w,*/w,layer/en,_,outputs/en,)/w,)/w, ,#, ,[/w,[/w,logits/en,2/m,,/w,……/w,6/m,]/w,,/w, ,[/w,class/en,2/m,,/w,……/w,6/m,]/w,,/w, ,[/w,bbox/en,2/m,,/w,……/w,6/m,]/w,]/w, ,outputs/en, ,=/w, ,[/w,kl/en,./w,concatenate/en,(/w,axis/en,=/w,1/m,,/w, ,name/en,=/w,n/en,)/w,(/w,list/en,(/w,o/en,)/w,)/w, ,for/en, ,o/en,,/w, ,n/en, ,in/en, ,zip/en,(/w,outputs/en,,/w, ,output/en,_,names/en,)/w,]/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,anchors/en,,/w, ,2/m,//w,4/m,]/w, ,#, ,其中/r,num/en,_,anchors/en,指/v,的/u,是/v,全部/m,特征/n,层/q,上/f,的/u,anchors/en,总数/n, ,rpn/en,_,class/en,_,logits/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en, ,=/w, ,outputs/en, ,#, ,generate/en, ,proposals/en, ,#, ,proposals/en, ,are/en, ,[/w,batch/en,,/w, ,n/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,normalized/en, ,coordinates/en, ,#, ,and/en, ,zero/en, ,padded/en,./w, ,#, ,post/en,_,nms/en,_,rois/en,_,inference/en, ,=/w, ,1000/m, ,#, ,post/en,_,nms/en,_,rois/en,_,training/en, ,=/w, ,2000/m, ,proposal/en,_,count/en, ,=/w, ,config/en,./w,post/en,_,nms/en,_,rois/en,_,training/en, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,\/w, ,else/en, ,config/en,./w,post/en,_,nms/en,_,rois/en,_,inference/en, ,#, ,[/w,images/en,_,per/en,_,gpu/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,#, ,images/en,_,per/en,_,gpu/en,取代/v,了/u,batch/en,，/w,之后/f,说/v,的/u,batch/en,都/d,是/v,images/en,_,per/en,_,gpu/en, ,rpn/en,_,rois/en, ,=/w, ,proposallayer/en,(/w, ,proposal/en,_,count/en,=/w,proposal/en,_,count/en,,/w, ,nms/en,_,threshold/en,=/w,config/en,./w,rpn/en,_,nms/en,_,threshold/en,,/w, ,#, ,0.7/m, ,name/en,=/w,"/w,roi/en,"/w,,/w, ,config/en,=/w,config/en,)/w,(/w,[/w,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,,/w, ,anchors/en,]/w,)/w, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,#, ,class/en, ,id/en, ,mask/en, ,to/en, ,mark/en, ,class/en, ,ids/en, ,supported/en, ,by/en, ,the/en, ,dataset/en, ,the/en, ,image/en, ,#, ,came/en, ,from/en,./w, ,active/en,_,class/en,_,ids/en, ,=/w, ,kl/en,./w,lambda/en,(/w, ,lambda/en, ,x/en,:/w, ,parse/en,_,image/en,_,meta/en,_,graph/en,(/w,x/en,)/w,[/w,"/w,active/en,_,class/en,_,ids/en,"/w,]/w, ,)/w,(/w,input/en,_,image/en,_,meta/en,)/w, ,if/en, ,not/en, ,config/en,./w,use/en,_,rpn/en,_,rois/en,:/w, ,#, ,ignore/en, ,predicted/en, ,rois/en, ,and/en, ,use/en, ,rois/en, ,provided/en, ,as/en, ,an/en, ,input/en,./w, ,input/en,_,rois/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,config/en,./w,post/en,_,nms/en,_,rois/en,_,training/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,roi/en,"/w,,/w, ,dtype/en,=/w,np/en,./w,int/en,32/m,)/w, ,#, ,normalize/en, ,coordinates/en, ,target/en,_,rois/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,norm/en,_,boxes/en,_,graph/en,(/w, ,x/en,,/w, ,k/en,./w,shape/en,(/w,input/en,_,image/en,)/w,[/w,1/m,:/w,3/m,]/w,)/w,)/w,(/w,input/en,_,rois/en,)/w, ,else/en,:/w, ,target/en,_,rois/en, ,=/w, ,rpn/en,_,rois/en, ,#, ,generate/en, ,detection/en, ,targets/en, ,#, ,subsamples/en, ,proposals/en, ,and/en, ,generates/en, ,target/en, ,outputs/en, ,for/en, ,training/en, ,#, ,note/en, ,that/en, ,proposal/en, ,class/en, ,ids/en,,