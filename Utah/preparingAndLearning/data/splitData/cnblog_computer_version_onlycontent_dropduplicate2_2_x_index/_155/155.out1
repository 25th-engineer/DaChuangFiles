计算机 视觉 关于 OpenCV 中 GPU 配置 编译 的 相关 
事项 标签 空格 分隔 计算机 视觉 前一段 发现 了 OpenCV 
中 关于 GPU 以及 opencl 的 相关 知识 打算 升级 
一下 对 OpenCV 的 使用 但是 发现 从 OpenCV 官网 
上 下载 的 都是 没有 WITH _ CUDA 这一 选项 
的 于是 必须 进行 OpenCV 带 CUDA 的 重 编译 
下面 就 记录 这 一 阶段 出现 的 一系列 问题 
关于 OpenCV 版本 的 问题 起初 直接 尝试 使用 一直 
用 的 OpenCV2 . 4.9 的 源码 进行 编译 选择 
的 编译 环境 为 Visual Studio2010 x64 因为 前面 在 
使用 cuda 的 时候 就 已经 遇到 过 关于 CUDA 
的 库 对于 32位 程序 的 不 全面 支持 即 
CUDA 的 较高 版本 好像 有 一些 64位 的 库 
在 32位 中 是 没有 的 所以 直接 选择 了 
x64 的 平台 而 此时 我 使用 的 CUDA 版本 
为 8.0 总之 编译 OpenCV 中 出现 了 一系列 莫名其妙 
的 问题 在 网上 也 不好 查看 最后 尝试 了 
使用 OpenCV2 . 4.13 版本 听说 是 2016年 更新 的 
版本 所以 应该 能跟/nr CUDA8 . 0 匹配 首先 只是 
将 OpenCV2 . 4.13 的 源码 替换 了 OpenCV2 . 
4.9 的 源码 然后 再去 编译 的 debug 版本 爆出 
了 无法 排除 的 错误 而 release 版本 居然 生成 
成功 了 但是 我 使用 这些 库 的 时候 总是 
说 CUDA function API call 错误 之类 应该 是 还是 
没有 配置 成功 这 一 问题 让 我 都想 放弃 
了 OpenCV 中 关于 CUDA 的 使用 了 后来 一再 
坚持 然后 决定 使用 Visual Studio 2015 进行 编译 这里 
说明 一下 我 用 CMAKE 进行 编译 的 时候 可选 
的 本地 编译器 有 10 13 和 15 版本 的 
当时 想 使用 13 版本 的 win64 但是 好像 configure 
不过 于是 一直 使用 10 版本 即使 打开 的 时候 
用 的 是 13 版本 但是 还是 报错 后来 猛然间 
醒悟 极 有可能 是 编译器 版本 的 问题 于是 使用 
CUDA8 . 0 + OpenCV2 . 4.13 + Visual Studio 
2015 x64 配置 不管 是 Debug 版本 还是 Release 版本 
都 生成 成功 了 这 全部 是 最新 版本 的 
相互 之间 的 匹配 关于 CMAKE 的 配置 选项 一个是 
要 选择 WITH _ CUDA 然后 是 选择 capabilities 我 
的 笔记本 是 GTX860M 对应 的 为 5.0 我 查了/nr 
一下 后面 要 部署 的 显卡 GTX1060 为 6.1 我 
把 这两项 加了 进去 其实 还有 一个 GPU 架构 的 
选项 好像 不 选 的话 就是 对应 自动 但是 里面 
还 好像 只有 开普勒 和 费米 架构 我 配置 成功 
的 这次 没有 选择 另外 好 像用 10 版本 的 
配置 这个 能力 的 时候 居然 配置 不 成功 不 
知道 啥 原因 关于 我 电脑 上 OpenCV 版本控制 的 
说明 1 保留 D 盘根 目 录下 的 OpenCV2 . 
4.9 与 OpenCV2 . 4.13 这 两个 都是/nr 基于 微软 
的 MSVC 编译器 的 其中 OpenCV2 . 4.13 版本 中的 
x 64中 对应 的 vc14 路径 下为 带 CUDA GPU 
配置 的 动态链接库 2 在 F 盘根 目 录下 的 
opencv2 . 4.13 是 对应 x64 版本 的 CUDA GPU 
编译 工程 可以 保留 以后 又 需要 在 进行 修改 
3 在 F 盘根 目 录下 的 OpenCV2 . 4.9 
MinGW 为 对应 MinGW gcc 编译器 的 动态链接库 可以 在 
Qt gcc 下 编译 使用 在 编写 跨平台 的 工程 
时 可以 使用 Qt 的 这个 版本 保留 工程 文件 
下面 是 一些 引文 参考 近期 由于 课题 需要 使用 
GPU 进行 加速 通过 调研 决定 采用 OpenCV 的 GPU 
支持 通过 整整 一天 的 摸索 终于 配置 成功 1 
. 系统 环境 windows 7 ultimate 版 64位 + visual 
studio 2010 ultimate 版 + OpenCV 2 . 4.9 + 
CUDA ToolKit 6.5 + CMake2 . 8.8 2 . 配置 
过程 大致 流程 CUDA Toolkit 6.5 的 下载 与 安装 
CMake 的 下载 与 安装 OpenCV 的 下载 与 编译 
测试 是否 安装 成功 2.1 CUDA ToolKit 6.5 的 下载 
与 安装 由于 之前 测试 直接 使用 OpenCV 的 预 
编译 的 版本 无法 使用 其 GPU 模块 因此 需要 
安装 CUDA Toolkit 之后 使用 自己 的 基于 CUDA 编译 
的 OpenCV 库 由于 自己 配置 时 CUDA ToolKit 版本 
是 7.0 于是 尝试 了 一下 结果 不 成功 原因 
估计 是 Opencv2 . 4.9 的 gpu 模块 对 最新 
的 CUDA 支持 不够 完善 因此 在 选择 CUDA 版本 
时 一定 要 考虑 OpenCV 对其 的 兼容性 自己 的 
一个 经验 是 到 http / / code . opencv 
. org / projects / opencv / wiki / ChangeLog 
看 一下 自己 的 OpenCV 版本 发布 的 时间 再到 
CUDA 下载 的 页面 找 一个 发布 时间 与 OpenCV 
发布 时间 相近 的 版本 选择 合适 的 版本 很 
重要 自己 花费 的 主要 时间 就 浪费 在 版本 
不兼容 上 ~ ~ ~ 自己 使用 的 是 CUDA 
ToolKit 6.5 根据 自己 的 系统 计算 需求 下载 对应 
的 版本 一路 安装 就 可以 了 这个 问题 应该 
都 不大 主要 是 确定 OpenCV 与 CUDA 的 兼容性 
2.2 CMake 工具 的 下载 与 安装 到 http / 
/ www . cmake . org / files / 下载 
任何 自己 需要 的 版本 虽然 我 的 win7 系统 
是 64位 的 但是 只有 32位 的 CMAKE 供 下载 
cmake 2 . 8.8 win32 x86 . exe 这个 对 
后面 的 编译 木 有影响 我 使用 的 是 2 
. 8.8 下载 完成 安装 就 OK ~ ~ 2.3 
OpenCV 的 下载 与 编译 到 OpenCV 的 主页 上 
找到 对应 的 版本 2 . 4.9 下载 Opencv for 
windows 安装 到 自己 的 目录 比如 D \ OpenCV 
然后 使用 CMake 工具 编译 基于 CUDA 和 TBB 的 
OpenCV 库 这个 过程 可以 参看 http / / www 
. cnblogs . com / freedomshe / archive / 2013 
/ 01/11 / win7 _ vs2012 _ opencv _ rebuild 
. html 这篇文章 写得 很详细 而且 图文并茂 很 好懂 虽然 
这 篇 文章 的 OPENCV 及 vs 版本 不同 但是 
VS2010 按照 他 的 过程 来 编译 也是 可以 顺利 
通过 的 需要 的 注意 的 是 1 在 配置 
CMake 的 时候 选择 VS10 WIN64 根据 自己 的 操作 
系统 和 VS 版本 选择 勾选/nr WITH _ TBB WITH 
_ CUDA 2 把/p debug/w 和/c release/w 两个/m 版本/n 都/d 
编译/v 上/f 编译 的 时间 比较 长 视 电脑 性能 
自己 编译 花了 耐心 等待 ~ ~ ~ 3 在 
编译 过程 中 可能 会 弹出 对话框 是否 要 reload 
the solution when a CMakeLists . tx has changed 这个 
可能 是 个 bug 是 CMake 的 宏 造成 的 
所以 可以 再 编译 前 检查 一下 是否 有 这样 
额 的 宏 VS2010 中 Tools 工具 Macros 宏 Macro 
explorer 宏 查看器 CMakeVSMacros2 也 可能 是 其他 的 目录 
找到 Public Sub ReloadProjects Optional ByVal projects As String = 
与 Public Sub StopBuild Optional ByVal projects As String = 
这 两个 函数 它们 应该 是 VB 写 的 把 
函数 体 注释 掉 就 可以 了 2.4 测试 是否 
安装 成功 安装 完成 后 新建 一个 WIN32 项目 注意 
配置 一 下 使用 x64 选项 进行 编译 如果 安装 
成功 int devNum = cv gpu g e t C 
u d a E n a b l e d 
D e v i c e C o u n 
t 将 返回 非 0 值 否则 说明 配置 为 
成功 # include stdafx . h # include # include 
opencv2 / opencv . hpp # include opencv2 / gpu 
/ gpu . hpp int _ tmain int argc _ 
TCHAR * argv { int devNum = cv gpu g 
e t C u d a E n a b 
l e d D e v i c e C 
o u n t try { cv Mat src _ 
host = cv imread lena . jpg CV _ LOAD 
_ IMAGE _ GRAYSCALE cv gpu GpuMat dst src src 
. upload src _ host cv gpu threshold src dst 
128.0 255.0 CV _ THRESH _ BINARY cv Mat result 
_ host dst . download result _ host cv namedWindow 
Result 1 cv imshow Result result _ host cv waitKey 
} catch const cv Exception & ex { std cout 
Error ex . what std endl } return 0 } 
参考文献 1 http / / www . cnblogs . com 
/ freedomshe / archive / 2013 / 01/11 / win7 
_ vs2012 _ opencv _ rebuild . html 2 http 
/ / blog . csdn . net / kelvin _ 
yan / article / details / 38866795 按语 首先 感谢 
http / / blog . csdn . net / fengbingchun 
/ article / details / 9831837 这个 博主 的 原创 
方法 在 这个 基础 上 编译 之后 发现 了 很多 
问题 所以 进行 了 改正 有了 以下 方法 重新 编译 
OpenCV 1 查看 本机 配置 查看 显卡 类型 是否 支持 
NVIDIA GPU 本机 显卡 为 NVIDIA GeForce GT630 2 从 
http / / www . nvidia . cn / Download 
/ index . aspx lang = cn 下载 最新 驱动 
并 安装 3 从 https / / developer . nvidia 
. com / cuda toolkit 根据 本机 类型 下载 相应 
最新版 的 CUDA Toolkit6 . 0 64位 安装 并 通过 
样本 程序验证 其 安装 正确 4 将 C \ ProgramFiles 
\ NVIDIAGPU Computing Toolkit \ CUDA \ v 6.0 \ 
bin 添加到 环境变量 中 检查 是否 已经 默认 添加 5 
从 http / / t h r e a d 
i n g b u i l d i n 
g b l o c k s . org / 
下载 最新版 的 TBB4 . 2 解压缩 并 将其 bin 
目录 D \ soft \ OpenCV2 . 4.8 \ TBB 
\ tbb41 _ 20140122oss \ bin \ ia64 \ vc10 
添加到 环境变量 中 注销 或 重启 6 从 http / 
/ opencv . org / downloads . html 下载 最新 
版本 的 OpenCV2 . 4.6 并解 压缩 到 D \ 
soft \ OpenCV2 . 4.8 文件夹 中 7 从 http 
/ / www . cmake . org / cmake / 
resources / software . html 下载 最新 版本 的 CMake2 
. 8 . 11.2 并 安装 8 打开 CMake 在 
Where isthesource code 中 选择 D \ soft \ OpenCV2 
. 4.6 \ opencv 文件夹 在 Where to buildthe binaries 
中 选择 D / soft / OpenCV2 . 4.6 / 
vs2010 _ GPU 文件夹 此 文件夹 为 手动 创建 9 
点击 Configure 按钮 在 弹出 的 对话框 中 选择 VisualStudio 
10 然后 点击 Finish 10 如果 有 红色 框 出现 
勾选/nr BUILD _ EXAMPLES WITH _ TBB WITH _ CUBLAS 
WITH _ CUDA WITH _ CUFFT 然后 再次 点击 Configure 
按钮 11 如果 还有 红色 框 出现 TBB _ INCLUDE 
_ DIRS 将其 值 改为 D \ soft \ OpenCV2 
. 4.6 \ TBB \ tbb41 _ 20130613oss \ include 
为 TBB 中 include 所在 的 目录 然后 再次 点击 
Configure 按钮 12 如何 还有 红色 框 出现 TBB _ 
LIB _ DIR TBB _ STDDEF _ PATH 再次 点击 
Configure 按钮 13 如果 在 下方 信息 框 中有 Use 
TBB YES ver 4.1 interface 6105 Use Cuda YES ver5 
. 0 证明 我们 已经 将 inteltbb 和 CUDA 正确 
配置 14 点击 Generate 按钮 此时 会在 D \ soft 
\ OpenCV2 . 4.6 \ vs2010 _ GPU 文件 夹下 
生成 OpenCV . sln 文件 15 以 管理员 身份 使用 
vs2010 打开 OpenCV . sln 文件 选择 View Properties Manager 
分别 选中 ALL _ BUILD 中的 Debug 和 Release 上 
的 Microsoft . Cpp . Win64 . user 依次 添加 
inteltbb 和 CUDA 的 Executable Directories I n c l 
u d e D i r e c t o 
r i e s 和 Library Directories 点击 右键 Properties 
需要 说明 的 是 opencv 里面 要 选择 build 文件夹 
下面 的 路径 才对 VC + + Directories I n 
c l u d e D i r e c 
t o r i e s D \ soft \ 
OpenCV2 . 4.6 \ TBB \ tbb41 _ 20130613oss \ 
include C \ Program Files \ NVIDIAGPU ComputingToolkit \ CUDA 
\ v 5.0 \ include D \ opencv \ build 
\ include D \ opencv \ build \ include \ 
opencv D \ opencv \ build \ include \ opencv2 
Library Directories D \ soft \ OpenCV2 . 4.6 \ 
TBB \ tbb41 _ 20130613oss \ lib \ ia64 \ 
vc10 C \ Program Files \ NVIDIA GPU Computing Toolkit 
\ CUDA \ v 5.0 \ lib \ Win64 D 
\ opencv \ build \ x64 \ vc10 \ lib 
Executable Directories D \ soft \ OpenCV2 . 4.6 \ 
TBB \ tbb41 _ 20130613oss \ bin \ ia64 \ 
vc10 C \ Program Files \ NVIDIA GPU ComputingToolkit \ 
CUDA \ v 5.0 \ bin D \ opencv \ 
build \ x64 \ vc10 \ bin 16 选中 modules 
中的 opencv _ gpu 点击 右键 选择 Properties Linker Input 
I g n o r e p e c i 
f i c D e f a u l t 
Libraries 加入 libcmtlibcmtd 可 忽视 这条 17 分别 在 Debug 
和 Release 下 选择 SolutionExplorer 里 的 Solution OpenCV 点击 
右键 运行 Rebuild Solution 这个 过程 比较 漫长 win7 64位 
4GB 内存 大概 需要 3 小时 18 点击 CMakeTargets 下 
的 INSTALL 右键 仅 本 工程 build 之后 会在 D 
\ soft \ OpenCV2 . 4.3 \ vs2010 \ install 
文件 夹下 的 bin 文件夹 中 存放 相应 的 动态库 
在 lib 文件夹 下 存放 相应 的 静态 库 补充 
说明 1 安装 CUDA Toolkit 时 最好 不要 修改 其 
默认 的 安装 目录 2 第 17步 的 重建 过程 
中 如果 出现 了 很 异常 诡异 的 行为 有 
一种 调试 方式 是 删除 原先 配置 的 文件夹 重新 
cmake 清空 VS2010 里面 的 工程 重新 编译 可能 会 
改善 3 为了 缩短 编译 时间 可以 通过 CMake 中 
改变 CUDA _ ARCH _ BIN CUDA _ ARCH _ 
PTX 值 进行 设置 将 BUILD _ EXAMPLES 的 勾选/nr 
去掉 没有 这么 做 因为 是 为了 全部 编译 4 
在 编译 前 最好 把 360 安全卫士 和 杀毒软件 关闭 
5 也可 不用 管理员 身份 打开 OpenCV . sln 第 
15步 的 属性 配置 在 不同 的 电脑 上 有的 
必须 的 有的 可以 不 需要 最好 都 加上 免得 
返工 6 也 可以 不用 修改 opencv _ gpu 模块 
的 属性 配置 默认 即可 即 第 16步 也 不是 
必须 的 7 编译 过程 中 会 弹出 数次 对话框 
如 出现 宏 对话框 则 点击 Cancel 选项 其它 则 
选择 Yes 选项 8 编译 成功 后的库/nr 也 可以 直接 
应用于 OpenCV 中的 OpenCL 模块 Debug 过程 编译 错误 解决 
1 无法 加载 宏 C / Users / XXX / 
Documents / Visual Studio 2010Projects / VSMacros80 / Samples / 
Samples . vsmacros 解决 方法 把 这个 附件 放在 上述 
目录 里面 附件 2 错误 CMakeFiles / example _ gpu 
_ driver _ api _ multi . dir / driver 
_ api _ multi . cpp . o Infunction ` 
destroyContexts driver _ api _ multi . cpp . text 
. _ Z 1 5 d e s t r 
o y C o n t e x t s 
v + 0xc undefined referenceto ` cuCtxDestroy _ v2 driver 
_ api _ multi . cpp . text . _ 
Z 1 5 d e s t r o y 
C o n t e x t s v + 
0x1c u n d e f i n e d 
r e f e r e n c e to 
` cuCtxDestroy _ v2 CMakeFiles / example _ gpu _ 
driver _ api _ multi . dir / driver _ 
api _ multi . cpp . o Infunction ` Worker 
operator int const driver _ api _ multi . cpp 
. text . _ ZNK6WorkerclEi + 0x19 undefined reference to 
` cuCtxPushCurrent _ v2 driver _ api _ multi . 
cpp . text . _ ZNK6WorkerclEi + 0x6bf undefined reference 
to ` cuCtxPopCurrent _ v2 解决 方法 Only two example 
will affect by this bug example _ gpu _ driver 
_ api _ multi and example _ gpu _ driver 
_ api _ stereo _ multi Modify line 39 target 
_ link _ libraries $ { the _ target } 
$ { OPENCV _ LINKER _ LIBS } $ { 
OPENCV _ GPU _ SAMPLES _ REQUIRED _ DEPS } 
to target _ link _ libraries $ { the _ 
target } $ { OPENCV _ LINKER _ LIBS } 
$ { OPENCV _ GPU _ SAMPLES _ REQUIRED _ 
DEPS } cuda in opencv 2.4 . 6.1 / samples 
/ gpu / CMakeLists . txt can easily fixthis problem 
3 错误 dllmain 重复 定义 opencv _ world246 . dll 
不存在 等 错误 解决 方法 cmake 的 时候 不要 勾选/nr 
build _ world 选项 这个 重建 也 不是 必须 的 
4 错误 37374error LNK1104 无法 打开 文件 . . \ 
. . \ lib \ Debug \ opencv _ superres248d 
. lib D \ opencv \ opencv248GPU \ modules \ 
superres \ LINKopencv _ test _ superres 分析 是 链接库 
链接 不上 造成 的 添上 这些 库 就 可以 了 
解决办法 第 15步 中 务必 把 opencv 的 include \ 
bin \ lib 目标 都 加进去 而且是 build 目 录下 
的 如果 还有 问题 那么 重新 cmake 或者 清除 VS2010 
的 缓存 就 可以 了 5 错误 Unable to cast 
COM object of type System . _ _ ComObject to 
interface type EnvDTE . DTE . 解决办法 可能 是 这个 
或者 可以 放在 这里 不 解决 继续 编译 可以 没有 
问题 http / / blogs . msdn . com / 
b / smondal / archive / 2012 / 10/02 / 
unable to cast com object of type system comobject to 
interface type microsoft visualstudio ole interop iserviceprovider . aspx The 
exception seems to indicate the crashwas caused due to an 
interface not being found . This indicates thatsomething s wrong 
with proxy / stubs on the machine . At l 
e a s t I e r v i c 
e P r o v i d e r is 
failing . IE is usually the owner of the I 
e r v i c e P r o v 
i d e r p r o x y . 
From the dump it showed devenv . exe process crashed 
shortly afterloading C \ Windows \ SysWOW64 \ actxprxy . 
dll andC \ Windows \ System32 \ mssprxy . dll 
The issue turned out to be b r o k 
e n r e g i s t r a 
t i o n for IServiceProvider . The proxy stub 
CLSID was wrong it wasreferring to actxprxy . dll instead 
of ieproxy . dll on Windows 7 x64 . R 
e g i s t e r i n g 
i e p r o x y . dll from 
an elevated cmd prompt resolved the issue . regsvr32 C 
\ Program Files x86 \ Internet Explorer \ ieproxy . 
dll On x86 systems regsvr32 C \ Program Files \ 
Internet Explorer \ ieproxy . dll 新 编译 的 opencv 
使用 方法 1 打开 vs2010 新建 一个 控制台 应用程序 为 
vs2010 配置 OpenCV 环境 选择 View Properties Manager 分别 选中 
Debug 和 Release 上 的 Microsoft . Cpp . Win64 
. user 点击 右键 Properties VC + + Directories Include 
Directories D \ Soft \ OpenCV2 . 4.6 \ vs2010 
_ GPU \ install \ include D \ Soft \ 
OpenCV2 . 4.6 \ vs2010 _ GPU \ install \ 
include \ opencv D \ Soft \ OpenCV2 . 4.6 
\ vs2010 _ GPU \ install \ include \ opencv2 
Library Directories D \ Soft \ OpenCV2 . 4.6 \ 
vs2010 _ GPU \ install \ lib 2 选中 工程 
Properties Configuration Properties Linker Input A d d i t 
i o n a l D e p e n 
d e n c i e s Debug 和 Release 
添加 相应 的 . lib 库 3 将 D \ 
soft \ OpenCV2 . 4.6 \ vs2010 _ GPU \ 
install \ bin 加入到 windows 系统 环境变量 Path 中 重启 
也 可以 将 install 文件夹 全部 拷贝 出来 作为 一个 
新的 opencv 版本 存在 里面 应该 包括 include \ bin 
\ lib 这个 几个 主要 目录 4 示例 如下 如果 
iDevicesNum 结果 非 0 说明 安装 配置 正确 1 . 
# include stdafx . h 2 . # include opencv2 
/ opencv . hpp 3 . # include opencv2 / 
gpu / gpu . hpp 4 . 5 . using 
namespace cv 6 . using namespace cv gpu 7 . 
8 . int _ tmain int argc _ TCHAR * 
argv 9 . { 10 . int iDevicesNum = g 
e t C u d a E n a b 
l e d D e v i c e C 
o u n t 11 . 12 . cout iDevicesNum 
endl 13 . 14 . return 0 15 . } 
参考文献 1 http / / opencv . willowgarage . com 
/ wiki / OpenCV _ GPU 2 http / / 
docs . opencv . org / modules / gpu / 
doc / introduction . html 3 http / / wenku 
. baidu . com / view / 8 1 e 
2 9 c 6 f 0 1 1 c a 
3 0 0 a 6 c 3 9 0 d 
d . html 4 http / / blog . cuvilib 
. com / 2011 / 03/22 / how to build 
opencv 2 2 with gpu cuda on windows 7 / 
5 http / / docs . nvidia . com / 
cuda / cuda getting started guide for microsoft windows / 
index . html 计算机 视觉 关于 OpenCV 中 GPU 配置 编译 的 相关 
事项 标签 空格 分隔 计算机 视觉 前一段 发现 了 OpenCV 
中 关于 GPU 以及 opencl 的 相关 知识 打算 升级 
一下 对 OpenCV 的 使用 但是 发现 从 OpenCV 官网 
上 下载 的 都是 没有 WITH _ CUDA 这一 选项 
的 于是 必须 进行 OpenCV 带 CUDA 的 重 编译 
下面 就 记录 这 一 阶段 出现 的 一系列 问题 
关于 OpenCV 版本 的 问题 起初 直接 尝试 使用 一直 
用 的 OpenCV2 . 4.9 的 源码 进行 编译 选择 
的 编译 环境 为 Visual Studio2010 x64 因为 前面 在 
使用 cuda 的 时候 就 已经 遇到 过 关于 CUDA 
的 库 对于 32位 程序 的 不 全面 支持 即 
CUDA 的 较高 版本 好像 有 一些 64位 的 库 
在 32位 中 是 没有 的 所以 直接 选择 了 
x64 的 平台 而 此时 我 使用 的 CUDA 版本 
为 8.0 总之 编译 OpenCV 中 出现 了 一系列 莫名其妙 
的 问题 在 网上 也 不好 查看 最后 尝试 了 
使用 OpenCV2 . 4.13 版本 听说 是 2016年 更新 的 
版本 所以 应该 能跟/nr CUDA8 . 0 匹配 首先 只是 
将 OpenCV2 . 4.13 的 源码 替换 了 OpenCV2 . 
4.9 的 源码 然后 再去 编译 的 debug 版本 爆出 
了 无法 排除 的 错误 而 release 版本 居然 生成 
成功 了 但是 我 使用 这些 库 的 时候 总是 
说 CUDA function API call 错误 之类 应该 是 还是 
没有 配置 成功 这 一 问题 让 我 都想 放弃 
了 OpenCV 中 关于 CUDA 的 使用 了 后来 一再 
坚持 然后 决定 使用 Visual Studio 2015 进行 编译 这里 
说明 一下 我 用 CMAKE 进行 编译 的 时候 可选 
的 本地 编译器 有 10 13 和 15 版本 的 
当时 想 使用 13 版本 的 win64 但是 好像 configure 
不过 于是 一直 使用 10 版本 即使 打开 的 时候 
用 的 是 13 版本 但是 还是 报错 后来 猛然间 
醒悟 极 有可能 是 编译器 版本 的 问题 于是 使用 
CUDA8 . 0 + OpenCV2 . 4.13 + Visual Studio 
2015 x64 配置 不管 是 Debug 版本 还是 Release 版本 
都 生成 成功 了 这 全部 是 最新 版本 的 
相互 之间 的 匹配 关于 CMAKE 的 配置 选项 一个是 
要 选择 WITH _ CUDA 然后 是 选择 capabilities 我 
的 笔记本 是 GTX860M 对应 的 为 5.0 我 查了/nr 
一下 后面 要 部署 的 显卡 GTX1060 为 6.1 我 
把 这两项 加了 进去 其实 还有 一个 GPU 架构 的 
选项 好像 不 选 的话 就是 对应 自动 但是 里面 
还 好像 只有 开普勒 和 费米 架构 我 配置 成功 
的 这次 没有 选择 另外 好 像用 10 版本 的 
配置 这个 能力 的 时候 居然 配置 不 成功 不 
知道 啥 原因 关于 我 电脑 上 OpenCV 版本控制 的 
说明 1 保留 D 盘根 目 录下 的 OpenCV2 . 
4.9 与 OpenCV2 . 4.13 这 两个 都是/nr 基于 微软 
的 MSVC 编译器 的 其中 OpenCV2 . 4.13 版本 中的 
x 64中 对应 的 vc14 路径 下为 带 CUDA GPU 
配置 的 动态链接库 2 在 F 盘根 目 录下 的 
opencv2 . 4.13 是 对应 x64 版本 的 CUDA GPU 
编译 工程 可以 保留 以后 又 需要 在 进行 修改 
3 在 F 盘根 目 录下 的 OpenCV2 . 4.9 
MinGW 为 对应 MinGW gcc 编译器 的 动态链接库 可以 在 
Qt gcc 下 编译 使用 在 编写 跨平台 的 工程 
时 可以 使用 Qt 的 这个 版本 保留 工程 文件 
下面 是 一些 引文 参考 近期 由于 课题 需要 使用 
GPU 进行 加速 通过 调研 决定 采用 OpenCV 的 GPU 
支持 通过 整整 一天 的 摸索 终于 配置 成功 1 
. 系统 环境 windows 7 ultimate 版 64位 + visual 
studio 2010 ultimate 版 + OpenCV 2 . 4.9 + 
CUDA ToolKit 6.5 + CMake2 . 8.8 2 . 配置 
过程 大致 流程 CUDA Toolkit 6.5 的 下载 与 安装 
CMake 的 下载 与 安装 OpenCV 的 下载 与 编译 
测试 是否 安装 成功 2.1 CUDA ToolKit 6.5 的 下载 
与 安装 由于 之前 测试 直接 使用 OpenCV 的 预 
编译 的 版本 无法 使用 其 GPU 模块 因此 需要 
安装 CUDA Toolkit 之后 使用 自己 的 基于 CUDA 编译 
的 OpenCV 库 由于 自己 配置 时 CUDA ToolKit 版本 
是 7.0 于是 尝试 了 一下 结果 不 成功 原因 
估计 是 Opencv2 . 4.9 的 gpu 模块 对 最新 
的 CUDA 支持 不够 完善 因此 在 选择 CUDA 版本 
时 一定 要 考虑 OpenCV 对其 的 兼容性 自己 的 
一个 经验 是 到 http / / code . opencv 
. org / projects / opencv / wiki / ChangeLog 
看 一下 自己 的 OpenCV 版本 发布 的 时间 再到 
CUDA 下载 的 页面 找 一个 发布 时间 与 OpenCV 
发布 时间 相近 的 版本 选择 合适 的 版本 很 
重要 自己 花费 的 主要 时间 就 浪费 在 版本 
不兼容 上 ~ ~ ~ 自己 使用 的 是 CUDA 
ToolKit 6.5 根据 自己 的 系统 计算 需求 下载 对应 
的 版本 一路 安装 就 可以 了 这个 问题 应该 
都 不大 主要 是 确定 OpenCV 与 CUDA 的 兼容性 
2.2 CMake 工具 的 下载 与 安装 到 http / 
/ www . cmake . org / files / 下载 
任何 自己 需要 的 版本 虽然 我 的 win7 系统 
是 64位 的 但是 只有 32位 的 CMAKE 供 下载 
cmake 2 . 8.8 win32 x86 . exe 这个 对 
后面 的 编译 木 有影响 我 使用 的 是 2 
. 8.8 下载 完成 安装 就 OK ~ ~ 2.3 
OpenCV 的 下载 与 编译 到 OpenCV 的 主页 上 
找到 对应 的 版本 2 . 4.9 下载 Opencv for 
windows 安装 到 自己 的 目录 比如 D \ OpenCV 
然后 使用 CMake 工具 编译 基于 CUDA 和 TBB 的 
OpenCV 库 这个 过程 可以 参看 http / / www 
. cnblogs . com / freedomshe / archive / 2013 
/ 01/11 / win7 _ vs2012 _ opencv _ rebuild 
. html 这篇文章 写得 很详细 而且 图文并茂 很 好懂 虽然 
这 篇 文章 的 OPENCV 及 vs 版本 不同 但是 
VS2010 按照 他 的 过程 来 编译 也是 可以 顺利 
通过 的 需要 的 注意 的 是 1 在 配置 
CMake 的 时候 选择 VS10 WIN64 根据 自己 的 操作 
系统 和 VS 版本 选择 勾选/nr WITH _ TBB WITH 
_ CUDA 2 把/p debug/w 和/c release/w 两个/m 版本/n 都/d 
编译/v 上/f 编译 的 时间 比较 长 视 电脑 性能 
自己 编译 花了 耐心 等待 ~ ~ ~ 3 在 
编译 过程 中 可能 会 弹出 对话框 是否 要 reload 
the solution when a CMakeLists . tx has changed 这个 
可能 是 个 bug 是 CMake 的 宏 造成 的 
所以 可以 再 编译 前 检查 一下 是否 有 这样 
额 的 宏 VS2010 中 Tools 工具 Macros 宏 Macro 
explorer 宏 查看器 CMakeVSMacros2 也 可能 是 其他 的 目录 
找到 Public Sub ReloadProjects Optional ByVal projects As String = 
与 Public Sub StopBuild Optional ByVal projects As String = 
这 两个 函数 它们 应该 是 VB 写 的 把 
函数 体 注释 掉 就 可以 了 2.4 测试 是否 
安装 成功 安装 完成 后 新建 一个 WIN32 项目 注意 
配置 一 下 使用 x64 选项 进行 编译 如果 安装 
成功 int devNum = cv gpu g e t C 
u d a E n a b l e d 
D e v i c e C o u n 
t 将 返回 非 0 值 否则 说明 配置 为 
成功 # include stdafx . h # include # include 
opencv2 / opencv . hpp # include opencv2 / gpu 
/ gpu . hpp int _ tmain int argc _ 
TCHAR * argv { int devNum = cv gpu g 
e t C u d a E n a b 
l e d D e v i c e C 
o u n t try { cv Mat src _ 
host = cv imread lena . jpg CV _ LOAD 
_ IMAGE _ GRAYSCALE cv gpu GpuMat dst src src 
. upload src _ host cv gpu threshold src dst 
128.0 255.0 CV _ THRESH _ BINARY cv Mat result 
_ host dst . download result _ host cv namedWindow 
Result 1 cv imshow Result result _ host cv waitKey 
} catch const cv Exception & ex { std cout 
Error ex . what std endl } return 0 } 
参考文献 1 http / / www . cnblogs . com 
/ freedomshe / archive / 2013 / 01/11 / win7 
_ vs2012 _ opencv _ rebuild . html 2 http 
/ / blog . csdn . net / kelvin _ 
yan / article / details / 38866795 按语 首先 感谢 
http / / blog . csdn . net / fengbingchun 
/ article / details / 9831837 这个 博主 的 原创 
方法 在 这个 基础 上 编译 之后 发现 了 很多 
问题 所以 进行 了 改正 有了 以下 方法 重新 编译 
OpenCV 1 查看 本机 配置 查看 显卡 类型 是否 支持 
NVIDIA GPU 本机 显卡 为 NVIDIA GeForce GT630 2 从 
http / / www . nvidia . cn / Download 
/ index . aspx lang = cn 下载 最新 驱动 
并 安装 3 从 https / / developer . nvidia 
. com / cuda toolkit 根据 本机 类型 下载 相应 
最新版 的 CUDA Toolkit6 . 0 64位 安装 并 通过 
样本 程序验证 其 安装 正确 4 将 C \ ProgramFiles 
\ NVIDIAGPU Computing Toolkit \ CUDA \ v 6.0 \ 
bin 添加到 环境变量 中 检查 是否 已经 默认 添加 5 
从 http / / t h r e a d 
i n g b u i l d i n 
g b l o c k s . org / 
下载 最新版 的 TBB4 . 2 解压缩 并 将其 bin 
目录 D \ soft \ OpenCV2 . 4.8 \ TBB 
\ tbb41 _ 20140122oss \ bin \ ia64 \ vc10 
添加到 环境变量 中 注销 或 重启 6 从 http / 
/ opencv . org / downloads . html 下载 最新 
版本 的 OpenCV2 . 4.6 并解 压缩 到 D \ 
soft \ OpenCV2 . 4.8 文件夹 中 7 从 http 
/ / www . cmake . org / cmake / 
resources / software . html 下载 最新 版本 的 CMake2 
. 8 . 11.2 并 安装 8 打开 CMake 在 
Where isthesource code 中 选择 D \ soft \ OpenCV2 
. 4.6 \ opencv 文件夹 在 Where to buildthe binaries 
中 选择 D / soft / OpenCV2 . 4.6 / 
vs2010 _ GPU 文件夹 此 文件夹 为 手动 创建 9 
点击 Configure 按钮 在 弹出 的 对话框 中 选择 VisualStudio 
10 然后 点击 Finish 10 如果 有 红色 框 出现 
勾选/nr BUILD _ EXAMPLES WITH _ TBB WITH _ CUBLAS 
WITH _ CUDA WITH _ CUFFT 然后 再次 点击 Configure 
按钮 11 如果 还有 红色 框 出现 TBB _ INCLUDE 
_ DIRS 将其 值 改为 D \ soft \ OpenCV2 
. 4.6 \ TBB \ tbb41 _ 20130613oss \ include 
为 TBB 中 include 所在 的 目录 然后 再次 点击 
Configure 按钮 12 如何 还有 红色 框 出现 TBB _ 
LIB _ DIR TBB _ STDDEF _ PATH 再次 点击 
Configure 按钮 13 如果 在 下方 信息 框 中有 Use 
TBB YES ver 4.1 interface 6105 Use Cuda YES ver5 
. 0 证明 我们 已经 将 inteltbb 和 CUDA 正确 
配置 14 点击 Generate 按钮 此时 会在 D \ soft 
\ OpenCV2 . 4.6 \ vs2010 _ GPU 文件 夹下 
生成 OpenCV . sln 文件 15 以 管理员 身份 使用 
vs2010 打开 OpenCV . sln 文件 选择 View Properties Manager 
分别 选中 ALL _ BUILD 中的 Debug 和 Release 上 
的 Microsoft . Cpp . Win64 . user 依次 添加 
inteltbb 和 CUDA 的 Executable Directories I n c l 
u d e D i r e c t o 
r i e s 和 Library Directories 点击 右键 Properties 
需要 说明 的 是 opencv 里面 要 选择 build 文件夹 
下面 的 路径 才对 VC + + Directories I n 
c l u d e D i r e c 
t o r i e s D \ soft \ 
OpenCV2 . 4.6 \ TBB \ tbb41 _ 20130613oss \ 
include C \ Program Files \ NVIDIAGPU ComputingToolkit \ CUDA 
\ v 5.0 \ include D \ opencv \ build 
\ include D \ opencv \ build \ include \ 
opencv D \ opencv \ build \ include \ opencv2 
Library Directories D \ soft \ OpenCV2 . 4.6 \ 
TBB \ tbb41 _ 20130613oss \ lib \ ia64 \ 
vc10 C \ Program Files \ NVIDIA GPU Computing Toolkit 
\ CUDA \ v 5.0 \ lib \ Win64 D 
\ opencv \ build \ x64 \ vc10 \ lib 
Executable Directories D \ soft \ OpenCV2 . 4.6 \ 
TBB \ tbb41 _ 20130613oss \ bin \ ia64 \ 
vc10 C \ Program Files \ NVIDIA GPU ComputingToolkit \ 
CUDA \ v 5.0 \ bin D \ opencv \ 
build \ x64 \ vc10 \ bin 16 选中 modules 
中的 opencv _ gpu 点击 右键 选择 Properties Linker Input 
I g n o r e p e c i 
f i c D e f a u l t 
Libraries 加入 libcmtlibcmtd 可 忽视 这条 17 分别 在 Debug 
和 Release 下 选择 SolutionExplorer 里 的 Solution OpenCV 点击 
右键 运行 Rebuild Solution 这个 过程 比较 漫长 win7 64位 
4GB 内存 大概 需要 3 小时 18 点击 CMakeTargets 下 
的 INSTALL 右键 仅 本 工程 build 之后 会在 D 
\ soft \ OpenCV2 . 4.3 \ vs2010 \ install 
文件 夹下 的 bin 文件夹 中 存放 相应 的 动态库 
在 lib 文件夹 下 存放 相应 的 静态 库 补充 
说明 1 安装 CUDA Toolkit 时 最好 不要 修改 其 
默认 的 安装 目录 2 第 17步 的 重建 过程 
中 如果 出现 了 很 异常 诡异 的 行为 有 
一种 调试 方式 是 删除 原先 配置 的 文件夹 重新 
cmake 清空 VS2010 里面 的 工程 重新 编译 可能 会 
改善 3 为了 缩短 编译 时间 可以 通过 CMake 中 
改变 CUDA _ ARCH _ BIN CUDA _ ARCH _ 
PTX 值 进行 设置 将 BUILD _ EXAMPLES 的 勾选/nr 
去掉 没有 这么 做 因为 是 为了 全部 编译 4 
在 编译 前 最好 把 360 安全卫士 和 杀毒软件 关闭 
5 也可 不用 管理员 身份 打开 OpenCV . sln 第 
15步 的 属性 配置 在 不同 的 电脑 上 有的 
必须 的 有的 可以 不 需要 最好 都 加上 免得 
返工 6 也 可以 不用 修改 opencv _ gpu 模块 
的 属性 配置 默认 即可 即 第 16步 也 不是 
必须 的 7 编译 过程 中 会 弹出 数次 对话框 
如 出现 宏 对话框 则 点击 Cancel 选项 其它 则 
选择 Yes 选项 8 编译 成功 后的库/nr 也 可以 直接 
应用于 OpenCV 中的 OpenCL 模块 Debug 过程 编译 错误 解决 
1 无法 加载 宏 C / Users / XXX / 
Documents / Visual Studio 2010Projects / VSMacros80 / Samples / 
Samples . vsmacros 解决 方法 把 这个 附件 放在 上述 
目录 里面 附件 2 错误 CMakeFiles / example _ gpu 
_ driver _ api _ multi . dir / driver 
_ api _ multi . cpp . o Infunction ` 
destroyContexts driver _ api _ multi . cpp . text 
. _ Z 1 5 d e s t r 
o y C o n t e x t s 
v + 0xc undefined referenceto ` cuCtxDestroy _ v2 driver 
_ api _ multi . cpp . text . _ 
Z 1 5 d e s t r o y 
C o n t e x t s v + 
0x1c u n d e f i n e d 
r e f e r e n c e to 
` cuCtxDestroy _ v2 CMakeFiles / example _ gpu _ 
driver _ api _ multi . dir / driver _ 
api _ multi . cpp . o Infunction ` Worker 
operator int const driver _ api _ multi . cpp 
. text . _ ZNK6WorkerclEi + 0x19 undefined reference to 
` cuCtxPushCurrent _ v2 driver _ api _ multi . 
cpp . text . _ ZNK6WorkerclEi + 0x6bf undefined reference 
to ` cuCtxPopCurrent _ v2 解决 方法 Only two example 
will affect by this bug example _ gpu _ driver 
_ api _ multi and example _ gpu _ driver 
_ api _ stereo _ multi Modify line 39 target 
_ link _ libraries $ { the _ target } 
$ { OPENCV _ LINKER _ LIBS } $ { 
OPENCV _ GPU _ SAMPLES _ REQUIRED _ DEPS } 
to target _ link _ libraries $ { the _ 
target } $ { OPENCV _ LINKER _ LIBS } 
$ { OPENCV _ GPU _ SAMPLES _ REQUIRED _ 
DEPS } cuda in opencv 2.4 . 6.1 / samples 
/ gpu / CMakeLists . txt can easily fixthis problem 
3 错误 dllmain 重复 定义 opencv _ world246 . dll 
不存在 等 错误 解决 方法 cmake 的 时候 不要 勾选/nr 
build _ world 选项 这个 重建 也 不是 必须 的 
4 错误 37374error LNK1104 无法 打开 文件 . . \ 
. . \ lib \ Debug \ opencv _ superres248d 
. lib D \ opencv \ opencv248GPU \ modules \ 
superres \ LINKopencv _ test _ superres 分析 是 链接库 
链接 不上 造成 的 添上 这些 库 就 可以 了 
解决办法 第 15步 中 务必 把 opencv 的 include \ 
bin \ lib 目标 都 加进去 而且是 build 目 录下 
的 如果 还有 问题 那么 重新 cmake 或者 清除 VS2010 
的 缓存 就 可以 了 5 错误 Unable to cast 
COM object of type System . _ _ ComObject to 
interface type EnvDTE . DTE . 解决办法 可能 是 这个 
或者 可以 放在 这里 不 解决 继续 编译 可以 没有 
问题 http / / blogs . msdn . com / 
b / smondal / archive / 2012 / 10/02 / 
unable to cast com object of type system comobject to 
interface type microsoft visualstudio ole interop iserviceprovider . aspx The 
exception seems to indicate the crashwas caused due to an 
interface not being found . This indicates thatsomething s wrong 
with proxy / stubs on the machine . At l 
e a s t I e r v i c 
e P r o v i d e r is 
failing . IE is usually the owner of the I 
e r v i c e P r o v 
i d e r p r o x y . 
From the dump it showed devenv . exe process crashed 
shortly afterloading C \ Windows \ SysWOW64 \ actxprxy . 
dll andC \ Windows \ System32 \ mssprxy . dll 
The issue turned out to be b r o k 
e n r e g i s t r a 
t i o n for IServiceProvider . The proxy stub 
CLSID was wrong it wasreferring to actxprxy . dll instead 
of ieproxy . dll on Windows 7 x64 . R 
e g i s t e r i n g 
i e p r o x y . dll from 
an elevated cmd prompt resolved the issue . regsvr32 C 
\ Program Files x86 \ Internet Explorer \ ieproxy . 
dll On x86 systems regsvr32 C \ Program Files \ 
Internet Explorer \ ieproxy . dll 新 编译 的 opencv 
使用 方法 1 打开 vs2010 新建 一个 控制台 应用程序 为 
vs2010 配置 OpenCV 环境 选择 View Properties Manager 分别 选中 
Debug 和 Release 上 的 Microsoft . Cpp . Win64 
. user 点击 右键 Properties VC + + Directories Include 
Directories D \ Soft \ OpenCV2 . 4.6 \ vs2010 
_ GPU \ install \ include D \ Soft \ 
OpenCV2 . 4.6 \ vs2010 _ GPU \ install \ 
include \ opencv D \ Soft \ OpenCV2 . 4.6 
\ vs2010 _ GPU \ install \ include \ opencv2 
Library Directories D \ Soft \ OpenCV2 . 4.6 \ 
vs2010 _ GPU \ install \ lib 2 选中 工程 
Properties Configuration Properties Linker Input A d d i t 
i o n a l D e p e n 
d e n c i e s Debug 和 Release 
添加 相应 的 . lib 库 3 将 D \ 
soft \ OpenCV2 . 4.6 \ vs2010 _ GPU \ 
install \ bin 加入到 windows 系统 环境变量 Path 中 重启 
也 可以 将 install 文件夹 全部 拷贝 出来 作为 一个 
新的 opencv 版本 存在 里面 应该 包括 include \ bin 
\ lib 这个 几个 主要 目录 4 示例 如下 如果 
iDevicesNum 结果 非 0 说明 安装 配置 正确 1 . 
# include stdafx . h 2 . # include opencv2 
/ opencv . hpp 3 . # include opencv2 / 
gpu / gpu . hpp 4 . 5 . using 
namespace cv 6 . using namespace cv gpu 7 . 
8 . int _ tmain int argc _ TCHAR * 
argv 9 . { 10 . int iDevicesNum = g 
e t C u d a E n a b 
l e d D e v i c e C 
o u n t 11 . 12 . cout iDevicesNum 
endl 13 . 14 . return 0 15 . } 
参考文献 1 http / / opencv . willowgarage . com 
/ wiki / OpenCV _ GPU 2 http / / 
docs . opencv . org / modules / gpu / 
doc / introduction . html 3 http / / wenku 
. baidu . com / view / 8 1 e 
2 9 c 6 f 0 1 1 c a 
3 0 0 a 6 c 3 9 0 d 
d . html 4 http / / blog . cuvilib 
. com / 2011 / 03/22 / how to build 
opencv 2 2 with gpu cuda on windows 7 / 
5 http / / docs . nvidia . com / 
cuda / cuda getting started guide for microsoft windows / 
index . html 计算机 视觉 关于 OpenCV 中 GPU 配置 编译 的 相关 
事项 标签 空格 分隔 计算机 视觉 前一段 发现 了 OpenCV 
中 关于 GPU 以及 opencl 的 相关 知识 打算 升级 
一下 对 OpenCV 的 使用 但是 发现 从 OpenCV 官网 
上 下载 的 都是 没有 WITH _ CUDA 这一 选项 
的 于是 必须 进行 OpenCV 带 CUDA 的 重 编译 
下面 就 记录 这 一 阶段 出现 的 一系列 问题 
关于 OpenCV 版本 的 问题 起初 直接 尝试 使用 一直 
用 的 OpenCV2 . 4.9 的 源码 进行 编译 选择 
的 编译 环境 为 Visual Studio2010 x64 因为 前面 在 
使用 cuda 的 时候 就 已经 遇到 过 关于 CUDA 
的 库 对于 32位 程序 的 不 全面 支持 即 
CUDA 的 较高 版本 好像 有 一些 64位 的 库 
在 32位 中 是 没有 的 所以 直接 选择 了 
x64 的 平台 而 此时 我 使用 的 CUDA 版本 
为 8.0 总之 编译 OpenCV 中 出现 了 一系列 莫名其妙 
的 问题 在 网上 也 不好 查看 最后 尝试 了 
使用 OpenCV2 . 4.13 版本 听说 是 2016年 更新 的 
版本 所以 应该 能跟/nr CUDA8 . 0 匹配 首先 只是 
将 OpenCV2 . 4.13 的 源码 替换 了 OpenCV2 . 
4.9 的 源码 然后 再去 编译 的 debug 版本 爆出 
了 无法 排除 的 错误 而 release 版本 居然 生成 
成功 了 但是 我 使用 这些 库 的 时候 总是 
说 CUDA function API call 错误 之类 应该 是 还是 
没有 配置 成功 这 一 问题 让 我 都想 放弃 
了 OpenCV 中 关于 CUDA 的 使用 了 后来 一再 
坚持 然后 决定 使用 Visual Studio 2015 进行 编译 这里 
说明 一下 我 用 CMAKE 进行 编译 的 时候 可选 
的 本地 编译器 有 10 13 和 15 版本 的 
当时 想 使用 13 版本 的 win64 但是 好像 configure 
不过 于是 一直 使用 10 版本 即使 打开 的 时候 
用 的 是 13 版本 但是 还是 报错 后来 猛然间 
醒悟 极 有可能 是 编译器 版本 的 问题 于是 使用 
CUDA8 . 0 + OpenCV2 . 4.13 + Visual Studio 
2015 x64 配置 不管 是 Debug 版本 还是 Release 版本 
都 生成 成功 了 这 全部 是 最新 版本 的 
相互 之间 的 匹配 关于 CMAKE 的 配置 选项 一个是 
要 选择 WITH _ CUDA 然后 是 选择 capabilities 我 
的 笔记本 是 GTX860M 对应 的 为 5.0 我 查了/nr 
一下 后面 要 部署 的 显卡 GTX1060 为 6.1 我 
把 这两项 加了 进去 其实 还有 一个 GPU 架构 的 
选项 好像 不 选 的话 就是 对应 自动 但是 里面 
还 好像 只有 开普勒 和 费米 架构 我 配置 成功 
的 这次 没有 选择 另外 好 像用 10 版本 的 
配置 这个 能力 的 时候 居然 配置 不 成功 不 
知道 啥 原因 关于 我 电脑 上 OpenCV 版本控制 的 
说明 1 保留 D 盘根 目 录下 的 OpenCV2 . 
4.9 与 OpenCV2 . 4.13 这 两个 都是/nr 基于 微软 
的 MSVC 编译器 的 其中 OpenCV2 . 4.13 版本 中的 
x 64中 对应 的 vc14 路径 下为 带 CUDA GPU 
配置 的 动态链接库 2 在 F 盘根 目 录下 的 
opencv2 . 4.13 是 对应 x64 版本 的 CUDA GPU 
编译 工程 可以 保留 以后 又 需要 在 进行 修改 
3 在 F 盘根 目 录下 的 OpenCV2 . 4.9 
MinGW 为 对应 MinGW gcc 编译器 的 动态链接库 可以 在 
Qt gcc 下 编译 使用 在 编写 跨平台 的 工程 
时 可以 使用 Qt 的 这个 版本 保留 工程 文件 
下面 是 一些 引文 参考 近期 由于 课题 需要 使用 
GPU 进行 加速 通过 调研 决定 采用 OpenCV 的 GPU 
支持 通过 整整 一天 的 摸索 终于 配置 成功 1 
. 系统 环境 windows 7 ultimate 版 64位 + visual 
studio 2010 ultimate 版 + OpenCV 2 . 4.9 + 
CUDA ToolKit 6.5 + CMake2 . 8.8 2 . 配置 
过程 大致 流程 CUDA Toolkit 6.5 的 下载 与 安装 
CMake 的 下载 与 安装 OpenCV 的 下载 与 编译 
测试 是否 安装 成功 2.1 CUDA ToolKit 6.5 的 下载 
与 安装 由于 之前 测试 直接 使用 OpenCV 的 预 
编译 的 版本 无法 使用 其 GPU 模块 因此 需要 
安装 CUDA Toolkit 之后 使用 自己 的 基于 CUDA 编译 
的 OpenCV 库 由于 自己 配置 时 CUDA ToolKit 版本 
是 7.0 于是 尝试 了 一下 结果 不 成功 原因 
估计 是 Opencv2 . 4.9 的 gpu 模块 对 最新 
的 CUDA 支持 不够 完善 因此 在 选择 CUDA 版本 
时 一定 要 考虑 OpenCV 对其 的 兼容性 自己 的 
一个 经验 是 到 http / / code . opencv 
. org / projects / opencv / wiki / ChangeLog 
看 一下 自己 的 OpenCV 版本 发布 的 时间 再到 
CUDA 下载 的 页面 找 一个 发布 时间 与 OpenCV 
发布 时间 相近 的 版本 选择 合适 的 版本 很 
重要 自己 花费 的 主要 时间 就 浪费 在 版本 
不兼容 上 ~ ~ ~ 自己 使用 的 是 CUDA 
ToolKit 6.5 根据 自己 的 系统 计算 需求 下载 对应 
的 版本 一路 安装 就 可以 了 这个 问题 应该 
都 不大 主要 是 确定 OpenCV 与 CUDA 的 兼容性 
2.2 CMake 工具 的 下载 与 安装 到 http / 
/ www . cmake . org / files / 下载 
任何 自己 需要 的 版本 虽然 我 的 win7 系统 
是 64位 的 但是 只有 32位 的 CMAKE 供 下载 
cmake 2 . 8.8 win32 x86 . exe 这个 对 
后面 的 编译 木 有影响 我 使用 的 是 2 
. 8.8 下载 完成 安装 就 OK ~ ~ 2.3 
OpenCV 的 下载 与 编译 到 OpenCV 的 主页 上 
找到 对应 的 版本 2 . 4.9 下载 Opencv for 
windows 安装 到 自己 的 目录 比如 D \ OpenCV 
然后 使用 CMake 工具 编译 基于 CUDA 和 TBB 的 
OpenCV 库 这个 过程 可以 参看 http / / www 
. cnblogs . com / freedomshe / archive / 2013 
/ 01/11 / win7 _ vs2012 _ opencv _ rebuild 
. html 这篇文章 写得 很详细 而且 图文并茂 很 好懂 虽然 
这 篇 文章 的 OPENCV 及 vs 版本 不同 但是 
VS2010 按照 他 的 过程 来 编译 也是 可以 顺利 
通过 的 需要 的 注意 的 是 1 在 配置 
CMake 的 时候 选择 VS10 WIN64 根据 自己 的 操作 
系统 和 VS 版本 选择 勾选/nr WITH _ TBB WITH 
_ CUDA 2 把/p debug/w 和/c release/w 两个/m 版本/n 都/d 
编译/v 上/f 编译 的 时间 比较 长 视 电脑 性能 
自己 编译 花了 耐心 等待 ~ ~ ~ 3 在 
编译 过程 中 可能 会 弹出 对话框 是否 要 reload 
the solution when a CMakeLists . tx has changed 这个 
可能 是 个 bug 是 CMake 的 宏 造成 的 
所以 可以 再 编译 前 检查 一下 是否 有 这样 
额 的 宏 VS2010 中 Tools 工具 Macros 宏 Macro 
explorer 宏 查看器 CMakeVSMacros2 也 可能 是 其他 的 目录 
找到 Public Sub ReloadProjects Optional ByVal projects As String = 
与 Public Sub StopBuild Optional ByVal projects As String = 
这 两个 函数 它们 应该 是 VB 写 的 把 
函数 体 注释 掉 就 可以 了 2.4 测试 是否 
安装 成功 安装 完成 后 新建 一个 WIN32 项目 注意 
配置 一 下 使用 x64 选项 进行 编译 如果 安装 
成功 int devNum = cv gpu g e t C 
u d a E n a b l e d 
D e v i c e C o u n 
t 将 返回 非 0 值 否则 说明 配置 为 
成功 # include stdafx . h # include # include 
opencv2 / opencv . hpp # include opencv2 / gpu 
/ gpu . hpp int _ tmain int argc _ 
TCHAR * argv { int devNum = cv gpu g 
e t C u d a E n a b 
l e d D e v i c e C 
o u n t try { cv Mat src _ 
host = cv imread lena . jpg CV _ LOAD 
_ IMAGE _ GRAYSCALE cv gpu GpuMat dst src src 
. upload src _ host cv gpu threshold src dst 
128.0 255.0 CV _ THRESH _ BINARY cv Mat result 
_ host dst . download result _ host cv namedWindow 
Result 1 cv imshow Result result _ host cv waitKey 
} catch const cv Exception & ex { std cout 
Error ex . what std endl } return 0 } 
参考文献 1 http / / www . cnblogs . com 
/ freedomshe / archive / 2013 / 01/11 / win7 
_ vs2012 _ opencv _ rebuild . html 2 http 
/ / blog . csdn . net / kelvin _ 
yan / article / details / 38866795 按语 首先 感谢 
http / / blog . csdn . net / fengbingchun 
/ article / details / 9831837 这个 博主 的 原创 
方法 在 这个 基础 上 编译 之后 发现 了 很多 
问题 所以 进行 了 改正 有了 以下 方法 重新 编译 
OpenCV 1 查看 本机 配置 查看 显卡 类型 是否 支持 
NVIDIA GPU 本机 显卡 为 NVIDIA GeForce GT630 2 从 
http / / www . nvidia . cn / Download 
/ index . aspx lang = cn 下载 最新 驱动 
并 安装 3 从 https / / developer . nvidia 
. com / cuda toolkit 根据 本机 类型 下载 相应 
最新版 的 CUDA Toolkit6 . 0 64位 安装 并 通过 
样本 程序验证 其 安装 正确 4 将 C \ ProgramFiles 
\ NVIDIAGPU Computing Toolkit \ CUDA \ v 6.0 \ 
bin 添加到 环境变量 中 检查 是否 已经 默认 添加 5 
从 http / / t h r e a d 
i n g b u i l d i n 
g b l o c k s . org / 
下载 最新版 的 TBB4 . 2 解压缩 并 将其 bin 
目录 D \ soft \ OpenCV2 . 4.8 \ TBB 
\ tbb41 _ 20140122oss \ bin \ ia64 \ vc10 
添加到 环境变量 中 注销 或 重启 6 从 http / 
/ opencv . org / downloads . html 下载 最新 
版本 的 OpenCV2 . 4.6 并解 压缩 到 D \ 
soft \ OpenCV2 . 4.8 文件夹 中 7 从 http 
/ / www . cmake . org / cmake / 
resources / software . html 下载 最新 版本 的 CMake2 
. 8 . 11.2 并 安装 8 打开 CMake 在 
Where isthesource code 中 选择 D \ soft \ OpenCV2 
. 4.6 \ opencv 文件夹 在 Where to buildthe binaries 
中 选择 D / soft / OpenCV2 . 4.6 / 
vs2010 _ GPU 文件夹 此 文件夹 为 手动 创建 9 
点击 Configure 按钮 在 弹出 的 对话框 中 选择 VisualStudio 
10 然后 点击 Finish 10 如果 有 红色 框 出现 
勾选/nr BUILD _ EXAMPLES WITH _ TBB WITH _ CUBLAS 
WITH _ CUDA WITH _ CUFFT 然后 再次 点击 Configure 
按钮 11 如果 还有 红色 框 出现 TBB _ INCLUDE 
_ DIRS 将其 值 改为 D \ soft \ OpenCV2 
. 4.6 \ TBB \ tbb41 _ 20130613oss \ include 
为 TBB 中 include 所在 的 目录 然后 再次 点击 
Configure 按钮 12 如何 还有 红色 框 出现 TBB _ 
LIB _ DIR TBB _ STDDEF _ PATH 再次 点击 
Configure 按钮 13 如果 在 下方 信息 框 中有 Use 
TBB YES ver 4.1 interface 6105 Use Cuda YES ver5 
. 0 证明 我们 已经 将 inteltbb 和 CUDA 正确 
配置 14 点击 Generate 按钮 此时 会在 D \ soft 
\ OpenCV2 . 4.6 \ vs2010 _ GPU 文件 夹下 
生成 OpenCV . sln 文件 15 以 管理员 身份 使用 
vs2010 打开 OpenCV . sln 文件 选择 View Properties Manager 
分别 选中 ALL _ BUILD 中的 Debug 和 Release 上 
的 Microsoft . Cpp . Win64 . user 依次 添加 
inteltbb 和 CUDA 的 Executable Directories I n c l 
u d e D i r e c t o 
r i e s 和 Library Directories 点击 右键 Properties 
需要 说明 的 是 opencv 里面 要 选择 build 文件夹 
下面 的 路径 才对 VC + + Directories I n 
c l u d e D i r e c 
t o r i e s D \ soft \ 
OpenCV2 . 4.6 \ TBB \ tbb41 _ 20130613oss \ 
include C \ Program Files \ NVIDIAGPU ComputingToolkit \ CUDA 
\ v 5.0 \ include D \ opencv \ build 
\ include D \ opencv \ build \ include \ 
opencv D \ opencv \ build \ include \ opencv2 
Library Directories D \ soft \ OpenCV2 . 4.6 \ 
TBB \ tbb41 _ 20130613oss \ lib \ ia64 \ 
vc10 C \ Program Files \ NVIDIA GPU Computing Toolkit 
\ CUDA \ v 5.0 \ lib \ Win64 D 
\ opencv \ build \ x64 \ vc10 \ lib 
Executable Directories D \ soft \ OpenCV2 . 4.6 \ 
TBB \ tbb41 _ 20130613oss \ bin \ ia64 \ 
vc10 C \ Program Files \ NVIDIA GPU ComputingToolkit \ 
CUDA \ v 5.0 \ bin D \ opencv \ 
build \ x64 \ vc10 \ bin 16 选中 modules 
中的 opencv _ gpu 点击 右键 选择 Properties Linker Input 
I g n o r e p e c i 
f i c D e f a u l t 
Libraries 加入 libcmtlibcmtd 可 忽视 这条 17 分别 在 Debug 
和 Release 下 选择 SolutionExplorer 里 的 Solution OpenCV 点击 
右键 运行 Rebuild Solution 这个 过程 比较 漫长 win7 64位 
4GB 内存 大概 需要 3 小时 18 点击 CMakeTargets 下 
的 INSTALL 右键 仅 本 工程 build 之后 会在 D 
\ soft \ OpenCV2 . 4.3 \ vs2010 \ install 
文件 夹下 的 bin 文件夹 中 存放 相应 的 动态库 
在 lib 文件夹 下 存放 相应 的 静态 库 补充 
说明 1 安装 CUDA Toolkit 时 最好 不要 修改 其 
默认 的 安装 目录 2 第 17步 的 重建 过程 
中 如果 出现 了 很 异常 诡异 的 行为 有 
一种 调试 方式 是 删除 原先 配置 的 文件夹 重新 
cmake 清空 VS2010 里面 的 工程 重新 编译 可能 会 
改善 3 为了 缩短 编译 时间 可以 通过 CMake 中 
改变 CUDA _ ARCH _ BIN CUDA _ ARCH _ 
PTX 值 进行 设置 将 BUILD _ EXAMPLES 的 勾选/nr 
去掉 没有 这么 做 因为 是 为了 全部 编译 4 
在 编译 前 最好 把 360 安全卫士 和 杀毒软件 关闭 
5 也可 不用 管理员 身份 打开 OpenCV . sln 第 
15步 的 属性 配置 在 不同 的 电脑 上 有的 
必须 的 有的 可以 不 需要 最好 都 加上 免得 
返工 6 也 可以 不用 修改 opencv _ gpu 模块 
的 属性 配置 默认 即可 即 第 16步 也 不是 
必须 的 7 编译 过程 中 会 弹出 数次 对话框 
如 出现 宏 对话框 则 点击 Cancel 选项 其它 则 
选择 Yes 选项 8 编译 成功 后的库/nr 也 可以 直接 
应用于 OpenCV 中的 OpenCL 模块 Debug 过程 编译 错误 解决 
1 无法 加载 宏 C / Users / XXX / 
Documents / Visual Studio 2010Projects / VSMacros80 / Samples / 
Samples . vsmacros 解决 方法 把 这个 附件 放在 上述 
目录 里面 附件 2 错误 CMakeFiles / example _ gpu 
_ driver _ api _ multi . dir / driver 
_ api _ multi . cpp . o Infunction ` 
destroyContexts driver _ api _ multi . cpp . text 
. _ Z 1 5 d e s t r 
o y C o n t e x t s 
v + 0xc undefined referenceto ` cuCtxDestroy _ v2 driver 
_ api _ multi . cpp . text . _ 
Z 1 5 d e s t r o y 
C o n t e x t s v + 
0x1c u n d e f i n e d 
r e f e r e n c e to 
` cuCtxDestroy _ v2 CMakeFiles / example _ gpu _ 
driver _ api _ multi . dir / driver _ 
api _ multi . cpp . o Infunction ` Worker 
operator int const driver _ api _ multi . cpp 
. text . _ ZNK6WorkerclEi + 0x19 undefined reference to 
` cuCtxPushCurrent _ v2 driver _ api _ multi . 
cpp . text . _ ZNK6WorkerclEi + 0x6bf undefined reference 
to ` cuCtxPopCurrent _ v2 解决 方法 Only two example 
will affect by this bug example _ gpu _ driver 
_ api _ multi and example _ gpu _ driver 
_ api _ stereo _ multi Modify line 39 target 
_ link _ libraries $ { the _ target } 
$ { OPENCV _ LINKER _ LIBS } $ { 
OPENCV _ GPU _ SAMPLES _ REQUIRED _ DEPS } 
to target _ link _ libraries $ { the _ 
target } $ { OPENCV _ LINKER _ LIBS } 
$ { OPENCV _ GPU _ SAMPLES _ REQUIRED _ 
DEPS } cuda in opencv 2.4 . 6.1 / samples 
/ gpu / CMakeLists . txt can easily fixthis problem 
3 错误 dllmain 重复 定义 opencv _ world246 . dll 
不存在 等 错误 解决 方法 cmake 的 时候 不要 勾选/nr 
build _ world 选项 这个 重建 也 不是 必须 的 
4 错误 37374error LNK1104 无法 打开 文件 . . \ 
. . \ lib \ Debug \ opencv _ superres248d 
. lib D \ opencv \ opencv248GPU \ modules \ 
superres \ LINKopencv _ test _ superres 分析 是 链接库 
链接 不上 造成 的 添上 这些 库 就 可以 了 
解决办法 第 15步 中 务必 把 opencv 的 include \ 
bin \ lib 目标 都 加进去 而且是 build 目 录下 
的 如果 还有 问题 那么 重新 cmake 或者 清除 VS2010 
的 缓存 就 可以 了 5 错误 Unable to cast 
COM object of type System . _ _ ComObject to 
interface type EnvDTE . DTE . 解决办法 可能 是 这个 
或者 可以 放在 这里 不 解决 继续 编译 可以 没有 
问题 http / / blogs . msdn . com / 
b / smondal / archive / 2012 / 10/02 / 
unable to cast com object of type system comobject to 
interface type microsoft visualstudio ole interop iserviceprovider . aspx The 
exception seems to indicate the crashwas caused due to an 
interface not being found . This indicates thatsomething s wrong 
with proxy / stubs on the machine . At l 
e a s t I e r v i c 
e P r o v i d e r is 
failing . IE is usually the owner of the I 
e r v i c e P r o v 
i d e r p r o x y . 
From the dump it showed devenv . exe process crashed 
shortly afterloading C \ Windows \ SysWOW64 \ actxprxy . 
dll andC \ Windows \ System32 \ mssprxy . dll 
The issue turned out to be b r o k 
e n r e g i s t r a 
t i o n for IServiceProvider . The proxy stub 
CLSID was wrong it wasreferring to actxprxy . dll instead 
of ieproxy . dll on Windows 7 x64 . R 
e g i s t e r i n g 
i e p r o x y . dll from 
an elevated cmd prompt resolved the issue . regsvr32 C 
\ Program Files x86 \ Internet Explorer \ ieproxy . 
dll On x86 systems regsvr32 C \ Program Files \ 
Internet Explorer \ ieproxy . dll 新 编译 的 opencv 
使用 方法 1 打开 vs2010 新建 一个 控制台 应用程序 为 
vs2010 配置 OpenCV 环境 选择 View Properties Manager 分别 选中 
Debug 和 Release 上 的 Microsoft . Cpp . Win64 
. user 点击 右键 Properties VC + + Directories Include 
Directories D \ Soft \ OpenCV2 . 4.6 \ vs2010 
_ GPU \ install \ include D \ Soft \ 
OpenCV2 . 4.6 \ vs2010 _ GPU \ install \ 
include \ opencv D \ Soft \ OpenCV2 . 4.6 
\ vs2010 _ GPU \ install \ include \ opencv2 
Library Directories D \ Soft \ OpenCV2 . 4.6 \ 
vs2010 _ GPU \ install \ lib 2 选中 工程 
Properties Configuration Properties Linker Input A d d i t 
i o n a l D e p e n 
d e n c i e s Debug 和 Release 
添加 相应 的 . lib 库 3 将 D \ 
soft \ OpenCV2 . 4.6 \ vs2010 _ GPU \ 
install \ bin 加入到 windows 系统 环境变量 Path 中 重启 
也 可以 将 install 文件夹 全部 拷贝 出来 作为 一个 
新的 opencv 版本 存在 里面 应该 包括 include \ bin 
\ lib 这个 几个 主要 目录 4 示例 如下 如果 
iDevicesNum 结果 非 0 说明 安装 配置 正确 1 . 
# include stdafx . h 2 . # include opencv2 
/ opencv . hpp 3 . # include opencv2 / 
gpu / gpu . hpp 4 . 5 . using 
namespace cv 6 . using namespace cv gpu 7 . 
8 . int _ tmain int argc _ TCHAR * 
argv 9 . { 10 . int iDevicesNum = g 
e t C u d a E n a b 
l e d D e v i c e C 
o u n t 11 . 12 . cout iDevicesNum 
endl 13 . 14 . return 0 15 . } 
参考文献 1 http / / opencv . willowgarage . com 
/ wiki / OpenCV _ GPU 2 http / / 
docs . opencv . org / modules / gpu / 
doc / introduction . html 3 http / / wenku 
. baidu . com / view / 8 1 e 
2 9 c 6 f 0 1 1 c a 
3 0 0 a 6 c 3 9 0 d 
d . html 4 http / / blog . cuvilib 
. com / 2011 / 03/22 / how to build 
opencv 2 2 with gpu cuda on windows 7 / 
5 http / / docs . nvidia . com / 
cuda / cuda getting started guide for microsoft windows / 
index . html 