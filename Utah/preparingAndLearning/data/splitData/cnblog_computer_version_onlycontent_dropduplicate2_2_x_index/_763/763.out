项目/n,源码/nw,一/m,、/w,faster/en,-/w,rcnn/en,简介/n,『/w,cs/en,231/m,n/en,』/w,faster/en,_,rcnn/en,『/w,计算机/n,视觉/n,』/w,faster/en,-/w,rcnn/en,学习/v,_,其一/r,：/w,目标/n,检测/vn,及/c,rcnn/en,谱系/n,一篇/mq,讲/v,的/u,非常/d,明白/v,的/u,文章/n,：/w,一文/mq,读/v,懂/v,faster/en, ,rcnn/en,(/w,1/m,)/w,输入/v,测试/vn,图像/n,；/w,(/w,2/m,)/w,将/d,整/m,张/q,图片/n,输入/v,cnn/en,，/w,进行/v,特征/n,提取/v,；/w,(/w,3/m,)/w,用/p,rpn/en,生成/vn,建议/n,窗口/s,(/w,proposals/en,)/w,，/w,每张/r,图片/n,保留/v,约/d,300个/m,建议/n,窗口/s,；/w,(/w,4/m,)/w,把/p,建议/n,窗口/s,映射/v,到/v,cnn/en,的/u,最后/f,一层/mq,卷积/nw,feature/en, ,map/en,上/f,；/w,(/w,5/m,)/w,通过/p,roi/en, ,pooling/en,层/q,使/v,每个/r,roi/en,生成/vn,固定/a,尺寸/n,的/u,feature/en, ,map/en,；/w,(/w,6/m,)/w,利用/v,softmax/en, ,loss/en,(/w,探测/vn,分类/vn,概率/n,)/w, ,和/c,smooth/en, ,l/en,1/m, ,loss/en,(/w,探测/vn,边框/n,回归/v,)/w,对/p,分类/vn,概率/n,和/c,边框/n,回归/v,(/w,bounding/en, ,box/en, ,regression/en,)/w,联合/v,训练/vn,./w,相比/v,fast/en,-/w,rcnn/en,，/w,主要/b,两处/mq,不同/a,(/w,1/m,)/w,使用/v,rpn/en,(/w,region/en, ,proposal/en, ,network/en,)/w,代替/v,原来/d,的/u,selective/en, ,search/en,方法/n,产生/v,建议/n,窗口/s,；/w,(/w,2/m,)/w,产生/v,建议/n,窗口/s,的/u,cnn/en,和/c,目标/n,检测/vn,的/u,cnn/en,共享/v,改进/v,快速/d,产生/v,建议/n,框/q,：/w,faster/en,-/w,rcnn/en,创造性/n,地/u,采用/v,卷积/nw,网络/n,自行/d,产生/v,建议/n,框/q,，/w,并且/c,和/c,目标/n,检测/vn,网络/n,共享/v,卷积/nw,网络/n,，/w,使得/v,建议/n,框/q,数目/n,从/p,原有/v,的/u,约/d,2000个/m,减少/v,为/p,300个/m,，/w,且/c,建议/n,框/q,的/u,质量/n,也/d,有/v,本质/n,的/u,提高/v,./w,rpn/en,简介/n,放/v,到/v,整体/n,网络/n,中/f,如下/v,，/w,对于/p,共享/v,的/u,feature/en, ,map/en,，/w,rpn/en,使用/v,3/m,*/w,3/m,的/u,滑窗/nw,，/w,每个/r,滑动/vn,窗口/s,位置/n,生成/vn,9个/m,候选/b,窗口/s,（/w,不同/a,尺度/n,、/w,不同/a,宽高/nw,）/w,，/w,对应/v,36个/m,坐标/n,、/w,18个/m,分类/vn,。/w,训练/vn,过程/n,中/f,，/w,1/m,）/w,丢弃/v,跨越/v,边界/n,的/u,anchor/en,；/w,2/m,）/w,与/p,样本/n,重叠/v,区域/n,大于/v,0.7/m,的/u,anchor/en,标记/n,为/p,前景/n,，/w,重叠/v,区域/n,小于/v,0.3/m,的/u,标定/v,为/p,背景/n,；/w,总结/v,一下/m,：/w,•/w, ,在/p,feature/en, ,map/en,上/f,滑动/vn,窗口/s,•/w, ,建/v,一个/m,神经/n,网络/n,用于/v,物体/n,分类/vn,+/w,框/q,位置/n,的/u,回归/v,•/w, ,滑动/vn,窗口/s,的/u,位置/n,提供/v,了/u,物体/n,的/u,大体/d,位置/n,信息/n,•/w, ,框/q,的/u,回归/v,提供/v,了/u,框/q,更/d,精确/a,的/u,位置/n,这里/r,的/u,分类/vn,只/d,需要/v,区分/v,候选框/nw,内/f,特征/n,为/p,前景/n,或者/c,背景/n,，/w,这里/r,的/u,边框/n,回归/v,也/d,是/v,为了/p,之后/f,获得/v,更/d,精确/a,的/u,目标/n,位置/n,。/w,损失/n,函数/n,故/c,整个/b,网络/n,包含/v,四个/m,损失/n,函数/n,;/w,•/w, ,rpn/en, ,calssification/en,(/w,anchor/en, ,good/en,./w,bad/en,)/w,，/w,判断/v,anchor/en,前景/n,背景/n,类别/n,•/w, ,rpn/en, ,regression/en,(/w,anchor/en,-/w,>,propoasal/en,)/w,，/w,计算/v,anchor/en,和/c,gt/en, ,box/en,的/u,偏差/n,，/w,利用/v,mask/en,仅/d,计算/v,前景/n,anchor/en,•/w, ,fast/en, ,r/en,-/w,cnn/en, ,classification/en,(/w,over/en, ,classes/en,)/w,，/w,判断/v,proposal/en,分类/vn,，/w,包含/v,类别/n,数/m,c/en,+/w,背景/n,•/w, ,fast/en, ,r/en,-/w,cnn/en, ,regression/en,(/w,proposal/en, ,-/w,>,box/en,)/w,，/w,计算/v,proposal/en,和/c,gt/en, ,box/en,的/u,偏差/n,，/w,利用/v,mask/en,仅/d,计算/v,类别/n,的/u,proposal/en,注意/v,到/v,前/f,两个/m,损失/n,函数/n,目标/n,是/v,修正/v,anchor/en,，/w,后/f,两个/m,损失/n,函数/n,目标/n,是/v,修正/v,proposal/en,，/w,实际上/d,产生/v,了/u,众多/m,anchors/en,后/f,，/w,会/v,进行/v,筛选/v,（/w,非/h,极/d,大/a,值/n,抑制/v,并/c,按照/p,前景/n,得分/n,排序/vn,等等/u,）/w,，/w,选出/v,特定/b,比例/n,的/u,前景/n,背景/n,anchors/en,作为/v,proposal/en,进行/v,后面/f,的/u,运算/vn,。/w,二/m,、/w,代码/n,解读/v,faster/en,-/w,rcnn/en,网络/n,设计/vn,很/d,是/v,复杂/a,，/w,个人/n,觉得/v,但/c,看/v,论文/n,或者/c,其他/r,材料/n,并/c,不能/v,很/d,好/a,的/u,理解/v,这/r,套/q,流程/n,，/w,本篇/r,我们/r,从/p,实际/n,的/u,代码/n,出发/v,，/w,看看/v,到底/d,是/v,这/r,套/q,网络/n,系统/n,到底/d,是/v,如何/r,设计/vn,的/u,。/w,anchor/en,和/c,proposalregion/en, ,proposal/en,（/w,或者/c,简称/v,proposal/en,，/w,或者/c,简称/v,roi/en,）/w,，/w,可以/v,说/v,rpn/en,网络/n,的/u,目的/n,就是/d,为了/p,得到/v,proposal/en,，/w,这些/r,proposal/en,是/v,对/p,ground/en, ,truth/en,更/d,好/a,的/u,刻画/v,（/w,和/c,anchor/en,相比/v,，/w,坐标/n,更/d,贴近/v,ground/en, ,truth/en,，/w,毕竟/d,anchor/en,的/u,坐标/n,都/d,是/v,批量/d,地/u,按照/p,scale/en,和/c,aspect/en, ,ratio/en,复制/v,的/u,）/w,。/w,如果/c,你/r,还/d,记得/v,在/p,系列/q,二/m,中/f,关于/p,网络结构/l,的/u,介绍/v,，/w,那么/r,你/r,就/d,应该/v,了解/v,到/v,rpn/en,网络/n,的/u,回归/v,支路/n,输出/v,的/u,值/n,（/w,offset/en,）/w,作为/v,smooth/en, ,l/en,1/m,损失/n,函数/n,的/u,输入/v,之一/r,时/ng,，/w,其/r,含义/n,就/d,是/v,使得/v,proposal/en,和/c,anchor/en,之间/f,的/u,offset/en,（/w,rpn/en,网络/n,的/u,回归/v,支路/n,输出/v,）/w,尽可能/d,与/p,ground/en, ,truth/en,和/c,anchor/en,之间/f,的/u,offset/en,（/w,rpn/en,网络/n,的/u,回归/v,支路/n,的/u,回归/v,目标/n,）/w,接近/v,。/w,调包/nw,部分/n,涉及/v,了/u,mx/en,基础/n,框架/n,和/c,一个/m,作者/n,自己/r,创建/v,的/u,operate/en,，/w,import/en, ,mxnet/en, ,as/en, ,mx/en, ,from/en, ,symnet/en, ,import/en, ,proposal/en,_,target/en,特征/n,提取器/nw,一/m,如/v,开篇/n,的/u,图/n,，/w,这里/r,是/v,最/d,上面/f,一行/n,的/u,网络/n,，/w,即/v,提取/v,feature/en, ,map/en,的/u,部分/n,，/w,使用/v,了/u,4个/m,pooling/en,层/q,，/w,意味着/v,原始/a,图像/n,：/w,feature/en, ,map/en, ,=/w, ,16/m,：/w,1/m,，/w,def/en, ,get/en,_,vgg/en,_,feature/en,(/w,data/en,)/w,:/w, ,#, ,group/en, ,1/m, ,conv/en,1/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,data/en,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,64/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,1/m,_,1/m,"/w,)/w, ,relu/en,1/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,1/m,_,1/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,1/m,_,1/m,"/w,)/w, ,conv/en,1/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,1/m,_,1/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,64/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,1/m,_,2/m,"/w,)/w, ,relu/en,1/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,1/m,_,2/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,1/m,_,2/m,"/w,)/w, ,pool/en,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,pooling/en,(/w, ,data/en,=/w,relu/en,1/m,_,2/m,,/w, ,pool/en,_,type/en,=/w,"/w,max/en,"/w,,/w, ,kernel/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,stride/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,pool/en,1/m,"/w,)/w, ,#, ,group/en, ,2/m, ,conv/en,2/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,pool/en,1/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,128/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,2/m,_,1/m,"/w,)/w, ,relu/en,2/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,2/m,_,1/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,2/m,_,1/m,"/w,)/w, ,conv/en,2/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,2/m,_,1/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,128/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,2/m,_,2/m,"/w,)/w, ,relu/en,2/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,2/m,_,2/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,2/m,_,2/m,"/w,)/w, ,pool/en,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,pooling/en,(/w, ,data/en,=/w,relu/en,2/m,_,2/m,,/w, ,pool/en,_,type/en,=/w,"/w,max/en,"/w,,/w, ,kernel/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,stride/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,pool/en,2/m,"/w,)/w, ,#, ,group/en, ,3/m, ,conv/en,3/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,pool/en,2/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,256/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,3/m,_,1/m,"/w,)/w, ,relu/en,3/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,3/m,_,1/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,3/m,_,1/m,"/w,)/w, ,conv/en,3/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,3/m,_,1/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,256/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,3/m,_,2/m,"/w,)/w, ,relu/en,3/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,3/m,_,2/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,3/m,_,2/m,"/w,)/w, ,conv/en,3/m,_,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,3/m,_,2/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,256/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,3/m,_,3/m,"/w,)/w, ,relu/en,3/m,_,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,3/m,_,3/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,3/m,_,3/m,"/w,)/w, ,pool/en,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,pooling/en,(/w, ,data/en,=/w,relu/en,3/m,_,3/m,,/w, ,pool/en,_,type/en,=/w,"/w,max/en,"/w,,/w, ,kernel/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,stride/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,pool/en,3/m,"/w,)/w, ,#, ,group/en, ,4/m, ,conv/en,4/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,pool/en,3/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,4/m,_,1/m,"/w,)/w, ,relu/en,4/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,4/m,_,1/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,4/m,_,1/m,"/w,)/w, ,conv/en,4/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,4/m,_,1/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,4/m,_,2/m,"/w,)/w, ,relu/en,4/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,4/m,_,2/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,4/m,_,2/m,"/w,)/w, ,conv/en,4/m,_,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,4/m,_,2/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,4/m,_,3/m,"/w,)/w, ,relu/en,4/m,_,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,4/m,_,3/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,4/m,_,3/m,"/w,)/w, ,pool/en,4/m, ,=/w, ,mx/en,./w,symbol/en,./w,pooling/en,(/w, ,data/en,=/w,relu/en,4/m,_,3/m,,/w, ,pool/en,_,type/en,=/w,"/w,max/en,"/w,,/w, ,kernel/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,stride/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,pool/en,4/m,"/w,)/w, ,#, ,group/en, ,5/m, ,conv/en,5/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,pool/en,4/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,5/m,_,1/m,"/w,)/w, ,relu/en,5/m,_,1/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,5/m,_,1/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,5/m,_,1/m,"/w,)/w, ,conv/en,5/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,5/m,_,1/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,5/m,_,2/m,"/w,)/w, ,relu/en,5/m,_,2/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,5/m,_,2/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,5/m,_,2/m,"/w,)/w, ,conv/en,5/m,_,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,relu/en,5/m,_,2/m,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,workspace/en,=/w,2048/m,,/w, ,name/en,=/w,"/w,conv/en,5/m,_,3/m,"/w,)/w, ,relu/en,5/m,_,3/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,conv/en,5/m,_,3/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,5/m,_,3/m,"/w,)/w, ,return/en, ,relu/en,5/m,_,3/m,特征/n,提取器/nw,二/m,下面/f,是/v,最后/f,的/u,一/m,小/a,部分/n,网络/n,，/w,我们/r,将/d,筛选/v,出来/v,的/u,proposal/en,作用/n,于/p,feature/en, ,map/en,，/w,得到/v,候选/b,区域/n,，/w,然后/c,使用/v,roipooling/en,得到/v,大小/n,一致/a,的/u,候选/b,区域/n,，/w,这些/r,区域/n,送入/v,本/r,部分/n,网络/n,，/w,得到/v,用于/v,分类/vn,、/w,回归/v,的/u,特征/n,，/w,def/en, ,get/en,_,vgg/en,_,top/en,_,feature/en,(/w,data/en,)/w,:/w, ,#, ,group/en, ,6/m, ,flatten/en, ,=/w, ,mx/en,./w,symbol/en,./w,flatten/en,(/w,data/en,=/w,data/en,,/w, ,name/en,=/w,"/w,flatten/en,"/w,)/w, ,fc/en,6/m, ,=/w, ,mx/en,./w,symbol/en,./w,fullyconnected/en,(/w,data/en,=/w,flatten/en,,/w, ,num/en,_,hidden/en,=/w,4096/m,,/w, ,name/en,=/w,"/w,fc/en,6/m,"/w,)/w, ,relu/en,6/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,fc/en,6/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,6/m,"/w,)/w, ,drop/en,6/m, ,=/w, ,mx/en,./w,symbol/en,./w,dropout/en,(/w,data/en,=/w,relu/en,6/m,,/w, ,p/en,=/w,0.5/m,,/w, ,name/en,=/w,"/w,drop/en,6/m,"/w,)/w, ,#, ,group/en, ,7/m, ,fc/en,7/m, ,=/w, ,mx/en,./w,symbol/en,./w,fullyconnected/en,(/w,data/en,=/w,drop/en,6/m,,/w, ,num/en,_,hidden/en,=/w,4096/m,,/w, ,name/en,=/w,"/w,fc/en,7/m,"/w,)/w, ,relu/en,7/m, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,fc/en,7/m,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,relu/en,7/m,"/w,)/w, ,drop/en,7/m, ,=/w, ,mx/en,./w,symbol/en,./w,dropout/en,(/w,data/en,=/w,relu/en,7/m,,/w, ,p/en,=/w,0.5/m,,/w, ,name/en,=/w,"/w,drop/en,7/m,"/w,)/w, ,return/en, ,drop/en,7/m,主体/n,函数/n,函数/n,接口/n,def/en, ,get/en,_,vgg/en,_,train/en,(/w,anchor/en,_,scales/en,,/w, ,anchor/en,_,ratios/en,,/w, ,rpn/en,_,feature/en,_,stride/en,,/w, ,rpn/en,_,pre/en,_,topk/en,,/w, ,rpn/en,_,post/en,_,topk/en,,/w, ,rpn/en,_,nms/en,_,thresh/en,,/w, ,rpn/en,_,min/en,_,size/en,,/w, ,rpn/en,_,batch/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,rcnn/en,_,feature/en,_,stride/en,,/w, ,rcnn/en,_,pooled/en,_,size/en,,/w, ,rcnn/en,_,batch/en,_,size/en,,/w, ,rcnn/en,_,batch/en,_,rois/en,,/w, ,rcnn/en,_,fg/en,_,fraction/en,,/w, ,rcnn/en,_,fg/en,_,overlap/en,,/w, ,rcnn/en,_,bbox/en,_,stds/en,)/w,:/w,首先/d,定义/n,了/u,一些/m,用于/v,接收/v,数据/n,&/w,标签/n,信息/n,的/u,占位/v,符变量/nr,，/w,num/en,_,anchors/en, ,=/w, ,len/en,(/w,anchor/en,_,scales/en,)/w, ,*/w, ,len/en,(/w,anchor/en,_,ratios/en,)/w, ,data/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,data/en,"/w,)/w, ,#, ,图片/n,信息/n,：/w,[/w,batch/en,,/w, ,channel/en,,/w, ,height/en,,/w, ,width/en,]/w, ,im/en,_,info/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,im/en,_,info/en,"/w,)/w, ,gt/en,_,boxes/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,gt/en,_,boxes/en,"/w,)/w, ,#, ,真实/a,框/q,信息/n,：/w,[/w,obj/en,数量/n,,/w, ,5/m,]/w, ,#, ,anchor/en,标签/n,：/w,-/w,1/m,、/w,0/m,、/w,1/m, ,(/w,无效/v,、/w,背景/n,、/w,目标/n,)/w, ,rpn/en,_,label/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,'/w,label/en,'/w,)/w, ,#, ,[/w,batch/en,,/w, ,2/m,,/w, ,中心点/nz,行数/n,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,根据/p,初始/b,anchor/en,和/c,ground/en, ,truth/en,计算/v,出来/v,的/u,offset/en, ,rpn/en,_,bbox/en,_,target/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,'/w,bbox/en,_,target/en,'/w,)/w, ,#, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,mask/en,，/w,如果/c,anchor/en,标签/n,是/v,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,1/m,，/w,anchor/en,标签/n,是/v,0/m,或/c,-/w,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,0/m, ,rpn/en,_,bbox/en,_,weight/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,'/w,bbox/en,_,weight/en,'/w,)/w, ,#, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w,获取/v,卷积/nw,特征/n,#, ,shared/en, ,convolutional/en, ,layers/en, ,conv/en,_,feat/en, ,=/w, ,get/en,_,vgg/en,_,feature/en,(/w,data/en,)/w,使用/v,3/m,×/w,3/m,的/u,滑窗/nw,，/w,进行/v,卷积/nw,，/w,#, ,rpn/en, ,layers/en, ,rpn/en,_,conv/en, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,conv/en,_,feat/en,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,name/en,=/w,"/w,rpn/en,_,conv/en,_,3/m,x/en,3/m,"/w,)/w, ,rpn/en,_,relu/en, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,rpn/en,_,conv/en,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,rpn/en,_,relu/en,"/w,)/w,每个/r,滑动/vn,窗口/s,位置/n,生成/vn,9个/m,候选/b,窗口/s,（/w,不同/a,尺度/n,、/w,不同/a,宽高/nw,）/w,，/w,对应/v,36个/m,坐标/n,、/w,18个/m,分类/vn,，/w,（/w,即/v,根据/p,每张/r,图片/n,的/u,feat/en, ,map/en,大小/n,，/w,生成/vn,对应/v,数量/n,的/u,中心点/nz,，/w,以及/c,候选/b,框体/nw,）/w,rpn/en, ,calssification/en,(/w,anchor/en, ,good/en,./w,bad/en,)/w,下面/f,是/v,计算/v,全部/m,候选/b,窗口/s,对应/v,2/m,分类/vn,的/u,部分/n,，/w,生成/vn,损失/n,函数/n,的/u,第一/m,部分/n,：/w,全部/m,候选/b,窗/ng,含/v,//w,不含/v,obj/en,的/u,二/m,分类/vn,损失/n,，/w,#, ,rpn/en, ,classification/en,:/w, ,obj/en, ,//w, ,not/en,_,obj/en, ,#, ,[/w,batch/en,,/w, ,2/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,cls/en,_,score/en, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,rpn/en,_,relu/en,,/w, ,kernel/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,pad/en,=/w,(/w,0/m,,/w, ,0/m,)/w,,/w, ,num/en,_,filter/en,=/w,2/m, ,*/w, ,num/en,_,anchors/en,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,score/en,"/w,)/w, ,#, ,[/w,batch/en,,/w, ,2/m,,/w, ,中心点/nz,行数/n,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,cls/en,_,score/en,_,reshape/en, ,=/w, ,mx/en,./w,symbol/en,./w,reshape/en,(/w, ,data/en,=/w,rpn/en,_,cls/en,_,score/en,,/w, ,shape/en,=/w,(/w,0/m,,/w, ,2/m,,/w, ,-/w,1/m,,/w, ,0/m,)/w,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,score/en,_,reshape/en,"/w,)/w, ,#, ,获取/v,交叉/vn,熵/g,回/v,传/v,梯度/n,，/w,对于/p,出现/v,了/u,-/w,1/m,的/u,图片/n,梯度/n,直接/ad,全部/m,置/v,为/p,0/m, ,#, ,在/p,faster/en, ,rcnn/en,算法/n,中/f,，/w,anchor/en,一共/d,有/v,3种/mq,标签/n,：/w,-/w,1/m,、/w,0/m,、/w,1/m,，/w,分别/d,表示/v,无效/v,、/w,背景/n,、/w,目标/n, ,rpn/en,_,cls/en,_,prob/en, ,=/w, ,mx/en,./w,symbol/en,./w,softmaxoutput/en,(/w,data/en,=/w,rpn/en,_,cls/en,_,score/en,_,reshape/en,,/w, ,label/en,=/w,rpn/en,_,label/en,,/w, ,multi/en,_,output/en,=/w,true/en,,/w, ,normalization/en,=/w,'/w,valid/en,'/w,,/w, ,use/en,_,ignore/en,=/w,true/en,,/w, ,ignore/en,_,label/en,=/w,-/w,1/m,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,prob/en,"/w,)/w, ,#, ,切换/vn,为/p,含/v,//w,不含/v,obj/en,两/m,通道/n,，/w,对/p,每/r,一个/m,anchor/en,是否/v,有/v,obj/en,进行/v,softmax/en,处理/v, ,#, ,[/w,batch/en,,/w, ,2/m,,/w, ,中心点/nz,行数/n,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,cls/en,_,act/en, ,=/w, ,mx/en,./w,symbol/en,./w,softmax/en,(/w, ,data/en,=/w,rpn/en,_,cls/en,_,score/en,_,reshape/en,,/w, ,axis/en,=/w,1/m,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,act/en,"/w,)/w, ,#, ,[/w,batch/en,，/w, ,2/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,reshpe/en,方法/n,不同/a,于/p,reshape/en,方法/n,，/w,详情/n,见/v,此/r,方法/n,文档/n, ,rpn/en,_,cls/en,_,act/en,_,reshape/en, ,=/w, ,mx/en,./w,symbol/en,./w,reshape/en,(/w, ,data/en,=/w,rpn/en,_,cls/en,_,act/en,,/w, ,shape/en,=/w,(/w,0/m,,/w, ,2/m, ,*/w, ,num/en,_,anchors/en,,/w, ,-/w,1/m,,/w, ,0/m,)/w,,/w, ,name/en,=/w,'/w,rpn/en,_,cls/en,_,act/en,_,reshape/en,'/w,)/w,rpn/en, ,regression/en,(/w,anchor/en,-/w,>,propoasal/en,)/w,下面/f,计算/v,全部/m,候选/b,窗口/s,对应/v,4个/m,坐标值/nw,的/u,部分/n,，/w,生成/vn,损失/n,函数/n,第二/m,部分/n,：/w,全部/m,候选框/nw,坐标/n,回归/v,，/w,#, ,rpn/en, ,bbox/en, ,regression/en, ,#, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,bbox/en,_,pred/en, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,rpn/en,_,relu/en,,/w, ,kernel/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,pad/en,=/w,(/w,0/m,,/w, ,0/m,)/w,,/w, ,num/en,_,filter/en,=/w,4/m, ,*/w, ,num/en,_,anchors/en,,/w, ,name/en,=/w,"/w,rpn/en,_,bbox/en,_,pred/en,"/w,)/w, ,#, ,rpn/en,_,bbox/en,_,weight/en,:/w, ,anchor/en,的/u,mask/en,，/w,如果/c,某个/r,anchor/en,的/u,标签/n,是/v,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,1/m,，/w,anchor/en,的/u,标签/n,是/v,0/m,或/c,-/w,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,0/m, ,#, ,rpn/en,_,bbox/en,_,target/en,:/w, ,根据/p,初始/b,anchor/en,和/c,ground/en, ,truth/en,计算/v,出来/v,的/u,offset/en, ,rpn/en,_,bbox/en,_,loss/en,_, ,=/w, ,rpn/en,_,bbox/en,_,weight/en, ,*/w, ,mx/en,./w,symbol/en,./w,smooth/en,_,l/en,1/m,(/w,name/en,=/w,'/w,rpn/en,_,bbox/en,_,loss/en,_,'/w,,/w, ,scalar/en,=/w,3.0/m,,/w, ,data/en,=/w,(/w,rpn/en,_,bbox/en,_,pred/en, ,-/w, ,rpn/en,_,bbox/en,_,target/en,)/w,)/w, ,#, ,获取/v,回归/v,梯度/n, ,#, ,grad/en,_,scale/en,:/w, ,表示/v,回归/v,损失/n,占/v,rpn/en,网络/n,总/b,损失/n,比/p,，/w,该/r,参数/n,相差/v,几/m,个/q,量级/n,对/p,结果/n,影响/vn,也/d,不/d,大/a, ,rpn/en,_,bbox/en,_,loss/en, ,=/w, ,mx/en,./w,sym/en,./w,makeloss/en,(/w,name/en,=/w,'/w,rpn/en,_,bbox/en,_,loss/en,'/w,,/w, ,data/en,=/w,rpn/en,_,bbox/en,_,loss/en,_,,/w, ,grad/en,_,scale/en,=/w,1.0/m, ,//w, ,rpn/en,_,batch/en,_,rois/en,)/w,候选框/nw,生成/vn,我们/r,会/v,获取/v,数量/n,繁多/a,的/u,候选框/nw,（/w,即/v,上面/f,得到/v,的/u,候选框/nw,含有/v,obj/en,的/u,得分/n,和/c,候选框/nw,坐标/n,修正值/nw,）/w,，/w,首先/d,会/v,根据/p,框体/nw,含有/v,obj/en,的/u,概率/n,进行/v,一次/mq,初/f,筛/v,，/w,然后/c,经由/p,非/h,极/d,大/a,值/n,抑制/v,算法/n,筛选/v,2000个/m,候选框/nw,进入/v,下/f,一步/mq,的/u,操作/v,；/w,在/p,第二/m,步/q,中/f,，/w,我们/r,会/v,获取/v,最终/d,的/u,128个/m,候选框/nw,、/w,它们/r,各自/r,对应/v,的/u,标签/n,、/w,它们/r,坐标/n,回归/v,的/u,目标/n,、/w,以及/c,标定/v,它们/r,正负/n,的/u,坐标/n,掩码/nw,，/w,用于/v,精确/a,的/u,训练/vn,候选框/nw,，/w,生成/vn,目标/n,边框/n,。/w,这个/r,一步/mq,的/u,操作/v,使用/v,了/u,作者/n,新建/v,的/u,操作/v,节点/n,，/w,具体/a,实现/v,见/v,源码/nw,，/w,这里/r,只/d,简单/a,介绍/v,该/r,操作/v,的/u,输入/v,输出/v,以及/c,作用/n,。/w,另注/nw,，/w,函数/n,返回/v,的/u,候选框/nw,5个/m,属性/n,与/p,后面/f,的/u,roipooling/en,一脉相承/i,，/w,[/w,候选框/nw,对应/v,batch/en,中/f,图片/n,的/u,索引/n,，/w,候选框/nw,坐/v,标/v,×/w,4/m,]/w,，/w,后面/f,使用/v,这个/r,值/n,可以/v,直接/ad,进行/v,roipooling/en,。/w,#, ,rpn/en, ,proposal/en, ,#, ,获取/v,指定/v,数目/n,的/u,候选框/nw,proposal/en, ,#, ,[/w,2000个/m,候选框/nw,,/w, ,5个/m,属性/n,]/w, ,#, ,5个/m,属性/n,:/w, ,batch/en,中/f,图片/n,index/en,，/w,4个/m,坐标/n, ,rois/en, ,=/w, ,mx/en,./w,symbol/en,./w,contrib/en,./w,multiproposal/en,(/w, ,cls/en,_,prob/en,=/w,rpn/en,_,cls/en,_,act/en,_,reshape/en,,/w, ,#, ,cls/en,_,prob/en,:/w, ,[/w,batch/en,，/w, ,2/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,bbox/en,_,pred/en,=/w,rpn/en,_,bbox/en,_,pred/en,,/w, ,#, ,bbox/en,_,pred/en,:/w, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,im/en,_,info/en,=/w,im/en,_,info/en,,/w, ,#, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,im/en,_,info/en,"/w,)/w, ,feature/en,_,stride/en,=/w,rpn/en,_,feature/en,_,stride/en,,/w, ,#, ,16/m, ,scales/en,=/w,anchor/en,_,scales/en,,/w, ,ratios/en,=/w,anchor/en,_,ratios/en,,/w, ,#, ,(/w,0.5/m,,/w, ,1/m,,/w, ,2/m,)/w, ,rpn/en,_,pre/en,_,nms/en,_,top/en,_,n/en,=/w,rpn/en,_,pre/en,_,topk/en,,/w, ,#, ,12000/m,，/w,对/p,rpn/en,网络/n,输出/v,的/u,anchor/en,进行/v,nms/en,操作/v,之前/f,的/u,proposal/en,最/d,大/a,数量/n, ,#, ,输入/v,proposal/en,的/u,数量/n,大于/v,12000时/t,，/w,对/p,这些/r,proposal/en,的/u,预测/v,为/p,foreground/en,的/u,概率/n,（/w,也/d,叫/v,score/en,，/w, ,#, ,换句话说/c,就/d,是/v,预测/v,标签/n,为/p,1/m,的/u,概率/n,）/w,从/p,高/a,到/v,低/a,排序/vn,，/w,然后/c,选择/v,前面/f,12000个/m, ,rpn/en,_,post/en,_,nms/en,_,top/en,_,n/en,=/w,rpn/en,_,post/en,_,topk/en,,/w, ,#, ,2000/m,，/w,经过/p,nms/en,过滤/v,之后/f,得到/v,的/u,proposal/en,数量/n, ,threshold/en,=/w,rpn/en,_,nms/en,_,thresh/en,,/w, ,#, ,0.7/m,，/w,是/v,nms/en,算法/n,阈值/n, ,rpn/en,_,min/en,_,size/en,=/w,rpn/en,_,min/en,_,size/en,,/w, ,#, ,16/m, ,name/en, ,=/w, ,'/w,rois/en,'/w, ,)/w, ,#, ,rcnn/en, ,roi/en, ,proposal/en, ,target/en, ,#, ,根据/p,上/f,一步/mq,获取/v,的/u,proposal/en,（/w,即/v,rois/en,）/w,和/c,真实/a,框/q,（/w,gt/en,_,boxes/en,）/w,进行/v,筛选/v, ,#, ,获取/v,128个/m,proposal/en,，/w,对应/v,的/u,128个/m,label/en,，/w,对应/v,的/u,128个/m,真实/a,坐标/n,，/w,128个/m,坐标/n,掩码/nw,（/w,构建/v,损失/n,函数/n,使用/v,）/w, ,group/en, ,=/w, ,mx/en,./w,symbol/en,./w,custom/en,(/w,rois/en,=/w,rois/en,,/w, ,#, ,2000/m,*/w,5/m,的/u,roi/en,信息/n, ,gt/en,_,boxes/en,=/w,gt/en,_,boxes/en,,/w, ,#, ,n/en,*/w,5/m,的/u,ground/en, ,truth/en,信息/n,，/w,n/en,表示/v,object/en,数量/n, ,op/en,_,type/en,=/w,'/w,proposal/en,_,target/en,'/w,,/w, ,num/en,_,classes/en,=/w,num/en,_,classes/en,,/w, ,#, ,num/en,_,classes/en,是/v,实际/n,要/v,分类/vn,的/u,类别/n,数/m,加上/v,背景/n,类/q, ,batch/en,_,images/en,=/w,rcnn/en,_,batch/en,_,size/en,,/w, ,#, ,1/m, ,batch/en,_,rois/en,=/w,rcnn/en,_,batch/en,_,rois/en,,/w, ,#, ,128/m, ,fg/en,_,fraction/en,=/w,rcnn/en,_,fg/en,_,fraction/en,,/w, ,#, ,0.25/m,，/w,正/d,样本/n,所/u,占/v,的/u,比例/n, ,fg/en,_,overlap/en,=/w,rcnn/en,_,fg/en,_,overlap/en,,/w, ,#, ,0.5/m, ,box/en,_,stds/en,=/w,rcnn/en,_,bbox/en,_,stds/en, ,#, ,(/w,0.1/m,,/w, ,0.1/m,,/w, ,0.2/m,,/w, ,0.2/m,)/w, ,)/w, ,rois/en, ,=/w, ,group/en,[/w,0/m,]/w, ,#, ,rois/en, ,(/w,128/m,,/w, ,5/m,)/w, ,label/en, ,=/w, ,group/en,[/w,1/m,]/w, ,#, ,roi/en,对应/v,的/u,标签/n,（/w,128/m,）/w, ,bbox/en,_,target/en, ,=/w, ,group/en,[/w,2/m,]/w, ,#, ,坐标/n,回归/v,的/u,目标/n,，/w,维度/n,是/v,(/w,128/m,,/w,84/m,)/w,,/w, ,其中/r,84/m,来自/v,(/w,20/m,+/w,1/m,)/w,*/w,4/m, ,bbox/en,_,weight/en, ,=/w, ,group/en,[/w,3/m,]/w, ,#, ,坐标/n,回归/v,时候/n,的/u,权重/nz,，/w,维度/n,是/v,(/w,128/m,,/w,84/m,)/w,，/w,对于/p,foreground/en,都/d,是/v,1/m,，/w,对于/p,backgroud/en,都/d,是/v,0/m,在/p,rpn/en,网络/n,得到/v,proposal/en,后/f,还/d,会/v,经过/p,一系列/mq,的/u,过滤/v,操作/v,才/d,会/v,得到/v,送入/v,检测/vn,网络/n,的/u,proposal/en,，/w,节点/n,proposal/en,_,target/en,会/v,将/d,2000个/m,proposal/en,过滤/v,成/v,128个/m,，/w,且/c,为/p,这/r,128个/m,proposal/en,分配/vn,标签/n,、/w,回归/v,目标/n,、/w,定义/n,正负/n,样本/n,的/u,1/m,:/w,3/m,比例/n,等/u,，/w,这/r,部分/n,算是/v,rpn/en,网络/n,和/c,检测/vn,网络/n,（/w,fast/en, ,rcnn/en,）/w,的/u,衔接/v,，/w,值得/v,注意/v,的/u,是/v,该/r,节点/n,不/d,接受/v,后面/f,层数/n,传递/v,而/c,来/v,的/u,梯度/n,，/w,且/c,向前/v,传递/v,梯度/n,强制/vn,为/p,0/m,，/w,已/d,即/v,网络/n,训练/vn,由/p,其/r,割裂/v,为/p,两个/m,部分/n,（/w,尽管/c,两/m,部分/n,仍然/d,相连/v,）/w,。/w,roipooling/en,层/q,将/d,任意/d,大小/n,的/u,输入/v,层/q,下/f,采样/v,为/p,同样/d,大小/n,的/u,输出/v,层/q,，/w,方便/a,后面/f,的/u,计算/v,。/w,这里/r,我们/r,使用/v,候选框/nw,（/w,128个/m,）/w,寻找/v,各自/r,对应/v,的/u,图片/n,，/w,并/c,将/d,各自/r,对应/v,的/u,区域/n,裁剪/v,出来/v,，/w,然后/c,pooling/en,为/p,同样/d,的/u,大小/n,，/w,本层/nw,的/u,两条/mq,虚线/n,输入/v,中/f,上面/f,一条/mq,表示/v,batch/en,图像/n,特征/n,，/w,下面/f,一条/mq,表示/v,候选框/nw,输入/v,#, ,rcnn/en, ,roi/en, ,pool/en, ,#, ,[/w,128个/m,候选框/nw,,/w, ,512个/m,通道/n,,/w, ,7行/mq,,/w, ,7列/mq,]/w, ,roi/en,_,pool/en, ,=/w, ,mx/en,./w,symbol/en,./w,roipooling/en,(/w, ,name/en,=/w,'/w,roi/en,_,pool/en,'/w,,/w, ,data/en,=/w,conv/en,_,feat/en,,/w, ,rois/en,=/w,rois/en,,/w, ,pooled/en,_,size/en,=/w,rcnn/en,_,pooled/en,_,size/en,,/w, ,#, ,(/w,7/m,,/w, ,7/m,)/w,，/w,输出/v,大小/n, ,spatial/en,_,scale/en,=/w,1.0/m, ,//w, ,rcnn/en,_,feature/en,_,stride/en, ,#, ,16/m,，/w, ,feat/en,//w,raw/en,_,img/en, ,)/w,将/d,对应/v,的/u,候选/b,区域/n,（/w,注意/v,此时/r,抠/v,图/n,完成/v,，/w,已经/d,不/d,是/v,候选框/nw,了/u,）/w,经由/p,vgg/en,的/u,分类/vn,头/n,部分/n,（/w,实际上/d,就是/d,对/p,候选/b,区域/n,再/d,进一步/d,抽象/a,提取/v,特征/n,）/w,进行/v,处理/v,，/w,#, ,rcnn/en, ,top/en, ,feature/en, ,#, ,[/w,128/m,,/w, ,4096/m,]/w,，/w,对/p,每个/r,roi/en,提取/v,最终/d,的/u,vgg/en,特征/n, ,top/en,_,feat/en, ,=/w, ,get/en,_,vgg/en,_,top/en,_,feature/en,(/w,roi/en,_,pool/en,)/w,最后/f,的/u,两个/m,损失/n,函数/n,生成/vn,过程/n,，/w,对/p,128个/m,候选/b,区域/n,的/u,抽象/a,特征/n,进行/v,分类/vn,（/w,此时/r,不/d,是/v,含/v,//w,不含/v,obj/en,，/w,而是/c,直接/ad,进行/v,21/m,分类/vn,）/w,，/w,并/c,对/p,每/r,一个/m,抽象/a,特征/n,回归/v,出/v,4个/m,坐标值/nw,，/w,两个/m,损失/n,函数/n,标签/n,均/d,来自/v,上面/f,自/p,定义/n,节点/n,的/u,输出/v,：/w,label/en, ,=/w, ,group/en,[/w,1/m,]/w, , , , , , , , , , , , , , , , , , , ,#, ,roi/en,对应/v,的/u,标签/n,（/w,128/m,）/w,bbox/en,_,target/en, ,=/w, ,group/en,[/w,2/m,]/w, , , , , , , ,#, ,坐标/n,回归/v,的/u,目标/n,，/w,维度/n,是/v,(/w,128/m,,/w,84/m,)/w,,/w, ,其中/r,84/m,来自/v,(/w,20/m,+/w,1/m,)/w,*/w,4/m,bbox/en,_,weight/en, ,=/w, ,group/en,[/w,3/m,]/w, , , , , , ,#, ,坐标/n,回归/v,时候/n,的/u,权重/nz,，/w,维度/n,是/v,(/w,128/m,,/w,84/m,)/w,，/w,对于/p,foreground/en,都/d,是/v,1/m,，/w,对于/p,backgroud/en,都/d,是/v,0/m,#, ,rcnn/en, ,classification/en, ,#, ,对/p,每个/r,roi/en,进行/v,分类/vn,，/w,并/c,构建/v,损失/n,函数/n, ,cls/en,_,score/en, ,=/w, ,mx/en,./w,symbol/en,./w,fullyconnected/en,(/w,name/en,=/w,'/w,cls/en,_,score/en,'/w,,/w, ,data/en,=/w,top/en,_,feat/en,,/w, ,num/en,_,hidden/en,=/w,num/en,_,classes/en,)/w, ,cls/en,_,prob/en, ,=/w, ,mx/en,./w,symbol/en,./w,softmaxoutput/en,(/w,name/en,=/w,'/w,cls/en,_,prob/en,'/w,,/w, ,data/en,=/w,cls/en,_,score/en,,/w, ,label/en,=/w,label/en,,/w, ,normalization/en,=/w,'/w,batch/en,'/w,)/w, ,#, ,rcnn/en, ,bbox/en, ,regression/en, ,#, ,对/p,每个/r,roi/en,进行/v,回归/v,，/w,并/c,构建/v,损失/n,函数/n, ,bbox/en,_,pred/en, ,=/w, ,mx/en,./w,symbol/en,./w,fullyconnected/en,(/w,name/en,=/w,'/w,bbox/en,_,pred/en,'/w,,/w, ,data/en,=/w,top/en,_,feat/en,,/w, ,num/en,_,hidden/en,=/w,num/en,_,classes/en, ,*/w, ,4/m,)/w, ,bbox/en,_,loss/en,_, ,=/w, ,bbox/en,_,weight/en, ,*/w, ,mx/en,./w,symbol/en,./w,smooth/en,_,l/en,1/m,(/w,name/en,=/w,'/w,bbox/en,_,loss/en,_,'/w,,/w, ,scalar/en,=/w,1.0/m,,/w, ,data/en,=/w,(/w,bbox/en,_,pred/en, ,-/w, ,bbox/en,_,target/en,)/w,)/w, ,bbox/en,_,loss/en, ,=/w, ,mx/en,./w,sym/en,./w,makeloss/en,(/w,name/en,=/w,'/w,bbox/en,_,loss/en,'/w,,/w, ,data/en,=/w,bbox/en,_,loss/en,_,,/w, ,grad/en,_,scale/en,=/w,1.0/m, ,//w, ,rcnn/en,_,batch/en,_,rois/en,)/w,附/v,、/w,主体/n,函数/n,全览/nw,def/en, ,get/en,_,vgg/en,_,train/en,(/w,anchor/en,_,scales/en,,/w, ,anchor/en,_,ratios/en,,/w, ,rpn/en,_,feature/en,_,stride/en,,/w, ,rpn/en,_,pre/en,_,topk/en,,/w, ,rpn/en,_,post/en,_,topk/en,,/w, ,rpn/en,_,nms/en,_,thresh/en,,/w, ,rpn/en,_,min/en,_,size/en,,/w, ,rpn/en,_,batch/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,rcnn/en,_,feature/en,_,stride/en,,/w, ,rcnn/en,_,pooled/en,_,size/en,,/w, ,rcnn/en,_,batch/en,_,size/en,,/w, ,rcnn/en,_,batch/en,_,rois/en,,/w, ,rcnn/en,_,fg/en,_,fraction/en,,/w, ,rcnn/en,_,fg/en,_,overlap/en,,/w, ,rcnn/en,_,bbox/en,_,stds/en,)/w,:/w, ,num/en,_,anchors/en, ,=/w, ,len/en,(/w,anchor/en,_,scales/en,)/w, ,*/w, ,len/en,(/w,anchor/en,_,ratios/en,)/w, ,data/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,data/en,"/w,)/w, ,#, ,图片/n,信息/n,：/w,[/w,batch/en,,/w, ,channel/en,,/w, ,height/en,,/w, ,width/en,]/w, ,im/en,_,info/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,im/en,_,info/en,"/w,)/w, ,gt/en,_,boxes/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,gt/en,_,boxes/en,"/w,)/w, ,#, ,真实/a,框/q,信息/n,：/w,[/w,obj/en,数量/n,,/w, ,5/m,]/w, ,#, ,anchor/en,标签/n,：/w,-/w,1/m,、/w,0/m,、/w,1/m, ,(/w,无效/v,、/w,背景/n,、/w,目标/n,)/w, ,rpn/en,_,label/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,'/w,label/en,'/w,)/w, ,#, ,[/w,batch/en,,/w, ,2/m,,/w, ,中心点/nz,行数/n,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,根据/p,初始/b,anchor/en,和/c,ground/en, ,truth/en,计算/v,出来/v,的/u,offset/en, ,rpn/en,_,bbox/en,_,target/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,'/w,bbox/en,_,target/en,'/w,)/w, ,#, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,mask/en,，/w,如果/c,anchor/en,标签/n,是/v,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,1/m,，/w,anchor/en,标签/n,是/v,0/m,或/c,-/w,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,0/m, ,rpn/en,_,bbox/en,_,weight/en, ,=/w, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,'/w,bbox/en,_,weight/en,'/w,)/w, ,#, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,shared/en, ,convolutional/en, ,layers/en, ,conv/en,_,feat/en, ,=/w, ,get/en,_,vgg/en,_,feature/en,(/w,data/en,)/w, ,#, ,rpn/en, ,layers/en, ,rpn/en,_,conv/en, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,conv/en,_,feat/en,,/w, ,kernel/en,=/w,(/w,3/m,,/w, ,3/m,)/w,,/w, ,pad/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,num/en,_,filter/en,=/w,512/m,,/w, ,name/en,=/w,"/w,rpn/en,_,conv/en,_,3/m,x/en,3/m,"/w,)/w, ,rpn/en,_,relu/en, ,=/w, ,mx/en,./w,symbol/en,./w,activation/en,(/w,data/en,=/w,rpn/en,_,conv/en,,/w, ,act/en,_,type/en,=/w,"/w,relu/en,"/w,,/w, ,name/en,=/w,"/w,rpn/en,_,relu/en,"/w,)/w, ,#, ,rpn/en, ,classification/en,:/w, ,obj/en, ,//w, ,not/en,_,obj/en, ,#, ,[/w,batch/en,,/w, ,2/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,cls/en,_,score/en, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,rpn/en,_,relu/en,,/w, ,kernel/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,pad/en,=/w,(/w,0/m,,/w, ,0/m,)/w,,/w, ,num/en,_,filter/en,=/w,2/m, ,*/w, ,num/en,_,anchors/en,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,score/en,"/w,)/w, ,#, ,[/w,batch/en,,/w, ,2/m,,/w, ,中心点/nz,行数/n,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,cls/en,_,score/en,_,reshape/en, ,=/w, ,mx/en,./w,symbol/en,./w,reshape/en,(/w, ,data/en,=/w,rpn/en,_,cls/en,_,score/en,,/w, ,shape/en,=/w,(/w,0/m,,/w, ,2/m,,/w, ,-/w,1/m,,/w, ,0/m,)/w,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,score/en,_,reshape/en,"/w,)/w, ,#, ,获取/v,交叉/vn,熵/g,回/v,传/v,梯度/n,，/w,对于/p,出现/v,了/u,-/w,1/m,的/u,图片/n,梯度/n,直接/ad,全部/m,置/v,为/p,0/m, ,#, ,在/p,faster/en, ,rcnn/en,算法/n,中/f,，/w,anchor/en,一共/d,有/v,3种/mq,标签/n,：/w,-/w,1/m,、/w,0/m,、/w,1/m,，/w,分别/d,表示/v,无效/v,、/w,背景/n,、/w,目标/n, ,rpn/en,_,cls/en,_,prob/en, ,=/w, ,mx/en,./w,symbol/en,./w,softmaxoutput/en,(/w,data/en,=/w,rpn/en,_,cls/en,_,score/en,_,reshape/en,,/w, ,label/en,=/w,rpn/en,_,label/en,,/w, ,multi/en,_,output/en,=/w,true/en,,/w, ,normalization/en,=/w,'/w,valid/en,'/w,,/w, ,use/en,_,ignore/en,=/w,true/en,,/w, ,ignore/en,_,label/en,=/w,-/w,1/m,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,prob/en,"/w,)/w, ,#, ,切换/vn,为/p,含/v,//w,不含/v,obj/en,两/m,通道/n,，/w,对/p,每/r,一个/m,anchor/en,是否/v,有/v,obj/en,进行/v,softmax/en,处理/v, ,#, ,[/w,batch/en,,/w, ,2/m,,/w, ,中心点/nz,行数/n,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,cls/en,_,act/en, ,=/w, ,mx/en,./w,symbol/en,./w,softmax/en,(/w, ,data/en,=/w,rpn/en,_,cls/en,_,score/en,_,reshape/en,,/w, ,axis/en,=/w,1/m,,/w, ,name/en,=/w,"/w,rpn/en,_,cls/en,_,act/en,"/w,)/w, ,#, ,[/w,batch/en,，/w, ,2/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,#, ,reshpe/en,方法/n,不同/a,于/p,reshape/en,方法/n,，/w,详情/n,见/v,此/r,方法/n,文档/n, ,rpn/en,_,cls/en,_,act/en,_,reshape/en, ,=/w, ,mx/en,./w,symbol/en,./w,reshape/en,(/w, ,data/en,=/w,rpn/en,_,cls/en,_,act/en,,/w, ,shape/en,=/w,(/w,0/m,,/w, ,2/m, ,*/w, ,num/en,_,anchors/en,,/w, ,-/w,1/m,,/w, ,0/m,)/w,,/w, ,name/en,=/w,'/w,rpn/en,_,cls/en,_,act/en,_,reshape/en,'/w,)/w, ,#, ,rpn/en, ,bbox/en, ,regression/en, ,#, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,rpn/en,_,bbox/en,_,pred/en, ,=/w, ,mx/en,./w,symbol/en,./w,convolution/en,(/w, ,data/en,=/w,rpn/en,_,relu/en,,/w, ,kernel/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,pad/en,=/w,(/w,0/m,,/w, ,0/m,)/w,,/w, ,num/en,_,filter/en,=/w,4/m, ,*/w, ,num/en,_,anchors/en,,/w, ,name/en,=/w,"/w,rpn/en,_,bbox/en,_,pred/en,"/w,)/w, ,#, ,rpn/en,_,bbox/en,_,weight/en,:/w, ,anchor/en,的/u,mask/en,，/w,如果/c,某个/r,anchor/en,的/u,标签/n,是/v,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,1/m,，/w,anchor/en,的/u,标签/n,是/v,0/m,或/c,-/w,1/m,，/w,则/d,mask/en,对应/v,值/n,为/p,0/m, ,#, ,rpn/en,_,bbox/en,_,target/en,:/w, ,根据/p,初始/b,anchor/en,和/c,ground/en, ,truth/en,计算/v,出来/v,的/u,offset/en, ,rpn/en,_,bbox/en,_,loss/en,_, ,=/w, ,rpn/en,_,bbox/en,_,weight/en, ,*/w, ,mx/en,./w,symbol/en,./w,smooth/en,_,l/en,1/m,(/w,name/en,=/w,'/w,rpn/en,_,bbox/en,_,loss/en,_,'/w,,/w, ,scalar/en,=/w,3.0/m,,/w, ,data/en,=/w,(/w,rpn/en,_,bbox/en,_,pred/en, ,-/w, ,rpn/en,_,bbox/en,_,target/en,)/w,)/w, ,#, ,获取/v,回归/v,梯度/n, ,#, ,grad/en,_,scale/en,:/w, ,表示/v,回归/v,损失/n,占/v,rpn/en,网络/n,总/b,损失/n,比/p,，/w,该/r,参数/n,相差/v,几/m,个/q,量级/n,对/p,结果/n,影响/vn,也/d,不/d,大/a, ,rpn/en,_,bbox/en,_,loss/en, ,=/w, ,mx/en,./w,sym/en,./w,makeloss/en,(/w,name/en,=/w,'/w,rpn/en,_,bbox/en,_,loss/en,'/w,,/w, ,data/en,=/w,rpn/en,_,bbox/en,_,loss/en,_,,/w, ,grad/en,_,scale/en,=/w,1.0/m, ,//w, ,rpn/en,_,batch/en,_,rois/en,)/w, ,#, ,rpn/en, ,proposal/en, ,#, ,获取/v,指定/v,数目/n,的/u,候选框/nw,proposal/en, ,#, ,[/w,2000个/m,候选框/nw,,/w, ,5个/m,属性/n,]/w, ,#, ,5个/m,属性/n,:/w, ,batch/en,中/f,图片/n,index/en,，/w,4个/m,坐标/n, ,rois/en, ,=/w, ,mx/en,./w,symbol/en,./w,contrib/en,./w,multiproposal/en,(/w, ,cls/en,_,prob/en,=/w,rpn/en,_,cls/en,_,act/en,_,reshape/en,,/w, ,#, ,cls/en,_,prob/en,:/w, ,[/w,batch/en,，/w, ,2/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,bbox/en,_,pred/en,=/w,rpn/en,_,bbox/en,_,pred/en,,/w, ,#, ,bbox/en,_,pred/en,:/w, ,[/w,batch/en,,/w, ,4/m,*/w,每个/r,位置/n,anchors/en,数目/n,,/w, ,中心点/nz,行数/n,,/w, ,中心点/nz,列数/nw,]/w, ,im/en,_,info/en,=/w,im/en,_,info/en,,/w, ,#, ,mx/en,./w,symbol/en,./w,variable/en,(/w,name/en,=/w,"/w,im/en,_,info/en,"/w,)/w, ,feature/en,_,stride/en,=/w,rpn/en,_,feature/en,_,stride/en,,/w, ,#, ,16/m, ,scales/en,=/w,anchor/en,_,scales/en,,/w, ,ratios/en,=/w,anchor/en,_,ratios/en,,/w, ,#, ,(/w,0.5/m,,/w, ,1/m,,/w, ,2/m,)/w, ,rpn/en,_,pre/en,_,nms/en,_,top/en,_,n/en,=/w,rpn/en,_,pre/en,_,topk/en,,/w, ,#, ,12000/m,，/w,对/p,rpn/en,网络/n,输出/v,的/u,anchor/en,进行/v,nms/en,操作/v,之前/f,的/u,proposal/en,最/d,大/a,数量/n, ,#, ,输入/v,proposal/en,的/u,数量/n,大于/v,12000时/t,，/w,对/p,这些/r,proposal/en,的/u,预测/v,为/p,foreground/en,的/u,概率/n,（/w,也/d,叫/v,score/en,，/w, ,#, ,换句话说/c,就/d,是/v,预测/v,标签/n,为/p,1/m,的/u,概率/n,）/w,从/p,高/a,到/v,低/a,排序/vn,，/w,然后/c,选择/v,前面/f,12000个/m, ,rpn/en,_,post/en,_,nms/en,_,top/en,_,n/en,=/w,rpn/en,_,post/en,_,topk/en,,/w, ,#, ,2000/m,，/w,经过/p,nms/en,过滤/v,之后/f,得到/v,的/u,proposal/en,数量/n, ,threshold/en,=/w,rpn/en,_,nms/en,_,thresh/en,,/w, ,#, ,0.7/m,，/w,是/v,nms/en,算法/n,阈值/n, ,rpn/en,_,min/en,_,size/en,=/w,rpn/en,_,min/en,_,size/en,,/w, ,#, ,16/m, ,name/en, ,=/w, ,'/w,rois/en,'/w, ,)/w, ,#, ,rcnn/en, ,roi/en, ,proposal/en, ,target/en, ,#, ,根据/p,上/f,一步/mq,获取/v,的/u,proposal/en,（/w,即/v,rois/en,）/w,和/c,真实/a,框/q,（/w,gt/en,_,boxes/en,）/w,进行/v,筛选/v, ,#, ,获取/v,128个/m,proposal/en,，/w,对应/v,的/u,128个/m,label/en,，/w,对应/v,的/u,128个/m,真实/a,坐标/n,，/w,128个/m,坐标/n,掩码/nw,（/w,构建/v,损失/n,函数/n,使用/v,）/w, ,group/en, ,=/w, ,mx/en,./w,symbol/en,./w,custom/en,(/w,rois/en,=/w,rois/en,,/w, ,#, ,2000/m,*/w,5/m,的/u,roi/en,信息/n, ,gt/en,_,boxes/en,=/w,gt/en,_,boxes/en,,/w, ,#, ,n/en,*/w,5/m,的/u,ground/en, ,truth/en,信息/n,，/w,n/en,表示/v,object/en,数量/n, ,op/en,_,type/en,=/w,'/w,proposal/en,_,target/en,'/w,,/w, ,num/en,_,classes/en,=/w,num/en,_,classes/en,,/w, ,#, ,num/en,_,classes/en,是/v,实际/n,要/v,分类/vn,的/u,类别/n,数/m,加上/v,背景/n,类/q, ,batch/en,_,images/en,=/w,rcnn/en,_,batch/en,_,size/en,,/w, ,#, ,1/m, ,batch/en,_,rois/en,=/w,rcnn/en,_,batch/en,_,rois/en,,/w, ,#, ,128/m, ,fg/en,_,fraction/en,=/w,rcnn/en,_,fg/en,_,fraction/en,,/w, ,#, ,0.25/m,，/w,正/d,样本/n,所/u,占/v,的/u,比例/n, ,fg/en,_,overlap/en,=/w,rcnn/en,_,fg/en,_,overlap/en,,/w, ,#, ,0.5/m, ,box/en,_,stds/en,=/w,rcnn/en,_,bbox/en,_,stds/en, ,#, ,(/w,0.1/m,,/w, ,0.1/m,,/w, ,0.2/m,,/w, ,0.2/m,)/w, ,)/w, ,rois/en, ,=/w, ,group/en,[/w,0/m,]/w, ,#, ,rois/en, ,(/w,128/m,,/w, ,5/m,)/w, ,label/en, ,=/w, ,group/en,[/w,1/m,]/w, ,#, ,roi/en,对应/v,的/u,标签/n,（/w,128/m,）/w, ,bbox/en,_,target/en, ,=/w, ,group/en,[/w,2/m,]/w, ,#, ,坐标/n,回归/v,的/u,目标/n,，/w,维度/n,是/v,(/w,128/m,,/w,84/m,)/w,,/w, ,其中/r,84/m,来自/v,(/w,20/m,+/w,1/m,)/w,*/w,4/m, ,bbox/en,_,weight/en, ,=/w, ,group/en,[/w,3/m,]/w, ,#, ,坐标/n,回归/v,时候/n,的/u,权重/nz,，/w,维度/n,是/v,(/w,128/m,,/w,84/m,)/w,，/w,对于/p,foreground/en,都/d,是/v,1/m,，/w,对于/p,backgroud/en,都/d,是/v,0/m, ,#, ,rcnn/en, ,roi/en, ,pool/en, ,#, ,[/w,128个/m,候选框/nw,,/w, ,512个/m,通道/n,,/w, ,7行/mq,,/w, ,7列/mq,]/w, ,roi/en,_,pool/en, ,=/w, ,mx/en,./w,symbol/en,./w,roipooling/en,(/w, ,name/en,=/w,'/w,roi/en,_,pool/en,'/w,,/w, ,data/en,=/w,conv/en,_,feat/en,,/w, ,rois/en,=/w,rois/en,,/w, ,pooled/en,_,size/en,=/w,rcnn/en,_,pooled/en,_,size/en,,/w, ,#, ,(/w,7/m,,/w, ,7/m,)/w,，/w,输出/v,大小/n, ,spatial/en,_,scale/en,=/w,1.0/m, ,//w, ,rcnn/en,_,feature/en,_,stride/en, ,#, ,16/m,，/w, ,feat/en,//w,raw/en,_,img/en, ,)/w, ,#, ,rcnn/en, ,top/en, ,feature/en, ,#, ,[/w,128/m,,/w, ,4096/m,]/w,，/w,对/p,每个/r,roi/en,提取/v,最终/d,的/u,vgg/en,特征/n, ,top/en,_,feat/en, ,=/w, ,get/en,_,vgg/en,_,top/en,_,feature/en,(/w,roi/en,_,pool/en,)/w, ,#, ,rcnn/en, ,classification/en, ,#, ,对/p,每个/r,roi/en,进行/v,分类/vn,，/w,并/c,构建/v,损失/n,函数/n, ,cls/en,_,score/en, ,=/w, ,mx/en,./w,symbol/en,./w,fullyconnected/en,(/w,name/en,=/w,'/w,cls/en,_,score/en,'/w,,/w, ,data/en,=/w,top/en,_,feat/en,,/w, ,num/en,_,hidden/en,=/w,num/en,_,classes/en,)/w, ,cls/en,_,prob/en, ,=/w, ,mx/en,./w,symbol/en,./w,softmaxoutput/en,(/w,name/en,=/w,'/w,cls/en,_,prob/en,'/w,,/w, ,data/en,=/w,cls/en,_,score/en,,/w, ,label/en,=/w,label/en,,/w, ,normalization/en,=/w,'/w,batch/en,'/w,)/w, ,#, ,rcnn/en, ,bbox/en, ,regression/en, ,#, ,对/p,每个/r,roi/en,进行/v,回归/v,，/w,并/c,构建/v,损失/n,函数/n, ,bbox/en,_,pred/en, ,=/w, ,mx/en,./w,symbol/en,./w,fullyconnected/en,(/w,name/en,=/w,'/w,bbox/en,_,pred/en,'/w,,/w, ,data/en,=/w,top/en,_,feat/en,,/w, ,num/en,_,hidden/en,=/w,num/en,_,classes/en, ,*/w, ,4/m,)/w, ,bbox/en,_,loss/en,_, ,=/w, ,bbox/en,_,weight/en, ,*/w, ,mx/en,./w,symbol/en,./w,smooth/en,_,l/en,1/m,(/w,name/en,=/w,'/w,bbox/en,_,loss/en,_,'/w,,/w, ,scalar/en,=/w,1.0/m,,/w, ,data/en,=/w,(/w,bbox/en,_,pred/en, ,-/w, ,bbox/en,_,target/en,)/w,)/w, ,bbox/en,_,loss/en, ,=/w, ,mx/en,./w,sym/en,./w,makeloss/en,(/w,name/en,=/w,'/w,bbox/en,_,loss/en,'/w,,/w, ,data/en,=/w,bbox/en,_,loss/en,_,,/w, ,grad/en,_,scale/en,=/w,1.0/m, ,//w, ,rcnn/en,_,batch/en,_,rois/en,)/w, ,#, ,reshape/en, ,output/en, ,#, ,[/w,1/m,,/w, ,128/m,]/w,,/w, ,[/w,1/m,,/w, ,128/m,,/w, ,21/m,]/w,,/w, ,[/w,1/m,,/w, ,128/m,,/w, ,84/m,]/w, ,label/en, ,=/w, ,mx/en,./w,symbol/en,./w,reshape/en,(/w,data/en,=/w,label/en,,/w, 