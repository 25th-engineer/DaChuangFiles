2/m,d/en,图像/n,几何/n,基元/nr,一般/a,的/u,，/w,表示/v,一个/m,2/m,d/en,几何/n,基元/nr,只/d,用/p,两个/m,维度/n,(/w,比如/v,x/en,，/w,y/en,)/w,就/d,可以/v,表示/v,了/u,，/w,但是/c,在/p,计算机/n,视觉/n,研究/vn,中/f,，/w,为了/p,统一/vn,对/p,2/m,d/en,几何/n,基元/nr,的/u,操作/v,（/w,后面/f,讲/v,到/v,的/u,仿射/nw,，/w,透射/v,变换/v,）/w,,/w,一般/a,会/v,以/p,增广/nw,矢量/n,的/u,方式/n,表示/v,几何/n,基元/nr,。/w,齐次/nrf,坐标/n,将/d,原本/d,n/en,维/q,的/u,坐标/n,用/p,一个/m,n/en,+/w,1维/mq,的/u,坐标/n,表示/v,，/w,其/r,两个/m,基本/a,作用/n,为/p,：/w,1/m,./w, ,区分/v,n/en,维/q,空间/n,的/u,点/q,和/c,向量/n,，/w,一个/m,点/q,的/u,第/m,n/en,+/w,1维/mq,为/p,非/h,零值/nw,，/w,而/c,向量/n,的/u,n/en,+/w,1维/mq,为/p,02/m,./w, ,统一/vn,几何/n,基元/nr,的/u,旋转/v,，/w,平移/vn,，/w,拉伸/v,，/w,投影/vn,等/u,操作/v,（/w,只/d,用/p,一个/m,矩阵/n,就/d,可以/v,表示/v,）/w,2/m,d/en,点/q,：/w,2/m,d/en,点/q,的/u,齐次/nrf,坐标/n,表示/v,为/p,：/w,，/w,其中/r,仅/d,在/p,尺度/n,上/f,不同/a,的/u,矢量/n,被/p,视为/v,等同/v,的/u,，/w,被/p,称作/v,为/p,2/m,d/en,投影/vn,空间/n,，/w,其次/c,矢量/n,可以/v,通过/p,除/p,以/p,最后/f,你/r,一个/m,元素/n,来/v,转换/v,为/p,非/h,齐次/nrf,矢量/n,x/en,，/w,即/v,：/w,其中/r,，/w,是/v,增广/nw,矢量/n,，/w,如果/c,最后/f,w/en,为/p,0/m,，/w,则/d,称/v,此/r,点/q,为/p,理想点/nw,或者/c,无穷远点/nt,，/w,它/r,没有/v,等同/v,的/u,非/h,齐次/nrf,表达/v,2/m,d/en,直线/n,：/w,2/m,d/en,直线/n,可以/v,用/p,齐次/nrf,向/p,量/n,表示/v,，/w,其/r,对应/v,的/u,直线/n,方程/n,为/p,：/w,，/w,其/r,规范化/vn,表达/v,为/p,，/w,如果/c, ,l/en, ,=/w, ,(/w,0/m,,/w,0/m,,/w,1/m,)/w,，/w,则/d,包含/v,所有/b,无穷远点/nt,2/m,d/en,圆锥/n,曲线/n,：/w,2/m,d/en,图像/n,变换/v,及/c,示例/n,利用/v,齐次/nrf,坐标/n,，/w,我们/r,可以/v,把/p,统一/vn,2/m,d/en,变换/v,操作/v,平移/vn,变换/v,：/w,，/w,其中/r,i/en,是/v,2/m,x/en,2/m,的/u,单位/n,矩阵/n,旋转/v,变换/v,：/w,放缩/nw,变换/v,（/w,x/en,，/w,y/en,分别/d,放缩/nw,）/w,：/w,仿射/nw,变换/v,：/w,投影/vn,变换/v,：/w,因为/c,而/c,仿射/nw,变换/v,是/v,投影/vn,变化/vn,的/u,子集/n,，/w,所有/b,对/p,2/m,d/en,几何/n,基元/nr,的/u,操作/v,都/d,以/p,用/p,一个/m,3/m,x/en,3/m,的/u,homography/en,表示/v,，/w,这样一来/l,对/p,图像/n,的/u,多次/m,2/m,d/en,变换/v,就/d,相当/d,于/p,图像/n,对/p,多/a,个/q,homography/en,矩阵/n,的/u,乘积/n,，/w,即/v,r/en, ,=/w, ,h/en,1/m,*/w,h/en,2/m,*/w,h/en,3/m,./w,./w,./w,hn/en,*/w,r/en,我们/r,用/p,python/en,代码/n,表示/v,这个/r,过程/n,1/m, ,import/en, ,numpy/en, ,as/en, ,np/en, ,2/m, ,import/en, ,cv/en,2/m, ,as/en, ,cv/en, ,3/m, ,from/en, ,numba/en, ,import/en, ,jit/en, ,4/m, ,import/en, ,matplotlib/en,./w,pyplot/en, ,as/en, ,plt/en, ,5/m, ,from/en, ,matplotlib/en,./w,font/en,_,manager/en, ,import/en, ,fontproperties/en, ,6/m, ,7/m, ,def/en, ,movet/en,(/w,tx/en,,/w, ,ty/en,,/w, ,lastop/en, ,=/w, ,none/en,)/w,-/w,>,np/en,./w,ndarray/en,:/w, ,8/m, ,op/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,1/m,,/w, ,0/m,,/w, ,tx/en,]/w,,/w, ,[/w,0/m,,/w, ,1/m,,/w, ,ty/en,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,1/m,]/w,]/w,,/w, ,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,9/m, ,if/en, ,lastop/en, ,is/en, ,not/en, ,none/en,:/w, ,10/m, ,op/en, ,=/w, ,np/en,./w,dot/en,(/w,op/en,,/w, ,lastop/en,)/w, ,11/m, ,return/en, ,op/en, ,12/m, ,13/m, ,14/m, ,def/en, ,rotatet/en,(/w,r/en,,/w, ,lastop/en, ,=/w, ,none/en,)/w,-/w,>,np/en,./w,ndarray/en,:/w, ,15/m, ,op/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,np/en,./w,cos/en,(/w,r/en,)/w,,/w, ,-/w,np/en,./w,sin/en,(/w,r/en,)/w,,/w, ,0/m,]/w,,/w, ,[/w,np/en,./w,sin/en,(/w,r/en,)/w,,/w, ,np/en,./w,cos/en,(/w,r/en,)/w,,/w, ,0/m,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,1/m,]/w,]/w,,/w, ,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,16/m, ,if/en, ,lastop/en, ,is/en, ,not/en, ,none/en,:/w, ,17/m, ,op/en, ,=/w, ,np/en,./w,dot/en,(/w,op/en,,/w, ,lastop/en,)/w, ,18/m, ,return/en, ,op/en, ,19/m, ,20/m, ,21/m, ,def/en, ,zoomt/en,(/w,rx/en,,/w, ,ry/en,,/w, ,lastop/en, ,=/w, ,none/en,)/w,-/w,>,np/en,./w,ndarray/en,:/w, ,22/m, ,op/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,rx/en,,/w, ,0/m,,/w, ,0/m,]/w,,/w, ,[/w,0/m,,/w, ,ry/en,,/w, ,0/m,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,1/m,]/w,]/w,,/w, ,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,23/m, ,if/en, ,lastop/en, ,is/en, ,not/en, ,none/en,:/w, ,24/m, ,op/en, ,=/w, ,np/en,./w,dot/en,(/w,op/en,,/w, ,lastop/en,)/w, ,25/m, ,return/en, ,op/en, ,26/m, ,27/m, ,def/en, ,transform/en,(/w,imgsrc/en,:/w,np/en,./w,ndarray/en,,/w, ,op/en,)/w,-/w,>,np/en,./w,ndarray/en,:/w, ,28/m, ,h/en,,/w, ,w/en, ,=/w, ,imgsrc/en,./w,shape/en,[/w,:/w,2/m,]/w, ,29/m, ,imgdst/en, ,=/w, ,np/en,./w,zeros/en,(/w,imgsrc/en,./w,shape/en,,/w, ,dtype/en,=/w,imgsrc/en,./w,dtype/en,)/w, ,30/m, ,for/en, ,i/en, ,in/en, ,range/en,(/w,h/en,)/w,:/w, ,31/m, ,v/en,1/m, ,=/w, ,np/en,./w,stack/en,(/w,(/w,np/en,./w,arange/en,(/w,w/en,)/w,,/w, ,np/en,./w,ones/en,(/w,w/en,)/w,*/w,i/en,,/w, ,np/en,./w,ones/en,(/w,w/en,)/w,)/w,,/w,axis/en,=/w,-/w,1/m,)/w, ,32/m, ,v/en,2/m, ,=/w, ,np/en,./w,dot/en,(/w,v/en,1/m,,/w, ,op/en,)/w, ,33/m, ,tpx/en,,/w, ,tpy/en,,/w, ,tpz/en, ,=/w, ,np/en,./w,hsplit/en,(/w,v/en,2/m,,/w, ,3/m,)/w, ,34/m, ,for/en, ,iy/en,,/w, ,ix/en,,/w, ,iz/en,,/w, ,j/en, ,in/en, ,zip/en,(/w,tpy/en,,/w, ,tpx/en,,/w, ,tpz/en,,/w, ,range/en,(/w,w/en,)/w,)/w,:/w, ,35/m, ,py/en,,/w, ,px/en, ,=/w, ,int/en,(/w,iy/en,//w,iz/en,)/w,,/w, ,int/en,(/w,ix/en,//w,iz/en,)/w, ,36/m, ,if/en, ,0/m,</w,=/w, ,py/en, ,</w, ,h/en, ,and/en, ,0/m, ,</w,=/w, ,px/en, ,</w, ,w/en,:/w, ,37/m, ,imgdst/en,[/w,int/en,(/w,py/en,)/w,,/w, ,int/en,(/w,px/en,)/w,]/w, ,=/w, ,imgsrc/en,[/w,i/en,,/w, ,j/en,]/w, ,38/m, ,39/m, ,return/en, ,imgdst/en,1/m, ,if/en, ,_,_,name/en,_,_, ,=/w,=/w, ,"/w,_,_,main/en,_,_,"/w,:/w, ,2/m, ,font/en,_,set/en, ,=/w, ,fontproperties/en,(/w,fname/en,=/w,r/en,"/w,c/en,:/w,\/w,windows/en,\/w,fonts/en,\/w,msyh/en,./w,ttc/en,"/w,,/w, ,size/en,=/w,12/m,)/w, ,3/m, ,imgsrc/en, ,=/w, ,plt/en,./w,imread/en,(/w,"/w,e/en,:/w,//w,users/en,//w,administrator/en,//w,pictures/en,//w,test/en,//w,user/en,./w,jpg/en,"/w,)/w, ,4/m, ,op/en, ,=/w, ,np/en,./w,transpose/en,(/w,movet/en,(/w,10/m,,/w,30/m,,/w, ,rotatet/en,(/w,np/en,./w,pi/en,//w,12/m,,/w, ,zoomt/en,(/w,1.1/m,,/w, ,1.2/m,)/w,)/w,)/w,)/w, ,5/m, ,6/m, ,imgdst/en, ,=/w, ,transform/en,(/w,imgsrc/en,,/w, ,op/en,)/w, ,7/m, ,plt/en,./w,figure/en,(/w,1/m,)/w,,/w, ,plt/en,./w,imshow/en,(/w,imgdst/en,)/w,,/w, ,plt/en,./w,title/en,(/w,"/w,resuult/en,"/w,,/w, ,fontproperties/en,=/w,font/en,_,set/en,)/w, ,8/m, ,plt/en,./w,show/en,(/w,)/w,我们/r,对/p,图/n,进行/v,了/u,如下/v,操作/v,：/w,1/m,./w, ,对/p,y/en,尺度/n,放大/v,1.1倍/mq,，/w,x/en,尺度/n,放大/v,1.2倍/mq,2/m,./w, ,绕/v,z/en,轴/q,（/w,垂直/v,于/p,x/en,,/w,y/en,）/w,旋转/v,π/w,//w,12度/mq,3/m,./w, ,x/en,方向/n,移动/vn,30/m,像素/n,，/w,y/en,方向/n,移动/vn,10/m,像素/n,fig/en,1/m,:/w, ,原图/nz,fig/en,2/m,:/w, ,仿射/nw,变换/v,结果/n,可以/v,看到/v,这个/r,结果/n,并/c,不/d,是/v,很/d,好/a,，/w,在/p,结果/n,中/f,发现/v,一些/m,很/d,明显/a,的/u,空洞/a,，/w,因为/c,我们/r,对/p,图像/n,进行/v,了/u,放大/v,操作/v,和/c,旋转/v,操作/v,，/w,在/p,这/r,一个/m,过程/n,中/f,结果/n,图像/n,的/u,有/v,一些/m,像素/n,的/u,值/n,并/c,不能/v,从/p,仿射/nw,变换/v,中/f,得出/v,，/w,从而/c,形成/v,空洞/a,，/w,可见/v,直接/ad,直接/ad,对/p,图像/n,进行/v,正/d,向/p,变换/v,效果/n,是/v,不好/a,的/u,。/w,下面/f,我们/r,将/d,会/v,看到/v,利用/v,反向/f,变换/v,+/w,插值/nw,的/u,方法/n,解决/v,空洞/a,的/u,问题/n,。/w,利用/v,透射/v,变换/v,来/v,进行/v,倾斜/v,校正/v,透射/v,变换/v,的/u,一个/m,应用/vn,就/d,是/v,拿/v,来/v,校正/v,图像/n,，/w,原理/n,很/d,简单/a,，/w,就是/d,把/p,根据/p,关键点/n,找到/v,变换/v,矩阵/n,假如/c,使用/v,矩阵/n,，/w,并且/c,设/v,h/en,33/m, ,=/w, ,1/m,，/w,那么/r,就要/d,把/p,剩下/v,的/u,8个/m,参数/n,给/p,解/v,出来/v,，/w,8个/m,未知数/n,需要/v,8个/m,方程/n,，/w,又/d,因为/c,从/p,仿射/nw,变换/v,的/u,对应/v,关系/n,，/w,可以/v,列/v,方程/n,为/p,：/w,也就是说/l,只要/c,找/v,8个点/mq,的/u,以及/c,其/r,两两/m,对应/v,关系/n,，/w,就/d,可以/v,找到/v,透射/v,变换/v,的/u,矩阵/n,，/w,也/d,就/d,可以/v,对/p,图像/n,进行/v,校正/v,了/u,透射/v,变换/v,有/v,放缩/nw,和/c,旋转/v,等/u,操作/v,，/w,正如/v,上/f,一/m,小节/n,所/u,说/v,，/w,如果/c,仅/d,使用/v,正/d,向/p,变换/v,，/w,那么/r,肯定/v,会/v,有/v,空洞/a,现象/n,的/u,发生/v,。/w,如果/c,使用/v,反向/f,变换/v,，/w,那么/r,这个/r,问题/n,也/d,就/d,迎刃而解/i,了/u,，/w,我们/r,要/v,做/v,的/u,就/d,是/v,扫描/v,反向/f,变换/v,的/u,位置/n,，/w,在/p,这里/r,我们/r,可以/v,采用/v,原/b,图像/n,正/d,向/p,变换/v,后/f,上下/f,左右/m,的/u,边界点/nz,确定/v,扫描/v,区域/n,，/w,然后/c,一个/m,一个/m,点/q,反向/f,变换/v,回/v,原/b,图像/n,中/f,，/w,并/c,根据/p,原/b,图像/n,来/v,进行/v,插值/nw,python/en,代码/n,1/m, ,#, ,warpcorrection/en,./w,py/en, ,2/m, ,3/m, ,@/w,jit/en, ,4/m, ,def/en, ,bilinearinterpolation/en,(/w,imgsrc/en,:/w,np/en,./w,ndarray/en,,/w, ,h/en,,/w, ,w/en,,/w, ,sx/en,:/w,float/en,,/w, ,sy/en,:/w,float/en,)/w,-/w,>,float/en,:/w, ,5/m, ,"/w,"/w,"/w, ,6/m, ,对/p,图片/n,的/u,指定/v,位置/n,做/v,双线性/nw,插值/nw, ,7/m, ,:/w,param/en, ,imgsrc/en,:/w,源/ng,图像/n, ,8/m, ,:/w,param/en, ,h/en,:/w, ,src/en,的/u,高度/d, ,9/m, ,:/w,param/en, ,w/en,:/w, ,src/en,的/u,宽度/n, ,10/m, ,:/w,param/en, ,sx/en,:/w, ,x/en,位置/n, ,11/m, ,:/w,param/en, ,sy/en,:/w, ,y/en,位置/n, ,12/m, ,:/w,return/en,:/w, ,所/u,插入/v,的/u,值/n, ,13/m, ,"/w,"/w,"/w, ,14/m, ,intsx/en,,/w, ,intsy/en, ,=/w, ,int/en,(/w,sx/en,)/w,,/w, ,int/en,(/w,sy/en,)/w, ,15/m, ,if/en, ,0/m, ,</w,=/w, ,intsx/en, ,</w, ,w/en, ,-/w, ,1/m, ,and/en, ,0/m, ,</w,=/w, ,intsy/en, ,</w, ,h/en, ,-/w, ,1/m,:/w, ,16/m, ,x/en,1/m,,/w, ,x/en,2/m, ,=/w, ,intsx/en,,/w, ,intsx/en, ,+/w, ,1/m, ,17/m, ,y/en,1/m,,/w, ,y/en,2/m, ,=/w, ,intsy/en,,/w, ,intsy/en, ,+/w, ,1/m, ,18/m, ,h/en,1/m, ,=/w, ,np/en,./w,dot/en,(/w,np/en,./w,array/en,(/w,[/w,x/en,2/m, ,-/w, ,sx/en,,/w, ,sx/en, ,-/w, ,x/en,1/m,]/w,)/w,,/w, ,imgsrc/en,[/w,y/en,1/m,:/w, ,y/en,2/m, ,+/w, ,1/m,,/w, ,x/en,1/m,:/w,x/en,2/m, ,+/w, ,1/m,]/w,)/w, ,19/m, ,return/en, ,h/en,1/m,[/w,0/m,]/w,*/w,(/w,y/en,2/m, ,-/w, ,sy/en,)/w, ,+/w, ,h/en,1/m,[/w,1/m,]/w,*/w,(/w,sy/en, ,-/w, ,y/en,1/m,)/w, ,20/m, ,else/en,:/w, ,21/m, ,return/en, ,imgsrc/en,[/w,intsy/en,,/w, ,intsx/en,]/w, ,22/m, ,23/m, ,def/en, ,warpcorrection/en,(/w,imgsrc/en,:/w,np/en,./w,ndarray/en,,/w, ,dots/en,:/w,tuple/en,)/w,-/w,>,np/en,./w,ndarray/en,:/w, ,24/m, ,assert/en, ,len/en,(/w,dots/en,)/w, ,=/w,=/w, ,4/m, ,25/m, ,26/m, ,#, ,四个点/mq,的/u,顺序/n,一定/d,要/v,按照/p,左上/f,，/w,右上/f,，/w,右下/f,，/w,左下/nz,的/u,顺时针/nw,顺序/n,点/q, ,27/m, ,d/en,1/m,,/w, ,d/en,2/m,,/w, ,d/en,3/m,,/w, ,d/en,4/m, ,=/w, ,dots/en, ,28/m, ,x/en,1/m,,/w, ,x/en,2/m,,/w, ,x/en,3/m,,/w, ,x/en,4/m, ,=/w, ,d/en,1/m,[/w,0/m,]/w,,/w, ,d/en,2/m,[/w,0/m,]/w,,/w, ,d/en,3/m,[/w,0/m,]/w,,/w, ,d/en,4/m,[/w,0/m,]/w, ,29/m, ,y/en,1/m,,/w, ,y/en,2/m,,/w, ,y/en,3/m,,/w, ,y/en,4/m, ,=/w, ,d/en,1/m,[/w,1/m,]/w,,/w, ,d/en,2/m,[/w,1/m,]/w,,/w, ,d/en,3/m,[/w,1/m,]/w,,/w, ,d/en,4/m,[/w,1/m,]/w, ,30/m, ,assert/en, ,x/en,1/m, ,</w, ,x/en,2/m, ,31/m, ,assert/en, ,x/en,4/m, ,</w, ,x/en,3/m, ,32/m, ,assert/en, ,y/en,1/m, ,</w, ,y/en,4/m, ,33/m, ,assert/en, ,y/en,2/m, ,</w, ,y/en,3/m, ,34/m, ,35/m, ,objw/en, ,=/w, ,np/en,./w,round/en,(/w,np/en,./w,sqrt/en,(/w,(/w,x/en,1/m, ,-/w, ,x/en,2/m,)/w, ,*/w,*/w, ,2/m, ,+/w, ,(/w,y/en,1/m, ,-/w, ,y/en,2/m,)/w, ,*/w,*/w, ,2/m,)/w,)/w, ,36/m, ,objh/en, ,=/w, ,np/en,./w,round/en,(/w,np/en,./w,sqrt/en,(/w,(/w,x/en,2/m, ,-/w, ,x/en,3/m,)/w, ,*/w,*/w, ,2/m, ,+/w, ,(/w,y/en,2/m, ,-/w, ,y/en,3/m,)/w, ,*/w,*/w, ,2/m,)/w,)/w, ,37/m, ,38/m, ,#, ,在/p,这里/r,我/r,简单/a,地/u,设/v,为/p,把/p,所/u,输入/v,的/u,四个点/mq,的/u,位置/n,，/w,通过/p,2/m,d/en,变换/v,，/w,变换/v,为/p,长方形/n,的/u,四个/m,顶点/n,的/u,位置/n,（/w,以/p,x/en,1/m,为/p,起点/n,）/w, ,39/m, ,t/en,1/m,,/w, ,t/en,2/m,,/w, ,t/en,3/m,,/w, ,t/en,4/m, ,=/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,)/w,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m, ,+/w, ,objw/en,)/w,,/w, ,(/w,y/en,1/m, ,+/w, ,objh/en,,/w, ,x/en,1/m, ,+/w, ,objw/en,)/w,,/w, ,(/w,y/en,1/m, ,+/w, ,objh/en,,/w, ,x/en,1/m,)/w,,/w, ,40/m, ,41/m, ,rx/en,1/m,,/w, ,rx/en,2/m,,/w, ,rx/en,3/m,,/w, ,rx/en,4/m, ,=/w, ,t/en,1/m,[/w,1/m,]/w,,/w, ,t/en,2/m,[/w,1/m,]/w,,/w, ,t/en,3/m,[/w,1/m,]/w,,/w, ,t/en,4/m,[/w,1/m,]/w, ,42/m, ,ry/en,1/m,,/w, ,ry/en,2/m,,/w, ,ry/en,3/m,,/w, ,ry/en,4/m, ,=/w, ,t/en,1/m,[/w,0/m,]/w,,/w, ,t/en,2/m,[/w,0/m,]/w,,/w, ,t/en,3/m,[/w,0/m,]/w,,/w, ,t/en,4/m,[/w,0/m,]/w, ,43/m, ,44/m, ,#, ,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,step/en, ,0/m,:/w, ,根据/p, ,8个点/mq,两两/m,对应/v,关系/n,找到/v,homography/en,矩阵/n,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w, ,45/m, ,#, ,把/p,8个/m,约束/vn,写/v,成/v,方程组/n,，/w,以/p,矩阵/n,的/u,形式/n,表达/v, ,46/m, ,m/en, ,=/w, ,np/en,./w,array/en,(/w,[/w, ,47/m, ,[/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,1/m,,/w, ,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,-/w,ry/en,1/m, ,*/w, ,y/en,1/m,,/w, ,-/w,ry/en,1/m, ,*/w, ,x/en,1/m,]/w,,/w, ,48/m, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,y/en,1/m,,/w, ,x/en,1/m,,/w, ,1/m,,/w, ,-/w,rx/en,1/m, ,*/w, ,y/en,1/m,,/w, ,-/w,rx/en,1/m, ,*/w, ,x/en,1/m,]/w,,/w, ,49/m, ,[/w,y/en,2/m,,/w, ,x/en,2/m,,/w, ,1/m,,/w, ,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,-/w,ry/en,2/m, ,*/w, ,y/en,2/m,,/w, ,-/w,ry/en,2/m, ,*/w, ,x/en,2/m,]/w,,/w, ,50/m, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,1/m,,/w, ,-/w,rx/en,2/m, ,*/w, ,y/en,2/m,,/w, ,-/w,rx/en,2/m, ,*/w, ,x/en,2/m,]/w,,/w, ,51/m, ,[/w,y/en,3/m,,/w, ,x/en,3/m,,/w, ,1/m,,/w, ,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,-/w,ry/en,3/m, ,*/w, ,y/en,3/m,,/w, ,-/w,ry/en,3/m, ,*/w, ,x/en,3/m,]/w,,/w, ,52/m, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,y/en,3/m,,/w, ,x/en,3/m,,/w, ,1/m,,/w, ,-/w,rx/en,3/m, ,*/w, ,y/en,3/m,,/w, ,-/w,rx/en,3/m, ,*/w, ,x/en,3/m,]/w,,/w, ,53/m, ,[/w,y/en,4/m,,/w, ,x/en,4/m,,/w, ,1/m,,/w, ,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,-/w,ry/en,4/m, ,*/w, ,y/en,4/m,,/w, ,-/w,ry/en,4/m, ,*/w, ,x/en,4/m,]/w,,/w, ,54/m, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,,/w, ,y/en,4/m,,/w, ,x/en,4/m,,/w, ,1/m,,/w, ,-/w,rx/en,4/m, ,*/w, ,y/en,4/m,,/w, ,-/w,rx/en,4/m, ,*/w, ,x/en,4/m,]/w,,/w, ,55/m, ,]/w,)/w, ,56/m, ,57/m, ,vectorsrc/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,ry/en,1/m,,/w, ,rx/en,1/m,,/w, ,ry/en,2/m,,/w, ,rx/en,2/m,,/w, ,ry/en,3/m,,/w, ,rx/en,3/m,,/w, ,ry/en,4/m,,/w, ,rx/en,4/m,]/w,)/w, ,58/m, ,vectorsrc/en,./w,shape/en, ,=/w, ,(/w,1/m,,/w, ,8/m,)/w, ,59/m, ,hflat/en, ,=/w, ,np/en,./w,dot/en,(/w,np/en,./w,linalg/en,./w,inv/en,(/w,m/en,)/w,,/w, ,np/en,./w,transpose/en,(/w,vectorsrc/en,)/w,)/w, ,60/m, ,a/en,,/w, ,b/en,,/w, ,c/en,,/w, ,d/en,,/w, ,e/en,,/w, ,f/en,,/w, ,g/en,,/w, ,h/en, ,=/w, ,hflat/en,[/w,0/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,1/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,2/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,3/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,4/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,5/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,6/m,,/w, ,0/m,]/w,,/w,hflat/en,[/w,7/m,,/w, ,0/m,]/w, ,61/m, ,62/m, ,h/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,a/en,,/w, ,b/en,,/w, ,c/en,]/w,,/w, ,63/m, ,[/w,d/en,,/w, ,e/en,,/w, ,f/en,]/w,,/w, ,64/m, ,[/w,g/en,,/w, ,h/en,,/w, ,1/m,]/w,]/w,,/w, ,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,65/m, ,66/m, ,#, ,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,step/en, ,1/m,:/w, ,通过/p,对/p,原/b,图像/n,四个/m,顶点/n,进行/v,正/d,向/p,投射/v,变换/v,，/w,确定/v,目标/n,图像/n,区域/n,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w, ,67/m, ,height/en,,/w, ,width/en, ,=/w, ,imgsrc/en,./w,shape/en,[/w,:/w,2/m,]/w, ,68/m, ,matrixoriginvertex/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,0/m,,/w, ,0/m,,/w, ,1/m,]/w,,/w, ,69/m, ,[/w,0/m,,/w, ,width/en, ,-/w, ,1/m,,/w, ,1/m,]/w,,/w, ,70/m, ,[/w,height/en, ,-/w, ,1/m,,/w, ,width/en, ,-/w, ,1/m,,/w, ,1/m,]/w, ,,/w, ,71/m, ,[/w,height/en, ,-/w, ,1/m,,/w, ,0/m,,/w, ,1/m,]/w,]/w,)/w, ,72/m, ,73/m, ,result/en, ,=/w, ,np/en,./w,dot/en,(/w,matrixoriginvertex/en,,/w, ,np/en,./w,transpose/en,(/w,h/en,)/w,)/w, ,74/m, ,minx/en, ,=/w, ,int/en,(/w,min/en,(/w,result/en,[/w,0/m,,/w, ,1/m,]/w,//w,result/en,[/w,0/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,1/m,,/w, ,1/m,]/w,//w,result/en,[/w,1/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,2/m,,/w, ,1/m,]/w,//w,result/en,[/w,2/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,3/m,,/w, ,1/m,]/w,//w,result/en,[/w,3/m,,/w, ,2/m,]/w,)/w,)/w, ,75/m, ,maxx/en, ,=/w, ,int/en,(/w,max/en,(/w,result/en,[/w,0/m,,/w, ,1/m,]/w,//w,result/en,[/w,0/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,1/m,,/w, ,1/m,]/w,//w,result/en,[/w,1/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,2/m,,/w, ,1/m,]/w,//w,result/en,[/w,2/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,3/m,,/w, ,1/m,]/w,//w,result/en,[/w,3/m,,/w, ,2/m,]/w,)/w,)/w, ,76/m, ,miny/en, ,=/w, ,int/en,(/w,min/en,(/w,result/en,[/w,0/m,,/w, ,0/m,]/w,//w,result/en,[/w,0/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,1/m,,/w, ,0/m,]/w,//w,result/en,[/w,1/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,2/m,,/w, ,0/m,]/w,//w,result/en,[/w,2/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,3/m,,/w, ,0/m,]/w,//w,result/en,[/w,3/m,,/w, ,2/m,]/w,)/w,)/w, ,77/m, ,maxy/en, ,=/w, ,int/en,(/w,max/en,(/w,result/en,[/w,0/m,,/w, ,0/m,]/w,//w,result/en,[/w,0/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,1/m,,/w, ,0/m,]/w,//w,result/en,[/w,1/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,2/m,,/w, ,0/m,]/w,//w,result/en,[/w,2/m,,/w, ,2/m,]/w,,/w, ,result/en,[/w,3/m,,/w, ,0/m,]/w,//w,result/en,[/w,3/m,,/w, ,2/m,]/w,)/w,)/w, ,78/m, ,79/m, ,#, ,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,step/en, ,2/m,:/w, ,反向/f,变换/v,+/w,双/m,二次/mq,插值/nw,校正/v,图像/n,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w,=/w, ,80/m, ,vtr/en, ,=/w, ,np/en,./w,empty/en,(/w,(/w,0/m,,/w,3/m,)/w,,/w,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,81/m, ,for/en, ,i/en, ,in/en, ,range/en,(/w,miny/en,,/w, ,maxy/en,)/w,:/w, ,82/m, ,arr/en,1/m, ,=/w, ,np/en,./w,arange/en,(/w,minx/en,,/w, ,maxx/en,)/w, ,83/m, ,arr/en,2/m, ,=/w, ,np/en,./w,ones/en,(/w,maxx/en, ,-/w, ,minx/en,)/w, ,84/m, ,vt/en,1/m, ,=/w, ,np/en,./w,stack/en,(/w,(/w,arr/en,2/m,*/w,i/en,,/w, ,arr/en,1/m, ,,/w, ,arr/en,2/m,)/w,,/w, ,axis/en,=/w,-/w,1/m,)/w, ,85/m, ,vtr/en, ,=/w, ,np/en,./w,concatenate/en,(/w,(/w,vtr/en,,/w, ,vt/en,1/m,)/w,,/w, ,axis/en,=/w,0/m,)/w, ,86/m, ,87/m, ,#, ,请/v,注意/v,，/w,因为/c,传/v,进去/v,的/u,是/v,规范化/vn,后/f,(/w,y/en,,/w, ,x/en,,/w, ,1/m,)/w,的/u,值/n,，/w,所以/c,得到/v,的/u,其实/d,是/v,(/w,y/en,//w,z/en,,/w, ,x/en,//w,z/en,,/w, ,1/m,//w,z/en,的/u,值/n,)/w, ,88/m, ,vts/en, ,=/w, ,np/en,./w,dot/en,(/w,vtr/en,,/w,np/en,./w,linalg/en,./w,inv/en,(/w,np/en,./w,transpose/en,(/w,h/en,)/w,)/w,)/w, ,89/m, ,dstheight/en,,/w, ,dstwidth/en, ,=/w, ,maxy/en, ,-/w, ,miny/en, ,+/w, ,1/m,,/w, ,maxx/en, ,-/w, ,minx/en, ,+/w, ,1/m, ,90/m, ,imgdst/en, ,=/w, ,np/en,./w,zeros/en,(/w,(/w,dstheight/en,,/w, ,dstwidth/en,,/w, ,imgsrc/en,./w,shape/en,[/w,2/m,]/w,)/w,,/w, ,dtype/en,=/w,imgsrc/en,./w,dtype/en,)/w, ,91/m, ,92/m, ,for/en, ,(/w,r/en,,/w, ,s/en,)/w, ,in/en, ,zip/en,(/w,vtr/en,,/w, ,vts/en,)/w,:/w, ,93/m, ,ry/en,,/w, ,rx/en, ,=/w, ,int/en,(/w,r/en,[/w,0/m,]/w,)/w,,/w, ,int/en,(/w,r/en,[/w,1/m,]/w,)/w, ,94/m, ,iy/en,,/w, ,ix/en, ,=/w, ,s/en,[/w,:/w,2/m,]/w, ,95/m, ,#, ,需要/v,解/v, ,[/w,y/en,,/w, ,x/en,]/w, ,=/w, ,[/w,iy/en,*/w,(/w,g/en,*/w,y/en, ,+/w, ,h/en,*/w,x/en, ,+/w, ,1/m,)/w,,/w, ,ix/en,*/w,(/w,g/en,*/w,y/en, ,+/w, ,h/en,*/w,x/en, ,+/w, ,1/m,)/w,]/w,这个/r,方程/n, ,96/m, ,th/en, ,=/w, ,np/en,./w,linalg/en,./w,inv/en,(/w,np/en,./w,array/en,(/w,[/w,[/w,iy/en, ,*/w, ,g/en, ,-/w, ,1/m,,/w, ,iy/en, ,*/w, ,h/en,]/w,,/w, ,97/m, ,[/w,ix/en, ,*/w, ,g/en,,/w, ,ix/en, ,*/w, ,h/en, ,-/w, ,1/m,]/w,]/w,)/w,)/w, ,98/m, ,99/m, ,vxy/en, ,=/w, ,np/en,./w,dot/en,(/w,th/en,,/w, ,np/en,./w,array/en,(/w,[/w,[/w,-/w,iy/en,]/w,,/w, ,[/w,-/w,ix/en,]/w,]/w,)/w,)/w, ,100/m, ,sy/en,,/w, ,sx/en, ,=/w, ,vxy/en,[/w,0/m,,/w, ,0/m,]/w,,/w, ,vxy/en,[/w,1/m,,/w, ,0/m,]/w, ,101/m, ,102/m, ,if/en, ,0/m, ,</w,=/w, ,round/en,(/w,sy/en,)/w, ,</w, ,height/en, ,and/en, ,0/m, ,</w,=/w, ,round/en,(/w,sx/en,)/w, ,</w, ,width/en,:/w, ,103/m, ,imgdst/en,[/w,ry/en, ,-/w, ,miny/en,,/w, ,rx/en, ,-/w, ,minx/en,]/w, ,=/w, ,bilinearinterpolation/en,(/w,imgsrc/en,,/w, ,height/en,,/w, ,width/en,,/w, ,sx/en,,/w, ,sy/en,)/w, ,104/m, ,105/m, ,return/en, ,imgdst/en,这里/r,使用/v,了/u,双/m,二次/mq,插值/nw,，/w,双/m,二次/mq,插值/nw,的/u,公式/n,推导/vn,如下/v,：/w,fig/en,3/m,./w, ,双/m,二次/mq,插值/nw,公式/n,推导/vn,fig/en,4/m,./w, ,双/m,二次/mq,插值/nw,图像/n,解释/v,上面/f,右图/n,所/u,展示/v,的/u,那样/r,，/w,双/m,二次/mq,插值/nw,其实/d,就/d,是/v,一个/m,加权/v,平均/a,操作/v,，/w,为了/p,和/c,双/m,二次/mq,插值/nw,的/u,效果/n,做/v,对比/v,，/w,我/r,加/v,了/u,个/q,最/d,邻近/v,插值/nw,继续/v,往/p,程序/n,里面/f,加/v,点/q,东西/n,，/w,来/v,测试/vn,下/f,实际/n,效果/n,，/w,在/p,这里/r,我/r,使用/v,了/u,opencv/en,的/u,highgui/en,的/u,包/v,1/m, ,#, ,-/w,*/w,-/w, ,coding/en,:/w, ,utf/en,-/w,8/m, ,-/w,*/w,-/w, ,2/m, ,import/en, ,matplotlib/en,./w,pyplot/en, ,as/en, ,plt/en, ,3/m, ,from/en, ,matplotlib/en,./w,font/en,_,manager/en, ,import/en, ,fontproperties/en, ,4/m, ,from/en, ,warptransform/en, ,import/en, ,*/w, ,5/m, ,from/en, ,multiprocessing/en,./w,dummy/en, ,import/en, ,process/en, ,6/m, ,7/m, ,windowcount/en, ,=/w, ,int/en,(/w,0/m,)/w, ,8/m, ,mainwinname/en, ,=/w, ,"/w,source/en,"/w, ,9/m, ,10/m, ,def/en, ,warpimage/en,(/w,imgsrc/en,:/w,np/en,./w,ndarray/en,,/w, ,dots/en,:/w,tuple/en,,/w, ,count/en,)/w,-/w,>,none/en,:/w, ,11/m, ,imgbliner/en,,/w, ,imgnearest/en, ,=/w, ,warpcorrection/en,(/w,imgsrc/en,,/w, ,dots/en,)/w, ,12/m, ,13/m, ,winname/en,:/w,str/en, ,=/w, ,f/en,"/w,result/en, ,bliner/en, ,{/w,count/en,}/w,"/w, ,14/m, ,cv/en,./w,namedwindow/en,(/w,winname/en,)/w, ,15/m, ,cv/en,./w,imshow/en,(/w,winname/en,,/w, ,imgbliner/en,)/w, ,16/m, ,17/m, ,winname/en,:/w,str/en, ,=/w, ,f/en,"/w,result/en, ,nearest/en, ,{/w,count/en,}/w,"/w, ,18/m, ,cv/en,./w,namedwindow/en,(/w,winname/en,)/w, ,19/m, ,cv/en,./w,imshow/en,(/w,winname/en,,/w, ,imgnearest/en,)/w, ,20/m, ,21/m, ,cv/en,./w,waitkey/en,(/w,0/m,)/w, ,22/m, ,cv/en,./w,destroywindow/en,(/w,winname/en,)/w, ,23/m, ,24/m, ,class/en, ,warpcorrectionmgr/en,:/w, ,25/m, ,def/en, ,_,_,init/en,_,_,(/w,self/en,,/w, ,imgsrc/en,)/w,:/w, ,26/m, ,self/en,./w,_,_,clicktime/en, ,=/w, ,0/m, ,27/m, ,self/en,./w,_,_,imgsrc/en, ,=/w, ,imgsrc/en,./w,copy/en,(/w,)/w, ,28/m, ,self/en,./w,_,_,imgdrawn/en, ,=/w, ,imgsrc/en,./w,copy/en,(/w,)/w, ,29/m, ,self/en,./w,_,_,dots/en, ,=/w, ,[/w,]/w, ,30/m, ,31/m, ,@/w,property/en, ,32/m, ,def/en, ,sourceimage/en,(/w,self/en,)/w,:/w, ,33/m, ,return/en, ,self/en,./w,_,_,imgsrc/en, ,34/m, ,35/m, ,@/w,property/en, ,36/m, ,def/en, ,drawnimage/en,(/w,self/en,)/w,:/w, ,37/m, ,return/en, ,self/en,./w,_,_,imgdrawn/en, ,38/m, ,39/m, ,@/w,drawnimage/en,./w,setter/en, ,40/m, ,def/en, ,drawnimage/en,(/w,self/en,,/w, ,newimg/en,)/w,:/w, ,41/m, ,self/en,./w,_,_,imgdrawn/en, ,=/w, ,newimg/en, ,42/m, ,43/m, ,@/w,property/en, ,44/m, ,def/en, ,clicktime/en,(/w,self/en,)/w,:/w, ,45/m, ,return/en, ,self/en,./w,_,_,clicktime/en, ,46/m, ,47/m, ,@/w,clicktime/en,./w,setter/en, ,48/m, ,def/en, ,clicktime/en,(/w,self/en,,/w, ,v/en,)/w,:/w, ,49/m, ,self/en,./w,_,_,clicktime/en, ,=/w, ,v/en, ,50/m, ,51/m, ,@/w,property/en, ,52/m, ,def/en, ,dots/en,(/w,self/en,)/w,:/w, ,53/m, ,return/en, ,self/en,./w,_,_,dots/en, ,54/m, ,55/m, ,@/w,staticmethod/en, ,56/m, ,def/en, ,mousecallback/en,(/w,event/en,,/w, ,x/en,,/w, ,y/en,,/w, ,flags/en,,/w, ,param/en,)/w,:/w, ,57/m, ,#, ,四个点/mq,的/u,顺序/n,一定/d,要/v,按照/p,左上/f,，/w,右上/f,，/w,右下/f,，/w,左下/nz,的/u,顺时针/nw,顺序/n,点/q, ,58/m, ,if/en, ,event/en, ,=/w,=/w, ,cv/en,./w,event/en,_,lbuttondblclk/en,:/w, ,59/m, ,clicktime/en, ,=/w, ,param/en,./w,clicktime/en, ,60/m, ,cv/en,./w,circle/en,(/w,param/en,./w,drawnimage/en,,/w, ,(/w,x/en,,/w, ,y/en,)/w,,/w, ,8/m,,/w, ,(/w,0/m,,/w, ,0/m,,/w, ,255/m,)/w,,/w,-/w,1/m,)/w, ,61/m, ,param/en,./w,dots/en,./w,append/en,(/w,(/w,x/en,,/w, ,y/en,)/w,)/w, ,62/m, ,cv/en,./w,imshow/en,(/w,mainwinname/en,,/w, ,param/en,./w,drawnimage/en,)/w, ,63/m, ,64/m, ,if/en, ,clicktime/en, ,+/w, ,1/m, ,=/w,=/w, ,4/m,:/w, ,65/m, ,global/en, ,windowcount/en, ,66/m, ,p/en, ,=/w, ,process/en,(/w,target/en,=/w,warpimage/en,,/w, ,args/en,=/w,(/w,param/en,./w,sourceimage/en,,/w, ,param/en,./w,dots/en,./w,copy/en,(/w,)/w,,/w, ,windowcount/en,)/w,)/w, ,67/m, ,p/en,./w,daemon/en, ,=/w, ,true/en, ,68/m, ,p/en,./w,start/en,(/w,)/w, ,69/m, ,70/m, ,param/en,./w,drawnimage/en, ,=/w, ,param/en,./w,sourceimage/en,./w,copy/en,(/w,)/w, ,71/m, ,cv/en,./w,imshow/en,(/w,mainwinname/en,,/w,param/en,./w,sourceimage/en,)/w, ,72/m, ,param/en,./w,dots/en,./w,clear/en,(/w,)/w, ,73/m, ,windowcount/en, ,+/w,=/w, ,1/m, ,74/m, ,75/m, ,param/en,./w,clicktime/en, ,=/w, ,(/w,clicktime/en, ,+/w, ,1/m,)/w, ,%/w, ,4/m, ,76/m, ,77/m, ,78/m, ,if/en, ,_,_,name/en,_,_, ,=/w,=/w, ,"/w,_,_,main/en,_,_,"/w,:/w, ,79/m, ,cv/en,./w,namedwindow/en,(/w,mainwinname/en,)/w, ,80/m, ,imgsrc/en, ,=/w, ,cv/en,./w,imread/en,(/w,"/w,e/en,:/w,//w,users/en,//w,administrator/en,//w,pictures/en,//w,test/en,//w,skew/en,./w,jpg/en,"/w,)/w, ,81/m, ,imgsrc/en, ,=/w, ,cv/en,./w,resize/en,(/w,imgsrc/en,,/w, ,(/w,int/en,(/w,imgsrc/en,./w,shape/en,[/w,1/m,]/w,//w,4/m,)/w,,/w, ,int/en,(/w,imgsrc/en,./w,shape/en,[/w,0/m,]/w,//w,4/m,)/w,)/w,)/w, ,82/m, ,83/m, ,mgr/en, ,=/w, ,warpcorrectionmgr/en,(/w,imgsrc/en,)/w, ,84/m, ,cv/en,./w,setmousecallback/en,(/w,mainwinname/en,,/w, ,warpcorrectionmgr/en,./w,mousecallback/en,,/w, ,mgr/en,)/w, ,85/m, ,86/m, ,cv/en,./w,imshow/en,(/w,mainwinname/en,,/w, ,imgsrc/en,)/w, ,87/m, ,cv/en,./w,waitkey/en,(/w,0/m,)/w, ,88/m, ,cv/en,./w,destroyallwindows/en,(/w,)/w,为了/p,对比/v,最近/t,邻/vg,插值/nw,和/c,双/m,二次/mq,插值/nw,的/u,差别/n,，/w,我/r,把/p,warpcorrection/en,改/v,了/u,一下/m,：/w,#, ,请/v,注意/v,，/w,因为/c,传/v,进去/v,的/u,是/v,规范化/vn,后/f,(/w,y/en,,/w, ,x/en,,/w, ,1/m,)/w,的/u,值/n,，/w,所以/c,得到/v,的/u,其实/d,是/v,(/w,y/en,//w,z/en,,/w, ,x/en,//w,z/en,,/w, ,1/m,//w,z/en,的/u,值/n,)/w, ,vts/en, ,=/w, ,np/en,./w,dot/en,(/w,vtr/en,,/w,np/en,./w,linalg/en,./w,inv/en,(/w,np/en,./w,transpose/en,(/w,h/en,)/w,)/w,)/w, ,dstheight/en,,/w, ,dstwidth/en, ,=/w, ,maxy/en, ,-/w, ,miny/en, ,+/w, ,1/m,,/w, ,maxx/en, ,-/w, ,minx/en, ,+/w, ,1/m, ,imgbliner/en, ,=/w, ,np/en,./w,zeros/en,(/w,(/w,dstheight/en,,/w, ,dstwidth/en,,/w, ,imgsrc/en,./w,shape/en,[/w,2/m,]/w,)/w,,/w, ,dtype/en,=/w,imgsrc/en,./w,dtype/en,)/w, ,imgnearest/en, ,=/w, ,np/en,./w,zeros/en,(/w,(/w,dstheight/en,,/w, ,dstwidth/en,,/w, ,imgsrc/en,./w,shape/en,[/w,2/m,]/w,)/w,,/w, ,dtype/en,=/w,imgsrc/en,./w,dtype/en,)/w, ,for/en, ,(/w,r/en,,/w, ,s/en,)/w, ,in/en, ,zip/en,(/w,vtr/en,,/w, ,vts/en,)/w,:/w, ,ry/en,,/w, ,rx/en, ,=/w, ,int/en,(/w,r/en,[/w,0/m,]/w,)/w,,/w, ,int/en,(/w,r/en,[/w,1/m,]/w,)/w, ,iy/en,,/w, ,ix/en, ,=/w, ,s/en,[/w,:/w,2/m,]/w, ,#, ,需要/v,解/v, ,[/w,y/en,,/w, ,x/en,]/w, ,=/w, ,[/w,iy/en,*/w,(/w,g/en,*/w,y/en, ,+/w, ,h/en,*/w,x/en, ,+/w, ,1/m,)/w,,/w, ,ix/en,*/w,(/w,g/en,*/w,y/en, ,+/w, ,h/en,*/w,x/en, ,+/w, ,1/m,)/w,]/w,这个/r,方程/n, ,th/en, ,=/w, ,np/en,./w,linalg/en,./w,inv/en,(/w,np/en,./w,array/en,(/w,[/w,[/w,iy/en, ,*/w, ,g/en, ,-/w, ,1/m,,/w, ,iy/en, ,*/w, ,h/en,]/w,,/w, ,[/w,ix/en, ,*/w, ,g/en,,/w, ,ix/en, ,*/w, ,h/en, ,-/w, ,1/m,]/w,]/w,)/w,)/w, ,vxy/en, ,=/w, ,np/en,./w,dot/en,(/w,th/en,,/w, ,np/en,./w,array/en,(/w,[/w,[/w,-/w,iy/en,]/w,,/w, ,[/w,-/w,ix/en,]/w,]/w,)/w,)/w, ,sy/en,,/w, ,sx/en, ,=/w, ,vxy/en,[/w,0/m,,/w, ,0/m,]/w,,/w, ,vxy/en,[/w,1/m,,/w, ,0/m,]/w, ,if/en, ,0/m, ,</w,=/w, ,round/en,(/w,sy/en,)/w, ,</w, ,height/en, ,and/en, ,0/m, ,</w,=/w, ,round/en,(/w,sx/en,)/w, ,</w, ,width/en,:/w, ,imgbliner/en,[/w,ry/en, ,-/w, ,miny/en,,/w, ,rx/en, ,-/w, ,minx/en,]/w, ,=/w, ,bilinearinterpolation/en,(/w,imgsrc/en,,/w, ,height/en,,/w, ,width/en,,/w, ,sx/en,,/w, ,sy/en,)/w, ,imgnearest/en,[/w,ry/en, ,-/w, ,miny/en,,/w, ,rx/en, ,-/w, ,minx/en,]/w, ,=/w, ,imgsrc/en,[/w,int/en,(/w,round/en,(/w,sy/en,)/w,)/w,,/w,int/en,(/w,round/en,(/w,sx/en,)/w,)/w,]/w, ,return/en, ,imgbliner/en,,/w, ,imgnearest/en,运行/vn,下/f,程序/n,来/v,看/v,下/f,效果/n,，/w,上面/f,程序/n,的/u,作用/n,就/d,是/v,选中/v,要/v,校正/v,图像/n,的/u,四个角/mq,，/w,然后/c,校正/v,（/w,ps/en,：/w,实际/n,运行/vn,可能/v,会/v,相当/d,慢/a,，/w,我/r,没/d,做/v,优化/v,）/w,原图/nz,fig/en,3/m,./w, ,最近/t,邻/vg,插值/nw,（/w,边缘/n,很/d,粗糙/a,，/w,看/v,“/w,清华大学出版社/nt,”/w,几/m,个/q,字/n,）/w,fig/en,4/m,./w, ,双/m,二次/mq,插值/nw,（/w,毛刺/n,很/d,少/a,，/w,但是/c,图像/n,模糊/a,了/u,）/w,opencv/en,库/n,中/f,warpperspective/en,源代码/n,其实/d,opencv/en,是/v,带/v,了/u,仿射/nw,变换/v,和/c,透射/v,变换/v,的/u,api/en,的/u,，/w,先/d,来/v,看/v,下/f,投影/vn,变换/v,的/u,源码/nw,（/w,在/p,imgwarp/en,./w,cpp/en,）/w,（/w,部分/n,关键/n,代码/n,，/w,assert/en,和/c,ipp/en,优化/v,这里/r,不/d,展示/v,了/u,）/w,：/w,1/m, ,void/en, ,cv/en,:/w,:/w,warpperspective/en,(/w, ,inputarray/en, ,_,src/en,,/w, ,outputarray/en, ,_,dst/en,,/w, ,inputarray/en, ,_,m/en,0/m,,/w, ,2/m, ,size/en, ,dsize/en,,/w, ,int/en, ,flags/en,,/w, ,int/en, ,bordertype/en,,/w, ,const/en, ,scalar/en,&/w, ,bordervalue/en, ,)/w, ,3/m, ,{/w, ,4/m, ,mat/en, ,src/en, ,=/w, ,_,src/en,./w,getmat/en,(/w,)/w,,/w, ,m/en,0/m, ,=/w, ,_,m/en,0/m,./w,getmat/en,(/w,)/w,;/w, ,5/m, ,_,dst/en,./w,create/en,(/w, ,dsize/en,./w,area/en,(/w,)/w, ,=/w,=/w, ,0/m, ,?/w, ,src/en,./w,size/en,(/w,)/w, ,:/w, ,dsize/en,,/w, ,src/en,./w,type/en,(/w,)/w, ,)/w,;/w, ,6/m, ,mat/en, ,dst/en, ,=/w, ,_,dst/en,./w,getmat/en,(/w,)/w,;/w, ,7/m, ,8/m, ,if/en,(/w, ,dst/en,./w,data/en, ,=/w,=/w, ,src/en,./w,data/en, ,)/w, ,9/m, ,src/en, ,=/w, ,src/en,./w,clone/en,(/w,)/w,;/w, ,10/m, ,11/m, ,double/en, ,m/en,[/w,9/m,]/w,;/w, ,12/m, ,mat/en, ,matm/en,(/w,3/m,,/w, ,3/m,,/w, ,cv/en,_,64/m,f/en,,/w, ,m/en,)/w,;/w, ,13/m, ,int/en, ,interpolation/en, ,=/w, ,flags/en, ,&/w, ,inter/en,_,max/en,;/w, ,14/m, ,15/m, ,//w,//w, ,插入/v,方法/n,不/d,支持/v,inter/en,_,area/en,，/w,用/p,inter/en,_,linear/en,代替/v, ,16/m, ,if/en,(/w, ,interpolation/en, ,=/w,=/w, ,inter/en,_,area/en, ,)/w, ,17/m, ,interpolation/en, ,=/w, ,inter/en,_,linear/en,;/w, ,18/m, ,19/m, ,cv/en,_,assert/en,(/w, ,(/w,m/en,0/m,./w,type/en,(/w,)/w, ,=/w,=/w, ,cv/en,_,32/m,f/en, ,|/w,|/w, ,m/en,0/m,./w,type/en,(/w,)/w, ,=/w,=/w, ,cv/en,_,64/m,f/en,)/w, ,&/w,&/w, ,m/en,0/m,./w,rows/en, ,=/w,=/w, ,3/m, ,&/w,&/w, ,m/en,0/m,./w,cols/en, ,=/w,=/w, ,3/m, ,)/w,;/w, ,20/m, ,m/en,0/m,./w,convertto/en,(/w,matm/en,,/w, ,matm/en,./w,type/en,(/w,)/w,)/w,;/w, ,21/m, ,22/m, ,//w,//w,这里/r,源码/nw,是/v,这样/r,操作/v,的/u,，/w,如果/c,可以/v,执行/v,ipp/en,，/w,那么/r,就/d,直接/ad,执行/v,ipp/en,指令/n,加块/nr,操作/v, ,23/m, ,//w,//w,如果/c,没有/v,说明/v,传入/v,的/u,变换/v,矩阵/n,已经/d,转置/nw,过/u,了/u,，/w,那么/r,执行/v,一次/mq,矩阵/n,转置/nw, ,24/m, ,if/en,(/w, ,!/w,(/w,flags/en, ,&/w, ,warp/en,_,inverse/en,_,map/en,)/w, ,)/w, ,25/m, ,invert/en,(/w,matm/en,,/w, ,matm/en,)/w,;/w, ,26/m, ,27/m, ,hal/en,:/w,:/w,warpperspectve/en,(/w,src/en,./w,type/en,(/w,)/w,,/w, ,src/en,./w,data/en,,/w, ,src/en,./w,step/en,,/w, ,src/en,./w,cols/en,,/w, ,src/en,./w,rows/en,,/w, ,dst/en,./w,data/en,,/w, ,dst/en,./w,step/en,,/w, ,dst/en,./w,cols/en,,/w, ,dst/en,./w,rows/en,,/w, ,28/m, ,matm/en,./w,ptr/en,</w,double/en,>,(/w,)/w,,/w, ,interpolation/en,,/w, ,bordertype/en,,/w, ,bordervalue/en,./w,val/en,)/w,;/w, ,29/m, ,}/w,1/m, ,namespace/en, ,hal/en, ,{/w, ,2/m, ,3/m, ,void/en, ,warpperspectve/en,(/w,int/en, ,src/en,_,type/en,,/w, ,4/m, ,const/en, ,uchar/en, ,*/w, ,src/en,_,data/en,,/w, ,size/en,_,t/en, ,src/en,_,step/en,,/w, ,int/en, ,src/en,_,width/en,,/w, ,int/en, ,src/en,_,height/en,,/w, ,5/m, ,uchar/en, ,*/w, ,dst/en,_,data/en,,/w, ,size/en,_,t/en, ,dst/en,_,step/en,,/w, ,int/en, ,dst/en,_,width/en,,/w, ,int/en, ,dst/en,_,height/en,,/w, ,6/m, ,const/en, ,double/en, ,m/en,[/w,9/m,]/w,,/w, ,int/en, ,interpolation/en,,/w, ,int/en, ,bordertype/en,,/w, ,const/en, ,double/en, ,bordervalue/en,[/w,4/m,]/w,)/w, ,7/m, ,{/w, ,8/m, ,mat/en, ,src/en,(/w,size/en,(/w,src/en,_,width/en,,/w, ,src/en,_,height/en,)/w,,/w, ,src/en,_,type/en,,/w, ,const/en,_,cast/en,</w,uchar/en,*/w,>,(/w,src/en,_,data/en,)/w,,/w, ,src/en,_,step/en,)/w,;/w, ,9/m, ,mat/en, ,dst/en,(/w,size/en,(/w,dst/en,_,width/en,,/w, ,dst/en,_,height/en,)/w,,/w, ,src/en,_,type/en,,/w, ,dst/en,_,data/en,,/w, ,dst/en,_,step/en,)/w,;/w, ,10/m, ,11/m, ,range/en, ,range/en,(/w,0/m,,/w, ,dst/en,./w,rows/en,)/w,;/w, ,12/m, ,warpperspectiveinvoker/en, ,invoker/en,(/w,src/en,,/w, ,dst/en,,/w, ,m/en,,/w, ,interpolation/en,,/w, ,bordertype/en,,/w, ,scalar/en,(/w,bordervalue/en,[/w,0/m,]/w,,/w, ,bordervalue/en,[/w,1/m,]/w,,/w, ,bordervalue/en,[/w,2/m,]/w,,/w, ,bordervalue/en,[/w,3/m,]/w,)/w,)/w,;/w, ,13/m, ,14/m, ,//w,//w,这里/r,是/v,一个/m,opencv/en,执行/v,并行/v,处理/v,的/u,一个/m,方法/n,，/w,真正/d,执行/v,处理/v,的/u,代码/n,在/p,warpperspectiveinvoker/en,的/u,函数/n,对象/n,操作符/n,中/f, ,15/m, ,parallel/en,_,for/en,_,(/w,range/en,,/w, ,invoker/en,,/w, ,dst/en,./w,total/en,(/w,)/w,//w,(/w,double/en,)/w,(/w,1/m,</w,</w,16/m,)/w,)/w,;/w, ,16/m, ,}/w, ,17/m, ,18/m, ,}/w, ,//w,//w, ,hal/en,:/w,:/w,1/m, ,class/en, ,warpperspectiveinvoker/en, ,:/w, ,2/m, ,public/en, ,parallelloopbody/en, ,3/m, ,{/w, ,4/m, ,public/en,:/w, ,5/m, ,warpperspectiveinvoker/en,(/w,const/en, ,mat/en, ,&/w,_,src/en,,/w, ,mat/en, ,&/w,_,dst/en,,/w, ,const/en, ,double/en, ,*/w,_,m/en,,/w, ,int/en, ,_,interpolation/en,,/w, ,6/m, ,int/en, ,_,bordertype/en,,/w, ,const/en, ,scalar/en, ,&/w,_,bordervalue/en,)/w, ,:/w, ,7/m, ,parallelloopbody/en,(/w,)/w,,/w, ,src/en,(/w,_,src/en,)/w,,/w, ,dst/en,(/w,_,dst/en,)/w,,/w, ,m/en,(/w,_,m/en,)/w,,/w, ,interpolation/en,(/w,_,interpolation/en,)/w,,/w, ,8/m, ,bordertype/en,(/w,_,bordertype/en,)/w,,/w, ,bordervalue/en,(/w,_,bordervalue/en,)/w, ,9/m, ,{/w, ,10/m, ,//w,//w,注意/v,m/en,就/d,是/v,转置/nw,矩阵/n, ,11/m, ,}/w, ,12/m, ,13/m, ,virtual/en, ,void/en, ,operator/en,(/w,)/w, ,(/w,const/en, ,range/en,&/w, ,range/en,)/w, ,const/en, ,14/m, ,{/w, ,15/m, ,const/en, ,int/en, ,block/en,_,sz/en, ,=/w, ,32/m,;/w, ,16/m, ,short/en, ,xy/en,[/w,block/en,_,sz/en,*/w,block/en,_,sz/en,*/w,2/m,]/w,,/w, ,a/en,[/w,block/en,_,sz/en,*/w,block/en,_,sz/en,]/w,;/w, ,17/m, ,int/en, ,x/en,,/w, ,y/en,,/w, ,x/en,1/m,,/w, ,y/en,1/m,,/w, ,width/en, ,=/w, ,dst/en,./w,cols/en,,/w, ,height/en, ,=/w, ,dst/en,./w,rows/en,;/w, ,18/m, ,19/m, ,int/en, ,bh/en,0/m, ,=/w, ,std/en,:/w,:/w,min/en,(/w,block/en,_,sz/en,//w,2/m,,/w, ,height/en,)/w,;/w, ,20/m, ,int/en, ,bw/en,0/m, ,=/w, ,std/en,:/w,:/w,min/en,(/w,block/en,_,sz/en,*/w,block/en,_,sz/en,//w,bh/en,0/m,,/w, ,width/en,)/w,;/w, ,//w,//w,操作/v,块/q,的/u,宽/a, ,21/m, ,bh/en,0/m, ,=/w, ,std/en,:/w,:/w,min/en,(/w,block/en,_,sz/en,*/w,block/en,_,sz/en,//w,bw/en,0/m,,/w, ,height/en,)/w,;/w, ,//w,//w,操作/v,块/q,的/u,高/a, ,22/m, ,23/m, ,//w,//w,下面/f,的/u,意思/n,是/v,，/w,如果/c,支持/v,sse/en,4/m,指令/n,，/w,那么/r,就/d,先/d,对/p,转置/nw,矩阵/n,进行/v,预/d,处理/v,，/w,下面/f,会/v,继续/v,用/p,到/v,这个/r,pwarp/en,_,impl/en,_,sse/en,4/m, ,24/m, ,#,if/en, ,cv/en,_,try/en,_,sse/en,4/m,_,1/m, ,25/m, 