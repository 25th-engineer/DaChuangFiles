1999年 由 David Lowe 首先 发表 于 计算机 视觉 国际 
会议 International Conference on Computer Vision ICCV 2004年 再 次经 
David Lowe/w 整理/n 完善/v 后/f 发表/v 于/p International/w journal of 
computer vision IJCV 截止 2014年 8月 该 论文 单篇 被 
引 次数 达 25000 余次 来自 百科 本 打算 对 
04年 的 论文 进行 翻译 结果 居然 搜到 完整 翻 
译版 虽然 翻译 的 不太好 不过 有 聊胜于无 本文 的 
讲解 大 部分 主要 还是 借鉴 了 最下面 参考文献 8 
的 资料 先 谢过 作者 该 作者 对 opencv 的 
好多 源码 进行 了 分析 很强 啊 先 说 sift 
中 一步 一步 的 的 动机 motivation 对于 普通 的 
图像匹配 来说 都是 平面 物体 比如 放在 这个 桌子 上 
的 书 然后 这本书 放在 另一个 地方 而非 人脸 在 
不断 的 旋转 一下 只能 看到 侧脸 一下 看到 前 
脸 即 sift 的 优点 之处 旋转 缩放 尺度 不变 
的 特性 而 这里 都指的/nr 是 平面 内 而 不是 
平面 外 的 旋转 此 观点 如果 有误 还望 告知 
sift 的 先驱 们 发现 对于 平面 物体 来说 只要 
对 两幅 图像 找到 超过 3对 物体 间 的 匹配 
点 就能 使用 射影几何 进行 对应 而 对于 旋转 的 
缩放 的 图像 如何 建立 稳定 的 关键 点 就是 
关键 了 当然 必须 考虑到 光照 变化 所以 相对来说 比如 
角 点 边缘 亮 区域 中的 暗点 暗区 域中 的 
亮点 等等 这 就是 关键点 检测 ps sift 是 建立 
在 灰度 图上 的 当然 找 关键点 的 方法 就是 
求取 空间 的 极值 可是 对于 只有 离散 值 的 
图像 来说 如何 能够 模拟 连续 值 形式 的 函数 
来 找到 最小值 这是 问题 的 关键 而且 通常 来说 
要求 图像 的 最值 需要 求导 什么 的 而 这都是 
使用 滤波器 的 方法 来 实现 的 可是 对于 不同 
尺度 的 图像 或者 其中 的 物体 来说 同 一个 
尺寸 的 滤波器 滤波 之后 得到 的 极值 有可能 差别 
较大 所以 就 出现 了 金字塔 形状 此 观点 如果 
有误 还望 告知 假设 图像 是 深层 的 那么 不断 
的 不同 大小 的 尺度 的 图中 是 会有 相同 
信息 的 所以 这 可以 看成 是 插值 形式 即 
当前 图像 与 图像 浓缩 成 一个 点 之间 无限 
的 插值 而成 的 不同 尺度 却 内容 相同 的 
图像 序列 可想而知 这时候 关键点 是 有了 可是 杂质 太多 
所以 需要 提纯 所以在 极值 之后 得到 关键点 接着 就 
需要 基于 关键 点 进行 筛选 得到 更 稳定 的 
关键 点 这 就是 关键点 定位 ps 解决 了 缩放 
尺度 的 特性 问题 然后 为了 使得 关键点 更加 稳固 
如果 加上 关键 点 周边 的 信息 一起 作为 其 
特征 那么 就 能 更好 的 建立 特征 空间 这时候 
可以 引入 方向 信息 即 求其 梯度 这样 只要 将 
不同 图片 的 这 一步 的 方向 都 旋转 到 
同一个 方向 那么 就 能够 更好 的 匹配 配了 这样 
就 解决 了 旋转 的 问题 这 就是 方向 确定 
ps 这样 尺度 方向 位置 信息 就都 有了 接下来 就是 
将 上面 的 这些 信息 都 进行 统一 的 描述 
从而 建立 最后 的 sift 特征 这 就是 建立 描述符 
一 原理 分析 1 尺度空间 极值 点 检测 尺度空间 高大 
上 的 词 具体 可 参考 6 7 其实 就是 
对 应着 平时 拍照 时候 摄像头 的 聚焦 过程 产生 
的 清晰 还是 模糊 的 意思 为了 更 直观 先从 
维基 上 找到 的 资料 来 解释 下 什么 是 
尺度空间 当然 这里 指 的 是 计算机 视觉 中的 尺度空间 
对于 一幅 给定 的 图像   它 的 线性 高斯 
尺度空间 就是 由该 图像 与 一个 2 维 高斯 核 
卷积 得到 的     . 其中 卷积 核 如下 
公式 1 其中 为 模糊 半径 的 平方 得到 的 
尺度 空间 为 公式 2 中的 点 表示 只在 变量 
  上 执行 卷积 操作     就是 尺度 参 
数了 是 用来 表示 当前 在 哪个 尺度 级别 上 
进行 卷积 这个 定义     中 限制 了   
不过 可以 看得 出来 计算机 视觉 中 得到 的 都是 
离散 的 间断 的 图像 序列 而 没法 得到 连续 
的 图像 当然 尺度 参数 即为 高斯 过滤器 的 方差 
    如果说   那么 过滤器     就 变成 
一个 脉冲 函数 导致 的 结果 就是     也 
就是 在     这个 级别 的 尺度空间 其实 就是 
图像     自己 随着   的 变大   就是 
针对 图像 上 使用 越来 越大 的 平滑 过滤器 因而会 
移除 越来越 多 图像 内容 的 细节 因为 过滤器 的 
标准差 是   所以 很大 程度 上 明显 小于 该 
值 的 一些 细节 就 会被 忽略 掉 Scale space 
representation     at scale   corresponding to the original 
imageScale space representation     at scaleScale space representation   
  at scaleScale space representation     at scaleScale space 
representation     at scaleScale space representation     at 
scale 说完 了 尺度空间 现在 接着 说 sift 的 第一 
步 极值 点 检测 ps 尺度 是 自然 存在 的 
不是人 为 创造 的 高斯 卷积 只是 表现 尺度 的 
一种 形式 高斯 卷积 也叫做 高斯 平滑 高斯 模糊 通常 
可以 用 来 减少 图像 噪声 以及 降低 细节 层次 
因为 在 实际 应用 中 在 计算 高斯 函数 的 
离散 近似 时 在 大概 3 σ 距离 之外 的 
像素 都 可以 看作 不起作用 这些 像素 的 计算 也 
就 可以 忽略 通常 图像 处理 程序 只 需要 计算 
的 矩阵 就 可以 保证 相关 像素 影响 所以 我们 
先 计算 σ 的 值 然后 通过 该 值 计算出 
所 需要 的 模板 的 大小 然后 对 模板 进行 
归一化 接着 用 其 对 图像 进行 高斯 过滤 比如 
当 方差 为 0.6时 得到 的 就是 5 × 5 
的 高斯 模板 可以 通过 matlab 代码生成 a = fspecial 
gaussian 5 0.6 ps 高斯 模糊 具有 园 对称性 而且是 
线性 可分 的 所以 可以 在 二维 的 图像 上 
对 每 一维 单独 进行 一维 高斯 模糊 来 减少 
计算 量 这 可以 参考 4 中的 2.3 分离 高斯 
模糊 部分 而且 对于 一幅 图像 进行 多 次连续 高斯 
模糊 的 效果 与 一次 更大 的 高斯 模糊 可以 
产生 同样 的 效果 大 的 高斯 模糊 的 半径 
是 所用 多个 高斯 模糊 半径 平方和 的 平方根 比如 
使用 半径 分别为 6 和8的/nr 两次/m 高斯/nr 模糊/a 变换/v 得到/v 
的/uj 效果/n 等/u 于/p 一次/m 半径/n 为/p 10/m 的/uj 高斯/nr 
模糊/a 效果/n 因为 6 ^ 2 + 8 ^ 2 
= 10 ^ 2 所以 使用 多个 连续 较小 的 
高斯 模糊 处理 不 会比 单个 高斯 较大 处理 时间 
少 上面 介绍 了 尺度 空间 和 高斯 模糊 接下来 
就是 介绍 高斯 金字塔 了 通过 构建 多层 的 高斯 
金字塔 来 计算 后续 的 图片 中的 极值 高斯 金字塔 
高斯 金字塔 高斯 金字塔 共 分 O 组 Octave 每组 
又分 层 Layer 组 内 各层 图像 的 分辨率 是 
相同 的 即 长 和宽/nr 相同 但 尺度 逐渐增加 即/v 
越往/nr 塔顶/ns 图像/n 越/d 模糊/a 而下 一组 的 图像 是 
由上 一组 图像 上 一组 倒数第 3张 即 上图 中的 
2组 的 第 0层 是 第一 组 的 上 往下 
数 第 3张 采样 得到 的 按照 隔 点 降 
采样 得到 的 即 图像 的 长 和宽/nr 分别 减半 
高斯 金字塔 的 组 数 O 是由 输入 图像 的 
分辨率 得到 的 因为 要 进行 隔 点 降 采样 
所以 在 执行 降 采样 生成 高斯 金字塔 时 一直 
到 4 * 4 大小 因为 太小 的 图片 也 
没什么 意义 了 其中 组 数 公式 为 公式 3 
其中 X 和Y/nr 分别为 输入 图像 的 长 和宽/nr ⌊ 
⌋ 表示 向下 取整 并且 每组 的 金字塔 的 层数 
为 S = s + 2 + 1   这里 
Lowe 建议 s 为 3 s 为 建议 的 2 
是 为了 不同 组 之间 能够 平滑 过渡 而在 顶部 
加上 的 2层 1 为 最底 的 原始 层 8 
假设 当前 图像 大小 为 512 * 512 则 如下 
操作 上面 公式 中 减 2 是 因为 假设 当前 
图像 即为 输入 图像 而有 的 资料 减 3 是 
因为 他们 把 自然界 作为 第 0组 而 经过 相机 
拍摄 就 成了 第 1组 所以 是 多 减 一次 
当然 了 到底 减 多少 任君 喜欢 这 不是 重点 
这时候 就 需要 依据 当前 图像 建立 自然 场景 的 
第 0 组 图像 了 即用 当前 图像 进行 插值 
得到 例如 上面 那样 的 1024 * 1024 的 一张 
图片 得到 了 组 数 之后 就是 计算 组 内 
尺度 和 组间 尺 度了 记得 这里 是 假设 当前 
得到 的 图片 的 尺度 为 0.5 的 即 第 
1组 的 第 0层 自然界 为 第 0组 即 拍照 
拍到 之后 拿到 的 那张 图片 我们 可以 很 自然 
的 知道 这是/i 有组内/nr 尺度/n 和/c 组间/i 尺度/n 的/uj 对于 
组 内 相邻 的 两幅 图片 来说 公式 4 假设 
这里 的 s 为 小写 的 不是 表示 层数 的 
那个 大 为什么 使用 1/2 这个 可以 看 lowe 的 
论文 1 所以 对于 某一 组 来说 当 s = 
3时 有=s/nr + 2 + 1 = 6幅 图片 即 
0 1 2 3 4 5 而 对于 组间 相邻 
的 尺度 来说 因为 后 一组 是 通过 前 一组 
的 倒数 第 3幅 图 进行 降 采样 得到 的 
即 前 一组 的 第 s 幅 为 将 带入 
得 其为 即 后 一组 的 第 0幅 图为 前 
一组 第 0幅 图 的 2倍 尺度 同时 推出 相邻 
两组 同 一层 的 图像 都是 2倍 尺度 关系 的 
则 总的 尺度 坐标 为 公式 5 其中 o 表示 
第 几组 r 表示 组 内 第几层 在 lowe 的 
论文 中 他 将 第 0层 也 就是 自然 界层 
的 初始 尺度 定义 为 1.6 而 我们 获取 的 
图片 初始 尺度 为 0.5 则 图像 金字塔 第 0层 
的 实际 尺度 为 sqrt 1.6 * 1.6 0.5 * 
0.5 = 1.52 之所以 可以 这么 计算 就是 因为 上面 
高斯 金字塔 之上 的 ps 部分 所述 当然 这 是 
为了 避免 检测 极值 点 之前 就 对 原始 图像 
的 高斯 平滑 以致于 图像 丢失 高频 信息 所以 才 
建议 在 建立 尺度空间 前 首先 对 原始 图像 的 
长宽 扩展 一倍 以 保留 原始 图像 的 信息 也 
就是 我们 之前 说 的 那个 假设 你 获得了 图像 
是 512 * 512 的 那么 就 弄 一个 1024 
* 1024 的 作为 最底层 图 这时候 因为 图像 扩展 
造成 的 尺度 计算 为 即 通过 计算机 得到 的 
真实 尺度 当然 这 一组 在 很多 资料 中 也叫做 
第 1 组 公式 6 本来 对于 关键点 的 检测 
可以   利用 LoG 高斯 拉普拉斯 方法 Laplacian of Gaussian 
即 图像 的 二阶 导数 能够 在 不同 的 尺度 
下 检测 到 图像 的 斑点 特征 从而 可以 确定 
图像 的 特征点 lindeberg 在 文献 scale space theory a 
basic tool for analysising structures at different scales 中 指出 
尺度 规范化 的 log 算子 具有 真正 的 尺度 不变性 
但 LoG 的 效率 不高 所以 sift 不 这么 做 
作者 对 两个 相邻 高斯 尺度空间 的 图像 相减 得到 
一个 DoG 高斯 差分 Difference of Gaussians 的 响应值 图像 
D x y σ 来 近似 LoG 公式 7 两者 
为什么 能够 等效 仔细 的 推导 可以 看 这里 的 
3.4 高斯 差分 金字塔 部分 用 DoG 代替 LoG 并不 
影响 对 图像 斑点 位置 的 检测 而且 用 DoG 
近似 LoG 可以 实现 下列 好处 第一 是 LoG 需要 
使用 两个 方向 的 高斯 二阶 微分 卷积 核 而 
DoG 直接 使用 高斯 卷积 核 省去 了 卷积 核 
生成 的 运算量 第二 是 DoG 保留 了 个 高斯 
尺度空间 的 图像 因此在 生成 某一 空间尺度 的 特征 时 
可以 直接 使用 公式 2 产生 的 尺度空间 图像 而 
无需 重新 再 次 生成 该 尺度 的 图像 第三 
是 DoG 具有 与 LoG 相同 的 性质 即 稳定 
性好 抗干扰 能力 强 为了 在 连续 的 尺度 下 
检测 图像 的 特征点 需要 建立 DoG 金字塔 而 DoG 
金字塔 的 建立 又 离不开 高斯 金字塔 的 建立 如下 
图 所示 左侧 为 高斯 金字塔 右侧 为 DoG 金字塔 
8 高斯 金字塔 的 组 内 相邻 两层 相减 而 
两 组间 的 各层 是 不能 相减 的 因此 高斯 
金字塔 每组 有s+/nr 3 层 图像 而 DoG 金字塔 每组 
则有 s + 2 层 图像 我们 可以 发现 未 
被 利用 到 的 高斯 金字塔 的 第 0组 的 
第 0层 和 最上面 一组 的 最上面 一层 而 dog 
金字塔 的 每组 的 第 0层 和 顶层 未被 用到 
原因 如下 极值 点 的 搜索 是 在 DoG 金字塔 
内 进行 的 这些 极值 点 就是 候选 的 特征点 
在 搜索 之前 我们 需要 在 DoG 金字 塔内 剔除 
那些 像素 值 过小 的 点 因为 这些 像素 具有 
较低 的 对比度 它们 肯定 不是 稳定 的 特征点 极值 
点 的 搜索 不仅 需要 在 它 所在 尺度空间 图像 
的 邻域 内 进行 还 需要 在 它 的 相邻 
尺度空间 图像 内 进行 如 2 关键点 的 定位 从 
上面 的 搜索 中 就 能够 得到 许多 的 极值 
点了 之 所谓 极值 点 就是 都是/nr 一群 待选 的 
点 不是 直接 就 可以 用 的 关键 点 因为 
它们 还 存在 一些 不 确定 的 因素 首先 是 
极值 点 的 搜索 是 在 离散 空间 内 进行 
的 并且 这些 离散 空间 还是 经过 不断 的 降 
采样 得到 的 如果把 采样 点 拟 合成 曲面 后 
我们 会 发现 原先 的 极值 点 并 不是 真正 
的 极值 点 也 就是 离散 空间 的 极值 点 
并 不是 连续 空间 的 极值 点 如 下图 4 
接下来 这 一大 段 都是 来自 参考文献 8 因为 觉得 
该 作者 讲 的 详细 所以 直接 复制 过来 这 
部分 了 为了 提高 关键点 的 稳定性 需要 对 尺度空间 
DoG 函数 进行 曲线拟合 因为 极值 点 是 一个 三维 
矢量 即 它 包括 极值 点 所在 的 图像 坐标 
及 尺度 坐标 利用 DoG 函数 在 尺度 空间 的 
Taylor 展开式 拟合 函数 假设 我们 在 点 处 展开 
展开 2 阶 即可   公式 8 对应 的 矩阵 
形式 为 公式 9 在 这里 表示 离散 空间 下 
的 插值 中心 在 离散 空间 内 也就是 采样 点 
坐标 表示 拟合 后 连续 空间 下 的 插值 点 
坐标 设 则 表示 相对于 插值 中心 插值 后的/nr 偏移量 
因此 上述 公式 可 写成 公式 10 求导 得 公式 
11 将其 置 为 0 得到 结果 为 公式 12 
将上 面的 极值 点 带入 求导 前 的 原 公式 
10 得 公式 13 对于 公式 12 所 求得 的 
偏移量 如果 大于 0.5 只要 x y 和σ/nr 任意 一个 
量 大于 0.5 则 表明 插值 点 已 偏移 到了 
它 的 临近 的 插值 中心 所以 必须 改变 当前 
的 位置 使 其为 它 所 偏 移到 的   
插值 中心 处 然后 在 新的 位置 上 重新 进行 
泰勒 级数 插值 拟合 直到 偏移量 小于 0.5 为止 x 
y 和σ/nr 都 小于 0.5 这 是 一个 迭代 的 
工程 当然 为了 避免 无限 次 的 迭代 我们 还 
需要 设置 一个 最大 迭代 次数 在 达到 了 迭代 
次数 但 仍然 没有 满足 偏移量 小于 0.5 的 情况 
下 该 极值 点 就要 被 剔除 掉 另外 如果 
由 公式 13 所 得到 的 极值 过小 即时 假设 
图像 的 灰度 值 在 0 1.0 之间 则 这样 
的 点 易 受到 噪声 的 干扰 而 变得 不 
稳定 所以 这些 点 也 应该 剔除 而在 opencv 中 
使用 的 是 下列 公式 来 判断 其 是否 为 
不 稳定 的 极值 公式 14 其中 T 为 经验 
阈值 系统 默认 初始 化为 0.04 仅仅 去除 低 对比度 
的 极值 点 对于 特征 的 稳定性 还是 远远 不够 
的 DoG 函数 在 图像 边缘 也 有着 较强 的 
边缘 响应 因此 我们 还 需要 排除 边缘 响应 一旦 
特征点 落在 图像 的 边缘 上 这些 点 就是 不 
稳定 的 点 这 是 因为 一 方面 图像 边缘 
上 的 点 是 很难 定位 的 具有 定位 的 
歧义 性 另一方面 这样 的 点 很容易 受到 噪声 的 
干扰 而 变得 不 稳定 因此 我们 一定 要 把 
这些 点 找到 并 剔除 掉 它 的 方法 与 
Harris 角 点 检测 算法 相似 即 一个 平坦 的 
DoG 响应 峰值 往往 在 横跨 边缘 的 地方 有 
较大 的 主 曲率 而在 垂直 边缘 的 方向 上有 
较小 的 主 曲率 主 曲率 可以 通过 2 × 
2 的 Hessian 矩阵 H 求出 公式 15 其中 和 
分别 表示 对 DoG 图像 中 的 像素 在 x 
轴 方向 和y/nr 轴 方向 上 求 二阶 偏 导 
和 二阶 混合 偏 导 而这 4个 值 可以 用 
有限 差分 求导 来 近似 得到 在 这里 我们 不 
需要 求 具体 的 矩阵 H 的 两个 特征值 α 
和β/nr 而 只要 知道 两个 特征值 的 比例 就 可以 
知道 该 像素点 的 主 曲率 矩阵 H 的 直 
迹 和 行列式 分别为 公式 16 公式 17 我们 首先 
剔除 掉 那些 行列式 为 负数 的 点 即 Det 
H 0 因为 如果 像素 的 曲率 有 不同 的 
符号 则 该点 肯定 不是 特征点 设 α β 并且 
α = γ β 其中 γ 1 则 公式 18 
上式 的 结果 只 与 两个 特征值 的 比例 有关 
而与 具体 的 特征值 无关 我们 知道 当 某个 像素 
的 H 矩阵 的 两个 特征值 相差 越大 即 γ 
很大 则 该 像素 越有 可能 是 边缘 对于 上面 
那个 公式 来说 当 两个 特征值 相 等时 等式 的 
值 最小 随着 γ 的 增加 等式 的 值 也 
增加 所以 要想 检查 主 曲率 的 比值 是否 小于 
某一 阈值 γ 只要 检查 下式 是否 成立 即可 公式 
19 对于 不 满足 上式 的 极值 点 就 不是 
特征点 因此 应该 把 它们 剔除 掉 Lowe 给出 γ 
为 10 在 上面 的 运算 中 需要 用到 有限 
差分法 求 偏 导 这 部分 可以 看看 这里 的 
4.3 有限 差分 求导 3 方向 角度 的 确定 上面 
这样 就算 是从 DoG 图 中找到 极值 点 然后 筛选 
下 留下 的 就是 关键 点了 这时候 为了 解决 旋转 
不变性 并且 使得 关键点 更加 的 鲁棒 就 对其 周围 
进行 深挖 将 周边 的 信息 赋予 到 这个 关键 
点上 就是 需要 根据 检测 到 的 特征 点 所在 
的 高斯 尺度 图像 的 局部 结构 求得 一个 方向 
基准 该 高斯 尺度 图像 的 尺度 σ 是 已知 
的 并且 该 尺度 是 相对于 高斯 金字塔 所在 组 
的 基准 层 的 尺度 即 公式 20 该 式子 
的 r 表示 的 是 第几层 而 下面 的 r 
表示 的 是 半径 而 所谓 局部 结构 指 的 
是 在 高斯 尺度 图像 中 以 特征点 为中心 以 
r 为 半径 的 区域 内 计算 所有 像素 梯度 
的 幅 角 和幅值/nr 半径 r 为 公式 21 其中 
σ 就是 上面 提到 的 相对 于 所在 组 的 
基准 层 的 高斯 尺度 图像 的 尺度 当然 了 
像素 梯度 的 幅 值 和幅角/nr 的 计算 公式 计算 
公式 为 公式 22 公式 23 因为 在 以 r 
为 半径 的 区域内 的 像素 梯度 幅 值 对 
圆心 处 的 特征点 的 贡献 是 不同 的 因此 
还 需要 对 幅 值 进行 加权 处理 这里 采用 
的 是 高斯 加权 该 高斯 函数 的 方差 为 
公式 24 在 完成 特征点 邻域 范围内 的 梯度 计算 
后 还要 应用 梯度方向 直方图 来 统计 邻域 内像素 的 
梯度方向 所 对应 的 幅 值 大小 具体 的 做法 
是 把 360度 分为 36 个 柱 则 每 10度 
为 一个 柱 其中 0 9 为 第 1 柱 
10 19 为 第 2 柱 以此类推 在 以 r 
为 半径 的 区域 内 把 那些 梯度方向 在 0 
9 范围内 的 像素 找出来 把 它们 的 加权 后的/nr 
梯度 幅 值 相加 在 一起 作为 第 1 柱 
的 柱 高 求 第 2 柱 以及 其他 柱 
的 高度 的 方法 相同 为了 防止 某个 梯度方向 角度 
因 受到 噪声 的 干扰 而 突变 我们 还 需要 
对 梯度方向 直方图 进行 平滑 处理 Opencv 中 直方图 以 
周围 360度 为 范围 每 10度 为 一个 柱 一共 
36个 柱 柱 所 代表 的 方向 为 像素点 梯度方向 
柱 的 长短 代表 了 梯度 幅 值 根据 Lowe 
的 建议 模板 采用 0.25 0.5 0.25 并 连续 加权 
两次 公式 25 这里 要 注意 下 不同 版本 的 
opencv 中 实现 的 方法 不 一样 其中 h 和H/nr 
分别/d 表示/v 平滑/a 前/f 和/c 平滑/a 后的/nr 直方图/n 由于 角度 
是 循环 的 即 0度 = 360度 如果 出现 h 
j j 超出 了 0 15 的 范围 那么 可以 
通过 圆周 循环 的 方法 找到 它 所 对应 的 
在 0 360度 之间 的 值 如 h 1 = 
h 35 上图 只 画了 8个 柱 该图 来自 这里 
方向 直方图 的 峰值 则 代表 了 该 特征点 处 
邻域 梯度 的 方向 以 直方图 中 最大 值 作为 
该 关键点 的 主 方向 为了 增强 匹配 的 鲁棒性 
只 保留 峰值 大于 主 方向 峰值 80％ 的 方向 
作为 该 关键点 的 辅 方向 因此 对于 同一 梯度 
值 的 多个 峰值 的 关键 点 位置 在/p 相同/d 
位置/v 和/c 尺度/n 将会/i 有/v 多个/m 关键/n 点/m 被/p 创建/v 
但/c 方向不同/l 仅有 15％ 的 关键 点 被 赋予 多个 
方向 但 可以 明显 的 提高 关键点 匹配 的 稳定性 
实际 编程 实现 中 就是 把 该 关键点 复 制成 
多份 关键点 并将 方向 值 分别 赋 给 这些 复制 
后的/nr 关键 点 并且 离散 的 梯度方向 直方图 要 进行 
插值 拟合 处理 来 求得 更 精确 的 方向 角度 
值 这样 直方图 的 主峰 值 即 最高 的 那个 
柱体 所 代表 的 方向 就是 该 特征点 处 邻域 
范围内 图像 梯度 的 主 方向 也 就是 该 特征点 
的 主 方向 由于 柱体 所 代表 的 角度 只是 
一个 范围 如 第 1 柱 的 角度 为 0 
9度 因此 还 需要 对 离散 的 梯度方向 直方图 进行 
插值 拟合 处理 以 得到 更 精确 的 方向 角度 
值 例如 我们 已经 得到 了 第 i 柱 所 
代表 的 方向 为 特征点 的 主 方向 则 拟合 
公式 为 公式 26 公式 27 其中 H 为由 公式 
34 得到 的 直方图 角度 θ 的 单位 是 度 
同样 的 上面 两个 公式 也 存在 着 之前 那个 
直方图 平滑 所 遇到 的 角度 问题 处理 的 方法 
同样 还是 利用 角度 的 圆周 循环 每个 特征点 除了 
必须 分 配 一个 主 方 向外 还 可能 有 
一个 或 更多 个 辅 方向 增加 辅 方向 的 
目的 是 为了 增强 图像匹配 的 鲁棒性 辅 方向 的 
定义 是 当 存在 另一个 柱体 高度 大于 主 方向柱 
  体 高度 的 80% 时 则 该 柱体 所 
代表 的 方向 角度 就是 该 特征点 的 辅 方向 
在 第 2 步中/nr 我们 实现 了 用 两个 信息量 
来 表示 一个 特征点 即 位置 和 尺度 那么 经过 
上面 的 计算 我们 对 特征点 的 表示 形式 又 
增加 了 一个 信息量 方向 即 如果 某 个 特征 
点 还有 一个 辅 方向 则 这个 特征点 就要 用 
两个 值 来 表示 和 其中 表示 主 方向 表示 
辅助 方向 而 其他 的 变量 x y σ 不变 
4 描述符 的 建立 描述 的 目的 在于 之前 的 
那些 零碎 的 关键 点 的 计算 之后 如何 用 
一组 向量 来 将 这个 关键 点 描述 出来 这个 
描述 子 不但 包含 关键点 也 包含 了 周边 贡献 
的 像素点 的 信息 因为 已经 有了/nr 尺度 位置 和 
方向 等 信息 所以 能够 有 较好 的 适应性 思路 
就是 对 关键 点 周围 图像 区域 分块 计算 块 
内 梯度 直方图 生成 具有 独特 性 的 向量 该向 
量 就是 该 区域 图像 信息 的 一种 抽象 具有 
唯一性 在 图像 局部 区域 内 这些 参数 可以 重复 
的 用来 描述 局部 二维 坐标系统 因为 这些 参数 具有 
不变性 下面 就 来 计算 局部 图像 区域 的 描述符 
描述符 既 具有 可区分 性 又 具有 对 某些 变量 
的 不变性 如 光亮 或 三维 视角 描述符 是 与 
关键 点 所在 的 尺度 有关 的 所以 描述 关键点 
是 需要 在 该 关键 点 所在 的 高斯 尺度 
图像 上 进行 的 在 高斯 尺度 图像 上 以 
关键点 为中心 将其 附近 邻域 划分为 d × d 个子 
区域 Lowe 取 d = 4 每 个子 区域 都是/nr 
一个 正方形 正方形 的 边 长为 3 σ 也 就是说 
正方形 的 边 长有 3 σ 个 像素点 这里 当然 
要对 3 σ 取整 σ 为 相对 于 关键 点 
所在 的 高斯 金字塔 的 组 的 基准 层 图像 
的 尺度 即 公式 20 所 表示 的 尺度 考虑 
到 实际 编程 的 需要 关键点 邻域 范围 的 边长 
应为 3 σ d + 1 因此 关键点 邻域 区域 
一共 应有 3 σ d + 1 × 3 σ 
d + 1 个 像素点 为了 保证 关键点 具有 旋转 
不变性 还 需要 以 关键点 为中心 将 上面 确定 下来 
的 关键 点 邻域 区域 旋转 θ θ 就是 该 
关键点 的 方向 由 于是 对 正方形 进行 旋转 为了 
使旋转 后的/nr 区域 包括 整个 正方形 应该/v 以/p 从/p 正方形/n 
的/uj 中心/n 到/v 它/r 的/uj 边的/nr 最长/a 距离/n 为/p 半径/n 
也 就是 正方形 对角线 长度 的 一半 即 公式 28 
所以 上述 的 关键 点 邻域 区域 实际 应该有 2r 
+ 1 × 2r + 1 个 像素点 由于 进行 
了 旋转 则 这些 采样 点 的 新 坐标 为 
公式 29 其中 是 旋转 后的/nr 像素 的 新 坐标 
是 旋转 前 的 坐标 ps 从 matrix computations . 
4th 中 可以 看到 即 上面 关键点 的 旋转 是 
逆时针 旋转 θ 度 . 上图 中上 左一/nr 到上 右 
一是 坐标系 顺时针 的 旋转 了 其实 也就 等同于 该 
坐标 逆时针 的 旋转 了 这时 我们 需要 计算 旋转 
以后 关键点 邻域 范围内 像素 的 梯度 幅 值 和 
梯度 幅 角 这里 的 梯度 幅 值 还 需要 
根据 其 对 中心 特征点 贡献 的 大小 进行 加权 
处理 加 权函数 仍然 采用 高斯 函数 它 的 方差 
的 平方 为 在 实际 应用 中 我们 是 先以 
关键点 为 圆心 以 公式 28 中的 r 为 半径 
计算/v 该/r 圆/n 内/n 所有/b 像素/n 的/uj 梯度/n 幅/n 角/n 
和/c 高斯/nr 加权/v 后的/nr 梯度/n 幅/n 值/n 然后 再 根据 
公式 29 得到 这些 幅 值 和幅角/nr 所 对应 的 
像素 在 旋转 以后 新的 坐标 位置 在 计算 关键点 
描述符 的 时候 我们 不 需要 精确 知道 邻域 内 
所有 像素 的 梯度 幅 值 和幅角/nr 我们 只 需要 
根据 直方图 知道 其 统计 值 即可 这里 的 直方图 
是 三维 直方图 如 下图 所示 上图 中的 三维 直方图 
为 一个 立方体 立方体 的 底 就是 关键点 邻域 区域 
如 前面 所述 该 区域 被 分为 4 × 4 
个子 区域 即 16 个子 区域 邻 域内 的 像素 
根据 其 坐标 位置 把 它们 归属于 这 16 个子 
区域 中 的 一个 立方体 的 三维 直方图 的 高为/nr 
邻域 像素 幅 角 的 大小 我们 把 360 度 
的 幅 角 范围 进行 8 等分 每一个 等份 为 
45 度 则 再 根据 邻域 像素 梯度 幅 角 
的 大小 把 它们 归属于 这 8 等份 中的 一份 
这样 三维 直方图 就 建立 了 起来 即 以 关键点 
为 中心 的 邻域 像素 根据 其 坐标 位置 以及 
它 的 幅 角 的 大小 被 划归 为 某个 
小 正方体 如 显然 正方体 的 中心 应该 代表 着 
该 正方体 但 落入 正方 体内 的 邻域 像素 不 
可能 都 在中心 因此 我们 应该 对 上面 提到 的 
梯度 幅 值 做 进一步 处理 根据 它 对 中心 
点 位置 的 贡献 大小 进行 加权 处理 即在 正方 
体内 根据 像素点 相对于 正方体 中心 的 距离 对 梯度 
幅 值 做 加权 处理 所以 三维 直方图 的 值 
即 正方体 的 值 共 需要 下面 4 个 步骤 
完成 1 计算 落入 该 正方 体内 的 邻域 像素 
的 梯度 幅 值 A 2 根据 该 像素 相对于 
关键点 的 距离 对 A 进行 高斯 加权 处理 得到 
B 3 根据 该 像素 相对于 它 所在 的 正方体 
的 中心 的 贡献 大小 再 对 B 进行 加权 
处理 得到 C 4 对 所有 落入 该 正方 体内 
的 像素 做 上述 处理 再 进行 求和 运算 Σ 
C 得到 D 由于 计算 相对于 正方体 中心点 的 贡献 
大小 略显 繁琐 因此 在 实际 应用 中 我们 需要 
经过 坐标 平移 把 中心点 平 移到 正方体 的 顶点 
上 这样 只 要 计算 正方 体内 的 点 对 
正方体 的 8 个 顶点 的 贡献 大小 即可 根据 
三线性 插值法 对 某个 顶点 的 贡献 值 是 以该 
顶点 和 正方 体内 的 点 为 对角线 的 两个 
顶点 所 构成 的 立方体 的 体积 如 公式 30 
经过 上面 的 三维 直方图 的 计算 最终 我们 得到 
了 该 特征点 的 特征 矢量 为了 去除 光照 变化 
的 影响 需要 对 特征 矢量 进行 归一化 处理 即 
公式 31 则为 归一化 后的/nr 特征 矢量 尽管 通过 归一化 
处理 可以 消除 对 光照 变化 的 影响 但 由于 
照相机 饱和 以及 三维 物体 表面 的 不同 数量 不同 
角度 的 光照 变化 所 引起 的 非线性 光照 变化 
仍然 存在 它 能够 影响 到 一些 梯度 的 相对 
幅 值 但 不太 会 影响 梯度 幅 角 为了 
消除 这 部分 的 影响 我们 还 需要 设 一个 
t = 0.2 的 阈值 保留 Q 中 小于 0.2 
的 元素 而把 Q 中 大于 0.2 的 元素 用 
0.2 替代 最后 再 对 Q 进行 一次 归一化 处理 
以 提高 关键点 的 可区分 性 备注 上面 的 4 
描述符 的 建立 还未 完全 的 理解 透 所以 是 
完整 的 照抄 的 接下来 将 会 分析 opencv 中的 
sift 代码 加深理解 然后 回 来 修改 2015年 09月 25日 
第 0次 修改 参考资料 1   Lowe SIFT 原文 http 
/ / www . cs . ubc . ca / 
~ lowe / papers / ijcv04 . pdf 2   
SIFT 特征提取 分析 http / / blog . csdn . 
net / abcjennifer / article / details / 7639681 3 
  王永明 王贵 锦 . 图像 局部 不变性 特征 与 
描述 . M 国防 工业 出版社 4   SIFT 算法 
详解 http / / blog . csdn . net / 
zddblog / article / details / 7521424 5 sift 论文 
翻译 http / / www . cnblogs . com / 
cuteshongshong / archive / 2012/05 / 25/2506374 . html 6 
Scale space theory in computer vision   7 尺度空间 维基 
https / / en . wikipedia . org / wiki 
/ Scale _ space 8   赵春江 opencv2 . 4.9 
源码 分析 SIFT http / / blog . csdn . 
net / zhaocj 1999年 由 David Lowe 首先 发表 于 计算机 视觉 国际 
会议 International Conference on Computer Vision ICCV 2004年 再 次经 
David Lowe/w 整理/n 完善/v 后/f 发表/v 于/p International/w journal of 
computer vision IJCV 截止 2014年 8月 该 论文 单篇 被 
引 次数 达 25000 余次 来自 百科 本 打算 对 
04年 的 论文 进行 翻译 结果 居然 搜到 完整 翻 
译版 虽然 翻译 的 不太好 不过 有 聊胜于无 本文 的 
讲解 大 部分 主要 还是 借鉴 了 最下面 参考文献 8 
的 资料 先 谢过 作者 该 作者 对 opencv 的 
好多 源码 进行 了 分析 很强 啊 先 说 sift 
中 一步 一步 的 的 动机 motivation 对于 普通 的 
图像匹配 来说 都是 平面 物体 比如 放在 这个 桌子 上 
的 书 然后 这本书 放在 另一个 地方 而非 人脸 在 
不断 的 旋转 一下 只能 看到 侧脸 一下 看到 前 
脸 即 sift 的 优点 之处 旋转 缩放 尺度 不变 
的 特性 而 这里 都指的/nr 是 平面 内 而 不是 
平面 外 的 旋转 此 观点 如果 有误 还望 告知 
sift 的 先驱 们 发现 对于 平面 物体 来说 只要 
对 两幅 图像 找到 超过 3对 物体 间 的 匹配 
点 就能 使用 射影几何 进行 对应 而 对于 旋转 的 
缩放 的 图像 如何 建立 稳定 的 关键 点 就是 
关键 了 当然 必须 考虑到 光照 变化 所以 相对来说 比如 
角 点 边缘 亮 区域 中的 暗点 暗区 域中 的 
亮点 等等 这 就是 关键点 检测 ps sift 是 建立 
在 灰度 图上 的 当然 找 关键点 的 方法 就是 
求取 空间 的 极值 可是 对于 只有 离散 值 的 
图像 来说 如何 能够 模拟 连续 值 形式 的 函数 
来 找到 最小值 这是 问题 的 关键 而且 通常 来说 
要求 图像 的 最值 需要 求导 什么 的 而 这都是 
使用 滤波器 的 方法 来 实现 的 可是 对于 不同 
尺度 的 图像 或者 其中 的 物体 来说 同 一个 
尺寸 的 滤波器 滤波 之后 得到 的 极值 有可能 差别 
较大 所以 就 出现 了 金字塔 形状 此 观点 如果 
有误 还望 告知 假设 图像 是 深层 的 那么 不断 
的 不同 大小 的 尺度 的 图中 是 会有 相同 
信息 的 所以 这 可以 看成 是 插值 形式 即 
当前 图像 与 图像 浓缩 成 一个 点 之间 无限 
的 插值 而成 的 不同 尺度 却 内容 相同 的 
图像 序列 可想而知 这时候 关键点 是 有了 可是 杂质 太多 
所以 需要 提纯 所以在 极值 之后 得到 关键点 接着 就 
需要 基于 关键 点 进行 筛选 得到 更 稳定 的 
关键 点 这 就是 关键点 定位 ps 解决 了 缩放 
尺度 的 特性 问题 然后 为了 使得 关键点 更加 稳固 
如果 加上 关键 点 周边 的 信息 一起 作为 其 
特征 那么 就 能 更好 的 建立 特征 空间 这时候 
可以 引入 方向 信息 即 求其 梯度 这样 只要 将 
不同 图片 的 这 一步 的 方向 都 旋转 到 
同一个 方向 那么 就 能够 更好 的 匹配 配了 这样 
就 解决 了 旋转 的 问题 这 就是 方向 确定 
ps 这样 尺度 方向 位置 信息 就都 有了 接下来 就是 
将 上面 的 这些 信息 都 进行 统一 的 描述 
从而 建立 最后 的 sift 特征 这 就是 建立 描述符 
一 原理 分析 1 尺度空间 极值 点 检测 尺度空间 高大 
上 的 词 具体 可 参考 6 7 其实 就是 
对 应着 平时 拍照 时候 摄像头 的 聚焦 过程 产生 
的 清晰 还是 模糊 的 意思 为了 更 直观 先从 
维基 上 找到 的 资料 来 解释 下 什么 是 
尺度空间 当然 这里 指 的 是 计算机 视觉 中的 尺度空间 
对于 一幅 给定 的 图像   它 的 线性 高斯 
尺度空间 就是 由该 图像 与 一个 2 维 高斯 核 
卷积 得到 的     . 其中 卷积 核 如下 
公式 1 其中 为 模糊 半径 的 平方 得到 的 
尺度 空间 为 公式 2 中的 点 表示 只在 变量 
  上 执行 卷积 操作     就是 尺度 参 
数了 是 用来 表示 当前 在 哪个 尺度 级别 上 
进行 卷积 这个 定义     中 限制 了   
不过 可以 看得 出来 计算机 视觉 中 得到 的 都是 
离散 的 间断 的 图像 序列 而 没法 得到 连续 
的 图像 当然 尺度 参数 即为 高斯 过滤器 的 方差 
    如果说   那么 过滤器     就 变成 
一个 脉冲 函数 导致 的 结果 就是     也 
就是 在     这个 级别 的 尺度空间 其实 就是 
图像     自己 随着   的 变大   就是 
针对 图像 上 使用 越来 越大 的 平滑 过滤器 因而会 
移除 越来越 多 图像 内容 的 细节 因为 过滤器 的 
标准差 是   所以 很大 程度 上 明显 小于 该 
值 的 一些 细节 就 会被 忽略 掉 Scale space 
representation     at scale   corresponding to the original 
imageScale space representation     at scaleScale space representation   
  at scaleScale space representation     at scaleScale space 
representation     at scaleScale space representation     at 
scale 说完 了 尺度空间 现在 接着 说 sift 的 第一 
步 极值 点 检测 ps 尺度 是 自然 存在 的 
不是人 为 创造 的 高斯 卷积 只是 表现 尺度 的 
一种 形式 高斯 卷积 也叫做 高斯 平滑 高斯 模糊 通常 
可以 用 来 减少 图像 噪声 以及 降低 细节 层次 
因为 在 实际 应用 中 在 计算 高斯 函数 的 
离散 近似 时 在 大概 3 σ 距离 之外 的 
像素 都 可以 看作 不起作用 这些 像素 的 计算 也 
就 可以 忽略 通常 图像 处理 程序 只 需要 计算 
的 矩阵 就 可以 保证 相关 像素 影响 所以 我们 
先 计算 σ 的 值 然后 通过 该 值 计算出 
所 需要 的 模板 的 大小 然后 对 模板 进行 
归一化 接着 用 其 对 图像 进行 高斯 过滤 比如 
当 方差 为 0.6时 得到 的 就是 5 × 5 
的 高斯 模板 可以 通过 matlab 代码生成 a = fspecial 
gaussian 5 0.6 ps 高斯 模糊 具有 园 对称性 而且是 
线性 可分 的 所以 可以 在 二维 的 图像 上 
对 每 一维 单独 进行 一维 高斯 模糊 来 减少 
计算 量 这 可以 参考 4 中的 2.3 分离 高斯 
模糊 部分 而且 对于 一幅 图像 进行 多 次连续 高斯 
模糊 的 效果 与 一次 更大 的 高斯 模糊 可以 
产生 同样 的 效果 大 的 高斯 模糊 的 半径 
是 所用 多个 高斯 模糊 半径 平方和 的 平方根 比如 
使用 半径 分别为 6 和8的/nr 两次/m 高斯/nr 模糊/a 变换/v 得到/v 
的/uj 效果/n 等/u 于/p 一次/m 半径/n 为/p 10/m 的/uj 高斯/nr 
模糊/a 效果/n 因为 6 ^ 2 + 8 ^ 2 
= 10 ^ 2 所以 使用 多个 连续 较小 的 
高斯 模糊 处理 不 会比 单个 高斯 较大 处理 时间 
少 上面 介绍 了 尺度 空间 和 高斯 模糊 接下来 
就是 介绍 高斯 金字塔 了 通过 构建 多层 的 高斯 
金字塔 来 计算 后续 的 图片 中的 极值 高斯 金字塔 
高斯 金字塔 高斯 金字塔 共 分 O 组 Octave 每组 
又分 层 Layer 组 内 各层 图像 的 分辨率 是 
相同 的 即 长 和宽/nr 相同 但 尺度 逐渐增加 即/v 
越往/nr 塔顶/ns 图像/n 越/d 模糊/a 而下 一组 的 图像 是 
由上 一组 图像 上 一组 倒数第 3张 即 上图 中的 
2组 的 第 0层 是 第一 组 的 上 往下 
数 第 3张 采样 得到 的 按照 隔 点 降 
采样 得到 的 即 图像 的 长 和宽/nr 分别 减半 
高斯 金字塔 的 组 数 O 是由 输入 图像 的 
分辨率 得到 的 因为 要 进行 隔 点 降 采样 
所以 在 执行 降 采样 生成 高斯 金字塔 时 一直 
到 4 * 4 大小 因为 太小 的 图片 也 
没什么 意义 了 其中 组 数 公式 为 公式 3 
其中 X 和Y/nr 分别为 输入 图像 的 长 和宽/nr ⌊ 
⌋ 表示 向下 取整 并且 每组 的 金字塔 的 层数 
为 S = s + 2 + 1   这里 
Lowe 建议 s 为 3 s 为 建议 的 2 
是 为了 不同 组 之间 能够 平滑 过渡 而在 顶部 
加上 的 2层 1 为 最底 的 原始 层 8 
假设 当前 图像 大小 为 512 * 512 则 如下 
操作 上面 公式 中 减 2 是 因为 假设 当前 
图像 即为 输入 图像 而有 的 资料 减 3 是 
因为 他们 把 自然界 作为 第 0组 而 经过 相机 
拍摄 就 成了 第 1组 所以 是 多 减 一次 
当然 了 到底 减 多少 任君 喜欢 这 不是 重点 
这时候 就 需要 依据 当前 图像 建立 自然 场景 的 
第 0 组 图像 了 即用 当前 图像 进行 插值 
得到 例如 上面 那样 的 1024 * 1024 的 一张 
图片 得到 了 组 数 之后 就是 计算 组 内 
尺度 和 组间 尺 度了 记得 这里 是 假设 当前 
得到 的 图片 的 尺度 为 0.5 的 即 第 
1组 的 第 0层 自然界 为 第 0组 即 拍照 
拍到 之后 拿到 的 那张 图片 我们 可以 很 自然 
的 知道 这是/i 有组内/nr 尺度/n 和/c 组间/i 尺度/n 的/uj 对于 
组 内 相邻 的 两幅 图片 来说 公式 4 假设 
这里 的 s 为 小写 的 不是 表示 层数 的 
那个 大 为什么 使用 1/2 这个 可以 看 lowe 的 
论文 1 所以 对于 某一 组 来说 当 s = 
3时 有=s/nr + 2 + 1 = 6幅 图片 即 
0 1 2 3 4 5 而 对于 组间 相邻 
的 尺度 来说 因为 后 一组 是 通过 前 一组 
的 倒数 第 3幅 图 进行 降 采样 得到 的 
即 前 一组 的 第 s 幅 为 将 带入 
得 其为 即 后 一组 的 第 0幅 图为 前 
一组 第 0幅 图 的 2倍 尺度 同时 推出 相邻 
两组 同 一层 的 图像 都是 2倍 尺度 关系 的 
则 总的 尺度 坐标 为 公式 5 其中 o 表示 
第 几组 r 表示 组 内 第几层 在 lowe 的 
论文 中 他 将 第 0层 也 就是 自然 界层 
的 初始 尺度 定义 为 1.6 而 我们 获取 的 
图片 初始 尺度 为 0.5 则 图像 金字塔 第 0层 
的 实际 尺度 为 sqrt 1.6 * 1.6 0.5 * 
0.5 = 1.52 之所以 可以 这么 计算 就是 因为 上面 
高斯 金字塔 之上 的 ps 部分 所述 当然 这 是 
为了 避免 检测 极值 点 之前 就 对 原始 图像 
的 高斯 平滑 以致于 图像 丢失 高频 信息 所以 才 
建议 在 建立 尺度空间 前 首先 对 原始 图像 的 
长宽 扩展 一倍 以 保留 原始 图像 的 信息 也 
就是 我们 之前 说 的 那个 假设 你 获得了 图像 
是 512 * 512 的 那么 就 弄 一个 1024 
* 1024 的 作为 最底层 图 这时候 因为 图像 扩展 
造成 的 尺度 计算 为 即 通过 计算机 得到 的 
真实 尺度 当然 这 一组 在 很多 资料 中 也叫做 
第 1 组 公式 6 本来 对于 关键点 的 检测 
可以   利用 LoG 高斯 拉普拉斯 方法 Laplacian of Gaussian 
即 图像 的 二阶 导数 能够 在 不同 的 尺度 
下 检测 到 图像 的 斑点 特征 从而 可以 确定 
图像 的 特征点 lindeberg 在 文献 scale space theory a 
basic tool for analysising structures at different scales 中 指出 
尺度 规范化 的 log 算子 具有 真正 的 尺度 不变性 
但 LoG 的 效率 不高 所以 sift 不 这么 做 
作者 对 两个 相邻 高斯 尺度空间 的 图像 相减 得到 
一个 DoG 高斯 差分 Difference of Gaussians 的 响应值 图像 
D x y σ 来 近似 LoG 公式 7 两者 
为什么 能够 等效 仔细 的 推导 可以 看 这里 的 
3.4 高斯 差分 金字塔 部分 用 DoG 代替 LoG 并不 
影响 对 图像 斑点 位置 的 检测 而且 用 DoG 
近似 LoG 可以 实现 下列 好处 第一 是 LoG 需要 
使用 两个 方向 的 高斯 二阶 微分 卷积 核 而 
DoG 直接 使用 高斯 卷积 核 省去 了 卷积 核 
生成 的 运算量 第二 是 DoG 保留 了 个 高斯 
尺度空间 的 图像 因此在 生成 某一 空间尺度 的 特征 时 
可以 直接 使用 公式 2 产生 的 尺度空间 图像 而 
无需 重新 再 次 生成 该 尺度 的 图像 第三 
是 DoG 具有 与 LoG 相同 的 性质 即 稳定 
性好 抗干扰 能力 强 为了 在 连续 的 尺度 下 
检测 图像 的 特征点 需要 建立 DoG 金字塔 而 DoG 
金字塔 的 建立 又 离不开 高斯 金字塔 的 建立 如下 
图 所示 左侧 为 高斯 金字塔 右侧 为 DoG 金字塔 
8 高斯 金字塔 的 组 内 相邻 两层 相减 而 
两 组间 的 各层 是 不能 相减 的 因此 高斯 
金字塔 每组 有s+/nr 3 层 图像 而 DoG 金字塔 每组 
则有 s + 2 层 图像 我们 可以 发现 未 
被 利用 到 的 高斯 金字塔 的 第 0组 的 
第 0层 和 最上面 一组 的 最上面 一层 而 dog 
金字塔 的 每组 的 第 0层 和 顶层 未被 用到 
原因 如下 极值 点 的 搜索 是 在 DoG 金字塔 
内 进行 的 这些 极值 点 就是 候选 的 特征点 
在 搜索 之前 我们 需要 在 DoG 金字 塔内 剔除 
那些 像素 值 过小 的 点 因为 这些 像素 具有 
较低 的 对比度 它们 肯定 不是 稳定 的 特征点 极值 
点 的 搜索 不仅 需要 在 它 所在 尺度空间 图像 
的 邻域 内 进行 还 需要 在 它 的 相邻 
尺度空间 图像 内 进行 如 2 关键点 的 定位 从 
上面 的 搜索 中 就 能够 得到 许多 的 极值 
点了 之 所谓 极值 点 就是 都是/nr 一群 待选 的 
点 不是 直接 就 可以 用 的 关键 点 因为 
它们 还 存在 一些 不 确定 的 因素 首先 是 
极值 点 的 搜索 是 在 离散 空间 内 进行 
的 并且 这些 离散 空间 还是 经过 不断 的 降 
采样 得到 的 如果把 采样 点 拟 合成 曲面 后 
我们 会 发现 原先 的 极值 点 并 不是 真正 
的 极值 点 也 就是 离散 空间 的 极值 点 
并 不是 连续 空间 的 极值 点 如 下图 4 
接下来 这 一大 段 都是 来自 参考文献 8 因为 觉得 
该 作者 讲 的 详细 所以 直接 复制 过来 这 
部分 了 为了 提高 关键点 的 稳定性 需要 对 尺度空间 
DoG 函数 进行 曲线拟合 因为 极值 点 是 一个 三维 
矢量 即 它 包括 极值 点 所在 的 图像 坐标 
及 尺度 坐标 利用 DoG 函数 在 尺度 空间 的 
Taylor 展开式 拟合 函数 假设 我们 在 点 处 展开 
展开 2 阶 即可   公式 8 对应 的 矩阵 
形式 为 公式 9 在 这里 表示 离散 空间 下 
的 插值 中心 在 离散 空间 内 也就是 采样 点 
坐标 表示 拟合 后 连续 空间 下 的 插值 点 
坐标 设 则 表示 相对于 插值 中心 插值 后的/nr 偏移量 
因此 上述 公式 可 写成 公式 10 求导 得 公式 
11 将其 置 为 0 得到 结果 为 公式 12 
将上 面的 极值 点 带入 求导 前 的 原 公式 
10 得 公式 13 对于 公式 12 所 求得 的 
偏移量 如果 大于 0.5 只要 x y 和σ/nr 任意 一个 
量 大于 0.5 则 表明 插值 点 已 偏移 到了 
它 的 临近 的 插值 中心 所以 必须 改变 当前 
的 位置 使 其为 它 所 偏 移到 的   
插值 中心 处 然后 在 新的 位置 上 重新 进行 
泰勒 级数 插值 拟合 直到 偏移量 小于 0.5 为止 x 
y 和σ/nr 都 小于 0.5 这 是 一个 迭代 的 
工程 当然 为了 避免 无限 次 的 迭代 我们 还 
需要 设置 一个 最大 迭代 次数 在 达到 了 迭代 
次数 但 仍然 没有 满足 偏移量 小于 0.5 的 情况 
下 该 极值 点 就要 被 剔除 掉 另外 如果 
由 公式 13 所 得到 的 极值 过小 即时 假设 
图像 的 灰度 值 在 0 1.0 之间 则 这样 
的 点 易 受到 噪声 的 干扰 而 变得 不 
稳定 所以 这些 点 也 应该 剔除 而在 opencv 中 
使用 的 是 下列 公式 来 判断 其 是否 为 
不 稳定 的 极值 公式 14 其中 T 为 经验 
阈值 系统 默认 初始 化为 0.04 仅仅 去除 低 对比度 
的 极值 点 对于 特征 的 稳定性 还是 远远 不够 
的 DoG 函数 在 图像 边缘 也 有着 较强 的 
边缘 响应 因此 我们 还 需要 排除 边缘 响应 一旦 
特征点 落在 图像 的 边缘 上 这些 点 就是 不 
稳定 的 点 这 是 因为 一 方面 图像 边缘 
上 的 点 是 很难 定位 的 具有 定位 的 
歧义 性 另一方面 这样 的 点 很容易 受到 噪声 的 
干扰 而 变得 不 稳定 因此 我们 一定 要 把 
这些 点 找到 并 剔除 掉 它 的 方法 与 
Harris 角 点 检测 算法 相似 即 一个 平坦 的 
DoG 响应 峰值 往往 在 横跨 边缘 的 地方 有 
较大 的 主 曲率 而在 垂直 边缘 的 方向 上有 
较小 的 主 曲率 主 曲率 可以 通过 2 × 
2 的 Hessian 矩阵 H 求出 公式 15 其中 和 
分别 表示 对 DoG 图像 中 的 像素 在 x 
轴 方向 和y/nr 轴 方向 上 求 二阶 偏 导 
和 二阶 混合 偏 导 而这 4个 值 可以 用 
有限 差分 求导 来 近似 得到 在 这里 我们 不 
需要 求 具体 的 矩阵 H 的 两个 特征值 α 
和β/nr 而 只要 知道 两个 特征值 的 比例 就 可以 
知道 该 像素点 的 主 曲率 矩阵 H 的 直 
迹 和 行列式 分别为 公式 16 公式 17 我们 首先 
剔除 掉 那些 行列式 为 负数 的 点 即 Det 
H 0 因为 如果 像素 的 曲率 有 不同 的 
符号 则 该点 肯定 不是 特征点 设 α β 并且 
α = γ β 其中 γ 1 则 公式 18 
上式 的 结果 只 与 两个 特征值 的 比例 有关 
而与 具体 的 特征值 无关 我们 知道 当 某个 像素 
的 H 矩阵 的 两个 特征值 相差 越大 即 γ 
很大 则 该 像素 越有 可能 是 边缘 对于 上面 
那个 公式 来说 当 两个 特征值 相 等时 等式 的 
值 最小 随着 γ 的 增加 等式 的 值 也 
增加 所以 要想 检查 主 曲率 的 比值 是否 小于 
某一 阈值 γ 只要 检查 下式 是否 成立 即可 公式 
19 对于 不 满足 上式 的 极值 点 就 不是 
特征点 因此 应该 把 它们 剔除 掉 Lowe 给出 γ 
为 10 在 上面 的 运算 中 需要 用到 有限 
差分法 求 偏 导 这 部分 可以 看看 这里 的 
4.3 有限 差分 求导 3 方向 角度 的 确定 上面 
这样 就算 是从 DoG 图 中找到 极值 点 然后 筛选 
下 留下 的 就是 关键 点了 这时候 为了 解决 旋转 
不变性 并且 使得 关键点 更加 的 鲁棒 就 对其 周围 
进行 深挖 将 周边 的 信息 赋予 到 这个 关键 
点上 就是 需要 根据 检测 到 的 特征 点 所在 
的 高斯 尺度 图像 的 局部 结构 求得 一个 方向 
基准 该 高斯 尺度 图像 的 尺度 σ 是 已知 
的 并且 该 尺度 是 相对于 高斯 金字塔 所在 组 
的 基准 层 的 尺度 即 公式 20 该 式子 
的 r 表示 的 是 第几层 而 下面 的 r 
表示 的 是 半径 而 所谓 局部 结构 指 的 
是 在 高斯 尺度 图像 中 以 特征点 为中心 以 
r 为 半径 的 区域 内 计算 所有 像素 梯度 
的 幅 角 和幅值/nr 半径 r 为 公式 21 其中 
σ 就是 上面 提到 的 相对 于 所在 组 的 
基准 层 的 高斯 尺度 图像 的 尺度 当然 了 
像素 梯度 的 幅 值 和幅角/nr 的 计算 公式 计算 
公式 为 公式 22 公式 23 因为 在 以 r 
为 半径 的 区域内 的 像素 梯度 幅 值 对 
圆心 处 的 特征点 的 贡献 是 不同 的 因此 
还 需要 对 幅 值 进行 加权 处理 这里 采用 
的 是 高斯 加权 该 高斯 函数 的 方差 为 
公式 24 在 完成 特征点 邻域 范围内 的 梯度 计算 
后 还要 应用 梯度方向 直方图 来 统计 邻域 内像素 的 
梯度方向 所 对应 的 幅 值 大小 具体 的 做法 
是 把 360度 分为 36 个 柱 则 每 10度 
为 一个 柱 其中 0 9 为 第 1 柱 
10 19 为 第 2 柱 以此类推 在 以 r 
为 半径 的 区域 内 把 那些 梯度方向 在 0 
9 范围内 的 像素 找出来 把 它们 的 加权 后的/nr 
梯度 幅 值 相加 在 一起 作为 第 1 柱 
的 柱 高 求 第 2 柱 以及 其他 柱 
的 高度 的 方法 相同 为了 防止 某个 梯度方向 角度 
因 受到 噪声 的 干扰 而 突变 我们 还 需要 
对 梯度方向 直方图 进行 平滑 处理 Opencv 中 直方图 以 
周围 360度 为 范围 每 10度 为 一个 柱 一共 
36个 柱 柱 所 代表 的 方向 为 像素点 梯度方向 
柱 的 长短 代表 了 梯度 幅 值 根据 Lowe 
的 建议 模板 采用 0.25 0.5 0.25 并 连续 加权 
两次 公式 25 这里 要 注意 下 不同 版本 的 
opencv 中 实现 的 方法 不 一样 其中 h 和H/nr 
分别/d 表示/v 平滑/a 前/f 和/c 平滑/a 后的/nr 直方图/n 由于 角度 
是 循环 的 即 0度 = 360度 如果 出现 h 
j j 超出 了 0 15 的 范围 那么 可以 
通过 圆周 循环 的 方法 找到 它 所 对应 的 
在 0 360度 之间 的 值 如 h 1 = 
h 35 上图 只 画了 8个 柱 该图 来自 这里 
方向 直方图 的 峰值 则 代表 了 该 特征点 处 
邻域 梯度 的 方向 以 直方图 中 最大 值 作为 
该 关键点 的 主 方向 为了 增强 匹配 的 鲁棒性 
只 保留 峰值 大于 主 方向 峰值 80％ 的 方向 
作为 该 关键点 的 辅 方向 因此 对于 同一 梯度 
值 的 多个 峰值 的 关键 点 位置 在/p 相同/d 
位置/v 和/c 尺度/n 将会/i 有/v 多个/m 关键/n 点/m 被/p 创建/v 
但/c 方向不同/l 仅有 15％ 的 关键 点 被 赋予 多个 
方向 但 可以 明显 的 提高 关键点 匹配 的 稳定性 
实际 编程 实现 中 就是 把 该 关键点 复 制成 
多份 关键点 并将 方向 值 分别 赋 给 这些 复制 
后的/nr 关键 点 并且 离散 的 梯度方向 直方图 要 进行 
插值 拟合 处理 来 求得 更 精确 的 方向 角度 
值 这样 直方图 的 主峰 值 即 最高 的 那个 
柱体 所 代表 的 方向 就是 该 特征点 处 邻域 
范围内 图像 梯度 的 主 方向 也 就是 该 特征点 
的 主 方向 由于 柱体 所 代表 的 角度 只是 
一个 范围 如 第 1 柱 的 角度 为 0 
9度 因此 还 需要 对 离散 的 梯度方向 直方图 进行 
插值 拟合 处理 以 得到 更 精确 的 方向 角度 
值 例如 我们 已经 得到 了 第 i 柱 所 
代表 的 方向 为 特征点 的 主 方向 则 拟合 
公式 为 公式 26 公式 27 其中 H 为由 公式 
34 得到 的 直方图 角度 θ 的 单位 是 度 
同样 的 上面 两个 公式 也 存在 着 之前 那个 
直方图 平滑 所 遇到 的 角度 问题 处理 的 方法 
同样 还是 利用 角度 的 圆周 循环 每个 特征点 除了 
必须 分 配 一个 主 方 向外 还 可能 有 
一个 或 更多 个 辅 方向 增加 辅 方向 的 
目的 是 为了 增强 图像匹配 的 鲁棒性 辅 方向 的 
定义 是 当 存在 另一个 柱体 高度 大于 主 方向柱 
  体 高度 的 80% 时 则 该 柱体 所 
代表 的 方向 角度 就是 该 特征点 的 辅 方向 
在 第 2 步中/nr 我们 实现 了 用 两个 信息量 
来 表示 一个 特征点 即 位置 和 尺度 那么 经过 
上面 的 计算 我们 对 特征点 的 表示 形式 又 
增加 了 一个 信息量 方向 即 如果 某 个 特征 
点 还有 一个 辅 方向 则 这个 特征点 就要 用 
两个 值 来 表示 和 其中 表示 主 方向 表示 
辅助 方向 而 其他 的 变量 x y σ 不变 
4 描述符 的 建立 描述 的 目的 在于 之前 的 
那些 零碎 的 关键 点 的 计算 之后 如何 用 
一组 向量 来 将 这个 关键 点 描述 出来 这个 
描述 子 不但 包含 关键点 也 包含 了 周边 贡献 
的 像素点 的 信息 因为 已经 有了/nr 尺度 位置 和 
方向 等 信息 所以 能够 有 较好 的 适应性 思路 
就是 对 关键 点 周围 图像 区域 分块 计算 块 
内 梯度 直方图 生成 具有 独特 性 的 向量 该向 
量 就是 该 区域 图像 信息 的 一种 抽象 具有 
唯一性 在 图像 局部 区域 内 这些 参数 可以 重复 
的 用来 描述 局部 二维 坐标系统 因为 这些 参数 具有 
不变性 下面 就 来 计算 局部 图像 区域 的 描述符 
描述符 既 具有 可区分 性 又 具有 对 某些 变量 
的 不变性 如 光亮 或 三维 视角 描述符 是 与 
关键 点 所在 的 尺度 有关 的 所以 描述 关键点 
是 需要 在 该 关键 点 所在 的 高斯 尺度 
图像 上 进行 的 在 高斯 尺度 图像 上 以 
关键点 为中心 将其 附近 邻域 划分为 d × d 个子 
区域 Lowe 取 d = 4 每 个子 区域 都是/nr 
一个 正方形 正方形 的 边 长为 3 σ 也 就是说 
正方形 的 边 长有 3 σ 个 像素点 这里 当然 
要对 3 σ 取整 σ 为 相对 于 关键 点 
所在 的 高斯 金字塔 的 组 的 基准 层 图像 
的 尺度 即 公式 20 所 表示 的 尺度 考虑 
到 实际 编程 的 需要 关键点 邻域 范围 的 边长 
应为 3 σ d + 1 因此 关键点 邻域 区域 
一共 应有 3 σ d + 1 × 3 σ 
d + 1 个 像素点 为了 保证 关键点 具有 旋转 
不变性 还 需要 以 关键点 为中心 将 上面 确定 下来 
的 关键 点 邻域 区域 旋转 θ θ 就是 该 
关键点 的 方向 由 于是 对 正方形 进行 旋转 为了 
使旋转 后的/nr 区域 包括 整个 正方形 应该/v 以/p 从/p 正方形/n 
的/uj 中心/n 到/v 它/r 的/uj 边的/nr 最长/a 距离/n 为/p 半径/n 
也 就是 正方形 对角线 长度 的 一半 即 公式 28 
所以 上述 的 关键 点 邻域 区域 实际 应该有 2r 
+ 1 × 2r + 1 个 像素点 由于 进行 
了 旋转 则 这些 采样 点 的 新 坐标 为 
公式 29 其中 是 旋转 后的/nr 像素 的 新 坐标 
是 旋转 前 的 坐标 ps 从 matrix computations . 
4th 中 可以 看到 即 上面 关键点 的 旋转 是 
逆时针 旋转 θ 度 . 上图 中上 左一/nr 到上 右 
一是 坐标系 顺时针 的 旋转 了 其实 也就 等同于 该 
坐标 逆时针 的 旋转 了 这时 我们 需要 计算 旋转 
以后 关键点 邻域 范围内 像素 的 梯度 幅 值 和 
梯度 幅 角 这里 的 梯度 幅 值 还 需要 
根据 其 对 中心 特征点 贡献 的 大小 进行 加权 
处理 加 权函数 仍然 采用 高斯 函数 它 的 方差 
的 平方 为 在 实际 应用 中 我们 是 先以 
关键点 为 圆心 以 公式 28 中的 r 为 半径 
计算/v 该/r 圆/n 内/n 所有/b 像素/n 的/uj 梯度/n 幅/n 角/n 
和/c 高斯/nr 加权/v 后的/nr 梯度/n 幅/n 值/n 然后 再 根据 
公式 29 得到 这些 幅 值 和幅角/nr 所 对应 的 
像素 在 旋转 以后 新的 坐标 位置 在 计算 关键点 
描述符 的 时候 我们 不 需要 精确 知道 邻域 内 
所有 像素 的 梯度 幅 值 和幅角/nr 我们 只 需要 
根据 直方图 知道 其 统计 值 即可 这里 的 直方图 
是 三维 直方图 如 下图 所示 上图 中的 三维 直方图 
为 一个 立方体 立方体 的 底 就是 关键点 邻域 区域 
如 前面 所述 该 区域 被 分为 4 × 4 
个子 区域 即 16 个子 区域 邻 域内 的 像素 
根据 其 坐标 位置 把 它们 归属于 这 16 个子 
区域 中 的 一个 立方体 的 三维 直方图 的 高为/nr 
邻域 像素 幅 角 的 大小 我们 把 360 度 
的 幅 角 范围 进行 8 等分 每一个 等份 为 
45 度 则 再 根据 邻域 像素 梯度 幅 角 
的 大小 把 它们 归属于 这 8 等份 中的 一份 
这样 三维 直方图 就 建立 了 起来 即 以 关键点 
为 中心 的 邻域 像素 根据 其 坐标 位置 以及 
它 的 幅 角 的 大小 被 划归 为 某个 
小 正方体 如 显然 正方体 的 中心 应该 代表 着 
该 正方体 但 落入 正方 体内 的 邻域 像素 不 
可能 都 在中心 因此 我们 应该 对 上面 提到 的 
梯度 幅 值 做 进一步 处理 根据 它 对 中心 
点 位置 的 贡献 大小 进行 加权 处理 即在 正方 
体内 根据 像素点 相对于 正方体 中心 的 距离 对 梯度 
幅 值 做 加权 处理 所以 三维 直方图 的 值 
即 正方体 的 值 共 需要 下面 4 个 步骤 
完成 1 计算 落入 该 正方 体内 的 邻域 像素 
的 梯度 幅 值 A 2 根据 该 像素 相对于 
关键点 的 距离 对 A 进行 高斯 加权 处理 得到 
B 3 根据 该 像素 相对于 它 所在 的 正方体 
的 中心 的 贡献 大小 再 对 B 进行 加权 
处理 得到 C 4 对 所有 落入 该 正方 体内 
的 像素 做 上述 处理 再 进行 求和 运算 Σ 
C 得到 D 由于 计算 相对于 正方体 中心点 的 贡献 
大小 略显 繁琐 因此 在 实际 应用 中 我们 需要 
经过 坐标 平移 把 中心点 平 移到 正方体 的 顶点 
上 这样 只 要 计算 正方 体内 的 点 对 
正方体 的 8 个 顶点 的 贡献 大小 即可 根据 
三线性 插值法 对 某个 顶点 的 贡献 值 是 以该 
顶点 和 正方 体内 的 点 为 对角线 的 两个 
顶点 所 构成 的 立方体 的 体积 如 公式 30 
经过 上面 的 三维 直方图 的 计算 最终 我们 得到 
了 该 特征点 的 特征 矢量 为了 去除 光照 变化 
的 影响 需要 对 特征 矢量 进行 归一化 处理 即 
公式 31 则为 归一化 后的/nr 特征 矢量 尽管 通过 归一化 
处理 可以 消除 对 光照 变化 的 影响 但 由于 
照相机 饱和 以及 三维 物体 表面 的 不同 数量 不同 
角度 的 光照 变化 所 引起 的 非线性 光照 变化 
仍然 存在 它 能够 影响 到 一些 梯度 的 相对 
幅 值 但 不太 会 影响 梯度 幅 角 为了 
消除 这 部分 的 影响 我们 还 需要 设 一个 
t = 0.2 的 阈值 保留 Q 中 小于 0.2 
的 元素 而把 Q 中 大于 0.2 的 元素 用 
0.2 替代 最后 再 对 Q 进行 一次 归一化 处理 
以 提高 关键点 的 可区分 性 备注 上面 的 4 
描述符 的 建立 还未 完全 的 理解 透 所以 是 
完整 的 照抄 的 接下来 将 会 分析 opencv 中的 
sift 代码 加深理解 然后 回 来 修改 2015年 09月 25日 
第 0次 修改 参考资料 1   Lowe SIFT 原文 http 
/ / www . cs . ubc . ca / 
~ lowe / papers / ijcv04 . pdf 2   
SIFT 特征提取 分析 http / / blog . csdn . 
net / abcjennifer / article / details / 7639681 3 
  王永明 王贵 锦 . 图像 局部 不变性 特征 与 
描述 . M 国防 工业 出版社 4   SIFT 算法 
详解 http / / blog . csdn . net / 
zddblog / article / details / 7521424 5 sift 论文 
翻译 http / / www . cnblogs . com / 
cuteshongshong / archive / 2012/05 / 25/2506374 . html 6 
Scale space theory in computer vision   7 尺度空间 维基 
https / / en . wikipedia . org / wiki 
/ Scale _ space 8   赵春江 opencv2 . 4.9 
源码 分析 SIFT http / / blog . csdn . 
net / zhaocj 1999年 由 David Lowe 首先 发表 于 计算机 视觉 国际 
会议 International Conference on Computer Vision ICCV 2004年 再 次经 
David Lowe/w 整理/n 完善/v 后/f 发表/v 于/p International/w journal of 
computer vision IJCV 截止 2014年 8月 该 论文 单篇 被 
引 次数 达 25000 余次 来自 百科 本 打算 对 
04年 的 论文 进行 翻译 结果 居然 搜到 完整 翻 
译版 虽然 翻译 的 不太好 不过 有 聊胜于无 本文 的 
讲解 大 部分 主要 还是 借鉴 了 最下面 参考文献 8 
的 资料 先 谢过 作者 该 作者 对 opencv 的 
好多 源码 进行 了 分析 很强 啊 先 说 sift 
中 一步 一步 的 的 动机 motivation 对于 普通 的 
图像匹配 来说 都是 平面 物体 比如 放在 这个 桌子 上 
的 书 然后 这本书 放在 另一个 地方 而非 人脸 在 
不断 的 旋转 一下 只能 看到 侧脸 一下 看到 前 
脸 即 sift 的 优点 之处 旋转 缩放 尺度 不变 
的 特性 而 这里 都指的/nr 是 平面 内 而 不是 
平面 外 的 旋转 此 观点 如果 有误 还望 告知 
sift 的 先驱 们 发现 对于 平面 物体 来说 只要 
对 两幅 图像 找到 超过 3对 物体 间 的 匹配 
点 就能 使用 射影几何 进行 对应 而 对于 旋转 的 
缩放 的 图像 如何 建立 稳定 的 关键 点 就是 
关键 了 当然 必须 考虑到 光照 变化 所以 相对来说 比如 
角 点 边缘 亮 区域 中的 暗点 暗区 域中 的 
亮点 等等 这 就是 关键点 检测 ps sift 是 建立 
在 灰度 图上 的 当然 找 关键点 的 方法 就是 
求取 空间 的 极值 可是 对于 只有 离散 值 的 
图像 来说 如何 能够 模拟 连续 值 形式 的 函数 
来 找到 最小值 这是 问题 的 关键 而且 通常 来说 
要求 图像 的 最值 需要 求导 什么 的 而 这都是 
使用 滤波器 的 方法 来 实现 的 可是 对于 不同 
尺度 的 图像 或者 其中 的 物体 来说 同 一个 
尺寸 的 滤波器 滤波 之后 得到 的 极值 有可能 差别 
较大 所以 就 出现 了 金字塔 形状 此 观点 如果 
有误 还望 告知 假设 图像 是 深层 的 那么 不断 
的 不同 大小 的 尺度 的 图中 是 会有 相同 
信息 的 所以 这 可以 看成 是 插值 形式 即 
当前 图像 与 图像 浓缩 成 一个 点 之间 无限 
的 插值 而成 的 不同 尺度 却 内容 相同 的 
图像 序列 可想而知 这时候 关键点 是 有了 可是 杂质 太多 
所以 需要 提纯 所以在 极值 之后 得到 关键点 接着 就 
需要 基于 关键 点 进行 筛选 得到 更 稳定 的 
关键 点 这 就是 关键点 定位 ps 解决 了 缩放 
尺度 的 特性 问题 然后 为了 使得 关键点 更加 稳固 
如果 加上 关键 点 周边 的 信息 一起 作为 其 
特征 那么 就 能 更好 的 建立 特征 空间 这时候 
可以 引入 方向 信息 即 求其 梯度 这样 只要 将 
不同 图片 的 这 一步 的 方向 都 旋转 到 
同一个 方向 那么 就 能够 更好 的 匹配 配了 这样 
就 解决 了 旋转 的 问题 这 就是 方向 确定 
ps 这样 尺度 方向 位置 信息 就都 有了 接下来 就是 
将 上面 的 这些 信息 都 进行 统一 的 描述 
从而 建立 最后 的 sift 特征 这 就是 建立 描述符 
一 原理 分析 1 尺度空间 极值 点 检测 尺度空间 高大 
上 的 词 具体 可 参考 6 7 其实 就是 
对 应着 平时 拍照 时候 摄像头 的 聚焦 过程 产生 
的 清晰 还是 模糊 的 意思 为了 更 直观 先从 
维基 上 找到 的 资料 来 解释 下 什么 是 
尺度空间 当然 这里 指 的 是 计算机 视觉 中的 尺度空间 
对于 一幅 给定 的 图像   它 的 线性 高斯 
尺度空间 就是 由该 图像 与 一个 2 维 高斯 核 
卷积 得到 的     . 其中 卷积 核 如下 
公式 1 其中 为 模糊 半径 的 平方 得到 的 
尺度 空间 为 公式 2 中的 点 表示 只在 变量 
  上 执行 卷积 操作     就是 尺度 参 
数了 是 用来 表示 当前 在 哪个 尺度 级别 上 
进行 卷积 这个 定义     中 限制 了   
不过 可以 看得 出来 计算机 视觉 中 得到 的 都是 
离散 的 间断 的 图像 序列 而 没法 得到 连续 
的 图像 当然 尺度 参数 即为 高斯 过滤器 的 方差 
    如果说   那么 过滤器     就 变成 
一个 脉冲 函数 导致 的 结果 就是     也 
就是 在     这个 级别 的 尺度空间 其实 就是 
图像     自己 随着   的 变大   就是 
针对 图像 上 使用 越来 越大 的 平滑 过滤器 因而会 
移除 越来越 多 图像 内容 的 细节 因为 过滤器 的 
标准差 是   所以 很大 程度 上 明显 小于 该 
值 的 一些 细节 就 会被 忽略 掉 Scale space 
representation     at scale   corresponding to the original 
imageScale space representation     at scaleScale space representation   
  at scaleScale space representation     at scaleScale space 
representation     at scaleScale space representation     at 
scale 说完 了 尺度空间 现在 接着 说 sift 的 第一 
步 极值 点 检测 ps 尺度 是 自然 存在 的 
不是人 为 创造 的 高斯 卷积 只是 表现 尺度 的 
一种 形式 高斯 卷积 也叫做 高斯 平滑 高斯 模糊 通常 
可以 用 来 减少 图像 噪声 以及 降低 细节 层次 
因为 在 实际 应用 中 在 计算 高斯 函数 的 
离散 近似 时 在 大概 3 σ 距离 之外 的 
像素 都 可以 看作 不起作用 这些 像素 的 计算 也 
就 可以 忽略 通常 图像 处理 程序 只 需要 计算 
的 矩阵 就 可以 保证 相关 像素 影响 所以 我们 
先 计算 σ 的 值 然后 通过 该 值 计算出 
所 需要 的 模板 的 大小 然后 对 模板 进行 
归一化 接着 用 其 对 图像 进行 高斯 过滤 比如 
当 方差 为 0.6时 得到 的 就是 5 × 5 
的 高斯 模板 可以 通过 matlab 代码生成 a = fspecial 
gaussian 5 0.6 ps 高斯 模糊 具有 园 对称性 而且是 
线性 可分 的 所以 可以 在 二维 的 图像 上 
对 每 一维 单独 进行 一维 高斯 模糊 来 减少 
计算 量 这 可以 参考 4 中的 2.3 分离 高斯 
模糊 部分 而且 对于 一幅 图像 进行 多 次连续 高斯 
模糊 的 效果 与 一次 更大 的 高斯 模糊 可以 
产生 同样 的 效果 大 的 高斯 模糊 的 半径 
是 所用 多个 高斯 模糊 半径 平方和 的 平方根 比如 
使用 半径 分别为 6 和8的/nr 两次/m 高斯/nr 模糊/a 变换/v 得到/v 
的/uj 效果/n 等/u 于/p 一次/m 半径/n 为/p 10/m 的/uj 高斯/nr 
模糊/a 效果/n 因为 6 ^ 2 + 8 ^ 2 
= 10 ^ 2 所以 使用 多个 连续 较小 的 
高斯 模糊 处理 不 会比 单个 高斯 较大 处理 时间 
少 上面 介绍 了 尺度 空间 和 高斯 模糊 接下来 
就是 介绍 高斯 金字塔 了 通过 构建 多层 的 高斯 
金字塔 来 计算 后续 的 图片 中的 极值 高斯 金字塔 
高斯 金字塔 高斯 金字塔 共 分 O 组 Octave 每组 
又分 层 Layer 组 内 各层 图像 的 分辨率 是 
相同 的 即 长 和宽/nr 相同 但 尺度 逐渐增加 即/v 
越往/nr 塔顶/ns 图像/n 越/d 模糊/a 而下 一组 的 图像 是 
由上 一组 图像 上 一组 倒数第 3张 即 上图 中的 
2组 的 第 0层 是 第一 组 的 上 往下 
数 第 3张 采样 得到 的 按照 隔 点 降 
采样 得到 的 即 图像 的 长 和宽/nr 分别 减半 
高斯 金字塔 的 组 数 O 是由 输入 图像 的 
分辨率 得到 的 因为 要 进行 隔 点 降 采样 
所以 在 执行 降 采样 生成 高斯 金字塔 时 一直 
到 4 * 4 大小 因为 太小 的 图片 也 
没什么 意义 了 其中 组 数 公式 为 公式 3 
其中 X 和Y/nr 分别为 输入 图像 的 长 和宽/nr ⌊ 
⌋ 表示 向下 取整 并且 每组 的 金字塔 的 层数 
为 S = s + 2 + 1   这里 
Lowe 建议 s 为 3 s 为 建议 的 2 
是 为了 不同 组 之间 能够 平滑 过渡 而在 顶部 
加上 的 2层 1 为 最底 的 原始 层 8 
假设 当前 图像 大小 为 512 * 512 则 如下 
操作 上面 公式 中 减 2 是 因为 假设 当前 
图像 即为 输入 图像 而有 的 资料 减 3 是 
因为 他们 把 自然界 作为 第 0组 而 经过 相机 
拍摄 就 成了 第 1组 所以 是 多 减 一次 
当然 了 到底 减 多少 任君 喜欢 这 不是 重点 
这时候 就 需要 依据 当前 图像 建立 自然 场景 的 
第 0 组 图像 了 即用 当前 图像 进行 插值 
得到 例如 上面 那样 的 1024 * 1024 的 一张 
图片 得到 了 组 数 之后 就是 计算 组 内 
尺度 和 组间 尺 度了 记得 这里 是 假设 当前 
得到 的 图片 的 尺度 为 0.5 的 即 第 
1组 的 第 0层 自然界 为 第 0组 即 拍照 
拍到 之后 拿到 的 那张 图片 我们 可以 很 自然 
的 知道 这是/i 有组内/nr 尺度/n 和/c 组间/i 尺度/n 的/uj 对于 
组 内 相邻 的 两幅 图片 来说 公式 4 假设 
这里 的 s 为 小写 的 不是 表示 层数 的 
那个 大 为什么 使用 1/2 这个 可以 看 lowe 的 
论文 1 所以 对于 某一 组 来说 当 s = 
3时 有=s/nr + 2 + 1 = 6幅 图片 即 
0 1 2 3 4 5 而 对于 组间 相邻 
的 尺度 来说 因为 后 一组 是 通过 前 一组 
的 倒数 第 3幅 图 进行 降 采样 得到 的 
即 前 一组 的 第 s 幅 为 将 带入 
得 其为 即 后 一组 的 第 0幅 图为 前 
一组 第 0幅 图 的 2倍 尺度 同时 推出 相邻 
两组 同 一层 的 图像 都是 2倍 尺度 关系 的 
则 总的 尺度 坐标 为 公式 5 其中 o 表示 
第 几组 r 表示 组 内 第几层 在 lowe 的 
论文 中 他 将 第 0层 也 就是 自然 界层 
的 初始 尺度 定义 为 1.6 而 我们 获取 的 
图片 初始 尺度 为 0.5 则 图像 金字塔 第 0层 
的 实际 尺度 为 sqrt 1.6 * 1.6 0.5 * 
0.5 = 1.52 之所以 可以 这么 计算 就是 因为 上面 
高斯 金字塔 之上 的 ps 部分 所述 当然 这 是 
为了 避免 检测 极值 点 之前 就 对 原始 图像 
的 高斯 平滑 以致于 图像 丢失 高频 信息 所以 才 
建议 在 建立 尺度空间 前 首先 对 原始 图像 的 
长宽 扩展 一倍 以 保留 原始 图像 的 信息 也 
就是 我们 之前 说 的 那个 假设 你 获得了 图像 
是 512 * 512 的 那么 就 弄 一个 1024 
* 1024 的 作为 最底层 图 这时候 因为 图像 扩展 
造成 的 尺度 计算 为 即 通过 计算机 得到 的 
真实 尺度 当然 这 一组 在 很多 资料 中 也叫做 
第 1 组 公式 6 本来 对于 关键点 的 检测 
可以   利用 LoG 高斯 拉普拉斯 方法 Laplacian of Gaussian 
即 图像 的 二阶 导数 能够 在 不同 的 尺度 
下 检测 到 图像 的 斑点 特征 从而 可以 确定 
图像 的 特征点 lindeberg 在 文献 scale space theory a 
basic tool for analysising structures at different scales 中 指出 
尺度 规范化 的 log 算子 具有 真正 的 尺度 不变性 
但 LoG 的 效率 不高 所以 sift 不 这么 做 
作者 对 两个 相邻 高斯 尺度空间 的 图像 相减 得到 
一个 DoG 高斯 差分 Difference of Gaussians 的 响应值 图像 
D x y σ 来 近似 LoG 公式 7 两者 
为什么 能够 等效 仔细 的 推导 可以 看 这里 的 
3.4 高斯 差分 金字塔 部分 用 DoG 代替 LoG 并不 
影响 对 图像 斑点 位置 的 检测 而且 用 DoG 
近似 LoG 可以 实现 下列 好处 第一 是 LoG 需要 
使用 两个 方向 的 高斯 二阶 微分 卷积 核 而 
DoG 直接 使用 高斯 卷积 核 省去 了 卷积 核 
生成 的 运算量 第二 是 DoG 保留 了 个 高斯 
尺度空间 的 图像 因此在 生成 某一 空间尺度 的 特征 时 
可以 直接 使用 公式 2 产生 的 尺度空间 图像 而 
无需 重新 再 次 生成 该 尺度 的 图像 第三 
是 DoG 具有 与 LoG 相同 的 性质 即 稳定 
性好 抗干扰 能力 强 为了 在 连续 的 尺度 下 
检测 图像 的 特征点 需要 建立 DoG 金字塔 而 DoG 
金字塔 的 建立 又 离不开 高斯 金字塔 的 建立 如下 
图 所示 左侧 为 高斯 金字塔 右侧 为 DoG 金字塔 
8 高斯 金字塔 的 组 内 相邻 两层 相减 而 
两 组间 的 各层 是 不能 相减 的 因此 高斯 
金字塔 每组 有s+/nr 3 层 图像 而 DoG 金字塔 每组 
则有 s + 2 层 图像 我们 可以 发现 未 
被 利用 到 的 高斯 金字塔 的 第 0组 的 
第 0层 和 最上面 一组 的 最上面 一层 而 dog 
金字塔 的 每组 的 第 0层 和 顶层 未被 用到 
原因 如下 极值 点 的 搜索 是 在 DoG 金字塔 
内 进行 的 这些 极值 点 就是 候选 的 特征点 
在 搜索 之前 我们 需要 在 DoG 金字 塔内 剔除 
那些 像素 值 过小 的 点 因为 这些 像素 具有 
较低 的 对比度 它们 肯定 不是 稳定 的 特征点 极值 
点 的 搜索 不仅 需要 在 它 所在 尺度空间 图像 
的 邻域 内 进行 还 需要 在 它 的 相邻 
尺度空间 图像 内 进行 如 2 关键点 的 定位 从 
上面 的 搜索 中 就 能够 得到 许多 的 极值 
点了 之 所谓 极值 点 就是 都是/nr 一群 待选 的 
点 不是 直接 就 可以 用 的 关键 点 因为 
它们 还 存在 一些 不 确定 的 因素 首先 是 
极值 点 的 搜索 是 在 离散 空间 内 进行 
的 并且 这些 离散 空间 还是 经过 不断 的 降 
采样 得到 的 如果把 采样 点 拟 合成 曲面 后 
我们 会 发现 原先 的 极值 点 并 不是 真正 
的 极值 点 也 就是 离散 空间 的 极值 点 
并 不是 连续 空间 的 极值 点 如 下图 4 
接下来 这 一大 段 都是 来自 参考文献 8 因为 觉得 
该 作者 讲 的 详细 所以 直接 复制 过来 这 
部分 了 为了 提高 关键点 的 稳定性 需要 对 尺度空间 
DoG 函数 进行 曲线拟合 因为 极值 点 是 一个 三维 
矢量 即 它 包括 极值 点 所在 的 图像 坐标 
及 尺度 坐标 利用 DoG 函数 在 尺度 空间 的 
Taylor 展开式 拟合 函数 假设 我们 在 点 处 展开 
展开 2 阶 即可   公式 8 对应 的 矩阵 
形式 为 公式 9 在 这里 表示 离散 空间 下 
的 插值 中心 在 离散 空间 内 也就是 采样 点 
坐标 表示 拟合 后 连续 空间 下 的 插值 点 
坐标 设 则 表示 相对于 插值 中心 插值 后的/nr 偏移量 
因此 上述 公式 可 写成 公式 10 求导 得 公式 
11 将其 置 为 0 得到 结果 为 公式 12 
将上 面的 极值 点 带入 求导 前 的 原 公式 
10 得 公式 13 对于 公式 12 所 求得 的 
偏移量 如果 大于 0.5 只要 x y 和σ/nr 任意 一个 
量 大于 0.5 则 表明 插值 点 已 偏移 到了 
它 的 临近 的 插值 中心 所以 必须 改变 当前 
的 位置 使 其为 它 所 偏 移到 的   
插值 中心 处 然后 在 新的 位置 上 重新 进行 
泰勒 级数 插值 拟合 直到 偏移量 小于 0.5 为止 x 
y 和σ/nr 都 小于 0.5 这 是 一个 迭代 的 
工程 当然 为了 避免 无限 次 的 迭代 我们 还 
需要 设置 一个 最大 迭代 次数 在 达到 了 迭代 
次数 但 仍然 没有 满足 偏移量 小于 0.5 的 情况 
下 该 极值 点 就要 被 剔除 掉 另外 如果 
由 公式 13 所 得到 的 极值 过小 即时 假设 
图像 的 灰度 值 在 0 1.0 之间 则 这样 
的 点 易 受到 噪声 的 干扰 而 变得 不 
稳定 所以 这些 点 也 应该 剔除 而在 opencv 中 
使用 的 是 下列 公式 来 判断 其 是否 为 
不 稳定 的 极值 公式 14 其中 T 为 经验 
阈值 系统 默认 初始 化为 0.04 仅仅 去除 低 对比度 
的 极值 点 对于 特征 的 稳定性 还是 远远 不够 
的 DoG 函数 在 图像 边缘 也 有着 较强 的 
边缘 响应 因此 我们 还 需要 排除 边缘 响应 一旦 
特征点 落在 图像 的 边缘 上 这些 点 就是 不 
稳定 的 点 这 是 因为 一 方面 图像 边缘 
上 的 点 是 很难 定位 的 具有 定位 的 
歧义 性 另一方面 这样 的 点 很容易 受到 噪声 的 
干扰 而 变得 不 稳定 因此 我们 一定 要 把 
这些 点 找到 并 剔除 掉 它 的 方法 与 
Harris 角 点 检测 算法 相似 即 一个 平坦 的 
DoG 响应 峰值 往往 在 横跨 边缘 的 地方 有 
较大 的 主 曲率 而在 垂直 边缘 的 方向 上有 
较小 的 主 曲率 主 曲率 可以 通过 2 × 
2 的 Hessian 矩阵 H 求出 公式 15 其中 和 
分别 表示 对 DoG 图像 中 的 像素 在 x 
轴 方向 和y/nr 轴 方向 上 求 二阶 偏 导 
和 二阶 混合 偏 导 而这 4个 值 可以 用 
有限 差分 求导 来 近似 得到 在 这里 我们 不 
需要 求 具体 的 矩阵 H 的 两个 特征值 α 
和β/nr 而 只要 知道 两个 特征值 的 比例 就 可以 
知道 该 像素点 的 主 曲率 矩阵 H 的 直 
迹 和 行列式 分别为 公式 16 公式 17 我们 首先 
剔除 掉 那些 行列式 为 负数 的 点 即 Det 
H 0 因为 如果 像素 的 曲率 有 不同 的 
符号 则 该点 肯定 不是 特征点 设 α β 并且 
α = γ β 其中 γ 1 则 公式 18 
上式 的 结果 只 与 两个 特征值 的 比例 有关 
而与 具体 的 特征值 无关 我们 知道 当 某个 像素 
的 H 矩阵 的 两个 特征值 相差 越大 即 γ 
很大 则 该 像素 越有 可能 是 边缘 对于 上面 
那个 公式 来说 当 两个 特征值 相 等时 等式 的 
值 最小 随着 γ 的 增加 等式 的 值 也 
增加 所以 要想 检查 主 曲率 的 比值 是否 小于 
某一 阈值 γ 只要 检查 下式 是否 成立 即可 公式 
19 对于 不 满足 上式 的 极值 点 就 不是 
特征点 因此 应该 把 它们 剔除 掉 Lowe 给出 γ 
为 10 在 上面 的 运算 中 需要 用到 有限 
差分法 求 偏 导 这 部分 可以 看看 这里 的 
4.3 有限 差分 求导 3 方向 角度 的 确定 上面 
这样 就算 是从 DoG 图 中找到 极值 点 然后 筛选 
下 留下 的 就是 关键 点了 这时候 为了 解决 旋转 
不变性 并且 使得 关键点 更加 的 鲁棒 就 对其 周围 
进行 深挖 将 周边 的 信息 赋予 到 这个 关键 
点上 就是 需要 根据 检测 到 的 特征 点 所在 
的 高斯 尺度 图像 的 局部 结构 求得 一个 方向 
基准 该 高斯 尺度 图像 的 尺度 σ 是 已知 
的 并且 该 尺度 是 相对于 高斯 金字塔 所在 组 
的 基准 层 的 尺度 即 公式 20 该 式子 
的 r 表示 的 是 第几层 而 下面 的 r 
表示 的 是 半径 而 所谓 局部 结构 指 的 
是 在 高斯 尺度 图像 中 以 特征点 为中心 以 
r 为 半径 的 区域 内 计算 所有 像素 梯度 
的 幅 角 和幅值/nr 半径 r 为 公式 21 其中 
σ 就是 上面 提到 的 相对 于 所在 组 的 
基准 层 的 高斯 尺度 图像 的 尺度 当然 了 
像素 梯度 的 幅 值 和幅角/nr 的 计算 公式 计算 
公式 为 公式 22 公式 23 因为 在 以 r 
为 半径 的 区域内 的 像素 梯度 幅 值 对 
圆心 处 的 特征点 的 贡献 是 不同 的 因此 
还 需要 对 幅 值 进行 加权 处理 这里 采用 
的 是 高斯 加权 该 高斯 函数 的 方差 为 
公式 24 在 完成 特征点 邻域 范围内 的 梯度 计算 
后 还要 应用 梯度方向 直方图 来 统计 邻域 内像素 的 
梯度方向 所 对应 的 幅 值 大小 具体 的 做法 
是 把 360度 分为 36 个 柱 则 每 10度 
为 一个 柱 其中 0 9 为 第 1 柱 
10 19 为 第 2 柱 以此类推 在 以 r 
为 半径 的 区域 内 把 那些 梯度方向 在 0 
9 范围内 的 像素 找出来 把 它们 的 加权 后的/nr 
梯度 幅 值 相加 在 一起 作为 第 1 柱 
的 柱 高 求 第 2 柱 以及 其他 柱 
的 高度 的 方法 相同 为了 防止 某个 梯度方向 角度 
因 受到 噪声 的 干扰 而 突变 我们 还 需要 
对 梯度方向 直方图 进行 平滑 处理 Opencv 中 直方图 以 
周围 360度 为 范围 每 10度 为 一个 柱 一共 
36个 柱 柱 所 代表 的 方向 为 像素点 梯度方向 
柱 的 长短 代表 了 梯度 幅 值 根据 Lowe 
的 建议 模板 采用 0.25 0.5 0.25 并 连续 加权 
两次 公式 25 这里 要 注意 下 不同 版本 的 
opencv 中 实现 的 方法 不 一样 其中 h 和H/nr 
分别/d 表示/v 平滑/a 前/f 和/c 平滑/a 后的/nr 直方图/n 由于 角度 
是 循环 的 即 0度 = 360度 如果 出现 h 
j j 超出 了 0 15 的 范围 那么 可以 
通过 圆周 循环 的 方法 找到 它 所 对应 的 
在 0 360度 之间 的 值 如 h 1 = 
h 35 上图 只 画了 8个 柱 该图 来自 这里 
方向 直方图 的 峰值 则 代表 了 该 特征点 处 
邻域 梯度 的 方向 以 直方图 中 最大 值 作为 
该 关键点 的 主 方向 为了 增强 匹配 的 鲁棒性 
只 保留 峰值 大于 主 方向 峰值 80％ 的 方向 
作为 该 关键点 的 辅 方向 因此 对于 同一 梯度 
值 的 多个 峰值 的 关键 点 位置 在/p 相同/d 
位置/v 和/c 尺度/n 将会/i 有/v 多个/m 关键/n 点/m 被/p 创建/v 
但/c 方向不同/l 仅有 15％ 的 关键 点 被 赋予 多个 
方向 但 可以 明显 的 提高 关键点 匹配 的 稳定性 
实际 编程 实现 中 就是 把 该 关键点 复 制成 
多份 关键点 并将 方向 值 分别 赋 给 这些 复制 
后的/nr 关键 点 并且 离散 的 梯度方向 直方图 要 进行 
插值 拟合 处理 来 求得 更 精确 的 方向 角度 
值 这样 直方图 的 主峰 值 即 最高 的 那个 
柱体 所 代表 的 方向 就是 该 特征点 处 邻域 
范围内 图像 梯度 的 主 方向 也 就是 该 特征点 
的 主 方向 由于 柱体 所 代表 的 角度 只是 
一个 范围 如 第 1 柱 的 角度 为 0 
9度 因此 还 需要 对 离散 的 梯度方向 直方图 进行 
插值 拟合 处理 以 得到 更 精确 的 方向 角度 
值 例如 我们 已经 得到 了 第 i 柱 所 
代表 的 方向 为 特征点 的 主 方向 则 拟合 
公式 为 公式 26 公式 27 其中 H 为由 公式 
34 得到 的 直方图 角度 θ 的 单位 是 度 
同样 的 上面 两个 公式 也 存在 着 之前 那个 
直方图 平滑 所 遇到 的 角度 问题 处理 的 方法 
同样 还是 利用 角度 的 圆周 循环 每个 特征点 除了 
必须 分 配 一个 主 方 向外 还 可能 有 
一个 或 更多 个 辅 方向 增加 辅 方向 的 
目的 是 为了 增强 图像匹配 的 鲁棒性 辅 方向 的 
定义 是 当 存在 另一个 柱体 高度 大于 主 方向柱 
  体 高度 的 80% 时 则 该 柱体 所 
代表 的 方向 角度 就是 该 特征点 的 辅 方向 
在 第 2 步中/nr 我们 实现 了 用 两个 信息量 
来 表示 一个 特征点 即 位置 和 尺度 那么 经过 
上面 的 计算 我们 对 特征点 的 表示 形式 又 
增加 了 一个 信息量 方向 即 如果 某 个 特征 
点 还有 一个 辅 方向 则 这个 特征点 就要 用 
两个 值 来 表示 和 其中 表示 主 方向 表示 
辅助 方向 而 其他 的 变量 x y σ 不变 
4 描述符 的 建立 描述 的 目的 在于 之前 的 
那些 零碎 的 关键 点 的 计算 之后 如何 用 
一组 向量 来 将 这个 关键 点 描述 出来 这个 
描述 子 不但 包含 关键点 也 包含 了 周边 贡献 
的 像素点 的 信息 因为 已经 有了/nr 尺度 位置 和 
方向 等 信息 所以 能够 有 较好 的 适应性 思路 
就是 对 关键 点 周围 图像 区域 分块 计算 块 
内 梯度 直方图 生成 具有 独特 性 的 向量 该向 
量 就是 该 区域 图像 信息 的 一种 抽象 具有 
唯一性 在 图像 局部 区域 内 这些 参数 可以 重复 
的 用来 描述 局部 二维 坐标系统 因为 这些 参数 具有 
不变性 下面 就 来 计算 局部 图像 区域 的 描述符 
描述符 既 具有 可区分 性 又 具有 对 某些 变量 
的 不变性 如 光亮 或 三维 视角 描述符 是 与 
关键 点 所在 的 尺度 有关 的 所以 描述 关键点 
是 需要 在 该 关键 点 所在 的 高斯 尺度 
图像 上 进行 的 在 高斯 尺度 图像 上 以 
关键点 为中心 将其 附近 邻域 划分为 d × d 个子 
区域 Lowe 取 d = 4 每 个子 区域 都是/nr 
一个 正方形 正方形 的 边 长为 3 σ 也 就是说 
正方形 的 边 长有 3 σ 个 像素点 这里 当然 
要对 3 σ 取整 σ 为 相对 于 关键 点 
所在 的 高斯 金字塔 的 组 的 基准 层 图像 
的 尺度 即 公式 20 所 表示 的 尺度 考虑 
到 实际 编程 的 需要 关键点 邻域 范围 的 边长 
应为 3 σ d + 1 因此 关键点 邻域 区域 
一共 应有 3 σ d + 1 × 3 σ 
d + 1 个 像素点 为了 保证 关键点 具有 旋转 
不变性 还 需要 以 关键点 为中心 将 上面 确定 下来 
的 关键 点 邻域 区域 旋转 θ θ 就是 该 
关键点 的 方向 由 于是 对 正方形 进行 旋转 为了 
使旋转 后的/nr 区域 包括 整个 正方形 应该/v 以/p 从/p 正方形/n 
的/uj 中心/n 到/v 它/r 的/uj 边的/nr 最长/a 距离/n 为/p 半径/n 
也 就是 正方形 对角线 长度 的 一半 即 公式 28 
所以 上述 的 关键 点 邻域 区域 实际 应该有 2r 
+ 1 × 2r + 1 个 像素点 由于 进行 
了 旋转 则 这些 采样 点 的 新 坐标 为 
公式 29 其中 是 旋转 后的/nr 像素 的 新 坐标 
是 旋转 前 的 坐标 ps 从 matrix computations . 
4th 中 可以 看到 即 上面 关键点 的 旋转 是 
逆时针 旋转 θ 度 . 上图 中上 左一/nr 到上 右 
一是 坐标系 顺时针 的 旋转 了 其实 也就 等同于 该 
坐标 逆时针 的 旋转 了 这时 我们 需要 计算 旋转 
以后 关键点 邻域 范围内 像素 的 梯度 幅 值 和 
梯度 幅 角 这里 的 梯度 幅 值 还 需要 
根据 其 对 中心 特征点 贡献 的 大小 进行 加权 
处理 加 权函数 仍然 采用 高斯 函数 它 的 方差 
的 平方 为 在 实际 应用 中 我们 是 先以 
关键点 为 圆心 以 公式 28 中的 r 为 半径 
计算/v 该/r 圆/n 内/n 所有/b 像素/n 的/uj 梯度/n 幅/n 角/n 
和/c 高斯/nr 加权/v 后的/nr 梯度/n 幅/n 值/n 然后 再 根据 
公式 29 得到 这些 幅 值 和幅角/nr 所 对应 的 
像素 在 旋转 以后 新的 坐标 位置 在 计算 关键点 
描述符 的 时候 我们 不 需要 精确 知道 邻域 内 
所有 像素 的 梯度 幅 值 和幅角/nr 我们 只 需要 
根据 直方图 知道 其 统计 值 即可 这里 的 直方图 
是 三维 直方图 如 下图 所示 上图 中的 三维 直方图 
为 一个 立方体 立方体 的 底 就是 关键点 邻域 区域 
如 前面 所述 该 区域 被 分为 4 × 4 
个子 区域 即 16 个子 区域 邻 域内 的 像素 
根据 其 坐标 位置 把 它们 归属于 这 16 个子 
区域 中 的 一个 立方体 的 三维 直方图 的 高为/nr 
邻域 像素 幅 角 的 大小 我们 把 360 度 
的 幅 角 范围 进行 8 等分 每一个 等份 为 
45 度 则 再 根据 邻域 像素 梯度 幅 角 
的 大小 把 它们 归属于 这 8 等份 中的 一份 
这样 三维 直方图 就 建立 了 起来 即 以 关键点 
为 中心 的 邻域 像素 根据 其 坐标 位置 以及 
它 的 幅 角 的 大小 被 划归 为 某个 
小 正方体 如 显然 正方体 的 中心 应该 代表 着 
该 正方体 但 落入 正方 体内 的 邻域 像素 不 
可能 都 在中心 因此 我们 应该 对 上面 提到 的 
梯度 幅 值 做 进一步 处理 根据 它 对 中心 
点 位置 的 贡献 大小 进行 加权 处理 即在 正方 
体内 根据 像素点 相对于 正方体 中心 的 距离 对 梯度 
幅 值 做 加权 处理 所以 三维 直方图 的 值 
即 正方体 的 值 共 需要 下面 4 个 步骤 
完成 1 计算 落入 该 正方 体内 的 邻域 像素 
的 梯度 幅 值 A 2 根据 该 像素 相对于 
关键点 的 距离 对 A 进行 高斯 加权 处理 得到 
B 3 根据 该 像素 相对于 它 所在 的 正方体 
的 中心 的 贡献 大小 再 对 B 进行 加权 
处理 得到 C 4 对 所有 落入 该 正方 体内 
的 像素 做 上述 处理 再 进行 求和 运算 Σ 
C 得到 D 由于 计算 相对于 正方体 中心点 的 贡献 
大小 略显 繁琐 因此 在 实际 应用 中 我们 需要 
经过 坐标 平移 把 中心点 平 移到 正方体 的 顶点 
上 这样 只 要 计算 正方 体内 的 点 对 
正方体 的 8 个 顶点 的 贡献 大小 即可 根据 
三线性 插值法 对 某个 顶点 的 贡献 值 是 以该 
顶点 和 正方 体内 的 点 为 对角线 的 两个 
顶点 所 构成 的 立方体 的 体积 如 公式 30 
经过 上面 的 三维 直方图 的 计算 最终 我们 得到 
了 该 特征点 的 特征 矢量 为了 去除 光照 变化 
的 影响 需要 对 特征 矢量 进行 归一化 处理 即 
公式 31 则为 归一化 后的/nr 特征 矢量 尽管 通过 归一化 
处理 可以 消除 对 光照 变化 的 影响 但 由于 
照相机 饱和 以及 三维 物体 表面 的 不同 数量 不同 
角度 的 光照 变化 所 引起 的 非线性 光照 变化 
仍然 存在 它 能够 影响 到 一些 梯度 的 相对 
幅 值 但 不太 会 影响 梯度 幅 角 为了 
消除 这 部分 的 影响 我们 还 需要 设 一个 
t = 0.2 的 阈值 保留 Q 中 小于 0.2 
的 元素 而把 Q 中 大于 0.2 的 元素 用 
0.2 替代 最后 再 对 Q 进行 一次 归一化 处理 
以 提高 关键点 的 可区分 性 备注 上面 的 4 
描述符 的 建立 还未 完全 的 理解 透 所以 是 
完整 的 照抄 的 接下来 将 会 分析 opencv 中的 
sift 代码 加深理解 然后 回 来 修改 2015年 09月 25日 
第 0次 修改 参考资料 1   Lowe SIFT 原文 http 
/ / www . cs . ubc . ca / 
~ lowe / papers / ijcv04 . pdf 2   
SIFT 特征提取 分析 http / / blog . csdn . 
net / abcjennifer / article / details / 7639681 3 
  王永明 王贵 锦 . 图像 局部 不变性 特征 与 
描述 . M 国防 工业 出版社 4   SIFT 算法 
详解 http / / blog . csdn . net / 
zddblog / article / details / 7521424 5 sift 论文 
翻译 http / / www . cnblogs . com / 
cuteshongshong / archive / 2012/05 / 25/2506374 . html 6 
Scale space theory in computer vision   7 尺度空间 维基 
https / / en . wikipedia . org / wiki 
/ Scale _ space 8   赵春江 opencv2 . 4.9 
源码 分析 SIFT http / / blog . csdn . 
net / zhaocj 