一/m,、/w,mask/en,生成/vn,概览/n,上/f,一节/mq,的/u,末尾/n,，/w,我们/r,已经/d,获取/v,了/u,待/v,检测/vn,图片/n,的/u,分类/vn,回归/v,信息/n,，/w,我们/r,将/d,回归/v,信息/n,（/w,即/v,待/v,检测/vn,目标/n,的/u,边框/n,信息/n,）/w,单独/d,提取/v,出来/v,，/w,结合/v,金字塔/n,特征/n,mrcnn/en,_,feature/en,_,maps/en,，/w,进行/v,mask/en,生成/vn,工作/vn,（/w,input/en,_,image/en,_,meta/en,用于/v,提取/v,输入/v,图片/n,长/a,宽/a,，/w,进行/v,金字塔/n,roi/en,处理/v,，/w,即/v,pyramidroialign/en,）/w,。/w,#, ,detections/en, ,#, ,output/en, ,is/en, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w, ,in/en, ,#, ,normalized/en, ,coordinates/en, ,detections/en, ,=/w, ,detectionlayer/en,(/w,config/en,,/w, ,name/en,=/w,"/w,mrcnn/en,_,detection/en,"/w,)/w,(/w, ,[/w,rpn/en,_,rois/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w, ,input/en,_,image/en,_,meta/en,]/w,)/w, ,#, ,create/en, ,masks/en, ,for/en, ,detections/en, ,detection/en,_,boxes/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en,[/w,./w,./w,./w,,/w, ,:/w,4/m,]/w,)/w,(/w,detections/en,)/w, ,mrcnn/en,_,mask/en, ,=/w, ,build/en,_,fpn/en,_,mask/en,_,graph/en,(/w,detection/en,_,boxes/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,config/en,./w,mask/en,_,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w,二/m,、/w,mask/en,生成/vn,函数/n,我们/r,在/p,『/w,计算机/n,视觉/n,』/w,mask/en,-/w,rcnn/en,_,推断/vn,网络/n,其/r,四/m,：/w,fpn/en,和/c,roialign/en,的/u,耦合/vn,已经/d,介绍/v,过/u,了/u,pyramidroialign/en, ,class/en,的/u,内容/n,，/w,def/en, ,build/en,_,fpn/en,_,mask/en,_,graph/en,(/w,rois/en,,/w, ,feature/en,_,maps/en,,/w, ,image/en,_,meta/en,,/w, ,pool/en,_,size/en,,/w, ,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,true/en,)/w,:/w, ,"/w,"/w,"/w,builds/en, ,the/en, ,computation/en, ,graph/en, ,of/en, ,the/en, ,mask/en, ,head/en, ,of/en, ,feature/en, ,pyramid/en, ,network/en,./w, ,rois/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,proposal/en, ,boxes/en, ,in/en, ,normalized/en, ,coordinates/en,./w, ,feature/en,_,maps/en,:/w, ,list/en, ,of/en, ,feature/en, ,maps/en, ,from/en, ,different/en, ,layers/en, ,of/en, ,the/en, ,pyramid/en,,/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,]/w,./w, ,each/en, ,has/en, ,a/en, ,different/en, ,resolution/en,./w, ,image/en,_,meta/en,:/w, ,[/w,batch/en,,/w, ,(/w,meta/en, ,data/en,)/w,]/w, ,image/en, ,details/en,./w, ,see/en, ,compose/en,_,image/en,_,meta/en,(/w,)/w, ,pool/en,_,size/en,:/w, ,the/en, ,width/en, ,of/en, ,the/en, ,square/en, ,feature/en, ,map/en, ,generated/en, ,from/en, ,roi/en, ,pooling/en,./w, ,num/en,_,classes/en,:/w, ,number/en, ,of/en, ,classes/en,,/w, ,which/en, ,determines/en, ,the/en, ,depth/en, ,of/en, ,the/en, ,results/en, ,train/en,_,bn/en,:/w, ,boolean/en,./w, ,train/en, ,or/en, ,freeze/en, ,batch/en, ,norm/en, ,layers/en, ,returns/en,:/w, ,masks/en, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,num/en,_,classes/en,]/w, ,"/w,"/w,"/w, ,#, ,roi/en, ,pooling/en, ,#, ,shape/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,channels/en,]/w, ,x/en, ,=/w, ,pyramidroialign/en,(/w,[/w,pool/en,_,size/en,,/w, ,pool/en,_,size/en,]/w,,/w, ,name/en,=/w,"/w,roi/en,_,align/en,_,mask/en,"/w,)/w,(/w,[/w,rois/en,,/w, ,image/en,_,meta/en,]/w, ,+/w, ,feature/en,_,maps/en,)/w, ,#, ,conv/en, ,layers/en, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,conv/en,1/m,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,mask/en,_,bn/en,1/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,conv/en,2/m,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,mask/en,_,bn/en,2/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,conv/en,3/m,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,mask/en,_,bn/en,3/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,256/m,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,conv/en,4/m,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,batchnorm/en,(/w,)/w,,/w, ,name/en,=/w,'/w,mrcnn/en,_,mask/en,_,bn/en,4/m,'/w,)/w,(/w,x/en,,/w, ,training/en,=/w,train/en,_,bn/en,)/w, ,x/en, ,=/w, ,kl/en,./w,activation/en,(/w,'/w,relu/en,'/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,dtranspose/en,(/w,256/m,,/w, ,(/w,2/m,,/w, ,2/m,)/w,,/w, ,strides/en,=/w,2/m,,/w, ,activation/en,=/w,"/w,relu/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,deconv/en,"/w,)/w,(/w,x/en,)/w, ,x/en, ,=/w, ,kl/en,./w,timedistributed/en,(/w,kl/en,./w,conv/en,2/m,d/en,(/w,num/en,_,classes/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,strides/en,=/w,1/m,,/w, ,activation/en,=/w,"/w,sigmoid/en,"/w,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,"/w,)/w,(/w,x/en,)/w, ,return/en, ,xpyramidroialign/en,之后/f,（/w,这里/r,会/v,降/v,采样/v,一次/mq,）/w,，/w,最终/d,生成/vn,众多/m,宽/a,高/a,等同/v,输入/v,roi/en, ,feat/en,，/w,但是/c,是/v,单/d,通道/n,的/u,mask/en,输出/v,（/w,最后/f,的/u,激活/vn,函数/n,很/d,疯狂/a,，/w,relu/en,接/v,sigmoid/en,，/w,保证/v,每个/r,像素/n,位置/n,介于/v,01/m,之间/f,）/w,，/w,此时/r,的/u,mask/en,掩码/nw,输出/v,大小/n,为/p,[/w,2/m,*/w,mask/en,_,pool/en,_,size/en,,/w, ,2/m,*/w,mask/en,_,pool/en,_,size/en,]/w,，/w,对/p,demo/en,./w,pynb/en,而言/u,是/v,28/m,*/w,28/m,（/w,源码/nw,注释/vn,给/p,的/u,数目/n,是/v,没有/v,*/w,2/m,的/u,，/w,由于/c,最后/f,有/v,一个/m,stride/en,为/p,2/m,的/u,转置/nw,卷积/nw,，/w,所以/c,应该/v,是/v,疏忽/vn,，/w,毕竟/d,config/en,的/u,另外/c,一个/m,参量/n,mask/en,_,shape/en,值/n,为/p,28/m,*/w,28/m,，/w,虽然/c,在/p,推断/vn,网络/n,没有/v,使用/v,到/v,）/w,。/w,至此/d,，/w,推断/vn,网络/n,的/u,最后/f,一个/m,输出/v,——/w,对象/n,级别/n,原始/a,mask/en,计算/v,了/u,出来/v,。/w,三/m,、/w,build/en,函数/n,返回/v,然后/c,，/w,我们/r,将/d,整个/b,build/en,函数/n,构建/v,model/en,所/u,需要/v,的/u,输入/v,tensor/en,和/c,输出/v,tensor/en,进行/v,打包/vn,，/w,创建/v,keras/en,模型/n,，/w,model/en, ,=/w, ,km/en,./w,model/en,(/w,[/w,input/en,_,image/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,input/en,_,anchors/en,]/w,,/w, ,[/w,detections/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w, ,mrcnn/en,_,mask/en,,/w, ,rpn/en,_,rois/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,]/w,,/w, ,name/en,=/w,'/w,mask/en,_,rcnn/en,'/w,)/w, ,#, ,add/en, ,multi/en,-/w,gpu/en, ,support/en,./w, ,if/en, ,config/en,./w,gpu/en,_,count/en, ,>, ,1/m,:/w, ,from/en, ,mrcnn/en,./w,parallel/en,_,model/en, ,import/en, ,parallelmodel/en, ,model/en, ,=/w, ,parallelmodel/en,(/w,model/en,,/w, ,config/en,./w,gpu/en,_,count/en,)/w, ,return/en, ,model/en,整理/v,一下/m,模型/n,输出/v,tensor/en,：/w,#, ,num/en,_,anchors/en,,/w, ,每张/r,图片/n,上/f,生成/vn,的/u,锚框/nw,数量/n,#, ,num/en,_,rois/en,,/w, ,每张/r,图片/n,上/f,由/p,锚框/nw,筛选/v,出/v,的/u,推荐区/ns,数量/n,，/w,#, ,#, ,由/p, ,post/en,_,nms/en,_,rois/en,_,training/en, ,或/c, ,post/en,_,nms/en,_,rois/en,_,inference/en, ,规定/n,#, ,num/en,_,detections/en,,/w, ,每张/r,图片/n,上/f,最终/d,检测/vn,输出/v,框/q,，/w,#, ,#, ,由/p, ,detection/en,_,max/en,_,instances/en, ,规定/n,#, ,detections/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w,#, ,mrcnn/en,_,class/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,probabilities/en,#, ,mrcnn/en,_,bbox/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w,#, ,mrcnn/en,_,mask/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,num/en,_,classes/en,]/w,#, ,rpn/en,_,rois/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w,#, ,rpn/en,_,class/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,anchors/en,,/w, ,2/m,]/w,#, ,rpn/en,_,bbox/en, ,[/w,batch/en,,/w, ,num/en,_,anchors/en,,/w, ,4/m,]/w,由于/c,我们/r,的/u,gpu/en,_,count/en,为/p,1/m,，/w,不/d,是/v,多卡/nrf,训练/vn,，/w,所以/c,不/d,需要/v,gpu/en,支持/v,（/w,多/a,gpu/en,模型/n,后面/f,应该/v,会/v,单/d,开/v,一节/mq,讲/v,）/w,，/w,直接/ad,将/d,model/en,返回/v,即可/v,。/w,附/v,、/w,maskrcnn/en, ,class/en,网络/n,构建/v,方法/n,总览/nw,再次/d,将/d,build/en,函数/n,全貌/n,贴/v,出/v,，/w,分支/n,选项/v,按照/p,mode/en,=/w,'/w,inference/en,'/w,选/v,即/v,为/p,本/r,系列/q,推断/vn,网络/n,的/u,内容/n,。/w,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#, ,#, ,maskrcnn/en, ,class/en, ,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#,#, ,class/en, ,maskrcnn/en,(/w,)/w,:/w, ,"/w,"/w,"/w,encapsulates/en, ,the/en, ,mask/en, ,rcnn/en, ,model/en, ,functionality/en,./w, ,the/en, ,actual/en, ,keras/en, ,model/en, ,is/en, ,in/en, ,the/en, ,keras/en,_,model/en, ,property/en,./w, ,"/w,"/w,"/w, ,def/en, ,_,_,init/en,_,_,(/w,self/en,,/w, ,mode/en,,/w, ,config/en,,/w, ,model/en,_,dir/en,)/w,:/w, ,"/w,"/w,"/w, ,mode/en,:/w, ,either/en, ,"/w,training/en,"/w, ,or/en, ,"/w,inference/en,"/w, ,config/en,:/w, ,a/en, ,sub/en,-/w,class/en, ,of/en, ,the/en, ,config/en, ,class/en, ,model/en,_,dir/en,:/w, ,directory/en, ,to/en, ,save/en, ,training/en, ,logs/en, ,and/en, ,trained/en, ,weights/en, ,"/w,"/w,"/w, ,assert/en, ,mode/en, ,in/en, ,[/w,'/w,training/en,'/w,,/w, ,'/w,inference/en,'/w,]/w, ,self/en,./w,mode/en, ,=/w, ,mode/en, ,self/en,./w,config/en, ,=/w, ,config/en, ,self/en,./w,model/en,_,dir/en, ,=/w, ,model/en,_,dir/en, ,self/en,./w,set/en,_,log/en,_,dir/en,(/w,)/w, ,self/en,./w,keras/en,_,model/en, ,=/w, ,self/en,./w,build/en,(/w,mode/en,=/w,mode/en,,/w, ,config/en,=/w,config/en,)/w, ,def/en, ,build/en,(/w,self/en,,/w, ,mode/en,,/w, ,config/en,)/w,:/w, ,"/w,"/w,"/w,build/en, ,mask/en, ,r/en,-/w,cnn/en, ,architecture/en,./w, ,input/en,_,shape/en,:/w, ,the/en, ,shape/en, ,of/en, ,the/en, ,input/en, ,image/en,./w, ,mode/en,:/w, ,either/en, ,"/w,training/en,"/w, ,or/en, ,"/w,inference/en,"/w,./w, ,the/en, ,inputs/en, ,and/en, ,outputs/en, ,of/en, ,the/en, ,model/en, ,differ/en, ,accordingly/en,./w, ,"/w,"/w,"/w, ,assert/en, ,mode/en, ,in/en, ,[/w,'/w,training/en,'/w,,/w, ,'/w,inference/en,'/w,]/w, ,#, ,image/en, ,size/en, ,must/en, ,be/en, ,dividable/en, ,by/en, ,2/m, ,multiple/en, ,times/en, ,h/en,,/w, ,w/en, ,=/w, ,config/en,./w,image/en,_,shape/en,[/w,:/w,2/m,]/w, ,#, ,[/w,1024/m, ,1024/m, ,3/m,]/w, ,if/en, ,h/en, ,//w, ,2/m,*/w,*/w,6/m, ,!/w,=/w, ,int/en,(/w,h/en, ,//w, ,2/m,*/w,*/w,6/m,)/w, ,or/en, ,w/en, ,//w, ,2/m,*/w,*/w,6/m, ,!/w,=/w, ,int/en,(/w,w/en, ,//w, ,2/m,*/w,*/w,6/m,)/w,:/w, ,#, ,这里/r,就/d,限定/v,了/u,下/f,采样/v,不/d,会/v,产生/v,坐标/n,误差/n, ,raise/en, ,exception/en,(/w,"/w,image/en, ,size/en, ,must/en, ,be/en, ,dividable/en, ,by/en, ,2/m, ,at/en, ,least/en, ,6/m, ,times/en, ,"/w, ,"/w,to/en, ,avoid/en, ,fractions/en, ,when/en, ,downscaling/en, ,and/en, ,upscaling/en,./w,"/w, ,"/w,for/en, ,example/en,,/w, ,use/en, ,256/m,,/w, ,320/m,,/w, ,384/m,,/w, ,448/m,,/w, ,512/m,,/w, ,./w,./w,./w, ,etc/en,./w, ,"/w,)/w, ,#, ,inputs/en, ,input/en,_,image/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,none/en,,/w, ,config/en,./w,image/en,_,shape/en,[/w,2/m,]/w,]/w,,/w, ,name/en,=/w,"/w,input/en,_,image/en,"/w,)/w, ,input/en,_,image/en,_,meta/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,config/en,./w,image/en,_,meta/en,_,size/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,image/en,_,meta/en,"/w,)/w, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,#, ,rpn/en, ,gt/en, ,input/en,_,rpn/en,_,match/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,1/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,rpn/en,_,match/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,input/en,_,rpn/en,_,bbox/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,rpn/en,_,bbox/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,detection/en, ,gt/en, ,(/w,class/en, ,ids/en,,/w, ,bounding/en, ,boxes/en,,/w, ,and/en, ,masks/en,)/w, ,#, ,1/m,./w, ,gt/en, ,class/en, ,ids/en, ,(/w,zero/en, ,padded/en,)/w, ,input/en,_,gt/en,_,class/en,_,ids/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,class/en,_,ids/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,int/en,32/m,)/w, ,#, ,2/m,./w, ,gt/en, ,boxes/en, ,in/en, ,pixels/en, ,(/w,zero/en, ,padded/en,)/w, ,#, ,[/w,batch/en,,/w, ,max/en,_,gt/en,_,instances/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,image/en, ,coordinates/en, ,input/en,_,gt/en,_,boxes/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,boxes/en,"/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,normalize/en, ,coordinates/en, ,gt/en,_,boxes/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,norm/en,_,boxes/en,_,graph/en,(/w, ,x/en,,/w, ,k/en,./w,shape/en,(/w,input/en,_,image/en,)/w,[/w,1/m,:/w,3/m,]/w,)/w,)/w,(/w,input/en,_,gt/en,_,boxes/en,)/w, ,#, ,3/m,./w, ,gt/en, ,masks/en, ,(/w,zero/en, ,padded/en,)/w, ,#, ,[/w,batch/en,,/w, ,height/en,,/w, ,width/en,,/w, ,max/en,_,gt/en,_,instances/en,]/w, ,if/en, ,config/en,./w,use/en,_,mini/en,_,mask/en,:/w, ,input/en,_,gt/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,0/m,]/w,,/w, ,config/en,./w,mini/en,_,mask/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,else/en,:/w, ,input/en,_,gt/en,_,masks/en, ,=/w, ,kl/en,./w,input/en,(/w, ,shape/en,=/w,[/w,config/en,./w,image/en,_,shape/en,[/w,0/m,]/w,,/w, ,config/en,./w,image/en,_,shape/en,[/w,1/m,]/w,,/w, ,none/en,]/w,,/w, ,name/en,=/w,"/w,input/en,_,gt/en,_,masks/en,"/w,,/w, ,dtype/en,=/w,bool/en,)/w, ,elif/en, ,mode/en, ,=/w,=/w, ,"/w,inference/en,"/w,:/w, ,#, ,anchors/en, ,in/en, ,normalized/en, ,coordinates/en, ,input/en,_,anchors/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,none/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,anchors/en,"/w,)/w, ,#, ,build/en, ,the/en, ,shared/en, ,convolutional/en, ,layers/en,./w, ,#, ,bottom/en,-/w,up/en, ,layers/en, ,#, ,returns/en, ,a/en, ,list/en, ,of/en, ,the/en, ,last/en, ,layers/en, ,of/en, ,each/en, ,stage/en,,/w, ,5/m, ,in/en, ,total/en,./w, ,#, ,don/en,'/w,t/en, ,create/en, ,the/en, ,thead/en, ,(/w,stage/en, ,5/m,)/w,,/w, ,so/en, ,we/en, ,pick/en, ,the/en, ,4/m,th/en, ,item/en, ,in/en, ,the/en, ,list/en,./w, ,if/en, ,callable/en,(/w,config/en,./w,backbone/en,)/w,:/w, ,_,,/w, ,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m, ,=/w, ,config/en,./w,backbone/en,(/w,input/en,_,image/en,,/w, ,stage/en,5/m,=/w,true/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,else/en,:/w, ,_,,/w, ,c/en,2/m,,/w, ,c/en,3/m,,/w, ,c/en,4/m,,/w, ,c/en,5/m, ,=/w, ,resnet/en,_,graph/en,(/w,input/en,_,image/en,,/w, ,config/en,./w,backbone/en,,/w, ,stage/en,5/m,=/w,true/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,#, ,top/en,-/w,down/en, ,layers/en, ,#, ,todo/en,:/w, ,add/en, ,assert/en, ,to/en, ,varify/en, ,feature/en, ,map/en, ,sizes/en, ,match/en, ,what/en,'/w,s/en, ,in/en, ,config/en, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,5/m,p/en,5/m,'/w,)/w,(/w,c/en,5/m,)/w, ,#, ,256/m, ,p/en,4/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,4/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,upsampled/en,"/w,)/w,(/w,p/en,5/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,4/m,p/en,4/m,'/w,)/w,(/w,c/en,4/m,)/w,]/w,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,3/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,upsampled/en,"/w,)/w,(/w,p/en,4/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,3/m,p/en,3/m,'/w,)/w,(/w,c/en,3/m,)/w,]/w,)/w, ,p/en,2/m, ,=/w, ,kl/en,./w,add/en,(/w,name/en,=/w,"/w,fpn/en,_,p/en,2/m,add/en,"/w,)/w,(/w,[/w, ,kl/en,./w,upsampling/en,2/m,d/en,(/w,size/en,=/w,(/w,2/m,,/w, ,2/m,)/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,3/m,upsampled/en,"/w,)/w,(/w,p/en,3/m,)/w,,/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,1/m,,/w, ,1/m,)/w,,/w, ,name/en,=/w,'/w,fpn/en,_,c/en,2/m,p/en,2/m,'/w,)/w,(/w,c/en,2/m,)/w,]/w,)/w, ,#, ,attach/en, ,3/m,x/en,3/m, ,conv/en, ,to/en, ,all/en, ,p/en, ,layers/en, ,to/en, ,get/en, ,the/en, ,final/en, ,feature/en, ,maps/en,./w, ,p/en,2/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,2/m,"/w,)/w,(/w,p/en,2/m,)/w, ,p/en,3/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,3/m,"/w,)/w,(/w,p/en,3/m,)/w, ,p/en,4/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,4/m,"/w,)/w,(/w,p/en,4/m,)/w, ,p/en,5/m, ,=/w, ,kl/en,./w,conv/en,2/m,d/en,(/w,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,,/w, ,(/w,3/m,,/w, ,3/m,)/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,5/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,p/en,6/m, ,is/en, ,used/en, ,for/en, ,the/en, ,5/m,th/en, ,anchor/en, ,scale/en, ,in/en, ,rpn/en,./w, ,generated/en, ,by/en, ,#, ,subsampling/en, ,from/en, ,p/en,5/m, ,with/en, ,stride/en, ,of/en, ,2/m,./w, ,p/en,6/m, ,=/w, ,kl/en,./w,maxpooling/en,2/m,d/en,(/w,pool/en,_,size/en,=/w,(/w,1/m,,/w, ,1/m,)/w,,/w, ,strides/en,=/w,2/m,,/w, ,name/en,=/w,"/w,fpn/en,_,p/en,6/m,"/w,)/w,(/w,p/en,5/m,)/w, ,#, ,note/en, ,that/en, ,p/en,6/m, ,is/en, ,used/en, ,in/en, ,rpn/en,,/w, ,but/en, ,not/en, ,in/en, ,the/en, ,classifier/en, ,heads/en,./w, ,rpn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,,/w, ,p/en,6/m,]/w, ,mrcnn/en,_,feature/en,_,maps/en, ,=/w, ,[/w,p/en,2/m,,/w, ,p/en,3/m,,/w, ,p/en,4/m,,/w, ,p/en,5/m,]/w, ,#, ,anchors/en, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,anchors/en, ,=/w, ,self/en,./w,get/en,_,anchors/en,(/w,config/en,./w,image/en,_,shape/en,)/w, ,#, ,duplicate/en, ,across/en, ,the/en, ,batch/en, ,dimension/en, ,because/en, ,keras/en, ,requires/en, ,it/en, ,#, ,todo/en,:/w, ,can/en, ,this/en, ,be/en, ,optimized/en, ,to/en, ,avoid/en, ,duplicating/en, ,the/en, ,anchors/en,?/w, ,anchors/en, ,=/w, ,np/en,./w,broadcast/en,_,to/en,(/w,anchors/en,,/w, ,(/w,config/en,./w,batch/en,_,size/en,,/w,)/w, ,+/w, ,anchors/en,./w,shape/en,)/w, ,#, ,a/en, ,hack/en, ,to/en, ,get/en, ,around/en, ,keras/en,'/w,s/en, ,bad/en, ,support/en, ,for/en, ,constants/en, ,anchors/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,tf/en,./w,variable/en,(/w,anchors/en,)/w,,/w, ,name/en,=/w,"/w,anchors/en,"/w,)/w,(/w,input/en,_,image/en,)/w, ,else/en,:/w, ,anchors/en, ,=/w, ,input/en,_,anchors/en, ,#, ,rpn/en, ,model/en,,/w, ,返回/v,的/u,是/v,keras/en,的/u,module/en,对象/n,,/w, ,注意/v,keras/en,中/f,的/u,module/en,对象/n,是/v,可/v,call/en,的/u, ,rpn/en, ,=/w, ,build/en,_,rpn/en,_,model/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,stride/en,,/w, ,#, ,1/m, ,3/m, ,256/m, ,len/en,(/w,config/en,./w,rpn/en,_,anchor/en,_,ratios/en,)/w,,/w, ,config/en,./w,top/en,_,down/en,_,pyramid/en,_,size/en,)/w, ,#, ,loop/en, ,through/en, ,pyramid/en, ,layers/en, ,layer/en,_,outputs/en, ,=/w, ,[/w,]/w, ,#, ,list/en, ,of/en, ,lists/en, ,for/en, ,p/en, ,in/en, ,rpn/en,_,feature/en,_,maps/en,:/w, ,layer/en,_,outputs/en,./w,append/en,(/w,rpn/en,(/w,[/w,p/en,]/w,)/w,)/w, ,#, ,保存/v,各/r,pyramid/en,特征/n,经过/p,rpn/en,之后/f,的/u,结果/n, ,#, ,concatenate/en, ,layer/en, ,outputs/en, ,#, ,convert/en, ,from/en, ,list/en, ,of/en, ,lists/en, ,of/en, ,level/en, ,outputs/en, ,to/en, ,list/en, ,of/en, ,lists/en, ,#, ,of/en, ,outputs/en, ,across/en, ,levels/en,./w, ,#, ,e/en,./w,g/en,./w, ,[/w,[/w,a/en,1/m,,/w, ,b/en,1/m,,/w, ,c/en,1/m,]/w,,/w, ,[/w,a/en,2/m,,/w, ,b/en,2/m,,/w, ,c/en,2/m,]/w,]/w, ,=/w,>, ,[/w,[/w,a/en,1/m,,/w, ,a/en,2/m,]/w,,/w, ,[/w,b/en,1/m,,/w, ,b/en,2/m,]/w,,/w, ,[/w,c/en,1/m,,/w, ,c/en,2/m,]/w,]/w, ,output/en,_,names/en, ,=/w, ,[/w,"/w,rpn/en,_,class/en,_,logits/en,"/w,,/w, ,"/w,rpn/en,_,class/en,"/w,,/w, ,"/w,rpn/en,_,bbox/en,"/w,]/w, ,outputs/en, ,=/w, ,list/en,(/w,zip/en,(/w,*/w,layer/en,_,outputs/en,)/w,)/w, ,#, ,[/w,[/w,logits/en,2/m,,/w,……/w,6/m,]/w,,/w, ,[/w,class/en,2/m,,/w,……/w,6/m,]/w,,/w, ,[/w,bbox/en,2/m,,/w,……/w,6/m,]/w,]/w, ,outputs/en, ,=/w, ,[/w,kl/en,./w,concatenate/en,(/w,axis/en,=/w,1/m,,/w, ,name/en,=/w,n/en,)/w,(/w,list/en,(/w,o/en,)/w,)/w, ,for/en, ,o/en,,/w, ,n/en, ,in/en, ,zip/en,(/w,outputs/en,,/w, ,output/en,_,names/en,)/w,]/w, ,#, ,[/w,batch/en,,/w, ,num/en,_,anchors/en,,/w, ,2/m,//w,4/m,]/w, ,#, ,其中/r,num/en,_,anchors/en,指/v,的/u,是/v,全部/m,特征/n,层/q,上/f,的/u,anchors/en,总数/n, ,rpn/en,_,class/en,_,logits/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en, ,=/w, ,outputs/en, ,#, ,generate/en, ,proposals/en, ,#, ,proposals/en, ,are/en, ,[/w,batch/en,,/w, ,n/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,in/en, ,normalized/en, ,coordinates/en, ,#, ,and/en, ,zero/en, ,padded/en,./w, ,#, ,post/en,_,nms/en,_,rois/en,_,inference/en, ,=/w, ,1000/m, ,#, ,post/en,_,nms/en,_,rois/en,_,training/en, ,=/w, ,2000/m, ,proposal/en,_,count/en, ,=/w, ,config/en,./w,post/en,_,nms/en,_,rois/en,_,training/en, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,\/w, ,else/en, ,config/en,./w,post/en,_,nms/en,_,rois/en,_,inference/en, ,#, ,[/w,images/en,_,per/en,_,gpu/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,)/w,]/w, ,#, ,images/en,_,per/en,_,gpu/en,取代/v,了/u,batch/en,，/w,之后/f,说/v,的/u,batch/en,都/d,是/v,images/en,_,per/en,_,gpu/en, ,rpn/en,_,rois/en, ,=/w, ,proposallayer/en,(/w, ,proposal/en,_,count/en,=/w,proposal/en,_,count/en,,/w, ,nms/en,_,threshold/en,=/w,config/en,./w,rpn/en,_,nms/en,_,threshold/en,,/w, ,#, ,0.7/m, ,name/en,=/w,"/w,roi/en,"/w,,/w, ,config/en,=/w,config/en,)/w,(/w,[/w,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,,/w, ,anchors/en,]/w,)/w, ,if/en, ,mode/en, ,=/w,=/w, ,"/w,training/en,"/w,:/w, ,#, ,class/en, ,id/en, ,mask/en, ,to/en, ,mark/en, ,class/en, ,ids/en, ,supported/en, ,by/en, ,the/en, ,dataset/en, ,the/en, ,image/en, ,#, ,came/en, ,from/en,./w, ,active/en,_,class/en,_,ids/en, ,=/w, ,kl/en,./w,lambda/en,(/w, ,lambda/en, ,x/en,:/w, ,parse/en,_,image/en,_,meta/en,_,graph/en,(/w,x/en,)/w,[/w,"/w,active/en,_,class/en,_,ids/en,"/w,]/w, ,)/w,(/w,input/en,_,image/en,_,meta/en,)/w, ,if/en, ,not/en, ,config/en,./w,use/en,_,rpn/en,_,rois/en,:/w, ,#, ,ignore/en, ,predicted/en, ,rois/en, ,and/en, ,use/en, ,rois/en, ,provided/en, ,as/en, ,an/en, ,input/en,./w, ,input/en,_,rois/en, ,=/w, ,kl/en,./w,input/en,(/w,shape/en,=/w,[/w,config/en,./w,post/en,_,nms/en,_,rois/en,_,training/en,,/w, ,4/m,]/w,,/w, ,name/en,=/w,"/w,input/en,_,roi/en,"/w,,/w, ,dtype/en,=/w,np/en,./w,int/en,32/m,)/w, ,#, ,normalize/en, ,coordinates/en, ,target/en,_,rois/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,norm/en,_,boxes/en,_,graph/en,(/w, ,x/en,,/w, ,k/en,./w,shape/en,(/w,input/en,_,image/en,)/w,[/w,1/m,:/w,3/m,]/w,)/w,)/w,(/w,input/en,_,rois/en,)/w, ,else/en,:/w, ,target/en,_,rois/en, ,=/w, ,rpn/en,_,rois/en, ,#, ,generate/en, ,detection/en, ,targets/en, ,#, ,subsamples/en, ,proposals/en, ,and/en, ,generates/en, ,target/en, ,outputs/en, ,for/en, ,training/en, ,#, ,note/en, ,that/en, ,proposal/en, ,class/en, ,ids/en,,/w, ,gt/en,_,boxes/en,,/w, ,and/en, ,gt/en,_,masks/en, ,are/en, ,zero/en, ,#, ,padded/en,./w, ,equally/en,,/w, ,returned/en, ,rois/en, ,and/en, ,targets/en, ,are/en, ,zero/en, ,padded/en,./w, ,rois/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,target/en,_,bbox/en,,/w, ,target/en,_,mask/en, ,=/w,\/w, ,detectiontargetlayer/en,(/w,config/en,,/w, ,name/en,=/w,"/w,proposal/en,_,targets/en,"/w,)/w,(/w,[/w, ,target/en,_,rois/en,,/w, ,input/en,_,gt/en,_,class/en,_,ids/en,,/w, ,gt/en,_,boxes/en,,/w, ,input/en,_,gt/en,_,masks/en,]/w,)/w, ,#, ,network/en, ,heads/en, ,#, ,todo/en,:/w, ,verify/en, ,that/en, ,this/en, ,handles/en, ,zero/en, ,padded/en, ,rois/en, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en, ,=/w,\/w, ,fpn/en,_,classifier/en,_,graph/en,(/w,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,config/en,./w,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,,/w, ,fc/en,_,layers/en,_,size/en,=/w,config/en,./w,fpn/en,_,classif/en,_,fc/en,_,layers/en,_,size/en,)/w, ,mrcnn/en,_,mask/en, ,=/w, ,build/en,_,fpn/en,_,mask/en,_,graph/en,(/w,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,config/en,./w,mask/en,_,pool/en,_,size/en,,/w, ,config/en,./w,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,#, ,todo/en,:/w, ,clean/en, ,up/en, ,(/w,use/en, ,tf/en,./w,identify/en, ,if/en, ,necessary/en,)/w, ,output/en,_,rois/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en, ,*/w, ,1/m,,/w, ,name/en,=/w,"/w,output/en,_,rois/en,"/w,)/w,(/w,rois/en,)/w, ,#, ,losses/en, ,rpn/en,_,class/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,rpn/en,_,class/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,rpn/en,_,class/en,_,loss/en,"/w,)/w,(/w, ,[/w,input/en,_,rpn/en,_,match/en,,/w, ,rpn/en,_,class/en,_,logits/en,]/w,)/w, ,rpn/en,_,bbox/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,rpn/en,_,bbox/en,_,loss/en,_,graph/en,(/w,config/en,,/w, ,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,rpn/en,_,bbox/en,_,loss/en,"/w,)/w,(/w, ,[/w,input/en,_,rpn/en,_,bbox/en,,/w, ,input/en,_,rpn/en,_,match/en,,/w, ,rpn/en,_,bbox/en,]/w,)/w, ,class/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,mrcnn/en,_,class/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,class/en,_,loss/en,"/w,)/w,(/w, ,[/w,target/en,_,class/en,_,ids/en,,/w, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,active/en,_,class/en,_,ids/en,]/w,)/w, ,bbox/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,mrcnn/en,_,bbox/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,bbox/en,_,loss/en,"/w,)/w,(/w, ,[/w,target/en,_,bbox/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,mrcnn/en,_,bbox/en,]/w,)/w, ,mask/en,_,loss/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,mrcnn/en,_,mask/en,_,loss/en,_,graph/en,(/w,*/w,x/en,)/w,,/w, ,name/en,=/w,"/w,mrcnn/en,_,mask/en,_,loss/en,"/w,)/w,(/w, ,[/w,target/en,_,mask/en,,/w, ,target/en,_,class/en,_,ids/en,,/w, ,mrcnn/en,_,mask/en,]/w,)/w, ,#, ,model/en, ,inputs/en, ,=/w, ,[/w,input/en,_,image/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,input/en,_,rpn/en,_,match/en,,/w, ,input/en,_,rpn/en,_,bbox/en,,/w, ,input/en,_,gt/en,_,class/en,_,ids/en,,/w, ,input/en,_,gt/en,_,boxes/en,,/w, ,input/en,_,gt/en,_,masks/en,]/w, ,if/en, ,not/en, ,config/en,./w,use/en,_,rpn/en,_,rois/en,:/w, ,inputs/en,./w,append/en,(/w,input/en,_,rois/en,)/w, ,outputs/en, ,=/w, ,[/w,rpn/en,_,class/en,_,logits/en,,/w, ,rpn/en,_,class/en,,/w, ,rpn/en,_,bbox/en,,/w, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w, ,mrcnn/en,_,mask/en,,/w, ,rpn/en,_,rois/en,,/w, ,output/en,_,rois/en,,/w, ,rpn/en,_,class/en,_,loss/en,,/w, ,rpn/en,_,bbox/en,_,loss/en,,/w, ,class/en,_,loss/en,,/w, ,bbox/en,_,loss/en,,/w, ,mask/en,_,loss/en,]/w, ,model/en, ,=/w, ,km/en,./w,model/en,(/w,inputs/en,,/w, ,outputs/en,,/w, ,name/en,=/w,'/w,mask/en,_,rcnn/en,'/w,)/w, ,else/en,:/w, ,#, ,network/en, ,heads/en, ,#, ,proposal/en, ,classifier/en, ,and/en, ,bbox/en, ,regressor/en, ,heads/en, ,#, ,output/en, ,shapes/en,:/w, ,#, ,mrcnn/en,_,class/en,_,logits/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,logits/en, ,(/w,before/en, ,softmax/en,)/w, ,#, ,mrcnn/en,_,class/en,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,probabilities/en, ,#, ,mrcnn/en,_,bbox/en,(/w,deltas/en,)/w,:/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,mrcnn/en,_,class/en,_,logits/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en, ,=/w,\/w, ,fpn/en,_,classifier/en,_,graph/en,(/w,rpn/en,_,rois/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,config/en,./w,pool/en,_,size/en,,/w, ,#, ,7/m, ,config/en,./w,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,,/w, ,fc/en,_,layers/en,_,size/en,=/w,config/en,./w,fpn/en,_,classif/en,_,fc/en,_,layers/en,_,size/en,)/w, ,#, ,detections/en, ,#, ,output/en, ,is/en, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w, ,in/en, ,#, ,normalized/en, ,coordinates/en, ,detections/en, ,=/w, ,detectionlayer/en,(/w,config/en,,/w, ,name/en,=/w,"/w,mrcnn/en,_,detection/en,"/w,)/w,(/w, ,[/w,rpn/en,_,rois/en,,/w, ,mrcnn/en,_,class/en,,/w, ,mrcnn/en,_,bbox/en,,/w, ,input/en,_,image/en,_,meta/en,]/w,)/w, ,#, ,create/en, ,masks/en, ,for/en, ,detections/en, ,detection/en,_,boxes/en, ,=/w, ,kl/en,./w,lambda/en,(/w,lambda/en, ,x/en,:/w, ,x/en,[/w,./w,./w,./w,,/w, ,:/w,4/m,]/w,)/w,(/w,detections/en,)/w, ,mrcnn/en,_,mask/en, ,=/w, ,build/en,_,fpn/en,_,mask/en,_,graph/en,(/w,detection/en,_,boxes/en,,/w, ,mrcnn/en,_,feature/en,_,maps/en,,/w, ,input/en,_,image/en,_,meta/en,,/w, ,config/en,./w,mask/en,_,pool/en,_,size/en,,/w, ,#, ,14/m, ,config/en,./w,num/en,_,classes/en,,/w, ,train/en,_,bn/en,=/w,config/en,./w,train/en,_,bn/en,)/w, ,#, ,num/en,_,anchors/en,,/w, ,每张/r,图片/n,上/f,生成/vn,的/u,锚框/nw,数量/n, ,#, ,num/en,_,rois/en,,/w, ,每张/r,图片/n,上/f,由/p,锚框/nw,筛选/v,出/v,的/u,推荐区/ns,数量/n,，/w, ,#, ,#, ,由/p, ,post/en,_,nms/en,_,rois/en,_,training/en, ,或/c, ,post/en,_,nms/en,_,rois/en,_,inference/en, ,规定/n, ,#, ,num/en,_,detections/en,,/w, ,每张/r,图片/n,上/f,最终/d,检测/vn,输出/v,框/q,，/w, ,#, ,#, ,由/p, ,detection/en,_,max/en,_,instances/en, ,规定/n, ,#, ,detections/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w, ,#, ,mrcnn/en,_,class/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,]/w, ,classifier/en, ,probabilities/en, ,#, ,mrcnn/en,_,bbox/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,num/en,_,classes/en,,/w, ,(/w,dy/en,,/w, ,dx/en,,/w, ,log/en,(/w,dh/en,)/w,,/w, ,log/en,(/w,dw/en,)/w,)/w,]/w, ,#, ,mrcnn/en,_,mask/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,detections/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,mask/en,_,pool/en,_,size/en,,/w, ,num/en,_,classes/en,]/w, ,#, ,rpn/en,_,rois/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,rois/en,,/w, ,(/w,y/en,1/m,,/w, ,x/en,1/m,,/w, ,y/en,2/m,,/w, ,x/en,2/m,,/w, ,class/en,_,id/en,,/w, ,score/en,)/w,]/w, ,#, ,rpn/en,_,class/en,,/w, ,[/w,batch/en,,/w, ,num/en,_,anchors/en,,/w, ,2/m,]/w, ,#, ,rpn/en,_,bbox/en, ,[/w,batch/en,,/w, ,num/en,_,anchors/en,,/w, ,4/m,]/w, ,model/en, ,=/w, ,km/e