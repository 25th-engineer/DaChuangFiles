感谢/v,中国人民大学/nt,的/u,胡鹤/nr,老师/n,，/w,课程/n,容量/n,巨大/a,，/w,收获/v,颇/d,丰/ag,。/w,之前/f,提到/v,的/u,cnn/en,模型/n,主要/b,用/p,到/v,人类/n,的/u,视觉/n,中枢/n,，/w,但/c,其/r,有/v,一/m,劣势/n,，/w,无论/c,是/v,人类/n,的/u,视觉/n,神经/n,还是/c,听觉/n,神经/n,，/w,所/u,接受/v,到/v,的/u,都/d,是/v,一个/m,连续/a,的/u,序列/n,，/w,使用/v,cnn/en,相当/d,于/p,割裂/v,了/u,前后/f,的/u,联系/v,。/w,从而/c,诞生/v,了/u,专门/d,为/p,处理/v,序列/n,的/u,recurrent/en, ,neural/en, ,network/en,（/w,rnn/en,）/w,，/w,每/r,一个/m,神经元/n,除了/p,当前/t,信息/n,的/u,输入/v,外/f,，/w,还有/v,之前/f,产生/v,的/u,记忆/n,信息/n,，/w,保留/v,序列/n,依赖/v,型/k,。/w,一/m,、/w,rnn/en,基本/a,原理/n,如下/v,图/n,所/u,示/vg,有/v,两种/mq,表示/v,方法/n,，/w,每张/r,图片/n,左边/f,是/v,rnn/en,的/u,神经元/n,（/w,称为/v,memory/en, ,cell/en,）/w,，/w,右边/f,是/v,按/p,时间/n,轴/q,展开/v,后/f,的/u,情况/n,。/w,每次/r,输入/v,两个/m,信息/n,输出/v,两个/m,信息/n,，/w,每/r,轮/q,处理/v,hidden/en, ,state/en,。/w,把/p,同样/d,神经元/n,在/p,时间/n,上/f,展开/v,处理/v,，/w,比/p,cnn/en,更加/d,节省/v,参数/n,，/w,是/v,一个/m,相当/d,高效/b,的/u,表示/v,方法/n,。/w,可/v,参考/v,如下/v,公式/n,表示/v,，/w,最后/f,简化/v,后/f,的/u,形式/n,同一般神经元/nw,相同/a,，/w,输入/v,信息/n,乘权/nw,重加/nw,偏值/nw,：/w,由于/c,t/en,状态/n,的/u,t/en,由/p,t/en,-/w,1/m,时候/n,决定/v,，/w,因而/c,具有/v,记忆/n,功能/n,，/w,也/d,叫作/v,memory/en, ,cell/en,（/w,或/c,cell/en,）/w,隐/vg,状态/n,可/v,由/p,如下/v,表示/v,：/w,隐/vg,状态/n,是/v,当前/t,t/en,时刻/n,的/u,状态/n,，/w,也/d,由/p,t/en,-/w,1/m,时刻/n,决定/v,，/w,简单/a,情况/n,下/f,，/w,hidden/en, ,state/en,等同/v,于/p,output/en,（/w,y/en,）/w,，/w,但/c,大多/d,较为/d,复杂/a,的/u,cell/en,中/f,，/w,它们/r,并/c,不/d,相同/a,。/w,如/v,下/f,图/n,所/u,示/vg,：/w,二/m,、/w,rnn/en,种类/n,：/w,1/m,./w, ,sequence/en,-/w,to/en,-/w,sequence/en,：/w,输入/v,输出/v,都/d,是/v,一个/m,序列/n,。/w,例如/v,股票/n,预测/v,中/f,的/u,rnn/en,，/w,输入/v,是/v,前/f,n/en,天/q,价格/n,，/w,输出/v,明天/t,的/u,股市/n,价格/n,。/w,2/m,./w, ,sequence/en,-/w,to/en,-/w,vector/en,：/w,输入/v,是/v,一个/m,序列/n,，/w,输出/v,单一/a,向量/n,。/w,例如/v,，/w,输入/v,一个/m,电影/n,评价/v,序列/n,，/w,输出/v,一个/m,分数/n,表示/v,情感/n,趋势/n,（/w,喜欢/v,还是/c,讨厌/v,）/w,。/w,3/m,./w, ,vector/en,-/w,to/en,-/w,sequence/en,：/w,输入/v,单一/a,向量/n,，/w,输出/v,一个/m,序列/n,。/w,4/m,./w,encoder/en,-/w,decoder/en,：/w,输入/v,sequence/en,-/w,to/en,-/w,vector/en,，/w,称作/v,encoder/en,，/w,输出/v,vector/en,-/w,to/en,-/w,sequence/en,，/w,称作/v,decoder/en,。/w,这/r,是/v,一个/m,delay/en,模型/n,，/w,经过/p,一段/mq,延迟/vn,，/w,即/v,把/p,所有/b,输入/v,都/d,读/v,取/v,后/f,，/w,在/p,decoder/en,中/f,获取/v,输入/v,并/c,输出/v,一个/m,序列/n,。/w,这个/r,模型/n,在/p,机器/n,翻译/v,中/f,使用/v,较/d,广泛/a,，/w,源/ng,语言/n,输/v,在/p,入/v,放/v,入/v,encoder/en,，/w,浓缩/vn,在/p,状态/n,信息/n,中/f,，/w,生成/vn,目标/n,语言/n,时/ng,，/w,可以/v,生成/vn,一个/m,不/d,长度/n,的/u,目标/n,语言/n,序列/n,。/w,三/m,、/w,rnn/en,实例/n,1/m,./w,手动/b,实现/v,以下/f,是/v,一个/m,手动/b,实现/v,rnn/en,的/u,实例/n,n/en,_,inputs/en, ,=/w, ,3/m, ,#, ,hidden/en, ,state/en, ,n/en,_,neurons/en, ,=/w, ,5/m, ,x/en,0/m, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,x/en,1/m, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,#, ,由于/c,wx/en,要/v,和/c,x/en,相乘/v,，/w,故/c,低维/nw,是/v,n/en,_,inputs/en, ,wx/en, ,=/w, ,tf/en,./w,variable/en,(/w,tf/en,./w,random/en,_,normal/en,(/w,shape/en,=/w,[/w,n/en,_,inputs/en,,/w, ,n/en,_,neurons/en,]/w,,/w,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w,)/w, ,#, ,低维/nw,，/w,高维/nr,都/d,是/v,n/en,_,neurons/en,，/w,为了/p,使得/v,输出/v,也/d,是/v,hidden/en, ,state/en,的/u,深度/n, ,#, ,这样/r,下/f,一次/mq,才/d,可以/v,继续/v,运算/vn, ,wy/en, ,=/w, ,tf/en,./w,variable/en,(/w,tf/en,./w,random/en,_,normal/en,(/w,shape/en,=/w,[/w,n/en,_,neurons/en,,/w,n/en,_,neurons/en,]/w,,/w,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w,)/w, ,b/en, ,=/w, ,tf/en,./w,variable/en,(/w,tf/en,./w,zeros/en,(/w,[/w,1/m,,/w, ,n/en,_,neurons/en,]/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w,)/w, ,#, ,y/en,0/m,初始/b,化为/v,0/m,，/w,初始/b,时/ng,没有/v,记忆/n, ,y/en,0/m, ,=/w, ,tf/en,./w,tanh/en,(/w,tf/en,./w,matmul/en,(/w,x/en,0/m,,/w, ,wx/en,)/w, ,+/w, ,b/en,)/w, ,#, ,把/p,上/f,一轮/mq,输出/v,y/en,0/m,也/d,作为/v,输入/v, ,y/en,1/m, ,=/w, ,tf/en,./w,tanh/en,(/w,tf/en,./w,matmul/en,(/w,y/en,0/m,,/w, ,wy/en,)/w, ,+/w, ,tf/en,./w,matmul/en,(/w,x/en,1/m,,/w, ,wx/en,)/w, ,+/w, ,b/en,)/w, ,init/en, ,=/w, ,tf/en,./w,global/en,_,variables/en,_,initializer/en,(/w,)/w, ,import/en, ,numpy/en, ,as/en, ,np/en, ,x/en,0/m,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,0/m,,/w, ,1/m,,/w, ,2/m,]/w,,/w, ,[/w,3/m,,/w, ,4/m,,/w, ,5/m,]/w,,/w, ,[/w,6/m,,/w, ,7/m,,/w, ,8/m,]/w,,/w, ,[/w,9/m,,/w, ,0/m,,/w, ,1/m,]/w,]/w,)/w, ,#, ,t/en, ,=/w, ,0/m, ,x/en,1/m,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,9/m,,/w, ,8/m,,/w, ,7/m,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,]/w,,/w, ,[/w,6/m,,/w, ,5/m,,/w, ,4/m,]/w,,/w, ,[/w,3/m,,/w, ,2/m,,/w, ,1/m,]/w,]/w,)/w, ,#, ,t/en, ,=/w, ,1/m, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,　,　,init/en,./w,run/en,(/w,)/w, ,　,　,y/en,0/m,_,val/en,,/w, ,y/en,1/m,_,val/en, ,=/w, ,sess/en,./w,run/en,(/w,[/w,y/en,0/m,,/w, ,y/en,1/m,]/w,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,0/m,:/w, ,x/en,0/m,_,batch/en,,/w, ,x/en,1/m,:/w, ,x/en,1/m,_,batch/en,}/w,)/w, ,#, ,y/en,0/m,，/w,y/en,1/m,都/d,是/v,4/m,*/w,5/m,大小/n,，/w,4/m,是/v,mini/en,-/w,batch/en,数目/n,，/w,5/m,是/v,输出/v,神经元/n,个数/n,tensorflow/en,函数/n,集成/vn,后/f,实现/v,2/m,./w,static/en, ,unrolling/en, ,through/en, ,timestatic/en,_,rnn/en,(/w,)/w,是/v,使用/v,链式/nw,cells/en,实现/v,一个/m,按/p,时间/n,轴/q,展开/v,的/u,rnn/en,#, ,这种/r,和/c,上面/f,那种/r,手动/b,实现/v,的/u,效果/n,相同/a, ,n/en,_,inputs/en, ,=/w, ,3/m, ,n/en,_,neurons/en, ,=/w, ,5/m, ,x/en,0/m, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,x/en,1/m, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,basic/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,output/en,_,seqs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,static/en,_,rnn/en,(/w,basic/en,_,cell/en,,/w, ,[/w,x/en,0/m,,/w, ,x/en,1/m,]/w,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,y/en,0/m,,/w, ,y/en,1/m, ,=/w, ,output/en,_,seqs/en, ,#, ,run/en,部分/n, ,init/en, ,=/w, ,tf/en,./w,global/en,_,variables/en,_,initializer/en,(/w,)/w, ,x/en,0/m,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,0/m,,/w, ,1/m,,/w, ,2/m,]/w,,/w, ,[/w,3/m,,/w, ,4/m,,/w, ,5/m,]/w,,/w, ,[/w,6/m,,/w, ,7/m,,/w, ,8/m,]/w,,/w, ,[/w,9/m,,/w, ,0/m,,/w, ,1/m,]/w,]/w,)/w, ,x/en,1/m,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,[/w,9/m,,/w, ,8/m,,/w, ,7/m,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,]/w,,/w, ,[/w,6/m,,/w, ,5/m,,/w, ,4/m,]/w,,/w, ,[/w,3/m,,/w, ,2/m,,/w, ,1/m,]/w,]/w,)/w, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,init/en,./w,run/en,(/w,)/w, ,y/en,0/m,_,val/en,,/w, ,y/en,1/m,_,val/en, ,=/w, ,sess/en,./w,run/en,(/w,[/w,y/en,0/m,,/w, ,y/en,1/m,]/w,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,0/m,:/w, ,x/en,0/m,_,batch/en,,/w, ,x/en,1/m,:/w, ,x/en,1/m,_,batch/en,}/w,)/w,packing/en, ,sequencen/en,_,steps/en, ,=/w, ,2/m, ,n/en,_,inputs/en, ,=/w, ,3/m, ,n/en,_,neurons/en, ,=/w, ,5/m, ,#, ,输入/v,是/v,一个/m,三维/nz,tensor/en,，/w,none/en,是/v,mini/en,-/w,batch/en,大小/n,不/d,限/v,，/w,n/en,_,steps/en,是/v,序列/n,长度/n, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,#, ,把/p,一个/m,高/a,维度/n,n/en,的/u,tensor/en,展开/v,成/v,一个/m,n/en,-/w,1维/mq,，/w,降维/nw,，/w,这里/r,是/v,3位/mq,降/v,到/v,2/m,维列/nr,表/n, ,#, ,unstack/en,之前/f,要/v,做/v,一个/m,1/m,,/w,2/m,维转/nr,置/v,，/w,相当/d,于/p,构造/v,了/u,n/en,_,steps/en,个数/n,的/u,列表/v, ,x/en,_,seqs/en, ,=/w, ,tf/en,./w,unstack/en,(/w,tf/en,./w,transpose/en,(/w,x/en,,/w, ,perm/en,=/w,[/w,1/m,,/w, ,0/m,,/w, ,2/m,]/w,)/w,)/w, ,basic/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,#, ,states/en,是/v,最新/a,状态/n, ,output/en,_,seqs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,static/en,_,rnn/en,(/w, ,basic/en,_,cell/en,,/w, ,x/en,_,seqs/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,再/d,做/v,一个/m,转置/nw,，/w,和/c,输入/v,对应/v, ,outputs/en, ,=/w, ,tf/en,./w,transpose/en,(/w,tf/en,./w,stack/en,(/w,output/en,_,seqs/en,)/w,,/w, ,perm/en,=/w,[/w,1/m,,/w, ,0/m,,/w, ,2/m,]/w,)/w, ,#, ,输入/v,大小/n,4/m,*/w,2/m,*/w,3/m, ,x/en,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w, ,#, ,t/en, ,=/w, ,0/m,　,　,　,　, ,t/en, ,=/w, ,1/m, ,[/w,[/w,0/m,,/w, ,1/m,,/w, ,2/m,]/w,,/w, ,[/w,9/m,,/w, ,8/m,,/w, ,7/m,]/w,]/w,,/w, ,#, ,instance/en, ,0/m, ,[/w,[/w,3/m,,/w, ,4/m,,/w, ,5/m,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,]/w,]/w,,/w, ,#, ,instance/en, ,1/m, ,[/w,[/w,6/m,,/w, ,7/m,,/w, ,8/m,]/w,,/w, ,[/w,6/m,,/w, ,5/m,,/w, ,4/m,]/w,]/w,,/w, ,#, ,instance/en, ,2/m, ,[/w,[/w,9/m,,/w, ,0/m,,/w, ,1/m,]/w,,/w, ,[/w,3/m,,/w, ,2/m,,/w, ,1/m,]/w,]/w,,/w, ,#, ,instance/en, ,3/m, ,]/w,)/w, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,init/en,./w,run/en,(/w,)/w, ,outputs/en,_,val/en, ,=/w, ,outputs/en,./w,eval/en,(/w,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,}/w,)/w, ,#, ,output/en,_,val/en,是/v,一个/m,4/m,*/w,2/m,*/w,5/m,，/w,仅/d,输出/v,维度/n,神经元/n,个数/n,改变/v,3/m,./w, ,dynamic/en, ,rnn/en,本身/r,支持/v,高维/nr,tensor/en,输入/v,，/w,内嵌/v,一个/m,循环/vn,运行/vn,足够/v,多/a,次数/n,的/u,cell/en,，/w,不/d,需要/v,unstack/en,步骤/n,。/w,这个/r,内嵌/v,循环/vn,while/en,_,loop/en,(/w,)/w,在/p,前/f,向/p,传播/vn,中将/n,每次/r,迭代/vn,的/u,tensor/en,值/n,存储/vn,下来/v,，/w,以/p,便于/v,反向/f,传播/vn,过程/n,中/f,使用/v,其/r,计算梯度值/nw,。/w,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,#, ,动态/n,rnn/en,内部/f,封装/vn,一个/m,循环/vn, ,#, ,根据/p,输入/v,，/w,动态/n,决定/v,自己/r,需要/v,展开/v,几/m,次/q, ,basic/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,outputs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,nn/en,./w,dynamic/en,_,rnn/en,(/w,basic/en,_,cell/en,,/w, ,x/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w,dynamicrnn/en,可以/v,动态/n,规定/n,输入/v,大小/n,（/w,就/d,像/v,句子/n,输入/v,）/w,n/en,_,steps/en, ,=/w, ,2/m, ,n/en,_,inputs/en, ,=/w, ,3/m, ,n/en,_,neurons/en, ,=/w, ,5/m, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,basic/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,seq/en,_,length/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,int/en,32/m,,/w, ,[/w,none/en,]/w,)/w, ,outputs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,nn/en,./w,dynamic/en,_,rnn/en,(/w,basic/en,_,cell/en,,/w, ,x/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,,/w, ,sequence/en,_,length/en,=/w,seq/en,_,length/en,)/w, ,init/en, ,=/w, ,tf/en,./w,global/en,_,variables/en,_,initializer/en,(/w,)/w, ,#, ,x/en,_,batch/en,的/u,大小/n,4/m,*/w,2/m,*/w,3/m, ,x/en,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w, ,#, ,step/en, ,0/m, ,step/en, ,1/m, ,[/w,[/w,0/m,,/w, ,1/m,,/w, ,2/m,]/w,,/w, ,[/w,9/m,,/w, ,8/m,,/w, ,7/m,]/w,]/w,,/w, ,#, ,instance/en, ,1/m, ,[/w,[/w,3/m,,/w, ,4/m,,/w, ,5/m,]/w,,/w, ,[/w,0/m,,/w, ,0/m,,/w, ,0/m,]/w,]/w,,/w, ,#, ,instance/en, ,2/m, ,(/w,padded/en, ,with/en, ,zero/en, ,vectors/en,)/w, ,[/w,[/w,6/m,,/w, ,7/m,,/w, ,8/m,]/w,,/w, ,[/w,6/m,,/w, ,5/m,,/w, ,4/m,]/w,]/w,,/w, ,#, ,instance/en, ,3/m, ,[/w,[/w,9/m,,/w, ,0/m,,/w, ,1/m,]/w,,/w, ,[/w,3/m,,/w, ,2/m,,/w, ,1/m,]/w,]/w,,/w, ,#, ,instance/en, ,4/m, ,]/w,)/w, ,#, ,这里/r,设置/v,sequence/en,大小/n,，/w,一共/d,4个/m,batch/en,，/w,第二/m,维/q,上/f,只/d,取/v,第一/m,个/q, ,seq/en,_,length/en,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,[/w,2/m,,/w, ,1/m,,/w, ,2/m,,/w, ,2/m,]/w,)/w, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,init/en,./w,run/en,(/w,)/w, ,outputs/en,_,val/en,,/w, ,states/en,_,val/en, ,=/w, ,sess/en,./w,run/en,(/w, ,[/w,outputs/en,,/w, ,states/en,]/w,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,,/w, ,seq/en,_,length/en,:/w, ,seq/en,_,length/en,_,batch/en,}/w,)/w,如果/c,事先/d,不/d,知道/v,输出/v,序列/n,的/u,长度/n,，/w,就/d,需要/v,定义/n,一个/m,end/en,-/w,of/en,-/w,sequence/en, ,token/en,（/w,eos/en, ,token/en,）/w,，/w,无论/c,是/v,课/n,上/f,还是/c,网上/s,相关/v,信息/n,都/d,很少/ad,，/w,这里/r,就/d,不/d,展开/v,了/u,。/w,。/w,四/m,、/w,rnn/en,训练/vn,1/m,./w, ,拟合/nz,分类/vn,rnn/en,比较/d,难以/d,训练/vn,，/w,单/d,是/v,如下/v,图/n,的/u,节点/n,中/f,，/w,cost/en, ,function/en,就/d,包含/v,y/en,2/m,,/w,y/en,3/m,,/w,y/en,4/m,三个/m,输出/v,，/w,往回/t,回溯/vn,。/w,以下/f,minist/en,中/f,使用/v,150个/m,rnn/en,神经元/n,，/w,最后/f,加/v,一个/m,全/a,连接/v,层/q,，/w,得到/v,10个/m,神经元/n,的/u,输出/v,（/w,分别/d,对应/v,0/m,-/w,9/m,）/w,，/w,最后/f,看/v,对应/v,在/p,from/en, ,tensorflow/en,./w,contrib/en,./w,layers/en, ,import/en, ,fully/en,_,connected/en, ,n/en,_,steps/en, ,=/w, ,28/m, ,n/en,_,inputs/en, ,=/w, ,28/m, ,n/en,_,neurons/en, ,=/w, ,150/m, ,n/en,_,outputs/en, ,=/w, ,10/m, ,learning/en,_,rate/en, ,=/w, ,0.001/m, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,#, ,一维/nw,输出/v, ,y/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,int/en,32/m,,/w, ,[/w,none/en,]/w,)/w, ,#, ,使用/v,最/d,简单/a,的/u,basicrnncell/en, ,basic/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,#,使用/v,dynamic/en,_,rnn/en, ,outputs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,nn/en,./w,dynamic/en,_,rnn/en,(/w,basic/en,_,cell/en,,/w, ,x/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,#, ,原始/a,输出/v, ,logits/en, ,=/w, ,fully/en,_,connected/en,(/w,states/en,,/w, ,n/en,_,outputs/en,,/w, ,activation/en,_,fn/en,=/w,none/en,)/w, ,#, ,计算/v,和/c,真实/a,的/u,交叉/vn,熵/g, ,xentropy/en, ,=/w, ,tf/en,./w,nn/en,./w,sparse/en,_,softmax/en,_,cross/en,_,entropy/en,_,with/en,_,logits/en,(/w,labels/en,=/w,y/en,,/w, ,logits/en,=/w,logits/en,)/w, ,loss/en, ,=/w, ,tf/en,./w,reduce/en,_,mean/en,(/w,xentropy/en,)/w, ,#, ,使用/v,adamoptimizer/en, ,optimizer/en, ,=/w, ,tf/en,./w,train/en,./w,adamoptimizer/en,(/w,learning/en,_,rate/en,=/w,learning/en,_,rate/en,)/w, ,training/en,_,op/en, ,=/w, ,optimizer/en,./w,minimize/en,(/w,loss/en,)/w, ,#, ,计算/v,准确率/n,，/w,只有/c,等于/v,y/en,才/d,是/v,对/p,的/u,，/w,其他/r,都/d,错/n, ,correct/en, ,=/w, ,tf/en,./w,nn/en,./w,in/en,_,top/en,_,k/en,(/w,logits/en,,/w, ,y/en,,/w, ,1/m,)/w, ,accuracy/en, ,=/w, ,tf/en,./w,reduce/en,_,mean/en,(/w,tf/en,./w,cast/en,(/w,correct/en,,/w, ,tf/en,./w,float/en,32/m,)/w,)/w, ,init/en, ,=/w, ,tf/en,./w,global/en,_,variables/en,_,initializer/en,(/w,)/w, ,from/en, ,tensorflow/en,./w,examples/en,./w,tutorials/en,./w,mnist/en, ,import/en, ,input/en,_,data/en, ,mnist/en, ,=/w, ,input/en,_,data/en,./w,read/en,_,data/en,_,sets/en,(/w,"/w,//w,tmp/en,//w,data/en,//w,"/w,)/w, ,#, ,转换/v,到/v,合理/a,的/u,输入/v,shape/en, ,x/en,_,test/en, ,=/w, ,mnist/en,./w,test/en,./w,images/en,./w,reshape/en,(/w,(/w,-/w,1/m,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,)/w,)/w, ,y/en,_,test/en, ,=/w, ,mnist/en,./w,test/en,./w,labels/en, ,#, ,run/en,100遍/mq,，/w,每次/r,处理/v,150个/m,输入/v, ,n/en,_,epochs/en, ,=/w, ,100/m, ,batch/en,_,size/en, ,=/w, ,150/m, ,#, ,开始/v,循环/vn, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,init/en,./w,run/en,(/w,)/w, ,for/en, ,epoch/en, ,in/en, ,range/en,(/w,n/en,_,epochs/en,)/w,:/w, ,for/en, ,iteration/en, ,in/en, ,range/en,(/w,mnist/en,./w,train/en,./w,num/en,_,examples/en, ,//w,//w, ,batch/en,_,size/en,)/w,:/w, ,#, ,读/v,入/v,数据/n,并/c,reshape/en, ,x/en,_,batch/en,,/w, ,y/en,_,batch/en, ,=/w, ,mnist/en,./w,train/en,./w,next/en,_,batch/en,(/w,batch/en,_,size/en,)/w, ,x/en,_,batch/en, ,=/w, ,x/en,_,batch/en,./w,reshape/en,(/w,(/w,-/w,1/m,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,)/w,)/w, ,#, ,x/en,大写/n,，/w,y/en,小写/n, ,sess/en,./w,run/en,(/w,training/en,_,op/en,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,,/w, ,y/en,:/w, ,y/en,_,batch/en,}/w,)/w, ,acc/en,_,train/en, ,=/w, ,accuracy/en,./w,eval/en,(/w,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,,/w, ,y/en,:/w, ,y/en,_,batch/en,}/w,)/w, ,acc/en,_,test/en, ,=/w, ,accuracy/en,./w,eval/en,(/w,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,test/en,,/w, ,y/en,:/w, ,y/en,_,test/en,}/w,)/w, ,#, ,每次/r,打印/v,一下/m,当前/t,信息/n, ,print/en,(/w,epoch/en,,/w, ,"/w,train/en, ,accuracy/en,:/w,"/w,,/w, ,acc/en,_,train/en,,/w, ,"/w,test/en, ,accuracy/en,:/w,"/w,,/w, ,acc/en,_,test/en,)/w,以下/f,，/w,只用/v,了/u,150个/m,参数/n,，/w,做/v,了/u,单层/nw,。/w,就/d,可以/v,达到/v,非常/d,高/a,的/u,效果/n,，/w,可以/v,看出/v,rnn/en,效果/n,非常/d,不错/a,序列/n,预测/v,，/w,前/f,20个/m,状态/n,作为/v,输入/v,，/w,则/d,第/m,2个/m,到/v,21个/m,作为/v,输出/v,，/w,作为/v,训练/vn,集/vg,#, ,输入/v,x/en,0/m,-/w,x/en,19/m, ,n/en,_,steps/en, ,=/w, ,20/m, ,#, ,只/d,预测/v,一个/m,值/n, ,n/en,_,inputs/en, ,=/w, ,1/m, ,#, ,rnn/en,有/v,100个/m, ,n/en,_,neurons/en, ,=/w, ,100/m, ,n/en,_,outputs/en, ,=/w, ,1/m, ,#, ,none/en,表示/v,min/en,_,batch/en,大小/n,这里/r,任意/d, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,y/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,outputs/en,]/w,)/w, ,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,,/w, ,activation/en,=/w,tf/en,./w,nn/en,./w,relu/en,)/w, ,outputs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,nn/en,./w,dynamic/en,_,rnn/en,(/w,cell/en,,/w, ,x/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w,如/v,上/f,代码/n,中/f,，/w,每次/r,输出/v,的/u,vector/en,都/d,是/v,100维/mq,的/u,，/w,加入/v,一个/m,output/en, ,rejections/en,后/f,，/w,使得/v,每/r,次/q,只/d,输出/v,1个/m,值/n,output/en, ,rejection/en,实现/v,代码/n,如下/v,#, ,设置/v,输出/v,为/p,上面/f,设定/v,的/u,n/en,_,outputs/en,大小/n, ,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,outputprojectionwrapper/en,(/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,,/w, ,activation/en,=/w,tf/en,./w,nn/en,./w,relu/en,)/w,,/w, ,output/en,_,size/en,=/w,n/en,_,outputs/en,)/w, ,learning/en,_,rate/en, ,=/w, ,0.001/m, ,loss/en, ,=/w, ,tf/en,./w,reduce/en,_,mean/en,(/w,tf/en,./w,square/en,(/w,outputs/en, ,-/w, ,y/en,)/w,)/w, ,optimizer/en, ,=/w, ,tf/en,./w,train/en,./w,adamoptimizer/en,(/w,learning/en,_,rate/en,=/w,learning/en,_,rate/en,)/w, ,training/en,_,op/en, ,=/w, ,optimizer/en,./w,minimize/en,(/w,loss/en,)/w, ,init/en, ,=/w, ,tf/en,./w,global/en,_,variables/en,_,initializer/en,(/w,)/w, ,#, ,开始/v,训练/vn, ,n/en,_,iterations/en, ,=/w, ,10000/m, ,batch/en,_,size/en, ,=/w, ,50/m, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,init/en,./w,run/en,(/w,)/w, ,for/en, ,iteration/en, ,in/en, ,range/en,(/w,n/en,_,iterations/en,)/w,:/w, ,x/en,_,batch/en,,/w, ,y/en,_,batch/en, ,=/w, ,[/w,./w,./w,./w,]/w, ,#, ,fetch/en, ,the/en, ,next/en, ,training/en, ,batch/en, ,sess/en,./w,run/en,(/w,training/en,_,op/en,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,,/w, ,y/en,:/w, ,y/en,_,batch/en,}/w,)/w, ,if/en, ,iteration/en, ,%/w, ,100/m, ,=/w,=/w, ,0/m,:/w, ,mse/en, ,=/w, ,loss/en,./w,eval/en,(/w,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,,/w, ,y/en,:/w, ,y/en,_,batch/en,}/w,)/w, ,print/en,(/w,iteration/en,,/w, ,"/w,\/w,tmse/en,:/w,"/w,,/w, ,mse/en,)/w,2/m,./w,预测/v,当/p,一个/m,rnn/en,训练/vn,好/a,后/f,，/w,它/r,就/d,可以/v,生成/vn,很多/m,新/a,的/u,东西/n,。/w,rnn/en,的/u,强大/a,的/u,生成/vn,能力/n,非常/d,有/v,魅力/n,，/w,用/p,很多/m,曲子/n,去/v,训练/vn,它/r,，/w,它/r,就/d,可以/v,生成/vn,新/a,的/u,曲子/n,，/w,用/p,很多/m,文章/n,训练/vn,它/r,，/w,他/r,就/d,可以/v,生成/vn,新/a,的/u,文章/n,。/w,如果/c,可以/v,训练/vn,出/v,功能/n,非常/d,强/a,的/u,rnn/en,模型/n,，/w,就/d,有/v,可能/v,代替/v,人/n,的/u,工作/vn,。/w,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,#, ,导入/v,训练/vn,好/a,的/u,模型/n, ,saver/en,./w,restore/en,(/w,sess/en,,/w, ,"/w,./w,//w,my/en,_,time/en,_,series/en,_,model/en,"/w,)/w, ,#, ,生成/vn,新/a,的/u,曲线/n, ,sequence/en, ,=/w, ,[/w,0/m,./w,]/w, ,*/w, ,n/en,_,steps/en, ,for/en, ,iteration/en, ,in/en, ,range/en,(/w,300/m,)/w,:/w, ,x/en,_,batch/en, ,=/w, ,np/en,./w,array/en,(/w,sequence/en,[/w,-/w,n/en,_,steps/en,:/w,]/w,)/w,./w,reshape/en,(/w,1/m,,/w, ,n/en,_,steps/en,,/w, ,1/m,)/w, ,y/en,_,pred/en, ,=/w, ,sess/en,./w,run/en,(/w,outputs/en,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,}/w,)/w, ,sequence/en,./w,append/en,(/w,y/en,_,pred/en,[/w,0/m,,/w, ,-/w,1/m,,/w, ,0/m,]/w,)/w,rnn/en,也/d,可以/v,不断/d,叠加/vn,，/w,形成/v,很/d,深/a,的/u,网络/n,，/w,如/v,下/f,图/n,所/u,示/vg,，/w,每/r,一层/mq,输出/v,都/d,反馈/v,到/v,当前/t,位置/n,的/u,输入/v,，/w,时间/n,轴/q,展开/v,后/f,，/w,如/v,右边/f,所/u,示/vg,。/w,n/en,_,inputs/en, ,=/w, ,2/m, ,n/en,_,steps/en, ,=/w, ,5/m, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,n/en,_,neurons/en, ,=/w, ,100/m, ,n/en,_,layers/en, ,=/w, ,3/m, ,#, ,做/v,了/u,3层/mq,rnn/en, ,#, ,模型/n,不/d,是/v,越/d,复杂/a,越/d,好/a,，/w,越/d,复杂/a,所/u,需/v,数据量/n,越/d,大/a,，/w,否则/c,会/v,有/v,过/u,拟合/nz,的/u,风险/n, ,#, ,可以/v,加/v,dropout/en,来/v,控制/v, ,layers/en, ,=/w, ,[/w,tf/en,./w,contrib/en,./w,rnn/en,./w,basicrnncell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,for/en, ,layer/en, ,in/en, ,range/en,(/w,n/en,_,layers/en,)/w,]/w, ,multi/en,_,layer/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,multirnncell/en,(/w,layers/en,)/w, ,outputs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,nn/en,./w,dynamic/en,_,rnn/en,(/w,multi/en,_,layer/en,_,cell/en,,/w, ,x/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,init/en, ,=/w, ,tf/en,./w,global/en,_,variables/en,_,initializer/en,(/w,)/w, ,x/en,_,batch/en, ,=/w, ,np/en,./w,random/en,./w,rand/en,(/w,2/m,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,)/w, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,init/en,./w,run/en,(/w,)/w, ,outputs/en,_,val/en,,/w, ,states/en,_,val/en, ,=/w, ,sess/en,./w,run/en,(/w,[/w,outputs/en,,/w, ,states/en,]/w,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,x/en,_,batch/en,}/w,)/w,五/m,、/w,困难/an,及/c,优化/v,反向/f,训练/vn,时/ng,，/w,对于/p,rnn/en,来说/u,，/w,要/v,横向/n,往/p,前/f,推/v,，/w,一直/d,往/p,前/f,推/v,到/v,序列/n,开始/v,的/u,地方/n,。/w,当/p,序列/n,非常/d,长/a,时/ng,，/w,梯度/n,消失/v,，/w,梯度/n,爆炸/v,都/d,与/p,路径/n,长度/n,太/d,长/a,有关/vn,，/w,前面/f,的/u,权重/nz,都/d,基本/a,固定/a,不/d,变/v,，/w,没有/v,训练/vn,效果/n,。/w,为了/p,解决/v,这个/r,困难/an,，/w,有/v,了/u,很多/m,更/d,复杂/a,rnn/en,模型/n,的/u,提出/v,1/m,./w,lstm/en,（/w,long/en, ,short/en, ,term/en, ,memory/en,）/w,97年/t,提出/v,，/w,直到/v,深度/n,学习/v,提出/v,，/w,使用/v,lstm/en,做出/v,具体/a,实事/n,后/f,，/w,才/d,火/n,起来/v,。/w,或许/d,是/v,因为/c,现在/t,有/v,大/a,数据/n,的/u,环境/n,，/w,以及/c,训练/vn,能力/n,很/d,强/a,的/u,硬件/n,这些/r,客观/n,条件/n,得/u,具备/v,，/w,才能/v,真正/d,发挥/v,lstm/en,的/u,威力/n,。/w,它/r,把/p,训练/vn,信息/n,分为/v,长期/d,记忆/n,（/w,c/en,）/w,和/c,短期/b,记忆/n,（/w,h/en,）/w,，/w,上面/f,的/u,长期/d,记忆/n,信息/n,，/w,可以/v,穿/v,到/v,很远/d,，/w,即使/c,序列/n,长/a,到/v,1000/m,，/w,也/d,可以/v,向前/v,传导/v,。/w,它/r,分/q,了/u,很多/m,个/q,门/n,（/w,gate/en,）/w,，/w,输出/v,信息/n,趋/v,近/a,于/p,0/m,，/w,门/n,关闭/v,，/w,趋/v,近/a,于/p,1门/mq,打开/v,。/w,i/en,是/v,输入门/nw,控制/v,新/a,输入/v,加/v,多少/r,到/v,长期/d,记忆/n,中/f,，/w,f/en,是/v,forget/en,控制/v,是否/v,受/v,长期/d,记忆/n,的/u,影响/vn,，/w,哪些/r,长期/d,记忆/n,被/p,忘掉/v,，/w,o/en,是/v,输出/v,门/n,控制/v,哪些/r,长期/d,记忆/n,可以/v,输出/v,并/c,作为/v,短期/b,记忆/n,ht/en,传递/v,下去/v,，/w,通过/p,这/r,3个门/mq,控制/v,信息/n,的/u,流动/vn,。/w,可以/v,保证/v,长期/d,记忆/n,变换/v,的/u,缓慢/a,，/w,相对/d,稳定/a,，/w,可以/v,对/p,距离/n,比较/d,远/a,的/u,序列/n,影响/vn,，/w,ht/en,和/c,ht/en,-/w,1/m,可以/v,看到/v,距离/n,也/d,比较/d,远/a,，/w,短期/b,记忆/n,ht/en,-/w,1/m,变化/vn,明显/a,。/w,#, ,tensorflow/en,中/f,lstm/en,具体/a,实现/v, ,n/en,_,steps/en, ,=/w, ,28/m, ,n/en,_,inputs/en, ,=/w, ,28/m, ,n/en,_,neurons/en, ,=/w, ,150/m, ,n/en,_,outputs/en, ,=/w, ,10/m, ,n/en,_,layers/en, ,=/w, ,3/m, ,learning/en,_,rate/en, ,=/w, ,0.001/m, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,[/w,none/en,,/w, ,n/en,_,steps/en,,/w, ,n/en,_,inputs/en,]/w,)/w, ,y/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,int/en,32/m,,/w, ,[/w,none/en,]/w,)/w, ,lstm/en,_,cells/en, ,=/w, ,[/w,tf/en,./w,contrib/en,./w,rnn/en,./w,basiclstmcell/en,(/w,num/en,_,units/en,=/w,n/en,_,neurons/en,)/w, ,for/en, ,layer/en, ,in/en, ,range/en,(/w,n/en,_,layers/en,)/w,]/w, ,multi/en,_,cell/en, ,=/w, ,tf/en,./w,contrib/en,./w,rnn/en,./w,multirnncell/en,(/w,lstm/en,_,cells/en,)/w, ,outputs/en,,/w, ,states/en, ,=/w, ,tf/en,./w,nn/en,./w,dynamic/en,_,rnn/en,(/w,multi/en,_,cell/en,,/w, ,x/en,,/w, ,dtype/en,=/w,tf/en,./w,float/en,32/m,)/w, ,top/en,_,layer/en,_,h/en,_,state/en, ,=/w, ,states/en,[/w,-/w,1/m,]/w,[/w,1/m,]/w, ,logits/en, ,=/w, ,tf/en,./w,layers/en,./w,dense/en,(/w,top/en,_,layer/en,_,h/en,_,state/en,,/w, ,n/en,_,outputs/en,,/w, ,name/en,=/w,"/w,softmax/en,"/w,)/w, ,xentropy/en, ,=/w, ,tf/en,./w,nn/en,./w,sparse/en,_,softmax/en,_,cross/en,_,entropy/en,_,with/en,_,logits/en,(/w,labels/en,=/w,y/en,,/w, ,logits/en,=/w,logits/en,)/w, ,loss/en, ,=/w, ,tf/en,./w,reduce/en,_,mean/en,(/w,xentropy/en,,/w, ,name/en,=/w,"/w,loss/en,"/w,)/w, ,optimizer/en, ,=/w, ,tf/en,./w,train/en,./w,adamoptimizer/en,(/w,learning/en,_,rate/en,=/w,learning/en,_,rate/en,)/w, ,training/en,_,op/en, ,=/w, ,optimizer/en,./w,minimize/en,(/w,loss/en,)/w, ,correct/en, ,=/w, ,tf/en,./w,nn/en,./w,in/en,_,top/en,_,k/en,(/w,logits/en,,/w, ,y/en,,/w, ,1/m,)/w, ,accuracy/en, ,=/w, ,tf/en,./w,reduce/en,_,mean/en,(/w,tf/en,./w,cast/en,(/w,correct/en,