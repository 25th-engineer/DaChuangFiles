本来 这个 公众 号 的 交流 消息中间件 相关 的 技术 
的 这周 去 上海 参加 了 QCon 第一 次 参加 
这样 的 技术 会议 感受 挺多 的 所以 整理 一下 
自己 的 一些 想法 接 公众 号 和 大家 交流 
一下 下面 进入 正题 从/p 自己/r 参加/v 了/ul 的/uj 一些/m 
分享/v 中/f 挑/v 一些/m 有趣/a 的/uj 议题/n 来/v 和/c 大家/n 
讨论/v 深蓝 20年 之后 的 人工智能 2017年 可以 说 是 
人工智能 的 元年 了 AlphaGo 战胜 李世石 然 人工智能 一下 
进入 了 大众 的 视野 之后 以 Master 的 身份 
60 连胜 接着 战胜 长期 世界 排名 第一 的 柯洁 
QCon 期间 AlphaGo Zero 通过 3天 自学 的 方式 就以 
100 0 的 方式 战胜 了 AlphaGo 可以 说 在 
棋类 领域 人类 对 人工智能 已经 没有 任何 胜 算了 
这次 QCon 复旦/nz 大学/n 的/uj 危辉/nr 教授/n 从/p 人工智能/n 的/uj 
历史/n 说起/v 之后 从 人工智能 的 问题 域 解题 步骤 
步步 深入 清晰 的 描述 了 目前 人工智能 领域 的 
进展 危辉/nr 教授 的 深蓝 20年 之后 的 人工智能 分享 
可能 从 听众 的 感受 上 有点 反 人工智能 热潮 
但是 我 认为 这场 分享 是 给 人工智能 的 门外 
的 我们 一个 很好 的 入门 介绍 让 我们 明白 
目前 人工智能 领域 的 发展 状况 让 我们 对 遍地 
的 人工智能 现象 有 一个 清晰 的 任务 另外 危辉/nr 
教授 演讲 的 逻辑性 严谨性 和 现场 把 控 能力 
真的 是 单从 一场 分享 能 感受到 功底 的 深厚 
这场 分享 的 PPT 没 能从 QCon 网站 上 下载 
到 并不能 回忆起 很多 具体 的 分享 内容 以上 是 
个人 现场 感受 的 一些 体验 免费 的 性能 午餐 
Alibaba JDK 协 程 这 一场 是 阿里 巴巴 技术 
专家 郁磊/nr 带来 关于 Alibaba JDK 协 程的/nr 介绍 在 
参加 这次 分享 之前 我 对 协 程并/nr 没有 什么 
概念 没 写过 C + + 程序 这场 分享 下 
来 只能 说 有个 简单 的 认识 另外 就是 感叹 
于 阿里 的 同学 在 这块 技术 领域 的 深入 
不过 就 目前 的 状况 对 我们 这样 一些 小 
公司 而言 可能 并 没有 技术 能力 去 修改 JVM 
短期内 的 编程 方式 并 不会 有 太大 的 改变 
可能 当 协 程 成为 一种 标准 一种 官方 提倡 
的 编程 方式 之后 才 会 慢慢 进入 大众 程序员 
的 领域 那 为什么 不 提前 学习 一些 呢 基于 
内存 的 分布式计算 这是 这次 QCon 去 听 的 第一 
个 具体 问题 领域 的 解决方案 包含 内容 如下 背景 
介绍 及 问题 阐述 候选 解决 方案 分析 分布式 内存 
计算 框架 介绍 客户 实践 这里 我 简要 的 说 
一下 第 1点 和第/nr 3点 问题 背景 Talking Data 技术 
团队 使用 bitmap 索引 技术 移动 运营 各项 指标 如 
日 活 留存 的 实时 计算 因为 bitmap 索引 高效 
且 能 节省 存储空间 它 能很/nr 方便 地做 指标 的 
实时 排 重 上面 是日 活 的 一个 例子 其实 
就是 用 一个 二进制位 来 保存 用户 的 状态 比如 
第一 位 表示 用户 设备 1 该位 为 0 表示 
用户 未 登录 过 为 1 表示 用户 登录 过 
那么 用户 重复 的 登录 自然 就 被忽略了 Talking Data 
使用 MySQL 的 blob 类型 存储 bitmap 数据 那么 每次 
需要 更新 数据 时 如 需要 更新 某 一个 用户 
的 状态 那么 需要 将 bitmap 读 取出来 修改 其中 
一位 之后 将 数据 写 回到 MySQL 中 那么 就 
带来 了 一个 问题 当 某个 APP 的 日 活 
数据量 特别 大 时 bitmap 数据 特别 大 频繁 的 
update 导致 了 产生 大量 的 MySQL binlog 解决方案 大概 
思路 就是 在 MySQL 之前 加上 一层 缓存 前端 的 
更新 操作 都在 Blade 内存 中 操作 之后 定时 同步 
写到 MySQL 中 这样 就 解决 了 频繁 更新 bitmap 
导致 的 大量 binlog 问题 几个 组件 如上图 APP 中 
使用 的 Client 内存 计算 服务 Blade Server 分为 Master 
和 Slave Blade Data Sync 负责 从 Server 定时 同步 
数据 到 MySQLBlade Admin 提供 管控 功能上 图中 Blade Server 
有主 备 关系 且 主 备 间有 交互 现场 提问 
环节 我 提了 以下 几个 问题 主从复制 是 怎么做 的 
支持 一 主 多 从吗/nr Blade Server 是 基于 内存 
的 没有 做 持久化 那么 可 么 保证 系统 的 
可靠性 比如 如果 主从 两个 节点 宕机 了 未 同步 
到 MySQL 的 数据 是否 就 丢失 了 得到 的 
答复 是 目前 他们 并 没有 做 主从复制 当前 其实 
是 双写的/nr 模式 即 Client 会将 数据 写到 Master 和 
Slave 这样 也 就 没有 第二 个 问题 的 处理 
了 对于 分布式系统 认为 首先 要 考虑 的 就是 系统 
的 可靠性 和 可用性 我们 常常 说 的 一点 就是 
为了 保证 数据 的 可靠性 我们 需要 一 式 三份 
而且 是 尽量 让 三分 数据 分 不到 不同 机器 
中 比 如同 机柜 的 机器 存 一份 跨 机柜 
的 存 一份 像 HDFS 那样 存储 数据 所以 我 
觉得 上面 的 方案 并 不是 一个 很 可靠 的 
方案 比如 使用 消息中间件 的 方式 是否 能 代替 上面 
的 方案 呢 客户端 将 消息 发送到 消息中间件 中 类似于 
RocketMQ 和 Kafka 这样 的 组件 中 之后 通过 Consumer 
定时 从中 取 消费 数据 来 解决 频繁 更新 的 
问题 数据 的 可靠性 通过 消息中间件 得到 了 保证 也可 
启动 实时 消费 的 Consumer 来 消费 数据 更新 到 
某个 内存 服务 中 这样 可以 提供 实时 的 查询 
服务 以上 是 自己 的 一些 疑问 和拍/nr 脑袋 的 
一个 替代 方案 欢迎 交流 不同 的 想法 饿 了么 
异地 多 活 的 基础 设施 建设 之前 我们 团队 
考虑 过 一些 异地 多 活 的 实现 方案 所以 
特地 去 听了 这场 分享 之前 在 自己 考虑 异地 
多 活 方案 时 遇到 的 最大 的 问题 是 
数据 同步 和 数据 一致性 下面 看 饿 了么 是 
如何 实现 基地 多 活 的 首先 是 饿 了么 
的 业务 特点 其中 最 重要 的 一点 就是 地域性 
饿 了么 的 业务 特点 可以 将 所有 数据 按照 
商户 所在 的 位置 信息 来 进行 划分 比如 所有 
南方 商户 的 数据 走 上海 机房 所有 北方 商户 
的 数据 走 北京 机房 对于 用户 和 订单 信息 
都 可以 关联 到 对应 的 商家 然后 访问 商家 
对应 所在 的 机房 的 服务 上面 是 饿 了么 
异地 多 活 的 数据 复制 实现 思路 就是 在 
两个 机房 之间 进行 双向 的 数据 复制 回想 一下 
因为 饿 了么 的 业务 特点 双向复制 的 数据 中 
不会 有 重叠 的 部分 从/p 北京/ns 机房/n 往/zg 上海/ns 
机房/n 复制/v 的/uj 是/v 北方/f 商户/n 的/uj 数据/n 从/p 上海/ns 
机房/n 到/v 北京/ns 机房/n 复制/v 的/uj 是/v 南方/f 商户/n 的/uj 
数据/n 在/p 复制/v 中/f 过滤掉/i 不必要/l 的/uj 数据/n 比如 从 
上海 复制 到 北京 的 数据 这 部分 数据 应用 
到 MySQL 之后 也 会 产生 binlog 这部分 binlog 需要 
从 北京 复制 到 上海 的 数据 中 剔除 这个 
通过 改造 SQL 或者 增加 标识 是 可以 做到 的 
这样 就 避免 掉 了 一个 数据 在 两个 机房 
同时 被 修改 的 问题 扩展 考虑 一个 问题 比如 
在 电商 场景 中 做 异地 多 活 对于 一个 
商品 在 北京 机房 和 上海 机房 都会 被 访问 
这个 时候 就 产生 了 一个 问题 商品 的 库存 
为 1 北京 机房 下了 一 单 将 商品 库存 
变更为 0 同时 上海 机房 也 下了 一 单 也将 
库存 变更为 0 这样 就 产生 了 超卖 的 问题 
另外 如何 在 双向 数据 同步 中将 上线 的 数据 
修复 即使 其中 一个 订单 失效 将 库存 修复 也 
会 一个 问题 Otter 阿里 巴巴 B2B 公司 因为 业务 
的 特性 卖家 主要 集中 在 国内 买家 主要 集中 
在 国外 所以 衍 生出 了 杭州 和 美国 异地 
机房 的 需求 同时 为了 提升 用户 体验 整个 机房 
的 架构 为 双A/nr 两边 均 可写 由此 诞生 了 
otter 这样 一个 产品 Otter 在 解决 数据 一致 性 
问题 时 同 一行 记录 多 地 修改 有 两种 
方案 事前控制 比如 paoxs 协议 在 多 地 数据 写入 
各自 数据 存储 之前 就 已经 决定 好 最后 保留 
哪条 记录 事后 补救 指 A / B 两地 修改 
的 数据 已经 保存 到 数据库 之后 通过/p 数据/n 同步/d 
后/f 保证/v 两/m 数据/n 的/uj 一致性/n 两种/m 方式/n 都是/nr 数据/n 
最终/d 一致性/n 的/uj 保证/v 具体 内容 可以 参考 Otter 数据 
一致性 解决方案 未完待续 . . . QCon3 天 还有 挺 
多想 和 大家 分享 的 所以 还有 下篇 包含 PhxQueue 
微信/i 开源/n 高/a 可用/v 强/a 一致/d 分布式/n 队列/n 的/uj 设计/vn 
与/p 实现/v Heron 的 Exactly Once 实现 几个 议题 的 
分享 感受 欢迎 关注 公众 号 交流 2017QCon 上海站 PPT 
下载 PPT 