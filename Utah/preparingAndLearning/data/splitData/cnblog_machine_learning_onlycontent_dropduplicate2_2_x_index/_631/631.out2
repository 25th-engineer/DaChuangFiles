机器/n,学习/v,中/f,，/w,神经/n,网络/n,算法/n,可以/v,说是/v,当下/t,使用/v,的/u,最/d,广泛/a,的/u,算法/n,。/w,神经/n,网络/n,的/u,结构/n,模仿/v,自/p,生物/n,神经/n,网络/n,，/w,生物/n,神经/n,网络/n,中/f,的/u,每个/r,神经元/n,与/p,其他/r,神经元/n,相连/v,，/w,当/p,它/r,“/w,兴奋/v,”/w,时/ng,，/w,想/v,下/f,一级/b,相连/v,的/u,神经元/n,发送/v,化学/n,物质/n,，/w,改变/v,这些/r,神经元/n,的/u,电位/n,；/w,如果/c,某/r,神经元/n,的/u,电位/n,超过/v,一个/m,阈值/n,，/w,则/d,被/p,激活/vn,，/w,否则/c,不/d,被/p,激活/vn,。/w,误差/n,逆传播算法/nw,（/w,error/en, ,back/en, ,propagation/en,）/w,是/v,神经/n,网络/n,中/f,最/d,有/v,代表性/n,的/u,算法/n,，/w,也/d,是/v,使用/v,最/d,多/a,的/u,算法/n,之一/r,。/w,误差/n,逆传播算法/nw,理论/n,推导/vn,误差/n,逆传播算法/nw,（/w,error/en, ,back/en, ,propagation/en,）/w,简称/v,bp/en,网络/n,算法/n,。/w,而/c,一般/a,在/p,说/v,bp/en,网络/n,算法/n,时/ng,，/w,默认/v,指用/nw,bp/en,算法/n,训练/vn,的/u,多/a,层/q,前馈/nw,神经/n,网络/n,。/w,下面/f,是/v,一个/m,简单/a,的/u,bp/en,神经/n,网络/n,示意图/n,。/w,其/r,拥有/v,一个/m,输入层/nw,，/w,一个/m,隐含层/nw,，/w,一个/m,输出/v,层/q,。/w,推导/vn,中/f,采用/v,这种/r,简单/a,的/u,三层/mq,的/u,神经/n,网络/n,。/w,定义/n,相关/v,的/u,一些/m,变量/n,如下/v,：/w,假设/v,有/v, ,d/en, ,个/q,输入/v,神经元/n,，/w,有/v, ,l/en, ,个/q,输出/v,神经元/n,，/w,q/en, ,个/q,隐含层神经元/nw,；/w,设/v,输出/v,层/q,第/m, ,j/en, ,个/q,神经元/n,的/u,阈值/n,为/p, ,θ,j/en, ,；/w,设/v,隐含层/nw,第/m, ,h/en, ,个/q,神经元/n,的/u,阈值/n,为/p, ,γ,h/en, ,；/w,输入层/nw,第/m, ,i/en, ,个/q,神经元/n,与/p,隐含层/nw,第/m, ,h/en, ,个/q,神经元/n,之间/f,的/u,连接权/nw,为/p, ,vih/en, ,；/w,隐含层/nw,第/m, ,h/en, ,个/q,神经元/n,与/p,输出/v,层/q,第/m, ,j/en, ,个/q,神经元/n,之间/f,的/u,连接权/nw,为/p, ,whj/en, ,；/w,记隐/nw,含/v,层/q,第/m, ,h/en, ,个/q,神经元/n,接收/v,到/v,来自/v,于/p,输入层/nw,的/u,输入/v,为/p, ,α,h/en,：/w,记/v,输出/v,层/q,第/m, ,j/en, ,个/q,神经元/n,接收/v,到/v,来自/v,于/p,隐含层/nw,的/u,输入/v,为/p, ,β,j/en,：/w,，/w,其中/r, ,bh/en, ,为/p,隐含层/nw,第/m, ,h/en, ,个/q,神经元/n,的/u,输出/v,理论/n,推导/vn,：/w,在/p,神经/n,网络/n,中/f,，/w,神经元/n,接收/v,到/v,来自/v,来自/v,其他/r,神经元/n,的/u,输入/v,信号/n,，/w,这些/r,信号/n,乘/v,以/p,权/n,重/a,累/a,加/v,到/v,神经元/n,接收/v,的/u,总/b,输入值/nw,上/f,，/w,随后/d,与/p,当前/t,神经元/n,的/u,阈值/n,进行/v,比较/d,，/w,然后/c,通过/p,激活/vn,函数/n,处理/v,，/w,产生/v,神经元/n,的/u,输出/v,。/w,激活/vn,函数/n,：/w,理想/n,的/u,激活/vn,函数/n,是/v,阶跃/nw,函数/n,，/w,“/w,0/m,”/w,对应/v,神经元/n,抑制/v,，/w,“/w,1/m,”/w,对应/v,神经元/n,兴奋/v,。/w,然而/c,阶跃/nw,函数/n,的/u,缺点/n,是/v,不/d,连续/a,，/w,不可导/nw,，/w,且/c,不/d,光滑/a,，/w,所以/c,常用/a,sigmoid/en,函数/n,作为/v,激活/vn,函数/n,代替/v,阶跃/nw,函数/n,。/w,如/v,下/f,图/n,分别/d,是/v,阶跃/nw,函数/n,和/c,sigmoid/en,函数/n,。/w,阶跃/nw,函数/n,：/w,sigmoid/en,函数/n,：/w,对于/p,一个/m,训练/vn,例/n,（/w,xk/en,,/w, ,yk/en,）/w,，/w,假设/v,神经/n,网络/n,的/u,输出/v,为/p, ,yk/en, ,，/w,则/d,输出/v,可/v,表示/v,为/p,：/w,f/en,(/w,*/w,*/w,*/w,)/w,表示/v,激活/vn,函数/n,，/w,默认/v,全部/m,的/u,激活/vn,函数/n,都/d,为/p,sigmoid/en,函数/n,。/w,则/d,可以/v,计算/v,网络/n,上/f,，/w,（/w,xk/en,,/w, ,yk/en,）/w,的/u,均方/nw,差/a,误差/n,为/p,：/w,乘/v,以/p,1/m,//w,2/m,是/v,为了/p,求导/nw,时/ng,能/v,正好/z,抵消/v,掉/v,常数/n,系数/n,。/w,现在/t,，/w,从/p,隐含层/nw,的/u,第/m,h/en,个/q,神经元/n,看/v,，/w,输入层/nw,总共/d,有/v, ,d/en, ,个/q,权/n,重/a,传递/v,参数/n,传/v,给/p,他/r,，/w,它/r,又/d,总共/d,有/v, ,l/en, ,个/q,权/n,重/a,传递/v,参数/n,传/v,给/p,输出/v,层/q,,/w, ,自身/r,还有/v, ,1/m, ,个/q,阈值/n,。/w,所以/c,在/p,我们/r,这个/r,神经/n,网络/n,中/f,，/w,一个/m,隐含层神经元/nw,有/v,（/w,d/en,+/w,l/en,+/w,1/m,）/w,个/q,参数/n,待/v,确定/v,。/w,输出/v,层/q,每个/r,神经元/n,还有/v,一个/m,阈值/n,，/w,所以/c,总共/d,有/v, ,l/en, ,个/q,阈值/n,。/w,最后/f,，/w,总共/d,有/v,（/w,d/en,+/w,l/en,+/w,1/m,）/w,*/w,q/en,+/w,l/en, ,个/q,待定/v,参数/n,。/w,首先/d,，/w,随机/d,给/p,出/v,这些/r,待定/v,的/u,参数/n,，/w,后面/f,通过/p,bp/en,算法/n,的/u,迭代/vn,，/w,这些/r,参数/n,的/u,值/n,会/v,逐渐/d,收敛/vn,于/p,合适/a,的/u,值/n,，/w,那时/r,，/w,神经/n,网络/n,也/d,就/d,训练/vn,完成/v,了/u,。/w,任意/d,权重/nz,参数/n,的/u,更新/v,公式/n,为/p,：/w,下面/f,以/p,隐含层/nw,到/v,输出/v,层/q,的/u,权重/nz,参数/n, ,whj/en, ,为/p,例/n,说明/v,：/w,我们/r,可以/v,按照/p,前面/f,给/p,出/v,的/u,公式/n,求/v,出/v,均/d,方差/nr,误差/n, ,ek/en, ,，/w,期望/v,其/r,为/p,0/m,，/w,或者/c,为/p,最小值/nz,。/w,而/c,bp/en,算法/n,基于/p,梯度/n,下降/v,法/j,（/w,gradient/en, ,descent/en,）/w,来/v,求解/v,最/d,优解/nw,，/w,以/p,目标/n,的/u,负/v,梯度/n,方向/n,对/p,参数/n,进行/v,调整/vn,，/w,通过/p,多次/m,迭代/vn,，/w,新/a,的/u,权重/nz,参数/n,会/v,逐渐/d,趋/v,近/a,于/p,最/d,优解/nw,。/w,对于/p,误差/n, ,ek/en, ,，/w,给/p,定/v,学习率/nw,（/w,learning/en, ,rate/en,）/w,即/v,步长/nz, ,η, ,，/w,有/v,：/w,再/d,看/v,一下/m,参数/n,的/u,传递/v,方向/n,，/w,首先/d, ,whj/en, ,影响/vn,到/v,了/u,输出/v,层神经元/nw,的/u,输入值/nw, ,β,j/en, ,，/w,然后/c,影响/vn,到/v,输出值/nw, ,yjk/en, ,,/w,然后/c,再/d,影响/vn,到/v,误差/n, ,ek/en, ,，/w,所以/c,可以/v,列出/v,如下/v,关系式/n,：/w,根据/p,输出/v,层神经元/nw,的/u,输入值/nw, ,β,j/en, ,的/u,定义/n,：/w,得到/v,：/w,对于/p,激活/vn,函数/n,（/w,sigmoid/en,函数/n,）/w,：/w,很/d,容易/a,通过/p,求导证/nw,得/u,下面/f,的/u,性质/n,：/w,使用/v,这个/r,性质/n,进行/v,如下/v,推导/vn,：/w,令/v,：/w,又/d,由于/c,：/w,所以/c,：/w,由/p,前面/f,的/u,定义/n,有/v,：/w,所以/c,：/w,把/p,这个/r,结果/n,结合/v,前面/f,的/u,几/m,个/q,式子/n,代/q,入/v,：/w,，/w, , ,，/w,得到/v,：/w,所以/c,：/w,ok/en,，/w,上面/f,这个/r,式子/n,就/d,是/v,梯度/n,了/u,。/w,通过/p,不停/v,地/u,更新/v,即/v,梯度/n,下降/v,法/j,就/d,可/v,实现/v,权重/nz,更新/v,了/u,。/w,推导/vn,到/v,这里/r,就/d,结束/v,了/u,，/w,再/d,来/v,解释/v,一下/m,式子/n,中/f,各个/r,元素/n,的/u,意义/n,。/w,η, ,为/p,学习率/nw,，/w,即/v,梯度/n,下降/v,的/u,补偿/vn,；/w,为/p,神经/n,网络/n,输出/v,层/q,第/m, ,j/en, ,个/q,神经元/n,的/u,输出值/nw,；/w,为/p,给/p,出/v,的/u,训练/vn,例/n,（/w,xk/en,,/w, ,yk/en,）/w,的/u,标志/n,（/w,label/en,）/w,，/w,即/v,训练/vn,集/vg,给/p,出/v,的/u,正确/a,输出/v,；/w,为/p,隐含层/nw,第/m, ,h/en, ,个/q,神经元/n,的/u,输出/v,。/w,类似/v,可/v,得/u,：/w,其中/r,，/w,这/r,部分/n,的/u,解法/n,与/p,前面/f,的/u,推导/vn,方法/n,类似/v,，/w,不/d,做/v,赘述/v,。/w,接下来/l,是/v,代码/n,部分/n,：/w,这/r,段/q,代码/n,网上/s,也/d,有/v,不少/m,地方/n,可以/v,看到/v,，/w,后面/f,会/v,简单/a,介绍/v,一下/m,程序/n,。/w,完整/a,程序/n,：/w,文件名/n,“/w,nn/en,_,test/en,./w,py/en,”/w,#, ,_,*/w,_, ,coding/en,:/w, ,utf/en,-/w,8/m, ,_,*/w,_, ,import/en, ,numpy/en, ,as/en, ,np/en, ,def/en, ,tanh/en,(/w,x/en,)/w,:/w, ,return/en, ,np/en,./w,tanh/en,(/w,x/en,)/w, ,def/en, ,tanh/en,_,derivative/en,(/w,x/en,)/w,:/w, ,return/en, ,1/m, ,-/w, ,np/en,./w,tanh/en,(/w,x/en,)/w, ,*/w, ,np/en,./w,tanh/en,(/w,x/en,)/w, ,#, ,sigmod/en,函数/n, ,def/en, ,logistic/en,(/w,x/en,)/w,:/w, ,return/en, ,1/m, ,//w, ,(/w,1/m, ,+/w, ,np/en,./w,exp/en,(/w,-/w,x/en,)/w,)/w, ,#, ,sigmod/en,函数/n,的/u,导数/n, ,def/en, ,logistic/en,_,derivative/en,(/w,x/en,)/w,:/w, ,return/en, ,logistic/en,(/w,x/en,)/w, ,*/w, ,(/w,1/m, ,-/w, ,logistic/en,(/w,x/en,)/w,)/w, ,class/en, ,neuralnetwork/en,:/w, ,def/en, ,_,_,init/en,_,_, ,(/w,self/en,,/w, ,layers/en,,/w, ,activation/en, ,=/w, ,'/w,tanh/en,'/w,)/w,:/w, ,if/en, ,activation/en, ,=/w,=/w, ,'/w,logistic/en,'/w,:/w, ,self/en,./w,activation/en, ,=/w, ,logistic/en, ,self/en,./w,activation/en,_,deriv/en, ,=/w, ,logistic/en,_,derivative/en, ,elif/en, ,activation/en, ,=/w,=/w, ,'/w,tanh/en,'/w,:/w, ,self/en,./w,activation/en, ,=/w, ,tanh/en, ,self/en,./w,activation/en,_,deriv/en, ,=/w, ,tanh/en,_,derivative/en, ,#, ,随机/d,产生/v,权重/nz,值/n, ,self/en,./w,weights/en, ,=/w, ,[/w,]/w, ,for/en, ,i/en, ,in/en, ,range/en,(/w,1/m,,/w, ,len/en,(/w,layers/en,)/w, ,-/w, ,1/m,)/w,:/w, ,#, ,不算/v,输入层/nw,，/w,循环/vn, ,self/en,./w,weights/en,./w,append/en,(/w,(/w,2/m, ,*/w, ,np/en,./w,random/en,./w,random/en,(/w, ,(/w,layers/en,[/w,i/en,-/w,1/m,]/w, ,+/w, ,1/m,,/w, ,layers/en,[/w,i/en,]/w, ,+/w, ,1/m,)/w,)/w, ,-/w, ,1/m,)/w, ,*/w, ,0.25/m, ,)/w, ,self/en,./w,weights/en,./w,append/en,(/w,(/w,2/m, ,*/w, ,np/en,./w,random/en,./w,random/en,(/w, ,(/w,layers/en,[/w,i/en,]/w, ,+/w, ,1/m,,/w, ,layers/en,[/w,i/en,+/w,1/m,]/w,)/w,)/w, ,-/w, ,1/m,)/w, ,*/w, ,0.25/m, ,)/w, ,#,print/en, ,self/en,./w,weights/en, ,def/en, ,fit/en,(/w,self/en,,/w, ,x/en,,/w, ,y/en,,/w, ,learning/en,_,rate/en,=/w,0.2/m,,/w, ,epochs/en,=/w,10000/m,)/w,:/w, ,x/en, ,=/w, ,np/en,./w,atleast/en,_,2/m,d/en,(/w,x/en,)/w, ,temp/en, ,=/w, ,np/en,./w,ones/en,(/w,[/w,x/en,./w,shape/en,[/w,0/m,]/w,,/w, ,x/en,./w,shape/en,[/w,1/m,]/w,+/w,1/m,]/w,)/w, ,temp/en,[/w,:/w,,/w, ,0/m,:/w,-/w,1/m,]/w, ,=/w, ,x/en, ,x/en, ,=/w, ,temp/en, ,y/en, ,=/w, ,np/en,./w,array/en,(/w,y/en,)/w, ,for/en, ,k/en, ,in/en, ,range/en,(/w,epochs/en,)/w,:/w, ,#, ,循环/vn,epochs/en,次/q, ,i/en, ,=/w, ,np/en,./w,random/en,./w,randint/en,(/w,x/en,./w,shape/en,[/w,0/m,]/w,)/w, ,#, ,随机/d,产生/v,一个/m,数/m,，/w,对应/v,行号/nw,，/w,即/v,数据集/nw,编号/v, ,a/en, ,=/w, ,[/w,x/en,[/w,i/en,]/w,]/w, ,#, ,抽出/v,这/r,行/v,的/u,数据集/nw, ,#, ,迭代/vn,将/d,输出/v,数据/n,更新/v,在/p,a/en,的/u,最后/f,一行/n, ,for/en, ,l/en, ,in/en, ,range/en,(/w,len/en,(/w,self/en,./w,weights/en,)/w,)/w,:/w, ,a/en,./w,append/en,(/w,self/en,./w,activation/en,(/w,np/en,./w,dot/en,(/w,a/en,[/w,l/en,]/w,,/w, ,self/en,./w,weights/en,[/w,l/en,]/w,)/w,)/w,)/w, ,#, ,减去/v,最后/f,更新/v,的/u,数据/n,，/w,得到/v,误差/n, ,error/en, ,=/w, ,y/en,[/w,i/en,]/w, ,-/w, ,a/en,[/w,-/w,1/m,]/w, ,deltas/en, ,=/w, ,[/w,error/en, ,*/w, ,self/en,./w,activation/en,_,deriv/en,(/w,a/en,[/w,-/w,1/m,]/w,)/w,]/w, ,#, ,求/v,梯度/n, ,for/en, ,l/en, ,in/en, ,range/en,(/w,len/en,(/w,a/en,)/w, ,-/w, ,2/m,,/w, ,0/m,,/w, ,-