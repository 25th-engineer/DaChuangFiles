之前/f,通过/p,各种/r,博客/n,视频/n,学习/v,cnn/en,，/w,总是/d,对/p,参数/n,啊/y,原理/n,啊/y,什么/r,的/u,懵懵懂懂/nw,。/w,。/w,这次/r,上课/v,终于/d,弄/v,明白/v,了/u,，/w,o/en,(/w,∩/w,_,∩/w,)/w,o/en,~/w,上/f,世纪/n,科学家/n,们/k,发现/v,了/u,几/m,个/q,视觉/n,神经/n,特点/n,，/w,视/vg,神经/n,具有/v,局部/n,感受/v,野/b,，/w,一/m,整/m,张/q,图/n,的/u,识别/v,由/p,多/a,个/q,局部/n,识别点/nw,构成/v,；/w,不同/a,神经元/n,对/p,不同/a,形状/n,有/v,识别/v,能力/n,，/w,且/c,视/vg,神经/n,具有/v,叠加/vn,能力/n,，/w,高层/n,复杂/a,的/u,图案/n,可以/v,由/p,低层/n,简单/a,线条/n,组成/v,。/w,之后/f,人们/n,发现/v,经过/p,conclusional/en,的/u,操作/v,，/w,可以/v,很/d,好/a,反映/v,视/vg,神经/n,处理/v,计算/v,的/u,过程/n,，/w,典型/n,的/u,是/v,1998年/t,lecun/en,发明/v,的/u,lenet/en,-/w,5/m,，/w,可以/v,极大/a,地/u,提升/v,识别/v,效果/n,。/w,本文/r,主要/b,就/d,convolutional/en, ,layer/en,、/w,pooling/en, ,layer/en,和/c,整体/n,cnn/en,结构/n,展开/v,一/m,、/w,convolutional/en, ,layer/en,卷积层/nw,1/m,、/w,原理/n,和/c,参数/n,可以/v,模拟/b,局部/n,感受/v,野/b,的/u,性质/n,，/w,同/p,上/f,一层/mq,不/d,是/v,全/a,连接/v,，/w,而是/c,一/m,小/a,块/q,区域/n,连接/v,，/w,这/r,一/m,小/a,块/q,就/d,是/v,局部/n,感受/v,野/b,（/w,receptive/en, ,field/en,）/w,。/w,并且/c,通过/p,构造/v,特定/b,的/u,卷积神经元/nw,，/w,可以/v,模拟/b,不同/a,神经元/n,对/p,不同/a,形状/n,刺激/v,不同/a,反应/vn,的/u,性质/n,。/w,如/v,下/f,图/n,所示/nz,，/w,一个/m,神经元/n,处理/v,一层/mq,会/v,形成/v,一个/m,feature/en, ,map/en,，/w,多/a,层/q,叠加/vn,，/w,层数/n,逐渐/d,加深/v,。/w,感受/v,野/b,（/w,kernel/en,或/c,filter/en,）/w,的/u,尺寸/n,可以/v,看做/v,fh/en,*/w,fw/en,，/w,由于/c,感受/v,野/b,本身/r,具有/v,尺寸/n,，/w,feature/en, ,map/en,会/v,不断/d,缩小/v,，/w,为了/p,处理/v,方便/a,，/w,使得/v,每/r,层/q,大小/n,不/d,变/v,，/w,于是/c,我们/r,每/r,层/q,加值/nz,为/p,0/m,的/u,边/d,（/w,zero/en, ,padding/en,）/w,，/w,保证/v,经过/p,处理/v,以后/f,的/u,feature/en, ,map/en,同/p,前/f,一层/mq,尺寸/n,一样/u,。/w,多/a,层/q,之间/f,的/u,卷积/nw,运算/vn,操作/v,，/w,相当/d,于/p,和/c,原来/d,像素/n,对应/v,位置/n,做/v,乘法/n,。/w,如下/v,左图/n,所/u,示/vg,，/w,加/v,了/u,边/d,后/f,可以/v,保证/v,上下层/nw,大小/n,一致/a,，/w,右图/n,表示/v,每/r,层/q,之间/f,convolve/en,的/u,操作/v,（/w,如果/c,不/d,加/v,zero/en, ,padding/en,）/w,。/w,但/c,上图/n,所示/nz,只是/d,简单/a,例子/n,，/w,一般/a,扫描/v,的/u,是/v,三维/nz,图像/n,（/w,rgb/en,）/w,，/w,就/d,不/d,是/v,一个/m,矩阵/n,，/w,而是/c,一个/m,立方体/n,，/w,我们/r,用/p,一个/m,三维/nz,块/q,去/v,扫描/v,它/r,，/w,原理/n,同/p,上图/n,相同/a,。/w,有时/d,扫描/v,时/ng,不/d,是/v,顺序/n,去/v,扫/v,，/w,而是/c,跳跃/v,着/u,扫描/v,，/w,每次/r,移动/vn,2/m,-/w,3个/m,像/v,素值/nr,（/w,stride/en,）/w,，/w,但/c,并非/v,完全/ad,分离/v,不/d,会/v,造成/v,信息/n,丢失/v,，/w,这样/r,形成/v,的/u,feature/en, ,map/en,相/d,较/d,于/p,原始/a,图片/n,缩小/v,，/w,实现/v,信息/n,聚集/v,的/u,效果/n,。/w,就/d,像/v,如下/v,灰度/n,图/n,（/w,2/m,d/en,）/w,中/f,所示/nz,，/w,左边/f,只/d,提取/v,竖线/n,（/w,vertical/en, ,filter/en,）/w,，/w,右边/f,只/d,提取/v,横线/n,（/w,horizontal/en, ,filter/en,）/w,可/v,看出/v,横梁/n,部分/n,变亮/nr,，/w,大量/m,不同/a,的/u,这样/r,的/u,filter/en,（/w,比如/v,可以/v,识别/v,边角/n,、/w,折线/n,的/u,filter/en,）/w,的/u,叠加/vn,，/w,可/v,形成/v,多/a,张/q,feature/en, ,maps/en,下/f,图/n,是/v,一个/m,3/m,d/en,的/u,rgb/en,效果/n,，/w,每个/r,kernel/en,（/w,filter/en,）/w,可以/v,扫描/v,出/v,一张/mq,feature/en, ,map/en,，/w,多/a,个/q,filter/en,可以/v,叠加/vn,出/v,很/d,厚/a,的/u,feature/en, ,maps/en,，/w,前/f,一层/mq,filter/en,做/v,卷积/nw,可以/v,形成/v,后/f,一层/mq,的/u,一个/m,像/v,素点/nr,如下/v,图/n,，/w,可以/v,代表/n,i/en,行/v,j/en,列/v,k/en,深度/n,的/u,一个/m,输出/v,像/v,素值/nr,，/w,k/en,’/w,代表/n,第/m,k/en,个/q,filter/en,，/w,w/en,代表/n,filter/en,中/f,的/u,值/n,，/w,x/en,代表/n,输入/v,，/w,b/en,是/v,偏值/nw,。/w,2/m,、/w,tensorflow/en,实现/v,以下/f,是/v,使用/v,tensorflow/en,实现/v,的/u,代码/n,，/w,主要/b,使用/v,conv/en,2/m,d/en,这个/r,函数/n,import/en, ,numpy/en, ,as/en, ,np/en, ,from/en, ,sklearn/en,./w,datasets/en, ,import/en, ,load/en,_,sample/en,_,images/en, ,#, ,load/en, ,sample/en, ,images/en, ,dataset/en, ,=/w, ,np/en,./w,array/en,(/w,load/en,_,sample/en,_,images/en,(/w,)/w,./w,images/en,,/w, ,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,#, ,一共/d,4维/mq,，/w,channel/en,表示/v,通道/n,数/m,，/w,rgb/en,是/v,3/m, ,batch/en,_,size/en,,/w, ,height/en,,/w, ,width/en,,/w, ,channels/en, ,=/w, ,dataset/en,./w,shape/en, ,#, ,create/en, ,2/m, ,filters/en, ,#, ,一般/a,感受/v,野/b,大小/n,7/m,*/w,7/m,,/w,5/m,*/w,5/m,,/w,3/m,*/w,3/m,，/w,设置/v,2个/m,kernel/en,，/w,输出/v,2层/mq,feature/en, ,map/en, ,filters/en,_,test/en, ,=/w, ,np/en,./w,zeros/en,(/w,shape/en,=/w,(/w,7/m,,/w, ,7/m,,/w, ,channels/en,,/w, ,2/m,)/w,,/w, ,dtype/en,=/w,np/en,./w,float/en,32/m,)/w, ,#, ,第一/m,个/q,（/w,0/m,）/w,filter/en,的/u,设定/v,，/w,7/m,*/w,7/m,矩/ng,阵/ng,中/f,，/w,3/m,是/v,中间/f, ,filters/en,_,test/en,[/w,:/w,,/w, ,3/m,,/w, ,:/w,,/w, ,0/m,]/w, ,=/w, ,1/m, ,#, ,vertical/en, ,line/en, ,#, ,第二/m,个/q,（/w,1/m,）/w,filter/en,的/u,设定/v, ,filters/en,_,test/en,[/w,3/m,,/w, ,:/w,,/w, ,:/w,,/w, ,1/m,]/w, ,=/w, ,1/m, ,#, ,horizontal/en, ,line/en, ,#, ,a/en, ,graph/en, ,with/en, ,input/en, ,x/en, ,plus/en, ,a/en, ,convolutional/en, ,layer/en, ,applying/en, ,the/en, ,2/m, ,filters/en, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,shape/en,=/w,(/w,none/en,,/w, ,height/en,,/w, ,width/en,,/w, ,channels/en,)/w,)/w, ,#, ,虽然/c,输入/v,是/v,一个/m,四维/nw,图像/n,，/w,但是/c,由于/c,batch/en,_,size/en,和/c,channel/en,都/d,已经/d,固定/a,，/w,所以/c,使用/v,conv/en,2/m,d/en, ,#, ,strides/en,设定/v,，/w,第一/m,个/q,和/c,第四/nw,个/q,都/d,是/v,1/m,表示/v,不/d,可以/v,跳/v,过/u,batch/en,_,size/en,和/c,channel/en, ,#, ,那/r,两个/m,2/m,表示/v,横/v,纵向/n,都/d,缩减/v,2/m,，/w,相当/d,于/p,整/m,张/q,图片/n,缩减/v,为/p,原来/d,四分之一/nw,，/w,做/v,了/u,75%/mq,的/u,缩减/v, ,convolution/en, ,=/w, ,tf/en,./w,nn/en,./w,conv/en,2/m,d/en,(/w,x/en,,/w, ,filters/en,,/w, ,strides/en,=/w,[/w,1/m,,/w,2/m,,/w,2/m,,/w,1/m,]/w,,/w, ,padding/en,=/w,"/w,same/en,"/w,)/w, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,output/en, ,=/w, ,sess/en,./w,run/en,(/w,convolution/en,,/w, ,feed/en,_,dict/en,=/w,{/w,x/en,:/w, ,dataset/en,}/w,)/w,下面/f,是/v,padding/en,的/u,值/n,same/en,和/c,valid/en,的/u,区别/n,（/w,filter/en,的/u,宽度/n,为/p,6/m,，/w,stride/en,为/p,5/m,）/w,，/w,same/en,确保/v,所有/b,图像/n,信息/n,都/d,被/p,convolve/en,添加/vn,zero/en, ,padding/en,，/w,而/c,valid/en,只/d,添加/vn,包含/v,在内/u,的/u,像素/n,点/q,3/m,、/w,所/u,耗/v,内/f,存/v,计算/v,相比/v,于/p,传统/n,的/u,全/a,连接/v,层/q,，/w,卷积层/nw,只是/d,部分/n,连接/v,，/w,节省/v,了/u,很多/m,内存/n,。/w,比如/v,：/w,一个/m,具有/v,5/m,*/w,5/m,大小/n,filter/en,的/u,卷积层/nw,，/w,输出/v,200张/mq,150/m,*/w,100/m,大小/n,的/u,feature/en, ,maps/en,，/w,stride/en,取/v,1/m,（/w,即/v,不/d,跳跃/v,）/w,，/w,padding/en,为/p,same/en,。/w,输入/v,是/v,150/m,*/w,100/m,大小/n,的/u,rgb/en,图像/n,（/w,channel/en,=/w,3/m,）/w,，/w,总共/d,的/u,参数/n,个/q,数/m,是/v,200/m,*/w,（/w,5/m,*/w,5/m,*/w,3/m,+/w,1/m,）/w,=/w,15200/m,，/w,其中/r,+/w,1/m,是/v,bias/en,；/w,如果/c,输出/v,采用/v,32/m,-/w,bits/en, ,float/en,表示/v,（/w,np/en,./w,float/en,32/m,）/w,，/w,那么/r,每张/r,图片会/nw,占据/v,200/m,*/w,150/m,*/w,100/m,*/w,32/m,=/w,9600000/m,bits/en,（/w,11.4/m,mb/en,）/w,，/w,如果/c,一个/m,training/en, ,batch/en,包含/v,100张/mq,图片/n,（/w,mini/en,-/w,batch/en,=/w,100/m,）/w,，/w,那么/r,这/r,一层/mq,卷积层/nw,就/d,会/v,占据/v,1/m,gb/en,的/u,ram/en,。/w,可以/v,看出/v,，/w,训练/vn,卷积/nw,神经/n,网络/n,是/v,非常/d,消耗/v,内存/n,的/u,，/w,但是/c,使用/v,时/ng,，/w,只用/v,到/v,最后/f,一层/mq,的/u,输出/v,即可/v,。/w,二/m,、/w,pooling/en, ,layer/en,池/ng,化/v,层/q,1/m,、/w,原理/n,和/c,参数/n,当/p,图片/n,大小/n,很/d,大/a,时/ng,内/f,存/v,消耗/v,巨大/a,，/w,而/c,pooling/en, ,layer/en,所/u,起/v,的/u,作用/n,是/v,浓缩/vn,效果/n,，/w,缓解/v,内存/n,压力/n,。/w,即/v,选取/v,一定/d,大小/n,区域/n,，/w,将/d,该/r,区域/n,用/p,一个/m,代表/n,元素/n,表示/v,。/w,具体/a,的/u,pooling/en,有/v,两种/mq,，/w,取/v,平均值/n,（/w,mean/en,）/w,和/c,取/v,最/d,大/a,值/n,（/w,max/en,）/w,。/w,如/v,下/f,图/n,所示/nz,是/v,一个/m,取/v,最/d,大/a,值/n,的/u,pooling/en, ,layer/en,，/w,kernel/en,大小/n,为/p,2/m,*/w,2/m,，/w,stride/en,大小/n,取决于/v,kernel/en,大小/n,，/w,这里/r,是/v,2/m,，/w,即/v,刚好/d,使得/v,所有/b,kernel/en,都/d,不/d,重叠/v,的/u,值/n,，/w,因而/c,实现/v,高效/b,的/u,信息/n,压缩/v,，/w,将/d,原始/a,图像/n,横纵压缩/nw,一半/m,，/w,如/v,右图/n,所/u,示/vg,，/w,特征/n,基本/a,都/d,完全/ad,保留/v,了/u,下来/v,。/w,pooling/en,这个/r,操作/v,不/d,影响/vn,channel/en,数/m,，/w,在/p,feature/en, ,map/en,上/f,也/d,一般/a,不/d,做/v,操作/v,（/w,即/v,z/en,轴/q,一般/a,不/d,变/v,）/w,，/w,只/d,改变/v,横/v,纵/c,大小/n,。/w,2/m,、/w,tensorflow/en,实现/v,#, ,create/en, ,a/en, ,graph/en, ,with/en, ,input/en, ,x/en, ,plus/en, ,a/en, ,max/en, ,pooling/en, ,layer/en, ,x/en, ,=/w, ,tf/en,./w,placeholder/en,(/w,tf/en,./w,float/en,32/m,,/w, ,shape/en,=/w,(/w,none/en,,/w, ,height/en,,/w, ,width/en,,/w, ,channels/en,)/w,)/w, ,#, ,选用/v,取/v,最/d,大/a,值/n,的/u,max/en,_,pool/en,方法/n, ,#, ,如果/c,是/v,取/v,平均值/n,，/w,这里/r,是/v,mean/en,_,pool/en,#, ,ksize/en,就是/d,kernel/en,大小/n,，/w,feature/en, ,map/en,和/c,channel/en,都/d,是/v,1/m,,/w,横向/n,纵向/n,是/v,2/m, ,max/en,_,pool/en, ,=/w, ,tf/en,./w,nn/en,./w,max/en,_,pool/en,(/w,x/en,,/w, ,ksize/en,=/w,[/w,1/m,,/w,2/m,,/w,2/m,,/w,1/m,]/w,,/w, ,strides/en,=/w,[/w,1/m,,/w,2/m,,/w,2/m,,/w,1/m,]/w,,/w,padding/en,=/w,"/w,valid/en,"/w,)/w, ,with/en, ,tf/en,./w,session/en,(/w,)/w, ,as/en, ,sess/en,:/w, ,output/en, ,=/w, ,sess