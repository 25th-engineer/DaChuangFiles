本来/d,这/r,篇/q,是/v,准备/v,5.15更/mq,的/u,，/w,但是/c,上周/t,一直/d,在/p,忙/v,签证/n,和/c,工作/vn,的/u,事/n,，/w,没/d,时间/n,就/d,推迟/v,了/u,，/w,现在/t,终于/d,有/v,时间/n,来/v,写写/v,learning/en, ,spark/en,最后/f,一部分/m,内容/n,了/u,。/w,第/m,10/m,-/w,11/m, ,章/q,主要/b,讲/v,的/u,是/v,spark/en, ,streaming/en, ,和/c,mllib/en,方面/n,的/u,内容/n,。/w,我们/r,知道/v,spark/en,在/p,离/v,线/n,处理/v,数据/n,上/f,的/u,性能/n,很/d,好/a,，/w,那么/r,它/r,在/p,实时/n,数据/n,上/f,的/u,表现/v,怎么样/r,呢/y,？/w,在/p,实际/n,生产/vn,中/f,，/w,我们/r,经常/d,需要/v,即使/c,处理/v,收到/v,的/u,数据/n,，/w,比如/v,实时/n,机器/n,学习/v,模型/n,的/u,应用/vn,，/w,自动/d,异常/a,的/u,检测/vn,，/w,实时/n,追踪/v,页面/n,访问/v,统计/v,的/u,应用/vn,等/u,。/w,spark/en, ,streaming/en,可以/v,很/d,好/a,的/u,解决/v,上述/b,类似/v,的/u,问题/n,。/w,了解/v,spark/en, ,streaming/en, ,，/w,只/d,需要/v,掌握/v,以下/f,几/m,点/q,即/v,可/v,：/w,dstream/en,概念/n,：/w,离散/vn,化流/nw,（/w,discretized/en, ,stream/en,）/w,，/w,是/v,随/v,时间/n,推移/vn,的/u,数据/n,。/w,由/p,每个/r,时间/n,区间/n,的/u,rdd/en,组成/v,的/u,序列/n,。/w,dstream/en,可以/v,从/p,flume/en,、/w,kafka/en,或者/c,hdfs/en,等/u,多/a,个/q,输入源/nw,创建/v,。/w,操作/v,：/w,转换/v,和/c,输出/v,，/w,支持/v,rdd/en,相关/v,的/u,操作/v,，/w,增加/v,了/u,“/w,滑动/vn,窗口/s,”/w,等于/v,时间/n,相关/v,的/u,操作/v,。/w,下面/f,以/p,一张/mq,图来/nrf,说明/v,spark/en, ,streaming/en,的/u,工作/vn,流程/n,：/w,从/p,上图/n,中/f,也/d,可以/v,看到/v,，/w,spark/en, ,streaming/en,把/p,流式/nw,计算/v,当做/v,一系列/mq,连续/a,的/u,小规模/d,批/q,处理/v,来/v,对待/v,。/w,它/r,从/p,各种/r,输入源/nw,读取/v,数据/n,，/w,并/c,把/p,数据/n,分组/vn,为/p,小/a,的/u,批次/n,，/w,新/a,的/u,批次/n,按/p,均匀/ad,的/u,时间/n,间隔/n,创建/v,出来/v,。/w,在/p,每个/r,时间/n,区间/n,开始/v,的/u,时候/n,，/w,一个/m,新/a,的/u,批次/n,就/d,创建/v,出来/v,，/w,在/p,该/r,区间/n,内/f,收到/v,的/u,数据/n,都/d,会/v,被/p,添加/vn,到/v,这个/r,批次/n,中/f,去/v,。/w,在/p,时间/n,区间/n,结束/v,时/ng,，/w,批次/n,停止/v,增长/v,。/w,转化/v,操作/v,无/v,状态/n,转化/v,操作/v,：/w,把/p,简单/a,的/u,rddtransformation/en,分别/d,应用/vn,到/v,每个/r,批次/n,上/f,，/w,每个/r,批次/n,的/u,处理/v,不/d,依赖/v,于/p,之前/f,的/u,批次/n,的/u,数据/n,。/w,包括/v,map/en,(/w,)/w,、/w,filter/en,(/w,)/w,、/w,reducebykey/en,(/w,)/w,等/u,。/w,有/v,状态/n,转化/v,操作/v,：/w,需要/v,使用/v,之前/f,批次/n,的/u,数据/n,或者/c,中间/f,结果/n,来/v,计算/v,当前/t,批次/n,的/u,数据/n,。/w,包括/v,基于/p,滑动/vn,窗口/s,的/u,转化/v,操作/v,，/w,和/c,追踪/v,状态/n,变化/vn,的/u,转化/v,操作/v,（/w,updatestatebykey/en,(/w,)/w,）/w,无/v,状态/n,转化/v,操作/v,有/v,状态/n,转化/v,操作/v,windows/en,机制/n,（/w,一/m,图/n,盛/v,千/m,言/vg,）/w,上图/n,应该/v,很/d,容易/a,看/v,懂/v,，/w,下面/f,举/v,个/q,实例/n,（/w,java/en,写/v,的/u,）/w,：/w,updatestatebykey/en,(/w,)/w,转化/v,操作/v,主要/b,用于/v,访问/v,状态/n,变量/n,，/w,用于/v,键值/nr,对/p,形式/n,的/u,dstream/en,。/w,首先/d,会/v,给/p,定/v,一个/m,由/p,(/w,键/nr,，/w,事件/n,)/w,对/p,构成/v,的/u,dstream/en,，/w,并/c,传递/v,一个/m,指定/v,如何/r,个人/n,剧新/nw,的/u,事件/n,更新/v,每个/r,键/nr,对应/v,状态/n,的/u,函数/n,，/w,它/r,可以/v,构建/v,出/v,一个/m,新/a,的/u,dstream/en,，/w,为/p,（/w,键/nr,，/w,状态/n,）/w,。/w,通俗/a,点/q,说/v,，/w,加入/v,我们/r,想/v,知道/v,一个/m,用户/n,最近/t,访问/v,的/u,10个/m,页面/n,是/v,什么/r,，/w,可以/v,把/p,键/nr,设置/v,为/p,用户/n,id/en,，/w,然后/c,updatestatebykey/en,(/w,)/w,就/d,可以/v,跟踪/v,每个/r,用户/n,最近/t,访问/v,的/u,10个/m,页面/n,，/w,这个/r,列表/v,就/d,是/v,“/w,状态/n,”/w,对象/n,。/w,具体/a,的/u,要/v,怎么/r,操作/v,呢/y,，/w,updatestatebykey/en,(/w,)/w,提供/v,了/u,一个/m,update/en,（/w,events/en,，/w,oldstate/en,）/w,函数/n,，/w,用于/v,接收/v,与/p,某/r,键/nr,相关/v,的/u,时间/n,以及/c,该键/nr,之前/f,对应/v,的/u,状态/n,，/w,然后/c,返回/v,这个/r,键/nr,对应/v,的/u,新/a,状态/n,。/w,events/en,：/w,是/v,在/p,当前/t,批次/n,中/f,收到/v,的/u,时间/n,列表/v,(/w,)/w,可能/v,为/p,空/a,。/w,oldstate/en,：/w,是/v,一个/m,可/v,选/v,的/u,状态/n,对象/n,，/w,存放/v,在/p,option/en,内/f,；/w,如果/c,一个/m,键/nr,没有/v,之前/f,的/u,状态/n,，/w,可以/v,为/p,空/a,。/w,newstate/en,：/w,由/p,函数/n,返回/v,，/w,也/d,以/p,option/en,形式/n,存在/v,。/w,如果/c,返回/v,一个/m,空/a,的/u,option/en,，/w,表示/v,想/v,要/v,删除/v,该/r,状态/n,。/w,updatestatebykey/en,(/w,)/w,的/u,结果/n,是/v,一个/m,新/a,的/u,dstream/en,，/w,内部/f,的/u,rdd/en,序列/n,由/p,每个/r,时间/n,区间/n,对应/v,的/u,（/w,键/nr,，/w,状态/n,）/w,对/p,组成/v,。/w,接/v,下/f,来讲/u,一下/m,输入源/nw,核心/n,数据源/nz,：/w,文件/n,流/v,，/w,包括/v,文本/n,格式/n,和/c,任意/d,hadoop/en,的/u,输入/v,格式/n,附加/vn,数据源/nz,：/w,kafka/en,和/c,flume/en,比较/d,常用/a,，/w,下面/f,会/v,讲/v,一下/m,kafka/en,的/u,输入/v,多数/m,据源/nw,与/p,集群/nz,规模/n,kafka/en,的/u,具体/a,操作/v,如下/v,：/w,基于/p,mllib/en,的/u,机器/n,学习/v,一般/a,我们/r,常用/a,的/u,算法/n,都/d,是/v,单机/n,跑/v,的/u,，/w,但是/c,想/v,要/v,在/p,集群/nz,上/f,运行/vn,，/w,不能/v,把/p,这些/r,算法/n,直接/ad,拿/v,过来/v,用/p,。/w,一/m,是/v,数据/n,格式/n,不同/a,，/w,单机/n,上/f,我们/r,一般/a,是/v,离/v,散型/nw,或者/c,连续型/nw,的/u,数据/n,，/w,数据/n,类型/n,一般/a,为/p,array/en,、/w,list/en,、/w,dataframe/en,比较/d,多/a,，/w,以/p,txt/en,、/w,csv/en,等/u,格式/n,存储/vn,，/w,但是/c,在/p,spark/en,上/f,，/w,数据/n,是/v,以/p,rdd/en,的/u,形式/n,存在/v,的/u,，/w,如何/r,把/p,ndarray/en,等/u,转化/v,为/p,rdd/en,是/v,一个/m,问题/n,；/w,此外/c,，/w,就算/d,我们/r,把/p,数据/n,转化/v,成/v,rdd/en,格式/n,，/w,算法/n,也/d,会/v,不/d,一样/u,。/w,举/v,个/q,例子/n,，/w,你/r,现在/t,有/v,一堆/mq,数据/n,，/w,存储/vn,为/p,rdd/en,格式/n,，/w,然后/c,设置/v,了/u,分区/vn,，/w,每个/r,分区/vn,存储/vn,一些/m,数据/n,准备/v,来/v,跑/v,算法/n,，/w,可以/v,把/p,每个/r,分区/vn,看做/v,是/v,一个/m,单机/n,跑/v,的/u,程序/n,，/w,但是/c,所有/b,分区/vn,跑/v,完/v,以后/f,呢/y,？/w,怎么/r,把/p,结果/n,综合/vn,起来/v,？/w,直接/ad,求/v,平均值/n,？/w,还是/c,别的/r,方式/n,？/w,所以/c,说/v,，/w,在/p,集群/nz,上/f,跑/v,的/u,算法/n,必须/d,是/v,专门/d,写/v,的/u,分布式/b,算法/n,。/w,而且/c,有些/r,算法/n,是/v,不能/v,分布/v,式/k,的/u,跑/v,。/w,mllib/en,中/f,也/d,只/d,包含/v,能够/v,在/p,集群/nz,上/f,运行/vn,良好/a,的/u,并行/v,算法/n,。/w,mllib/en,的/u,数据/n,类型/n,vector/en,：/w,向量/n,（/w,mllib/en,./w,linalg/en,./w,vectors/en,）/w,支持/v,dense/en,和/c,sparse/en,（/w,稠密/a,向量/n,和/c,稀疏/a,向量/n,）/w,。/w,区别/n,在/p,与/p,前者/r,的/u,没/d,一个/m,数值/n,都/d,会/v,存储/vn,下来/v,，/w,后者/r,只/d,存储/vn,非/h,零数/n,值/n,以/p,节约/v,空间/n,。/w,labeledpoint/en,:/w,（/w,mllib/en,./w,regression/en,）/w,表示/v,带/v,标签/n,的/u,数据点/nw,，/w,包含/v,一个/m,特征/n,向/p,量/n,与/p,一个/m,标签/n,,/w,注意/v,，/w,标签/n,要/v,转化/v,成/v,浮点型/nw,的/u,，/w,通过/p,stringindexer/en,转化/v,。/w,rating/en,:/w,(/w,mllib/en,./w,recommendation/en,)/w,，/w,用户/n,对/p,一个/m,产品/n,的/u,评分/vn,，/w,用于/v,产品/n,推荐/v,各种/r,model/en,类/q,：/w,每个/r,model/en,都/d,是/v,训练/vn,算法/n,的/u,结果/n,，/w,一般/a,都/d,有/v,一个/m,predict/en,(/w,)/w,方法/n,可以/v,用/p,来/v,对/p,新/a,的/u,数据点/nw,或者/c,数据点/nw,组成/v,的/u,rdd/en,应用/vn,该/r,模型/n,进行/v,预测/v,一般来说/l,，/w,大多数/m,算法/n,直接/ad,操作/v,由/p,vector/en,、/w,labledpoint/en,或/c,rating/en,组成/v,的/u,rdd/en,，/w,通常/d,我们/r,从/p,外部/f,数据/n,读取/v,数据/n,后/f,需要/v,进行/v,转化/v,操作/v,构建/v,rdd/en,。/w,具体/a,的/u,聚类/nw,和/c,分类/vn,算法/n,原理/n,不/d,多/a,讲/v,了/u,，/w,可以/v,自己/r,去/v,看/v,mllib/en,的/u,在线/vn,文档/n,里/f,去/v,看/v,。/w,下面/f,举/v,个/q,实例/n,----/nrf,垃圾/n,邮件/n,分类/vn,的/u,运行/vn,过程/n,：/w,步骤/n,：/w,1/m,./w,将/d,数据/n,转化/v,为/p,字符/n,串/v,rdd/en,2/m,./w,特征/n,提取/v,，/w,把/p,文本/n,数据/n,转化/v,为/p,数值/n,特征/n,，/w,返回/v,一个/m,向量/n,rdd/en,3/m,./w,在/p,训练/vn,集/vg,上/f,跑/v,模型/n,，/w,用/p,分类/vn,算法/n,4/m,./w,在/p,测试/vn,系/v,上/f,评估/vn,效果/n,具体/a,代码/n,：/w,1/m, ,from/en, ,pyspark/en,./w,mllib/en,./w,regression/en, ,import/en, ,labeledpoint/en, ,2/m, ,from/en, ,pyspark/en,./w,mllib/en,./w,feature/en, ,import/en, ,hashingtf/en, ,3/m, ,from/en, ,pyspark/en,./w,mllib/en,./w,calssification/en, ,import/en, ,logisticregressionwithsgd/en, ,4/m, ,5/m, ,spam/en, ,=/w, ,sc/en,./w,textfile/en,(/w,"/w,spam/en,./w,txt/en,"/w,)/w, ,6/m, ,normal/en, ,=/w, ,sc/en,./w,textfile/en,(/w,"/w,normal/en,./w,txt/en,"/w,)/w, ,7/m, ,8/m, ,#,创建/v,一个/m,hashingtf/en,实例/n,来/v,把/p,邮件/n,文本/n,映射/v,为/p,包含/v,10000个/m,特征/n,的/u,向量/n, ,9/m, ,tf/en, ,=/w, ,hashingtf/en,(/w,numfeatures/en, ,=/w, ,10000/m,)/w, ,10/m, ,#,各/r,邮件/n,都/d,被/p,切分/v,为/p,单词/n,，/w,每个/r,单词/n,背/v,映射/v,为/p,一个/m,特征/n, ,11/m, ,spamfeatures/en, ,=/w, ,spam/en,./w,map/en,(/w,lambda/en, ,email/en,:/w, ,tf/en,./w,transform/en,(/w,email/en,./w,split/en,(/w,"/w, ,"/w,)/w,)/w,)/w, ,12/m, ,normalfeatures/en, ,=/w, ,normal/en,./w,map/en,(/w,lambda/en, ,email/en,:/w, ,tf/en,./w,transform/en,(/w,email/en,./w,split/en,(/w,"/w, ,"/w,)/w,)/w,)/w, ,13/m, ,14/m, ,#,创建/v,labeledpoint/en,数据/n,集/vg,分别/d,存放/v,阳性/n,（/w,垃圾/n,邮件/n,）/w,和/c,阴性/n,（/w,正常/a,邮件/n,）/w,的/u,例子/n, ,15/m, ,positiveexamples/en, ,=/w, ,spamfeatures/en,./w,map/en,(/w,lambda/en, ,features/en,:/w, ,labeledpoint/en,(/w,1/m,,/w,features/en,)/w,)/w, ,16/m, ,negativeexamples/en, ,=/w, ,normalfeatures/en,./w,map/en,(/w,lambda/en, ,features/en,:/w, ,labeledpoint/en,(/w,0/m,,/w,features/en,)/w,)/w, ,17/m, ,trainingdata/en, ,=/w, ,positiveexamples/en,./w,union/en,(/w,negativeexamples/en,)/w, ,18/m, ,trainingdata/en,./w,cache/en,#,因为/c,逻辑/n,回归/v,是/v,迭代/vn,算法/n,，/w,所以/c,缓存/n,数据/n,rdd/en, ,19/m, ,20/m, ,#,使用/v,sgd/en,算法/n,运行/vn,逻辑/n,回归/v, ,21/m, ,model/en, ,=/w, ,logisticregressionwithsgd/en,./w,train/en,(/w,trainingdata/en,)/w, ,22/m, ,23/m, ,#,以/p,阳性/n,（/w,垃圾/n,邮件/n,）/w,和/c,阴性/n,（/w,正常/a,邮件/n,）/w,的/u,例子/n,分别/d,进行/v,测试/vn, ,24/m, ,postest/en, ,=/w, ,tf/en,./w,transform/en,(/w,"/w,o/en, ,m/en, ,g/en, ,get/en, ,cheap/en, ,stuff/en, ,by/en, ,sending/en, ,money/en, ,to/en,./w,./w,./w,"/w,./w,spl