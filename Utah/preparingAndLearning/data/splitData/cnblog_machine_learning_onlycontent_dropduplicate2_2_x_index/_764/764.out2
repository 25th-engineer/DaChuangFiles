第一/m,章/q, ,mesos/en, ,spark/en, ,shellspark/en,-/w,shell/en,（/w,1/m,）/w,修改/v,spark/en,//w,conf/en,//w,spark/en,-/w,env/en,./w,sh/en, ,,/w,增加/v,以下/f,内容/n,shell/en, ,export/en, ,mesos/en,_,native/en,_,java/en,_,library/en,=/w,//w,usr/en,//w,local/en,//w,mesos/en,//w,lib/en,//w,libmesos/en,./w,so/en, ,export/en, ,spark/en,_,executor/en,_,uri/en,=/w,</w,上传/v,spark/en,-/w,1/m,./w,6/m,./w,0/m,./w,tar/en,./w,gz/en,对应/v,的/u,hdfs/en, ,url/en,，/w, ,如果/c,已经/d,把/p,spark/en,的/u,jar/en,包/v,放/v,在/p,了/u,mesos/en, ,agent/en,机器/n,上/f,，/w,不/d,用/p,这个/r,配置/vn,>,（/w,2/m,）/w,运行/vn,命令/n,：/w,shell/en, ,./w,//w,bin/en,//w,spark/en,-/w,shell/en, ,--/nrf,master/en, ,mesos/en,:/w,//w,//w,host/en,:/w,5050/m,（/w,3/m,）/w,代码/n,`,`,`,scala/en,>, ,val/en, ,lines/en,=/w,sc/en,./w,textfile/en,(/w,"/w,//w,root/en,//w,readme/en,./w,md/en,"/w,)/w,lines/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,string/en,]/w, ,=/w, ,//w,root/en,//w,readme/en,./w,md/en, ,mappartitionsrdd/en,3/m, ,at/en, ,textfile/en, ,at/en,:/w,27/m,scala/en,>, ,lines/en,./w,countres/en,1/m,:/w, ,long/en, ,=/w, ,3/m,`,`,`,（/w,4/m,）/w,web/en,页面/n,：/w,4040/m,端口/n,，/w,可以/v,看到/v,上面/f,执行/v,的/u,count/en,操作/v,spark/en,的/u,核心/n,概念/n,（/w,1/m,）/w,spark/en,-/w,shell/en,其实/d,是/v,一个/m,driver/en, ,programme/en,（/w,驱动器/n,程序/n,）/w,（/w,2/m,）/w,driver/en, ,programme/en,包含/v,应用/vn,的/u,main/en,函数/n,，/w,定义/n,了/u,集群/nz,上/f,的/u,分布式/b,数据集/nw,，/w,用/p,来/v,发起/v,集群/nz,上/f,的/u,各种/r,并行/v,操作/v,（/w,3/m,）/w,由于/c,spark/en,-/w,shell/en,在/p,开启/v,时/ng,，/w,制定/v,了/u,master/en,，/w,因此/c,driver/en, ,programe/en,提交/v,这些/r,任务/n,到/v,集群/nz,上/f,操作/v,spark/en,文件/n,操作/v,第二/m,章/q, ,rdd/en,编程/vn,操作/v,过程/n,（/w,1/m,）/w,rdd/en,包含/v,两类/mq,操作/v,：/w,transaction/en,和/c,action/en,，/w,只有/c,action/en,会/v,对/p,rdd/en,计算/v,出/v,一个/m,结果/n,（/w,2/m,）/w,rdd/en,会/v,在/p,每次/r,action/en,操作/v,时/ng,重新/d,计算/v,。/w,可以/v,通过/p,presist/en,对/p,rdd/en,持久化/nw,，/w,在/p,第一/m,次/q,对/p,持久化/nw,的/u,rdd/en,计算/v,后/f,，/w,spark/en,会/v,把/p,rdd/en,内容/n,保存/v,到/v,内存/n,中/f,（/w,以/p,分区/vn,方式/n,存储/vn,在/p,集群/nz,的/u,每/r,台/q,机器/n,上/f,）/w,，/w,这样/r,之后/f,的/u,action/en,操作/v,就/d,可以/v,重用/v,这些/r,rdd/en,数据/n,。/w,默认/v,不/d,会/v,把/p,rdd/en,缓/v,存在/v,内存/n,中/f,是因为/c,，/w,大量/m,数据/n,不/d,应该/v,仅仅/d,以/p,不同/a,的/u,形式/n,多/a,份/q,存在/v,内存/n,中/f,。/w,scala/en, ,val/en, ,lines/en,=/w,sc/en,./w,textfile/en,(/w,"/w,//w,root/en,//w,readme/en,./w,md/en,"/w,)/w, ,val/en, ,rdd/en,2/m, ,=/w, ,lines/en,./w,filter/en,(/w,line/en,=/w,>,line/en,./w,contains/en,(/w,"/w,aa/en,"/w,)/w,)/w,./w,count/en, ,rdd/en,2/m,./w,presist/en,(/w,)/w, ,rdd/en,2/m,./w,count/en,创建/v,rdd/en,的/u,两种/mq,途径/n,（/w,1/m,）/w,把/p,已/d,有/v,集合/v,传/v,给/p,sparkcontext/en,的/u,parallelize/en,(/w,)/w,方法/n,（/w,2/m,）/w,从/p,外部/f,数据/n,创建/v,rddscala/en, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,"/w,aaa/en,"/w,,/w,"/w,bbb/en,"/w,)/w,)/w, ,sc/en,./w,textfile/en,(/w,"/w,//w,root/en,//w,readme/en,./w,md/en,"/w,)/w,rdd/en,操作/v,（/w,1/m,）/w,transaction/en,：/w,a/en,./w, ,转化/v,操作/v,只能/v,产生/v,新/a,的/u,rdd/en,，/w,而/c,不能/v,改版/v,原先/d,rdd/en,的/u,数据/n,errorsrdd/en, ,=/w, ,inputrdd/en,./w,filter/en,(/w,lambda/en, ,x/en,:/w, ,"/w,error/en,"/w, ,in/en, ,x/en,)/w, ,warningsrdd/en, ,=/w, ,inputrdd/en,./w,filter/en,(/w,lambda/en, ,x/en,:/w, ,"/w,warning/en,"/w, ,in/en, ,x/en,)/w, ,badlinesrdd/en, ,=/w, ,errorsrdd/en,./w,union/en,(/w,warningsrdd/en,)/w,b/en,./w, ,main/en,函数/n,中/f,，/w,所有/b,的/u,rdd/en,会/v,用/p,谱/ng,系/v,图/n,记录/v,产生/v,依赖/v,关系/n,（/w,2/m,）/w,action/en, ,:/w,a/en,./w, ,获取/v,操作/v,：/w,take/en,(/w,int/en, ,n/en,)/w, ,获取/v,rdd/en,的/u,前/f,n/en,行/v,数据/n,，/w, ,collect/en,(/w,)/w,获取/v,rdd/en,中/f,的/u,所有/b,数据/n,b/en,./w, ,当/p,调用/v,一个/m,新/a,action/en,操作/v,时/ng,，/w,整个/b,rdd/en,都/d,会/v,重新/d,计算/v,，/w,导致/v,行为/n,低效/n,，/w,用户/n,可以/v,将/d,中间/f,结果/n,持久化/nw,常见/a,算子/n,（/w,1/m,）/w,transaction/en,`,`,`,scalaval/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,1/m,,/w,2/m,,/w,3/m,,/w,3/m,)/w,)/w, ,//w,//w, ,（/w,1/m,,/w,2/m,,/w,3/m,,/w,3/m,）/w,scala/en,>, ,rdd/en,1/m,./w,map/en,(/w,x/en,=/w,>,x/en,+/w,1/m,)/w,./w,collect/en, ,//w,//w, ,array/en,(/w,2/m,,/w, ,3/m,,/w, ,4/m,,/w, ,4/m,)/w,scala/en,>, ,rdd/en,1/m,./w,flatmap/en,(/w,x/en,=/w,>,x/en,./w,to/en,(/w,3/m,)/w,)/w,./w,collect/en, ,//w,//w, ,array/en,(/w,1/m,,/w, ,2/m,,/w, ,3/m,,/w, ,2/m,,/w, ,3/m,,/w, ,3/m,,/w, ,3/m,)/w,scala/en,>, ,rdd/en,1/m,./w,filter/en,(/w,x/en, ,=/w,>, ,x/en,!/w,=/w,1/m,)/w,./w,collect/en, ,//w,//w, ,array/en,(/w,2/m,,/w, ,3/m,,/w, ,3/m,)/w,scala/en,>, ,rdd/en,1/m,./w,distinct/en,./w,collect/en, ,//w,//w, ,array/en,(/w,2/m,,/w, ,1/m,,/w, ,3/m,)/w,scala/en,>, ,rdd/en,1/m,./w,sample/en,(/w,false/en,,/w,0.5/m,)/w,./w,collect/en, ,//w,//w, ,随机/d,取样/vn,，/w,个数/n,和/c,数值/n,每次/r,都/d,不/d,一样/u,（/w,是否/v,替换/v,）/w,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,1/m,,/w,2/m,,/w,3/m,)/w,)/w, ,//w,//w, ,(/w,1/m,,/w,2/m,,/w,3/m,)/w,val/en, ,rdd/en,2/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,3/m,,/w,4/m,,/w,5/m,)/w,)/w, ,//w,//w, ,(/w,3/m,,/w,4/m,,/w,5/m,)/w,scala/en,>, ,rdd/en,1/m,./w,union/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,array/en,(/w,1/m,,/w, ,2/m,,/w, ,3/m,,/w, ,3/m,,/w, ,4/m,,/w, ,5/m,)/w,scala/en,>, ,rdd/en,1/m,./w,intersection/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,array/en,(/w,3/m,)/w, ,求/v,两个/m,rdd/en,共同/d,的/u,元素/n,scala/en,>, ,rdd/en,1/m,./w,subtract/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,array/en,(/w,2/m,,/w, ,1/m,)/w, ,求/v,两个/m,rdd/en,不同/a,的/u,部分/n,scala/en,>, ,rdd/en,1/m,./w,cartesian/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,两个/m,rdd/en,求笛/nw,卡尔/nr,积/v, ,array/en,(/w,(/w,1/m,,/w,3/m,)/w,,/w, ,(/w,1/m,,/w,4/m,)/w,,/w, ,(/w,1/m,,/w,5/m,)/w,,/w, ,(/w,2/m,,/w,3/m,)/w,,/w, ,(/w,3/m,,/w,3/m,)/w,,/w, ,(/w,2/m,,/w,4/m,)/w,,/w, ,(/w,2/m,,/w,5/m,)/w,,/w, ,(/w,3/m,,/w,4/m,)/w,,/w, ,(/w,3/m,,/w,5/m,)/w,)/w,*/w,*/w,（/w,2/m,）/w,action/en,*/w,*/w,scalaval/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,1/m,,/w,2/m,,/w,3/m,,/w,3/m,)/w,)/w, ,//w,home/en,//w,lj/en,//w,documents/en, ,//w,//w, ,（/w,1/m,,/w,2/m,,/w,3/m,,/w,3/m,）/w,scala/en,>, ,rdd/en,1/m,./w,collect/en, ,//w,//w, ,array/en,(/w,1/m,,/w, ,2/m,,/w, ,3/m,,/w, ,3/m,)/w, ,返回/v,rdd/en,所有/b,元素/n,scala/en,>, ,rdd/en,1/m,./w,count/en, ,//w,//w, ,4/m, ,返回/v,rdd/en,的/u,元素/n,个数/n,scala/en,>, ,rdd/en,1/m,./w,countbyvalue/en, ,//w,//w, ,map/en,(/w,2/m, ,-/w,>, ,1/m,,/w, ,1/m, ,-/w,>, ,1/m,,/w, ,3/m, ,-/w,>, ,2/m,)/w, ,返回/v,键值/nr,对/p,（/w,元素/n,值/n, ,-/w,>, ,元素/n,个数/n,）/w,scala/en,>, ,rdd/en,1/m,./w,take/en,(/w,2/m,)/w, ,//w,//w, ,array/en,(/w,1/m,,/w, ,2/m,)/w, ,返回/v,rdd/en,中/f,的/u,n/en,个/q,元素/n,scala/en,>, ,rdd/en,1/m,./w,top/en,(/w,2/m,)/w, ,//w,//w, ,array/en,(/w,3/m,,/w, ,3/m,)/w, ,返回/v,rdd/en,中/f,的/u,前/f,2个/m,元素/n,`,`,`,持久化/nw,（/w,1/m,）/w,rdd/en,持久化/nw,时/ng,，/w,计算/v,出/v,rdd/en,的/u,节点/n,会/v,分别/d,保存/v,他们/r,所/u,求/v,出/v,的/u,分区/vn,数据/n,（/w,2/m,）/w,如果/c,一个/m,有/v,持久化/nw,数据/n,的/u,节点/n,发生/v,故障/n,，/w,spark/en,会/v,在/p,用/p,到/v,缓存/n,数据/n,时/ng,重算/nw,丢失/v,的/u,数据/n,分区/vn,。/w,如果/c,想/v,在/p,节点/n,故障/n,时/ng,不/d,拖累/v,执行/v,速度/n,，/w,也/d,可以/v,把/p,数据/n,备份/n,到/v,多/a,个/q,节点/n,上/f,。/w,（/w,3/m,）/w,persist/en,(/w,)/w,默认/v,把/p,数据/n,以/p,序列化/nz,的/u,形式/n,缓/v,存在/v,jvm/en,堆/q,(/w,内存/n,)/w,中/f,，/w,同时/c,，/w,也/d,可以/v,通过/p,调整/vn,持久化/nw,级别/n,把/p,数据/n,缓存/n,到/v,磁盘/n,或/c,堆/q,外缓/nw,存/v,上/f,。/w,`,`,`,scalascala/en,>, ,rdd/en,2/m,./w,persist/en,(/w,storagelevel/en,./w,disk/en,_,only/en,)/w, ,//w,//w, ,persist/en,不/d,会/v,立刻/d,触发/v,缓存/n,，/w,而是/c,等到/v,第一/m,次/q,action/en,操作/v,后/f,，/w,自动/d,缓存/n,这个/r,rdd/en,结果/n,res/en,4/m,:/w, ,rdd/en,2/m,./w,type/en, ,=/w, ,mappartitionsrdd/en,1/m, ,at/en, ,filter/en, ,at/en,:/w,30/m,scala/en,>, ,rdd/en,2/m,./w,countres/en,5/m,:/w, ,long/en, ,=/w, ,1/m,`,`,`,（/w,4/m,）/w,如果/c,缓存/n,的/u,rdd/en,数据/n,在/p,节点/n,上/f,的/u,内/f,存放/v,不/d,下/f,了/u,，/w,spark/en,会/v,通过/p,lru/en,（/w,最近/t,最/d,少/a,被/p,使用/v,）/w,原则/n,吧老/nw,数据/n,移除/v,内存/n,，/w,存放/v,新/a,数据/n,。/w,因此/c,，/w,不论/c,只/d,缓/v,存/v,到/v,内存/n,还是/c,同时/c,缓存/n,到/v,内存/n,和/c,硬盘/n,，/w, ,都/d,不/d,会/v,因为/c,缓存/n,而/c,使得/v,作业/vn,停止/v,，/w,但是/c,缓存/n,过/u,多/a,不必要/v,的/u,数据/n,，/w,会/v,带来/v,更/d,多/a,分区/vn,重算/nw,时间/n,第三/nw,章/q, ,键值/nr,对/p,rdd/en,一/m,./w, ,普通/a,rdd/en,转换/v,成/v,pair/en, ,rdd/en,初始化/v,scala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,1/m,-/w,>,2/m,,/w,3/m,-/w,>,4/m,,/w,3/m,-/w,>,9/m,)/w,)/w, ,rdd/en,1/m,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,(/w,int/en,,/w, ,int/en,)/w,]/w, ,=/w, ,parallelcollectionrdd/en,[/w,0/m,]/w, ,at/en, ,parallelize/en, ,at/en, ,</w,console/en,>,:/w,24/m,二/m,./w, ,pair/en, ,rdd/en,转化/v,操作/v,聚合/v,操作/v,：/w,组合/v,rdd/en,中/f,相同/a,key/en,的/u,value/en,（/w,1/m,）/w,reducebykey/en,：/w,接受/v,一个/m,函数/n,，/w,为/p,数据/n,集中/v,每个/r,键/nr,进行/v,规约/v,操作/v,，/w,每个/r,规约/v,操作会/nw,将/d,键/nr,相同/a,的/u,值/n,合并/v,起来/v,（/w,2/m,）/w,foldbykey/en,:/w,将/d,key/en,相同/a,的/u,分/q,在/p,一组/mq,,/w,再/d,对/p,组/q,内/f,的/u,value/en,进行/v,fold/en,操作/v,./w,使用/v,一个/m,零值/nw,初始/b,进行/v,折叠/v,(/w,零值/nw,与/p,另/r,一个/m,元素/n,合并/v,结果/n,仍/d,为/p,该/r,元素/n,)/w,`,`,`,scala/en,//w,//w, ,mapvalues/en,与/p,reducebykey/en,计算/v,每个/r,键/nr,对应/v,的/u,均值/n,scala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,array/en,(/w,(/w,"/w,panda/en,"/w,,/w,3/m,)/w,,/w,(/w,"/w,pink/en,"/w,,/w,1/m,)/w,,/w,(/w,"/w,panda/en,"/w,,/w,6/m,)/w,,/w,(/w,"/w,pink/en,"/w,,/w,3/m,)/w,)/w,)/w,scala/en,>, ,val/en, ,rdd/en,2/m, ,=/w, ,rdd/en,1/m,./w,mapvalues/en,(/w,x/en,=/w,>,(/w,x/en,,/w,1/m,)/w,)/w,./w,reducebykey/en,(/w,(/w,v/en,1/m,,/w,v/en,2/m,)/w,=/w,>,(/w,v/en,1/m,./w,_,1/m,+/w,v/en,2/m,./w,_,1/m,,/w,v/en,1/m,./w,_,2/m,+/w,v/en,2/m,./w,_,2/m,)/w,)/w, ,//w,//w, ,array/en,(/w,(/w,panda/en,,/w,(/w,9/m,,/w,2/m,)/w,)/w,,/w, ,(/w,pink/en,,/w,(/w,4/m,,/w,2/m,)/w,)/w,)/w,scala/en,>, ,val/en, ,rdd/en,3/m, ,=/w, ,rdd/en,2/m,./w,mapvalues/en,(/w,v/en,=/w,>,v/en,./w,_,1/m,*/w,1.0/m,//w,v/en,./w,_,2/m,)/w, ,//w,//w, ,array/en,(/w,(/w,panda/en,,/w,4.5/m,)/w,,/w, ,(/w,pink/en,,/w,2.0/m,)/w,)/w,（/w,3/m,）/w,`,combinebykey/en,(/w,createcombiner/en,,/w,mergevalue/en,,/w,mergecombiners/en,)/w,`,：/w,combinebykey/en,方法/n,的/u,三个/m,参数/n,分别/d,对应/v,聚合/v,的/u,几/m,个/q,阶段/n,。/w,在/p,遍历/nw,所有/b,元素/n,时/ng,，/w,每个/r,元素/n,的/u,key/en,，/w,要么/c,没有/v,遇到/v,过/u,，/w,要么/c,与/p,之前/f,的/u,某个/r,元素/n,的/u,key/en,相同/a,。/w,第一/m,个/q,参数/n,createcombiner/en,：/w,将/d,每个/r,元素/n,的/u,value/en,映射/v,成/v,新/a,的/u,value/en,，/w,相当/d,于/p,mapvalue/en,方法/n,。/w,第二/m,个/q,参数/n,mergevalue/en,是/v,说/v,，/w,当/p,发现/v,该/r,元素/n,的/u,key/en,与/p,之前/f,已经/d,映射/v,成/v,新/a,value/en,的/u,元素/n,的/u,key/en,相同/a,时/ng,，/w,这个/r,新/a,形势/n,的/u,value/en,与/p,新/a,遍历/nw,到/v,的/u,元素/n,的/u,旧/a,形式/n,的/u,value/en,如何/r,组合/v,。/w,第三/nw,个/q,参数/n,mergecombiners/en,：/w,当/p,每个/r,分区/vn,的/u,元素/n,都/d,已经/d,形成/v,了/u,新/a,形势/n,的/u,k/en,,/w,v/en,，/w,此时/r,如何/r,对/p,相同/a,k/en,的/u,value/en,进行/v,组合/v,scala/en,//w,//w, ,combinevalues/en,计算/v,每个/r,key/en,的/u,平均值/n,scala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,array/en,(/w,(/w,"/w,panda/en,"/w,,/w,3/m,)/w,,/w,(/w,"/w,pink/en,"/w,,/w,1/m,)/w,,/w,(/w,"/w,panda/en,"/w,,/w,6/m,)/w,)/w,)/w,scala/en,>, ,val/en, ,rdd/en,2/m, ,=/w, ,rdd/en,1/m,./w,combinebykey/en,(/w,|/w, ,(/w,v/en,)/w,=/w,>,(/w,v/en,,/w,1/m,)/w,,/w,|/w, ,(/w,nvalue/en,:/w,(/w,int/en,,/w,int/en,)/w,,/w,ovalue/en,)/w,=/w,>,(/w,nvalue/en,./w,_,1/m,+/w,ovalue/en,,/w,nvalue/en,./w,_,2/m,+/w,1/m,)/w,,/w,|/w, ,(/w,nvalue/en,1/m,:/w,(/w,int/en,,/w,int/en,)/w,,/w,nvalue/en,2/m,:/w,(/w,int/en,,/w,int/en,)/w,)/w,=/w,>,(/w,nvalue/en,1/m,./w,_,1/m,+/w,nvalue/en,2/m,./w,_,1/m,,/w,nvalue/en,1/m,./w,_,2/m,+/w,nvalue/en,2/m,./w,_,2/m,)/w,|/w, ,)/w,scala/en,>, ,val/en, ,rdd/en,3/m, ,=/w, ,rdd/en,2/m,./w,mapvalues/en,(/w,v/en,=/w,>,v/en,./w,_,1/m,*/w,1.0/m,//w,v/en,./w,_,2/m,)/w, ,//w,//w, ,array/en,(/w,(/w,panda/en,,/w,4.5/m,)/w,,/w, ,(/w,pink/en,,/w,1.0/m,)/w,)/w,（/w,4/m,）/w,并行度/nz,优化/v,：/w,在/p,执行/v,分组/vn,和/c,聚合/v,时/ng,，/w,可以/v,指定/v,spark/en,的/u,分区/vn,数/m,scalasc/en,./w,parallelize/en,(/w,data/en,)/w,./w,reducebykey/en,(/w,(/w,x/en,,/w,y/en,)/w,=/w,>,x/en,+/w,y/en,,/w,10/m,)/w, ,//w,//w, ,指定/v,10个/m,分区/vn,`,`,`,数据/n,分组/vn,（/w,1/m,）/w,groupbykey/en,:/w,把/p,相同/a,键值/nr,的/u,rdd/en,[/w,k/en,,/w,v/en,]/w,经过/p,聚合/v,变成/v,rdd/en,[/w,k/en,,/w,iterator/en,(/w,v/en,)/w,]/w,./w, ,因此/c,,/w,scala/en, ,rdd/en,./w,reducebykey/en,(/w,func/en,)/w, ,=/w, ,rdd/en,./w,groupbykey/en,(/w,)/w,./w,mapvalues/en,(/w,v/en,=/w,>,v/en,./w,reduce/en,(/w,func/en,)/w,)/w,连接/v,（/w,1/m,）/w,cogroup/en,：/w,将/d,两个/m,pair/en, ,rdd/en,合并/v,成/v,一个/m,rdd/en,，/w,形式/n,为/p,rdd/en,[/w,k/en,,/w,iterator/en,[/w,v/en,]/w,,/w,iterator/en,[/w,w/en,]/w,]/w,（/w,2/m,）/w,leftouterjoin/en,和/c,rightouterjoin/en,：/w,分别/d,表示/v,左右/m,连接/v,`,`,`,scalascala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,array/en,(/w,(/w,1/m,,/w, ,30/m,)/w,,/w, ,(/w,2/m,,/w, ,29/m,)/w,,/w, ,(/w,4/m,,/w, ,21/m,)/w,)/w,)/w,scala/en,>, ,val/en, ,rdd/en,2/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,array/en,(/w,(/w,1/m,,/w, ,"/w,zhangsan/en,"/w,)/w,,/w, ,(/w,2/m,,/w, ,"/w,lisi/en,"/w,)/w,,/w, ,(/w,3/m,,/w, ,"/w,wangwu/en,"/w,)/w,)/w,)/w,scala/en,>, ,rdd/en,1/m,./w,cogroup/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,cogroupres/en,0/m,:/w, ,array/en,[/w,(/w,int/en,,/w, ,(/w,iterable/en,[/w,int/en,]/w,,/w, ,iterable/en,[/w,string/en,]/w,)/w,)/w,]/w, ,=/w,array/en,(/w,(/w,4/m,,/w,(/w,compactbuffer/en,(/w,21/m,)/w,,/w,compactbuffer/en,(/w,)/w,)/w,)/w,,/w,(/w,2/m,,/w,(/w,compactbuffer/en,(/w,29/m,)/w,,/w,compactbuffer/en,(/w,lisi/en,)/w,)/w,)/w,,/w,(/w,1/m,,/w,(/w,compactbuffer/en,(/w,30/m,)/w,,/w,compactbuffer/en,(/w,zhangsan/en,)/w,)/w,)/w,,/w,(/w,3/m,,/w,(/w,compactbuffer/en,(/w,)/w,,/w,compactbuffer/en,(/w,wangwu/en,)/w,)/w,)/w,)/w,scala/en,>, ,rdd/en,1/m,./w,leftouterjoin/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,leftouterjoinres/en,1/m,:/w, ,array/en,[/w,(/w,int/en,,/w, ,(/w,int/en,,/w, ,option/en,[/w,string/en,]/w,)/w,)/w,]/w, ,=/w, ,array/en,(/w,(/w,4/m,,/w,(/w,21/m,,/w,none/en,)/w,)/w,,/w, ,(/w,2/m,,/w,(/w,29/m,,/w,some/en,(/w,lisi/en,)/w,)/w,)/w,,/w, ,(/w,1/m,,/w,(/w,30/m,,/w,some/en,(/w,zhangsan/en,)/w,)/w,)/w,)/w,scala/en,>, ,rdd/en,1/m,./w,rightouterjoin/en,(/w,rdd/en,2/m,)/w,./w,collect/en, ,//w,//w, ,rightouterjoinres/en,2/m,:/w, ,array/en,[/w,(/w,int/en,,/w, ,(/w,option/en,[/w,int/en,]/w,,/w, ,string/en,)/w,)/w,]/w, ,=/w, ,array/en,(/w,(/w,2/m,,/w,(/w,some/en,(/w,29/m,)/w,,/w,lisi/en,)/w,)/w,,/w, ,(/w,1/m,,/w,(/w,some/en,(/w,30/m,)/w,,/w,zhangsan/en,)/w,)/w,,/w, ,(/w,3/m,,/w,(/w,none/en,,/w,wangwu/en,)/w,)/w,)/w,`,`,`,数据/n,排序/vn,（/w,1/m,）/w,sortbykey/en,：/w,默认/v,按照/p,升序/n,排列/v,相同/a,key/en,的/u,value/en,，/w,让/v,rdd/en,有/v,顺序/n,的/u,save/en,到/v,磁盘/n,或/c,展示/v,出来/v,`,`,`,scalascala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,array/en,(/w,(/w,"/w,panda/en,"/w,,/w,3/m,)/w,,/w,(/w,"/w,pink/en,"/w,,/w,1/m,)/w,,/w,(/w,"/w,panda/en,"/w,,/w,6/m,)/w,)/w,)/w,scala/en,>, ,def/en, ,sortint/en, ,=/w, ,new/en, ,ordering/en,[/w,int/en,]/w,{/w,|/w, ,override/en, ,def/en, ,compare/en,(/w,a/en,:/w,int/en,,/w,b/en,:/w,int/en,)/w, ,=/w, ,a/en,./w,tostring/en,./w,compare/en,(/w,b/en,./w,tostring/en,)/w,|/w, ,}/w,scala/en,>, ,rdd/en,1/m,./w,sortbykey/en,(/w,)/w,./w,collect/en,(/w,)/w, ,//w,//w, ,array/en,(/w,(/w,panda/en,,/w,3/m,)/w,,/w, ,(/w,panda/en,,/w,6/m,)/w,,/w, ,(/w,pink/en,,/w,1/m,)/w,)/w,`,`,`,pair/en, ,rdd/en,的/u,action/en,操作/v,（/w,1/m,）/w,countbykey/en,：/w,统计/v,每个/r,key/en,出现/v,的/u,个数/n,（/w,2/m,）/w,collectasmap/en,：/w,把/p,rdd/en,输出/v,map/en,（/w,3/m,）/w,lookup/en,(/w,key/en,)/w,：/w,返回/v,key/en,对应/v,的/u,所有/b,value/en,`,`,`,scalascala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,(/w,1/m,,/w,2/m,)/w,,/w,(/w,3/m,,/w,4/m,)/w,,/w,(/w,3/m,,/w,6/m,)/w,)/w,)/w,scala/en,>, ,rdd/en,1/m,./w,countbykey/en,(/w,)/w,res/en,5/m,:/w, ,scala/en,./w,collection/en,./w,map/en,[/w,int/en,,/w,long/en,]/w, ,=/w, ,map/en,(/w,1/m, ,-/w,>, ,1/m,,/w, ,3/m, ,-/w,>, ,2/m,)/w,scala/en,>, ,rdd/en,1/m,./w,collectasmapres/en,6/m,:/w, ,scala/en,./w,collection/en,./w,map/en,[/w,int/en,,/w,int/en,]/w, ,=/w, ,map/en,(/w,1/m, ,-/w,>, ,2/m,,/w, ,3/m, ,-/w,>, ,6/m,)/w,scala/en,>, ,rdd/en,1/m,./w,lookup/en,(/w,3/m,)/w,res/en,7/m,:/w, ,seq/en,[/w,int/en,]/w, ,=/w, ,wrappedarray/en,(/w,4/m,,/w, ,6/m,)/w,`,`,`,数据/n,分区/vn,（/w,1/m,）/w,分布式/b,程序/n,中/f,，/w,通信/vn,的/u,代价/n,很/d,大/a,，/w,因此/c,控制/v,数据/n,分布/v,来/v,减少/v,网络/n,传输/vn,可以/v,极大/a,提升/v,整体/n,性能/n,。/w,但/c,分区/vn,并非/v,对/p,所有/b,的/u,应用/vn,都/d,是/v,好/a,的/u,，/w,比如/v,如果/c,rdd/en,只/d,需/v,被/p,扫描/v,一次/mq,就/d,完全/ad,不必/d,预先/d,对/p,其/r,分区/vn,。/w,只有/c,当/p,数据集/nw,多次/m,在/p,诸如/v,连接/v,这样/r,的/u,基于/p,key/en,的/u,操作/v,时/ng,，/w,分区/vn,才/d,会/v,有用/a,。/w,（/w,2/m,）/w,所有/b,的/u,pair/en, ,rdd/en,都/d,能/v,进行/v,分区/vn,，/w,系统/n,会/v,根据/p,一个/m,针对/p,key/en,的/u,函数/n,对/p,元素/n,进行/v,分组/vn,。/w,spark/en,没有/v,给/p,出/v,显示/v,控制/v,每个/r,key/en,具体/a,落/v,在/p,哪个/r,工作/vn,节点/n,上/f,的/u,方法/n,（/w,其中/r,一个/m,原因/n,是/v,节点/n,失败/v,时/ng,让然/nw,可以/v,在/p,其他/r,节点/n,进行/v,工作/vn,）/w,。/w,但是/c,spark/en,可以/v,确保/v,同一/b,组/q,key/en,出现/v,在/p,同一个/r,节点/n,上/f,。/w,eg/en,：/w,通过/p,哈希分区/ns,将/d,一个/m,rdd/en,分成/v,100个/m,分区/vn,，/w,此时/r,key/en,的/u,哈希值/nr,对/p,100/m,取/v,模/ng,结果/n,相同/a,的/u,记录/v,都/d,会/v,被/p,放/v,在/p,同一个/r,节点/n,上/f,。/w,（/w,3/m,）/w,应用/vn,举例/v,：/w,内存/n,中/f,保存/v,着/u,一份/mq,由/p,(/w,userid/en,,/w,userinfo/en,)/w,对/p,组成/v,的/u,rdd/en,表/n,，/w,其中/r,userinfo/en,包含/v,用户/n,订阅/v,的/u,url/en,。/w,这/r,张/q,表会/nw,周期性/n,的/u,与/p,一个/m,小/a,文件/n,进行/v,组合/v,，/w,小/a,文件/n,存储/vn,着/u,过去/t,五分钟/t,用户/n,所/u,访问/v,的/u,url/en,。/w,因此/c,现在/t,要/v,每/r,五分钟/t,对/p,用户/n,访问/v,其/r,未/d,订阅/v,的/u,url/en,做/v,统计/v,。/w,`,`,`,scala/en,//w,//w, ,userid/en,和/c,userinfo/en,这个/r,表/n,一般/a,不/d,变/v,val/en, ,userdata/en, ,=/w, ,sc/en,./w,sequencefileuserid/en,,/w,userinfo/en,./w,persist/en,(/w,)/w,//w,//w, ,周期性/n,的/u,调用/v,该/r,方法/n,，/w,处理/v,过去/t,5分钟/t,产生/v,的/u,事件/n,日志/n,def/en, ,processnewlogs/en,(/w,logfilename/en,:/w,string/en,)/w,{/w,val/en, ,events/en, ,=/w, ,sc/en,./w,sequencefileuserid/en,,/w,userinfo/en, ,//w,//w, ,用户/n,点击/v,事件/n,日志/n,val/en, ,joined/en, ,=/w, ,userdata/en,./w,join/en,(/w,events/en,)/w, ,//w,//w, ,pair/en, ,rdd/en, ,of/en, ,(/w,userid/en,,/w,(/w,userinfo/en,,/w,linkinfo/en,)/w,)/w,val/en, ,offtopicvisits/en, ,=/w, ,joined/en,./w,filter/en,(/w,{/w,case/en, ,(/w,userid/en,,/w,(/w,userinfo/en,,/w,linkinfo/en,)/w,)/w, ,=/w,>, ,!/w,userinfo/en,./w,topics/en,./w,contains/en,(/w,linkinfo/en,./w,topic/en,)/w,}/w,)/w,./w,count/en,(/w,)/w,}/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,上面/f,的/u,代码/n,可以/v,运行/vn,，/w,但是/c,效率/n,不/d,高/a,。/w,原因/n,在于/v,。/w,默认/v,情况/n,下/f,，/w,join/en,操作会/nw,把/p,两个/m,pair/en, ,rdd/en,中/f,的/u,所有/b,key/en,的/u,哈希值/nr,都/d,求/v,出来/v,，/w,再/d,将/d,key/en,哈希值/nr,相同/a,的/u,记录/v,通过/p,网络/n,传/v,到/v,一个/m,机器/n,上/f,，/w,然后/c,在/p,那/r,台/q,机器/n,上/f,进行/v,连接/v,操作/v,。/w,因为/c,userdata/en,这/r,张/q,用户/n,订阅/v,uel/en,表/n,，/w,远远/d,比/p,没/d,五分钟/t,出现/v,的/u,小表/nr,大/a,，/w,所以/c,每/r,五分钟/t,都/d,要/v,对/p,userdata/en,表/n,进行/v,哈希取值/nr,，/w,然后/c,跨/v,节点/n,混洗/nw,。/w, ,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,因此/c,，/w,我们/r,的/u,改进/v,方法/n,就/d,是/v,先/d,对/p,userdata/en,表/n,进行/v,哈希分区/ns,，/w,之后/f,持久化/nw,到/v,内存/n,中/f,，/w,让/v,每/r,五分钟/t,出现/v,的/u,操作/v,只/d,对/p,小表/nr,进行/v,hash/en,取值/v,scalaval/en, ,userdata/en, ,=/w, ,sc/en,./w,sequencefileuserid/en,,/w,userinfo/en,./w,partitionby/en,(/w,new/en, ,hashpartitioner/en,(/w,100/m,)/w,)/w, ,//w,//w,分成/v,100个/m,分区/vn,，/w,分区/vn,个数/n,至少/d,和/c,集群/nz,中/f,机器/n,的/u,个数/n,相同/a,./w,persist/en,(/w,)/w, ,//w,//w, ,partitionby/en,只是/d,转化/v,操作/v,，/w,需要/v,持久化/nw,才/d,能/v,避免/v,每次/r,引用/v,该/r,rdd/en,重新/d,分区/vn,（/w,4/m,）/w,scala/en,可以/v,通过/p,rdd/en,的/u,partitioner/en,属性/n,获取/v,分区/vn,信息/n,scalascala/en,>, ,val/en, ,pairs/en, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,(/w,1/m,,/w,1/m,)/w,,/w,(/w,2/m,,/w,2/m,)/w,,/w,(/w,3/m,,/w,3/m,)/w,)/w,)/w,scala/en,>, ,pairs/en,./w,partitioner/en, ,//w,//w, ,无/v,分区/vn,res/en,8/m,:/w, ,option/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,partitioner/en,]/w, ,=/w, ,nonescala/en,>, ,val/en, ,partitioned/en, ,=/w, ,pairs/en,./w,partitionby/en,(/w,new/en, ,org/en,./w,apache/en,./w,spark/en,./w,hashpartitioner/en,(/w,2/m,)/w,)/w,scala/en,>, ,partitioned/en,./w,partitioner/en, ,//w,//w, ,有/v,分区/vn,res/en,9/m,:/w, ,option/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,partitioner/en,]/w, ,=/w, ,some/en,(/w,org/en,./w,apache/en,./w,spark/en,./w,hashpartitioner/en,@/w,2/m,)/w,（/w,5/m,）/w,合适/a,手动/b,设置/v,分区/vn,有/v,效益/n,：/w, ,用/p,partitioner/en,方法/n,对/p,rdd/en,分区/vn,会/v,对/p,很多/m,操作/v,产生/v,益处/n,：/w,`,reduceby/en,`, ,,/w, ,`,cogroup/en,`, ,,/w, ,`,groupwith/en,`, ,,/w, ,`,join/en,`, ,,/w, ,`,leftouterjoin/en,`, ,,/w, ,`,rightouterjoin/en,`, ,,/w, ,`,groupbykey/en,`, ,,/w, ,`,combinebykey/en,`, ,,/w, ,`,lookup/en,`,。/w,但是/c,对于/p,像/v,reducebykey/en,这样/r,操作/v,单个/b,rdd/en,的/u,方法/n,，/w,他们/r,只/d,会/v,把/p,每个/r,key/en,对应/v,的/u,value/en,在/p,本地/r,机器/n,上/f,进行/v,计算/v,，/w,最终/d,把/p,所有/b,机器/n,上/f,的/u,结果/n,进行/v,规约/v,，/w,这种/r,操作/v,本身/r,就/d,不/d,会/v,产生/v,数据/n,跨/v,节点/n,混洗/nw,。/w,但是/c,想/v,cogroup/en,和/c,join/en,这样/r,操作/v,两个/m,rdd/en,的/u,方法/n,，/w,如果/c,对/p,这/r,两个/m,rdd/en,采用/v,相同/a,的/u,办法/n,手动/b,分区/vn,，/w,那么/r,相同/a,key/en,的/u,项/q,都/d,在/p,同一/b,台/q,机器/n,上/f,，/w,这样/r,就/d,避免/v,了/u,产生/v,数据/n,的/u,跨/v,界/k,点/q,混洗/nw,</w,br/en,>, ,（/w,6/m,）/w,自/p,定义/n,分区/vn,方式/n, ,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,继承/v,`,org/en,./w,apache/en,./w,spark/en,./w,partitioner/en,`,类/q,，/w,实现/v,下列/b,三个/m,方法/n,：/w, ,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,(/w,a/en,)/w, ,numpartitions/en,：/w,创建/v,的/u,总分区/ns,数/m, ,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,(/w,b/en,)/w, ,getpartition/en,(/w,key/en,:/w,any/en,)/w,：/w,根据/p,key/en,，/w,返回/v,分区/vn,编号/v, ,(/w, ,编号/v,从/p,0/m,到/v,numpartitions/en,-/w,1/m, ,)/w, ,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,&/w,nbsp/en,;/w,(/w,c/en,)/w, ,equals/en,(/w,)/w,：/w,该/r,方法/n,来/v,判断/v,你/r,的/u,分区器/nw,对象/n,是否/v,和/c,其他/r,分区器/nw,实例/n,相同/a,scala/en,//w,*/w,*/w,创建/v,一个/m,基于/p,域名/n,的/u,分区器/nw,，/w,这个/r,分区器/nw,只/d,对/p,url/en,中/f,的/u,域名/n,部分/n,求/v,哈希/nrf,*/w,//w,class/en, ,domainnumpartitioner/en,(/w,numparts/en,:/w,int/en,)/w, ,extends/en, ,partitioner/en,{/w,override/en, ,def/en, ,numpartitions/en,:/w,int/en, ,=/w, ,numpartsoverride/en, ,def/en, ,getpartition/en,(/w,key/en,:/w,any/en,)/w,:/w,int/en, ,=/w, ,{/w,val/en, ,domain/en, ,=/w, ,new/en, ,java/en,./w,net/en,./w,url/en,(/w,key/en,./w,tostring/en,)/w,./w,gethost/en,(/w,)/w,val/en, ,code/en, ,=/w, ,(/w,domain/en,./w,hashcode/en, ,%/w, ,numpartitions/en,)/w,if/en,(/w,code/en, ,</w,0/m,)/w,code/en, ,+/w, ,numpartitionselsecode/en,}/w,override/en, ,def/en, ,equals/en,(/w,other/en,:/w,any/en,)/w,:/w,boolean/en, ,=/w, ,other/en, ,match/en,{/w,case/en, ,dnp/en,:/w,domainnumpartitioner/en, ,=/w,>, ,dnp/en,./w,numpartitions/en, ,=/w,=/w, ,numpartitionscase/en, ,_, ,=/w,>, ,false/en,}/w,}/w,`,`,`,第四/nw,章/q, ,spark/en,的/u,共享/v,变量/n,累加器/n,（/w,1/m,）/w,由于/c,spark/en,的/u,任务/n,再/d,多/a,个/q,节点/n,上/f,跑/v,，/w,驱动/vn,节点/n,上/f,的/u,普通/a,变量/n,不/d,能/v,再/d,多/a,个/q,节点/n,上/f,共享/v,，/w,因此/c,为了/p,解决/v,共享/v,变量/n,的/u,问题/n,，/w,提出/v,了/u,累加器/n,(/w, ,结果/n,聚合/v, ,)/w,和/c,广播/vn,变量/n, ,(/w, ,广播/vn, ,)/w,scala/en, ,//w,//w, ,计算/v,文件/n,中/f,空行/n,的/u,行数/n, ,scala/en,>, ,val/en, ,file/en, ,=/w, ,sc/en,./w,textfile/en,(/w,"/w,//w,root/en,//w,readme/en,./w,md/en,"/w,)/w, ,scala/en,>, ,val/en, ,count/en, ,=/w, ,sc/en,./w,accumulator/en,(/w,0/m,)/w, ,count/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,accumulator/en,[/w,int/en,]/w, ,=/w, ,0/m, ,scala/en,>, ,val/en, ,call/en, ,=/w, ,file/en,./w,map/en,(/w,line/en, ,=/w,>, ,{/w, ,if/en,(/w,line/en,=/w,=/w,"/w,"/w,)/w, ,count/en, ,+/w,=/w, ,1/m,}/w,)/w, ,scala/en,>, ,println/en,(/w,count/en,./w,value/en,)/w, ,5/m,这个/r,例子/n,中/f,，/w,使用/v,了/u,累加器/n,在/p,数据/n,读取/v,时/ng,进行/v,错误/n,统计/v,，/w,而/c,没有/v,对/p,rdd/en,进行/v,filter/en,和/c,reduce/en,实现/v,（/w,2/m,）/w,累加器/n,是/v,一种/mq,只/d,写/v,变量/n,，/w,操作/v,节点/n,不/d,能/v,访问/v,累加器/n,的/u,值/n,，/w,必须/d,要/v,对/p,每次/r,更新/v,操作/v,进行/v,复杂/a,的/u,通信/vn,（/w,3/m,）/w,通过/p,value/en,变量/n,获取/v,可/v,累加器/n,的/u,值/n,（/w,4/m,）/w,累加器/n,操作/v,应该/v,写/v,在/p,action/en,的/u,动作/n,中/f,：/w,比如/v,写/v,在/p,foreach/en,算子/n,。/w,因为/c,在/p,转化/v,算子/n,中/f,，/w,比如/v,如果/c,有/v,一个/m,分区/vn,执行/v,map/en,操作/v,失败/v,了/u,，/w,spark/en,会/v,在/p,另/r,一个/m,节点/n,重新/d,运行/vn,该/r,任务/n,，/w,即使/c,该/r,节点/n,没有/v,崩溃/v,，/w,只是/d,处理/v,速度/n,比/p,别的/r,节点/n,慢/a,很/d,多/a,。/w,spark/en,也/d,可以/v,抢占/v,式/k,的/u,再/d,另/r,一个/m,节点/n,上/f,启动/v,一个/m,任务/n,副本/n,，/w,谁/r,先/d,结束/v,任务/n,就/d,取/v,谁/r,的/u,副本/n,。/w,因此/c,，/w,这种/r,情况/n,会/v,导致/v,累加器/n,操作/v,重复/v,执行/v,多次/m,广播/vn,变量/n,（/w,1/m,）/w,广播/vn,变量/n,是/v,一种/mq,只读/nw,变量/n,（/w,2/m,）/w,虽然/c,spark/en,会/v,把/p,闭包/nw,中/f,的/u,变量/n,发送/v,到/v,每个/r,工作/vn,结点/nw,，/w,但/c,这种/r,方法/n,比/p,广播/vn,变量/n,低效/n,得/u,多/a,。/w,原因/n,有/v,二/m,：/w,a/en, ,)/w, ,广播/vn,变量/n,再/d,变量/n,的/u,发送/v,上/f,对/p,大/a,对象/n,有/v,网络/n,优化/v,b/en, ,)/w, ,如果/c,这个/r,变量/n,来自/v,于/p,读/v,取/v,文件/n,，/w,不/d,适用/v,广播/vn,变量/n,会/v,导致/v,这个/r,文件/n,会/v,被/p,不同/a,工作/vn,节点/n,读取/v,多次/m,。/w,（/w,3/m,）/w,使用/v,value/en,获取/v,广播/vn,变量/n,的/u,值/n,scala/en, ,scala/en,>, ,val/en, ,words/en, ,=/w, ,sc/en,./w,broadcast/en,(/w,list/en,(/w,"/w,fuck/en,"/w,,/w,"/w,shit/en,"/w,)/w,)/w, ,scala/en,>, ,words/en,./w,value/en, ,res/en,1/m,:/w, ,list/en,[/w,string/en,]/w, ,=/w, ,list/en,(/w,fuck/en,,/w, ,shit/en,)/w,（/w,4/m,）/w,当/p,广播/vn,变量/n,的/u,数据/n,很/d,大/a,时/ng,，/w,应当/v,选择/v,一种/mq,合适/a,的/u,序列化/nz,机制/n,分区/vn,共享/v,连接/v,池/ng,等/u,资源/n,（/w,1/m,）/w,当/p,map/en,等/u,转换/v,操作/v,中/f,包含/v,访问/v,数据库/n,等/u,操作/v,时/ng,，/w,就/d,需要/v,通过/p,数据库/n,连接/v,池/ng,的/u,方式/n,重用/v,连接/v,。/w,而/c,分布/v,式/k,的/u,代码/n,在/p,不同/a,分区/vn,中/f,运行/vn,，/w,简单/a,的/u,复用/vn,连接/v,池/ng,对象/n,无法/v,正常/a,工作/vn,。/w,（/w,2/m,）/w,scala/en,提供/v,了/u,mappartitions/en,(/w,function/en,)/w,算子/n,，/w,这个/r,function/en,中/f,的/u,变量/n,会/v,在/p,分区/vn,之间/f,a/en,共享/v,（/w,这个/r,function/en,输入/v,为/p,每个/r,分区/vn,的/u,元素/n,迭代器/nw,，/w,返回/v,一个/m,执行/v,结果/n,的/u,序列/n,迭代器/nw,）/w,`,`,`,scalaobject/en, ,test/en,1/m, ,extends/en, ,app/en,{/w,def/en, ,sumofeverypartition/en,(/w,in/en,:/w,iterator/en,[/w,int/en,]/w,)/w,:/w,int/en, ,=/w, ,{/w,var/en, ,sum/en, ,=/w, ,0/m,in/en,./w,reduce/en,(/w,+/w,)/w,}/w,val/en, ,conf/en, ,=/w, ,new/en, ,sparkconf/en,(/w,)/w,./w,setappname/en,(/w,"/w,test/en,111/m,"/w,)/w,./w,setmaster/en,(/w,"/w,mesos/en,:/w,//w,//w,base/en,1/m,:/w,5050/m,"/w,)/w,val/en, ,sc/en, ,=/w, ,new/en, ,sparkcontext/en,(/w,conf/en,)/w,val/en, ,input/en, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,1/m,,/w,2/m,,/w,3/m,,/w,4/m,)/w,)/w,val/en, ,result/en, ,=/w, ,input/en,./w,mappartitions/en,(/w, ,//w,//w, ,partval/en, ,:/w, ,iterator/en,[/w,int/en,]/w,，/w,rdd/en,中/f,的/u,元素/n,是/v,int/en,的/u,partval/en, ,=/w,>, ,iterator/en,(/w,sumofeverypartition/en,(/w,partval/en,)/w,)/w,)/w,result/en,./w,collect/en,(/w,)/w,./w,foreach/en,(/w,print/en,(/w,_,)/w,)/w, ,//w,//w, ,2个/m,结果/n,：/w,3/m,，/w,7/m,sc/en,./w,stop/en,}/w,`,`,`,数值/n,操作/v,（/w,1/m,）/w,spark/en,对/p,包含/v,数值/n,数据/n,的/u,rdd/en,提供/v,了/u,统计学/n,方法/n,|/w,方法/n,|/w,含义/n,|/w,|/w,:/w,--------/nrf,:/w,|/w,:/w,--------/nrf,:/w,|/w,|/w,count/en,(/w,long/en, ,value/en,)/w,|/w, ,rdd/en,中/f,元素/n,个数/n, ,|/w,|/w,mean/en,(/w,)/w,|/w, ,元素/n,平均值/n, ,|/w,|/w,vaiance/en,|/w, ,元素/n,方/q,差/a, ,|/w,|/w,samolevariance/en,(/w,)/w,|/w,从/p,采样/v,中/f,计算/v,出/v,方/q,差/a,|/w,|/w,stdev/en,(/w,)/w,|/w,标准差/nz,|/w,|/w,samplestdev/en,(/w,)/w,|/w,采样/v,的/u,标准差/nz,|/w,（/w,2/m,）/w,通过/p,rdd/en,的/u,stats/en,(/w,)/w,方法/n,，/w,返回/v,org/en,./w,apache/en,./w,spark/en,./w,util/en,./w,statcounter/en,对象/n,，/w,该/r,对象/n,包含/v,mean/en,(/w,)/w,平均值/n,,/w,stdev/en,(/w,)/w,标准/n,差/a,等/u,数值/n,方法/n,scala/en, ,scala/en,>, ,val/en, ,rdd/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,list/en,(/w,1/m,,/w,2/m,,/w,3/m,,/w,4/m,)/w,)/w, ,scala/en,>, ,val/en, ,stats/en, ,=/w, ,rdd/en,1/m,./w,stats/en,(/w,)/w, ,scala/en,>, ,stats/en,./w,mean/en,第五/nw,章/q, ,submit/en,提交/v,集群/nz,驱动器/n,节点/n,2个/m,职责/n,（/w,1/m,）/w,把/p,用户/n,程序/n,转换/v,成/v,分布式/b,任务/n,：/w,所有/b,的/u,spark/en,程序/n,遵从/v,同一个/r,流程/n,：/w,把/p,输入/v,数据/n,创建/v,一系列/mq,rdd/en,，/w,通过/p,转化/v,操作/v,派生/v,出/v,新/a,的/u,rdd/en,，/w,最后/f,使用/v,行动/vn,操作/v,收集/v,或/c,存储/vn,结果/n,rdd/en,中/f,的/u,数据/n,spark/en,程序/n,会/v,隐式/nw,地/u,创建/v,出/v,一个/m,由/p,操作/v,组成/v,的/u,有/v,向/p,无/v,环/v,图/n,，/w,当/p,驱动器/n,程序/n,执行/v,时/ng,会/v,把/p,这个/r,逻辑图/n,转换/v,为/p,物理/n,执行/v,计划/n,（/w,2/m,）/w,为/p,执行器/nw,节点/n,调度/vn,任务/n,驱动器/n,程序/n,必须/d,在/p,各/r,执行器/nw,进程/n,间/f,协调/v,任务/n,调度/vn,。/w,执行器/nw,进程/n,启动/v,后/f,，/w,会/v,向/p,驱动器/n,进程/n,注册/v,自己/r,执行器/nw,节点/n,2个/m,作用/n,：/w,spark/en,应用/vn,启动/v,时/ng,，/w,执行器/nw,节点/n,就/d,被/p,同时/c,启动/v,（/w,1/m,）/w,执行/v,组成/v,spark/en,应用/vn,的/u,任务/n,，/w,并/c,将/d,结果/n,返回/v,给/p,驱动器/n,程序/n,（/w,1/m,）/w,通过/p,blockmanager/en,为/p,用户/n,程序/n,中/f,要求/v,缓存/n,的/u,rdd/en,提供/v,内存式/nw,存储集群管理器/nw,spark/en,依赖/v,集群/nz,管理器/nw,启动/v,驱动器/n,节点/n,。/w,集群/nz,管理器/nw,是/v,spark/en,的/u,可/v,插拔式/nw,组件/n,。/w,集群/nz,管理器/nw,用于/v,启动/v,执行器/nw,节点/n,。/w,而/c,驱动器/n,可以/v,被/p,集群/nz,管理器/nw,也/d,可以/v,不/d,被/p,集群/nz,管理器/nw,启动/v,spark/en,-/w,submit/en,（/w,1/m,）/w,基本/a,格式/n,：/w,shell/en, ,bin/en,//w,spark/en,-/w,submit/en, ,[/w,options/en,]/w, ,</w,app/en, ,jar/en, ,|/w, ,python/en, ,file/en,>, ,[/w,app/en, ,options/en,]/w,构建/v,程序/n,包/v,（/w,1/m,）/w,build/en,./w,sbt/en,：/w,`,`,`,scalaimport/en, ,assemblykeys/en,./w,_,name/en, ,:/w,=/w, ,"/w,simple/en, ,project/en,"/w,version/en, ,:/w,=/w, ,"/w,1.0/m,"/w,organization/en, ,:/w,=/w, ,"/w,com/en,./w,databricks/en,"/w,scalaversion/en, ,:/w,=/w, ,"/w,2/m,./w,11/m,./w,8/m,"/w,librarydependencies/en, ,+/w,+/w,=/w, ,seq/en,(/w,//w,//w, ,spark/en,依赖/v,"/w,org/en,./w,apache/en,./w,spark/en,"/w, ,%/w, ,"/w,spark/en,-/w,core/en,_,2.10/m,"/w, ,%/w, ,"/w,1/m,./w,2/m,./w,0/m,"/w, ,%/w, ,"/w,provided/en,"/w,,/w,//w,//w, ,第三/nw,方/q,库/n,"/w,net/en,./w,sf/en,./w,jopt/en,-/w,simple/en,"/w, ,%/w, ,"/w,jopt/en,-/w,simple/en,"/w, ,%/w, ,"/w,4.3/m,"/w,,/w,"/w,joda/en,-/w,time/en,"/w, ,%/w, ,"/w,joda/en,-/w,time/en,"/w, ,%/w, ,"/w,2.0/m,"/w,)/w,//w,//w, ,这/r,条/q,语句/n,打开/v,了/u,assembly/en,插件/nz,的/u,功能/n,assemblysettings/en,//w,//w, ,配置/vn,assembly/en,插件/nz,所/u,使用/v,的/u,jarjarname/en, ,in/en, ,assembly/en, ,:/w,=/w, ,"/w,my/en,-/w,project/en,-/w,assembly/en,./w,jar/en,"/w,//w,//w, ,一个/m,用/p,来/v,把/p,scala/en,本身/r,排除/v,在/p,组合/v,jar/en,包/v,之外/f,的/u,特殊/a,选项/v,，/w,因为/c,spark/en,//w,//w, ,已经/d,包含/v,了/u,scalaassemblyoption/en, ,in/en, ,assembly/en, ,:/w,=/w,(/w,assemblyoption/en, ,in/en, ,assembly/en,)/w,./w,value/en,./w,copy/en,(/w,includescala/en, ,=/w, ,false/en,)/w,（/w,2/m,）/w,project/en,//w,assembly/en,./w,sbtshell/en,#, ,显示/v,project/en,//w,assembly/en,./w,sbt/en,的/u,内容/n,$/w, ,cat/en, ,project/en,//w,assembly/en,./w,sbtaddsbtplugin/en,(/w,"/w,com/en,./w,eed/en,3/m,si/en,9/m,n/en,"/w, ,%/w, ,"/w,sbt/en,-/w,assembly/en,"/w, ,%/w, ,"/w,0/m,./w,11/m,./w,2/m,"/w,)/w,$/w, ,sbt/en, ,assembly/en,`,`,`,submit/en,的/u,部署/v,模式/n,（/w,1/m,）/w,客户/n,端/v,模式/n,客户/n,端/v,模式/n,下/f,，/w,驱动器/n,程序/n,会/v,在/p,执行/v,spark/en,-/w,submit/en,的/u,机器/n,上/f,，/w,此时/r,终端/n,可以/v,看到/v,驱动器/n,程序/n,的/u,输出/v,，/w,但/c,要/v,保持/v,终端/n,始终/d,连接/v,。/w,且/c,该/r,机器/n,与/p,执行/v,节点/n,需要/v,有/v,很/d,快速/d,的/u,网络/n,交换/v,（/w,2/m,）/w,集群/nz,模式/n,：/w,--/nrf,deploy/en,-/w,mode/en, ,cluster/en,该/r,模式/n,下/f,，/w,驱动器/n,程序/n,本身/r,也/d,会/v,在/p,集群/nz,中/f,申请/v,资源/n,运行/vn,自己/r,的/u,进程/n,。/w,这样/r,，/w,可以/v,在/p,程序/n,运行/vn,时/ng,关闭/v,电脑/n,。/w,（/w,3/m,）/w,yarn/en,管理/vn,的/u,spark/en,集群/nz,既/c,有/v,客户/n,端/v,模式/n,，/w,又/d,有/v,集群/nz,模式/n,。/w,但是/c,mesos/en,管理/vn,的/u,spark/en,集群/nz,，/w,只有/c,客户/n,端/v,模式/n,，/w,但是/c,mesos/en,管理/vn,下/f,的/u,任务/n,，/w,可以/v,动态/n,分配/vn,cpu/en,（/w,即/v,执行器/nw,进程/n,占用/v,的/u,cpu/en,个数/n,会/v,在/p,他们/r,执行/v,的/u,过程/n,中/f,动态/n,变化/vn,）/w,。/w,这种/r,默认/v,的/u,方式/n,成为/v,细粒度/nz,模式/n,。/w,mesos/en,也/d,支持/v,粗粒度/nz,模式/n,，/w,一/m,开始/v,分配/vn,固定/a,的/u,cpu/en,，/w,内存/n,（/w,spark/en, ,应用/vn,的/u, ,spark/en,./w,mesos/en,./w,coarse/en, ,设置/v,为/p, ,true/en,）/w,（/w,4/m,）/w,yarn/en,集群/nz,和/c,mesos/en,集群/nz,的/u,选择/v,：/w,mesos/en, ,相对/d,于/p, ,yarn/en, ,和/c,独立/v,模式/n,的/u,一/m,大/a,优点/n,在于/v,其/r,细粒度/nz,共享/v,的/u,选项/v,，/w,该/r,选项/v,可以/v,将/d,类似/v, ,spark/en, ,shell/en,这样/r,的/u,交互式/n,应用/vn,中/f,的/u,不同/a,命令/n,分配/vn,到/v,不同/a,的/u, ,cpu/en, ,上/f,。/w,因此/c,这/r,对于/p,多/a,用户/n,同时/c,运行/vn,交互式/n, ,shell/en, ,的/u,用例/nw,更/d,有用处/nw,。/w,除此之外/c,，/w,选择/v,使用/v,yarn/en,模式/n,更为/d,合适/a,第六/nw,章/q, ,spark/en,-/w,sqldataset/en,与/p,dataframe/en,（/w,1/m,）/w,dataset/en,是/v,spark/en,1.6/m,以后/f,新加/nrf,的/u,分布式/b,数据集/nw,，/w,比/p,rdd/en,有/v,诸多/m,好处/n,，/w,比如/v,强/a,类型/n,和/c,提供/v,更/d,有力/a,的/u,表达/v,式/k,方法/n,，/w,适应/v,sql/en,执行/v,引擎/n,。/w,（/w,2/m,）/w,dataframe/en,是/v,包含/v,列名/nr,的/u,dataset/en,`,`,`,scala/en,//w,//w, ,1/m,./w, ,构建/v,对象/n,的/u,分布式/b,数据集/nw,scala/en,>, ,val/en, ,spark/en, ,=/w, ,sparksession/en,./w,builder/en,(/w,)/w,./w,appname/en,(/w,"/w,test/en,-/w,sql/en,"/w,)/w,./w,config/en,(/w,"/w,p/en,1/m,"/w,,/w, ,"/w,v/en,1/m,"/w,)/w,./w,getorcreate/en,(/w,)/w,scala/en,>, ,case/en, ,class/en, ,people/en,(/w,name/en,:/w,string/en,,/w,age/en,:/w,int/en,)/w,scala/en,>, ,val/en, ,ds/en,1/m, ,=/w, ,seq/en,(/w,people/en,(/w,"/w,andy/en,"/w,,/w,32/m,)/w,)/w,./w,todsscala/en,>, ,ds/en,1/m,./w,show/en,(/w,)/w,+/w,----/nrf,+/w,---/nrf,+/w,|/w,name/en,|/w,age/en,|/w,+/w,----/nrf,+/w,---/nrf,+/w,|/w,andy/en,|/w, ,32/m,|/w,+/w,----/nrf,+/w,---/nrf,+/w,scala/en,>, ,ds/en,1/m,./w,collectres/en,2/m,:/w, ,array/en,[/w,people/en,]/w, ,=/w, ,array/en,(/w,people/en,(/w,andy/en,,/w,32/m,)/w,)/w,//w,//w, ,2/m,./w, ,构建/v,一般/a,数据/n,类型/n,的/u,分布式/b,数据集/nw,scala/en,>, ,val/en, ,primitiveds/en, ,=/w, ,seq/en,(/w,1/m,,/w, ,2/m,,/w, ,3/m,,/w,5/m,,/w,7/m,,/w,9/m,)/w,./w,tods/en,(/w,)/w,primitiveds/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,dataset/en,[/w,int/en,]/w, ,=/w, ,[/w,value/en,:/w, ,int/en,]/w,scala/en,>, ,primitiveds/en,./w,map/en,(/w,_,+/w,1/m,)/w,./w,collectres/en,3/m,:/w, ,array/en,[/w,int/en,]/w, ,=/w, ,array/en,(/w,2/m,,/w, ,3/m,,/w, ,4/m,,/w, ,6/m,,/w, ,8/m,,/w, ,10/m,)/w,//w,//w,3/m,./w, ,把/p,文件/n,读/v,成/v,对象/n,的/u,分布式/b,数据集/nw,scala/en,>, ,case/en, ,class/en, ,person/en,(/w,name/en,:/w, ,string/en,,/w, ,age/en,:/w, ,bigint/en,)/w,defined/en, ,class/en, ,personscala/en,>, ,val/en, ,peopleds/en, ,=/w, ,spark/en,./w,read/en,./w,json/en,(/w,"/w,examples/en,//w,src/en,//w,main/en,//w,resources/en,//w,people/en,./w,json/en,"/w,)/w,./w,as/en,[/w,person/en,]/w,//w,//w, ,不加/v,as/en,[/w,person/en,]/w,，/w,只/d,会/v,读/v,成/v,res/en,6/m,:/w, ,array/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,row/en,]/w, ,=/w, ,array/en,(/w,[/w,null/en,,/w,michael/en,]/w,,/w, ,[/w,30/m,,/w,andy/en,]/w,,/w, ,[/w,19/m,,/w,justin/en,]/w,)/w,peopleds/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,dataset/en,[/w,person/en,]/w, ,=/w, ,[/w,age/en,:/w, ,bigint/en,,/w, ,name/en,:/w, ,string/en,]/w,scala/en,>, ,peopleds/en,./w,collectres/en,5/m,:/w, ,array/en,[/w,person/en,]/w, ,=/w, ,array/en,(/w,person/en,(/w,michael/en,,/w,null/en,)/w,,/w, ,person/en,(/w,andy/en,,/w,30/m,)/w,,/w, ,person/en,(/w,justin/en,,/w,19/m,)/w,)/w,`,`,`,解析/v,json/en,文件/n,（/w,1/m,）/w,文件/n,格式/n,：/w,文件/n,的/u,每/r,一行/n,都/d,是/v,一个/m,json/en,串/v,，/w,每/r,一行/n,会/v,被/p,转化/v,为/p,一个/m,row/en,对象/n,（/w,2/m,）/w,spark/en,-/w,sql/en,读/v,取/v,文件/n,后/f,，/w,把/p,整个/b,形成/v,一个/m,dataframe/en,，/w,带有/v,列名/nr,的/u,表/n,`,`,`,scalascala/en,>, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,sparksessionscala/en,>, ,import/en, ,spark/en,./w,implicits/en,./w,_,scala/en,>, ,val/en, ,spark/en, ,=/w, ,sparksession/en,./w,builder/en,(/w,)/w,./w,appname/en,(/w,"/w,test/en,-/w,sql/en,"/w,)/w,./w,config/en,(/w,"/w,p/en,1/m,"/w,,/w, ,"/w,v/en,1/m,"/w,)/w,./w,getorcreate/en,(/w,)/w,【/w,warn/en, ,sparksession/en,$/w,builder/en,:/w, ,using/en, ,an/en, ,existing/en, ,sparksession/en,;/w, ,some/en, ,configuration/en, ,may/en, ,not/en, ,take/en, ,effect/en,./w,】/w,【/w,spark/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,sparksession/en, ,=/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,sparksession/en,@/w,399/m,ef/en,33/m,f/en,】/w,scala/en,>, ,val/en, ,df/en, ,=/w, ,spark/en,./w,read/en,./w,json/en,(/w,"/w,examples/en,//w,src/en,//w,main/en,//w,resources/en,//w,people/en,./w,json/en,"/w,)/w,df/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,dataframe/en, ,=/w, ,[/w,age/en,:/w, ,bigint/en,,/w, ,name/en,:/w, ,string/en,]/w,scala/en,>, ,df/en,./w,select/en,(/w,"/w,name/en,"/w,)/w,./w,show/en,(/w,)/w,+/w,-------/nrf,+/w,|/w, ,name/en,|/w,+/w,-------/nrf,+/w,|/w,michael/en,|/w,|/w, ,andy/en,|/w,|/w, ,justin/en,|/w,+/w,-------/nrf,+/w,scala/en,>, ,df/en,./w,select/en,(/w,$/w,"/w,name/en,"/w,,/w, ,$/w,"/w,age/en,"/w, ,+/w, ,1/m,)/w,./w,show/en,+/w,-------/nrf,+/w,---------/nrf,+/w,|/w, ,name/en,|/w,(/w,age/en, ,+/w, ,1/m,)/w,|/w,+/w,-------/nrf,+/w,---------/nrf,+/w,|/w,michael/en,|/w, ,null/en,|/w,|/w, ,andy/en,|/w, ,31/m,|/w,|/w, ,justin/en,|/w, ,20/m,|/w,+/w,-------/nrf,+/w,---------/nrf,+/w,`,`,`,用/p,sql/en,语句/n,查询/v,session/en,中/f,的/u,视图/n,session/en,中/f,的/u,视图/n,只能/v,存在/v,于/p,这个/r,session/en,中/f,，/w,一旦/d,session/en,结束/v,，/w,视图/n,消失/v,。/w,如果/c,想/v,在/p,所有/b,session/en,中/f,共享/v,，/w,就要/d,使用/v,全局/n,视图/n,scala/en,>, ,df/en,./w,createorreplacetempview/en,(/w,"/w,people/en,"/w,)/w, ,scala/en,>, ,val/en, ,sqldf/en, ,=/w, ,spark/en,./w,sql/en,(/w,"/w,select/en, ,*/w, ,from/en, ,people/en,"/w,)/w, ,sqldf/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,dataframe/en, ,=/w, ,[/w,age/en,:/w, ,bigint/en,,/w, ,name/en,:/w, ,string/en,]/w, ,scala/en,>, ,sqldf/en,./w,collect/en, ,res/en,8/m,:/w, ,array/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,row/en,]/w, ,=/w, ,array/en,(/w,[/w,null/en,,/w,michael/en,]/w,,/w, ,[/w,30/m,,/w,andy/en,]/w,,/w, ,[/w,19/m,,/w,justin/en,]/w,)/w,全局/n,视图/n,全局/n,视图/n,保存/v,在/p,系统/n,数据库/n,global/en,_,temp/en,中/f,，/w,使用/v,全局/n,视图/n,时/ng,，/w,必须/d,加上/v,数据库/n,的/u,名字/n,`,`,`,scalascala/en,>, ,df/en,./w,createglobaltempview/en,(/w,"/w,people/en,"/w,)/w,scala/en,>, ,spark/en,./w,sql/en,(/w,"/w,select/en, ,*/w, ,from/en, ,global/en,_,temp/en,./w,people/en,"/w,)/w,./w,collectres/en,11/m,:/w, ,array/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,row/en,]/w, ,=/w, ,array/en,(/w,[/w,null/en,,/w,michael/en,]/w,,/w, ,[/w,30/m,,/w,andy/en,]/w,,/w, ,[/w,19/m,,/w,justin/en,]/w,)/w,scala/en,>, ,spark/en,./w,newsession/en,./w,sql/en,(/w,"/w,select/en, ,*/w, ,from/en, ,global/en,_,temp/en,./w,people/en,"/w,)/w,./w,collectres/en,12/m,:/w, ,array/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,row/en,]/w, ,=/w, ,array/en,(/w,[/w,null/en,,/w,michael/en,]/w,,/w, ,[/w,30/m,,/w,andy/en,]/w,,/w, ,[/w,19/m,,/w,justin/en,]/w,)/w,`,`,`,spark/en,-/w,sql/en,支持/v,的/u,文件/n,类型/n,spark/en,-/w,sql/en,支持/v,的/u,文件/n,类型/n,：/w,json/en,,/w, ,parquet/en,,/w, ,jdbc/en,,/w, ,orc/en,,/w, ,libsvm/en,,/w, ,csv/en,,/w, ,text/en,`,`,`,scalascala/en,>, ,val/en, ,peopledf/en, ,=/w, ,spark/en,./w,read/en,./w,format/en,(/w,"/w,json/en,"/w,)/w,./w,load/en,(/w,"/w,examples/en,//w,src/en,//w,main/en,//w,resources/en,//w,people/en,./w,json/en,"/w,)/w,peopledf/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,dataframe/en, ,=/w, ,[/w,age/en,:/w, ,bigint/en,,/w, ,name/en,:/w, ,string/en,]/w,scala/en,>, ,peopledf/en,./w,select/en,(/w,"/w,name/en,"/w,,/w, ,"/w,age/en,"/w,)/w,./w,write/en,./w,format/en,(/w,"/w,parquet/en,"/w,)/w,./w,save/en,(/w,"/w,namesandages/en,./w,parquet/en,"/w,)/w,slf/en,4/m,j/en,:/w, ,failed/en, ,to/en, ,load/en, ,class/en, ,"/w,org/en,./w,slf/en,4/m,j/en,./w,impl/en,./w,staticloggerbinder/en,"/w,./w,slf/en,4/m,j/en,:/w, ,defaulting/en, ,to/en, ,no/en,-/w,operation/en, ,(/w,nop/en,)/w, ,logger/en, ,implementationslf/en,4/m,j/en,:/w, ,see/en, ,http/en,:/w,//w,//w,www/en,./w,slf/en,4/m,j/en,./w,org/en,//w,codes/en,./w,html/en,#,staticloggerbinder/en, ,for/en, ,further/en, ,details/en,./w,`,`,`,第七/nw,章/q, ,spark/en, ,streaming/en,一/m,./w, ,入门/v,例子/n,要求/v,：/w,（/w,1/m,）/w,从/p,一台/mq,服务器/n,的/u,7777/m,端口/n,上/f,接受/v,一个/m,以/p,换行符/n,分割/v,的/u,多/a,行文/vn,本/r,，/w,从中/d,筛选/v,出/v,包含/v,error/en,的/u,行/v,并/c,打印/v,出来/v,（/w,2/m,）/w,使用/v,命令/n,模拟/b,向/p,端口/n,7777/m,发送/v,消息/n,shell/en, ,$/w, ,nc/en, ,-/w,lk/en, ,localhost/en, ,7777/m, ,</w,在/p,此/r,输入/v,文本/n,>,streaming/en,代码/n,：/w,`,`,`,scalaimport/en, ,org/en,./w,apache/en,./w,spark/en,./w,_,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,streaming/en,./w,_,object/en, ,testmain/en, ,{/w,def/en, ,main/en,(/w,args/en,:/w, ,array/en,[/w,string/en,]/w,)/w,:/w, ,unit/en, ,=/w, ,{/w,val/en, ,conf/en, ,=/w, ,new/en, ,sparkconf/en,(/w,)/w,val/en, ,ssc/en, ,=/w, ,new/en, ,streamingcontext/en,(/w,conf/en,,/w,seconds/en,(/w,1/m,)/w,)/w,val/en, ,lines/en, ,=/w, ,ssc/en,./w,sockettextstream/en,(/w,"/w,localhost/en,"/w,,/w,9999/m,)/w,val/en, ,words/en, ,=/w, ,lines/en,./w,flatmap/en,(/w,./w,split/en,(/w,"/w,"/w,)/w,)/w,val/en, ,pairs/en, ,=/w, ,words/en,./w,map/en,(/w,x/en,=/w,>,(/w,x/en,,/w,1/m,)/w,)/w,val/en, ,wordcounts/en, ,=/w, ,pairs/en,./w,reducebykey/en,(/w,+/w,_,)/w,wordcounts/en,./w,print/en,(/w,)/w,ssc/en,./w,start/en,(/w,)/w,ssc/en,./w,awaittermination/en,(/w,)/w,}/w,}/w,scalalibrarydependencies/en, ,+/w,+/w,=/w, ,seq/en,(/w,"/w,org/en,./w,apache/en,./w,spark/en,"/w, ,%/w, ,"/w,spark/en,-/w,streaming/en,_,2.11/m,"/w, ,%/w, ,"/w,2/m,./w,1/m,./w,0/m,"/w, ,,/w,"/w,org/en,./w,apache/en,./w,spark/en,"/w, ,%/w, ,"/w,spark/en,-/w,core/en,_,2.11/m,"/w, ,%/w, ,"/w,2/m,./w,1/m,./w,0/m,"/w,)/w,`,`,`,提交/v,代码/n,（/w,1/m,）/w,submit/en,提交/v,命令/n,shell/en, ,spark/en,-/w,submit/en, ,--/nrf,class/en, ,"/w,test/en,"/w, ,--/nrf,master/en, ,local/en,[/w,4/m,]/w, ,sparkdemo/en,_,2.11/m,-/w,1/m,./w,0/m,./w,jar/en,（/w,2/m,）/w,ide/en,中/f,配置/vn,的/u,提交/v,jvm/en,参数/n,-/w,dspark/en,./w,master/en,=/w,local/en,[/w,4/m,]/w, ,-/w,dspark/en,./w,app/en,./w,name/en,=/w,mystreamingtest/en,二/m,./w, ,架构/n,与/p,抽象/a,离散/vn,化流/nw,的/u,概念/n,（/w,1/m,）/w,spark/en,-/w,streaming/en,使用/v,微/ag,批次/n,架构/n,，/w,把/p,流式/nw,数据/n,当做/v,一系列/mq,小规模/d,批/q,处理/v,对待/v,。/w,新/a,批次/n,按照/p,均匀/ad,时间/n,间隔/n,创建/v,出来/v,（/w,2/m,）/w,streaming/en,的/u,编程/vn,模型/n,是/v,离/v,散化/nw,流/v,dstream/en,，/w,他/r,是/v,一个/m,rdd/en,序列/n,，/w,每个/r,rdd/en,代表/n,数据流/n,中/f,一个/m,时间/n,片/q,内/f,的/u,数据/n,straming/en,在/p,驱动器/n,和/c,执行/v,节点/n,的/u,执行/v,过程/n,（/w,1/m,）/w,spark/en, ,streamng/en,为/p,每个/r,输入源/nw,启动/v,接收器/n,，/w,接收器/n,以/p,任务/n,的/u,形式/n,运行/vn,在/p,执行器/nw,中/f,。/w,（/w,2/m,）/w,接收器/n,从/p,输入源/nw,收集/v,数据/n,并/c,保存/v,为/p,rdd/en,。/w,他们/r,在/p,收到/v,输入/v,数据/n,后/f,会/v,把/p,数据/n,复制/v,到/v,另/r,一个/m,执行器/nw,进程/n,来/v,保障/vn,容错性/nw,。/w,（/w,3/m,）/w,数据/n,被/p,保存/v,在/p,执行器/nw,进程/n,的/u,内存/n,中/f,，/w,和/c,缓存/n,rdd/en,的/u,方式/n,一样/u,。/w,（/w,4/m,）/w,streamingcontext/en,周期性/n,的/u,运行/vn,spark/en,任务/n,来/v,处理/v,这些/r,数据/n,，/w,把/p,数据/n,和/c,之前/f,区间/n,的/u,rdd/en,整合/vn,。/w,spark/en,-/w,streaming/en,的/u,容错性/nw,（/w,1/m,）/w,streaming/en,对/p,dstream/en,提供/v,的/u,容错性/nw,，/w,和/c,spark/en,为/p,rdd/en,提供/v,的/u,容错性/nw,一致/a,。/w,只要/c,数据/n,还/d,在/p,，/w,就/d,能/v,根据/p,rdd/en,谱系/n,图重/nw,算/v,出/v,任意/d,状态/n,的/u,数据集/nw,。/w,（/w,2/m,）/w,默认/v,情况/n,下/f,，/w,数据/n,分别/d,存在/v,于/p,两个/m,节点/n,上/f,，/w,这样/r,可以/v,保证/v,数据/n,容错性/nw,，/w,但是/c,只/d,根据/p,谱系/n,图重/nw,算/v,所有/b,从/p,程序/n,启动/v,就/d,接收/v,到/v,的/u,数据/n,可能/v,会/v,花/v,很/d,长/a,时间/n,。/w,因此/c,streaming/en,提供/v,检查点/n,来/v,保存/v,数据/n,到/v,hdfs/en,中/f,。/w,一般/a,情况/n,下/f,，/w,每/r,处理/v,5/m,-/w,10次/mq,就/d,保存/v,一次/mq,scala/en, ,ssc/en,./w,checkpoint/en,(/w,"/w,hdfs/en,:/w,//w,//w, ,./w,./w,./w, ,"/w,)/w, ,//w,//w, ,本地/r,开发/v,时/ng,，/w,可以/v,使用/v,本地/r,路径/n,三/m,./w, ,streaming/en,的/u,转化/v,操作/v,dstream/en,无/v,状态/n,转化/v,（/w,1/m,）/w,无/v,状态/n,转化/v,操作/v,是/v,应用/vn,到/v,每个/r,时间/n,片/q,的/u,rdd/en,上/f,的/u,eg/en,：/w,map/en,，/w,flatmap/en,，/w,filter/en,，/w,repartition/en,，/w,reducebykey/en,，/w,groupbykey/en,（/w,2/m,）/w,无/v,状态/n,转化/v,操作/v,也/d,可/v,用于/v,把/p,两个/m,同/p,时间/n,片/q,内/f,的/u,dstream/en,连接/v,起来/v,有/v,状态/n,转化/v,操作/v, ,-/w, ,滑动/vn,窗口/s,（/w,有/v,状态/n,转化/v,操作/v,需要/v,打开/v,检查点/n,机制/n,来/v,确保/v,容错性/nw,）/w,（/w,1/m,）/w,基于/p,窗口/s,的/u,操作/v,在/p,一个/m,比/p,streamingcontext/en,批次/n,更/d,长/a,的/u,时间/n,范围/n,内/f,，/w,通过/p,整合/vn,更/d,多/a,个/q,批次/n,的/u,结果/n,，/w,计算/v,整个/b,窗口/s,的/u,结果/n,。/w,所以/c,通过/p,window/en,产生/v,的/u,dstream/en,中/f,每个/r,rdd/en,会/v,包含/v,多/a,个/q,批次/n,的/u,数据/n,，/w,可以/v,对/p,这些/r,数据/n,进行/v,count/en,(/w,)/w, ,,/w, ,transform/en,(/w,)/w,操作/v,。/w,`,`,`,scalaobject/en, ,testmain/en, ,{/w,def/en, ,main/en,(/w,args/en,:/w, ,array/en,[/w,string/en,]/w,)/w,:/w, ,unit/en, ,=/w, ,{/w,val/en, ,sparkconf/en, ,=/w, ,new/en, ,sparkconf/en,(/w,)/w,val/en, ,ssc/en, ,=/w, ,new/en, ,streamingcontext/en,(/w,sparkconf/en,,/w, ,seconds/en,(/w,1/m,)/w,)/w,ssc/en,./w,checkpoint/en,(/w,"/w,./w,//w,checkpoints/en,"/w,)/w, ,//w,//w, ,设置/v,检查/vn,点/q,//w,//w, ,初始/b,消息/n,rdd/en, ,val/en, ,initialrdd/en, ,=/w, ,ssc/en,./w,sparkcontext/en,./w,parallelize/en,(/w,list/en,(/w,(/w,"/w,hello/en,"/w,,/w, ,1/m,)/w,,/w, ,(/w,"/w,world/en,"/w,,/w, ,1/m,)/w,)/w,)/w, ,//w,//w, ,创建/v,sparkstreaming/en,环境/n, ,val/en, ,lines/en, ,=/w, ,ssc/en,./w,sockettextstream/en,(/w,"/w,localhost/en,"/w,,/w,9999/m,)/w, ,val/en, ,words/en, ,=/w, ,lines/en,./w,flatmap/en,(/w,_,./w,split/en,(/w,"/w, ,"/w,)/w,)/w, ,val/en, ,pairs/en, ,=/w, ,words/en,./w,map/en,(/w,x/en, ,=/w,>, ,(/w,x/en,,/w, ,1/m,)/w,)/w, ,//w,//w, ,pairrdd/en, ,//w,*/w,*/w, ,*/w, ,@/w,param/en, ,reducefunc/en, ,:/w, ,reduce/en, ,function/en, ,*/w, ,@/w,param/en, ,windowduration/en,:/w,窗口/s,宽度/n,，/w,一次/mq,批/q,处理/v,的/u,时间/n,长短/n, ,*/w, ,@/w,param/en, ,slideduration/en,：/w,两次/mq,窗口/s,滑动/vn,间隔/n, ,*/w,//w, ,pairs/en,./w,reducebykeyandwindow/en,(/w,(/w,a/en,:/w,int/en,,/w,b/en,:/w,int/en,)/w,=/w,>,a/en,+/w,b/en,,/w,seconds/en,(/w,15/m,)/w,,/w,seconds/en,(/w,1/m,)/w,)/w, ,pairs/en,./w,print/en,(/w,)/w, ,ssc/en,./w,start/en,(/w,)/w, ,ssc/en,./w,awaittermination/en,(/w,)/w,}/w,}/w,`,`,`,有/v,状态/n,转化/v,操作/v, ,-/w, ,updatestatesbykey/en,(/w,)/w,与/p,mapwithstate/en,（/w,1/m,）/w,这/r,两个/m,方法/n,都/d,是/v,操作/v,pairrdd/en,的/u,,/w,他们/r,要求/v,新/a,消息/n,以/p,只读/nw,的/u,形式/n,到来/vn,，/w,key/en,是/v,新/a,消息/n,，/w,value/en,是/v,新/a,消息/n,对应/v,的/u,状态/n,（/w,2/m,）/w,mapwithstate/en,需要/v,传入/v,mappingfunc/en,来/v,计算/v,消息/n,的/u,新/a,状态/n,:/w, ,(/w,keytype/en,,/w, ,option/en,[/w,valuetype/en,]/w,,/w, ,state/en,[/w,statetype/en,]/w,)/w, ,=/w,>, ,mappedtype/en,（/w,3/m,）/w,updatestatebykey/en,需要/v,传入/v,updatefunc/en,来/v,更新/v,消息/n,状态/n,，/w,输入/v,参数/n,：/w,(/w,seq/en,[/w,v/en,]/w,,/w, ,option/en,[/w,s/en,]/w,)/w, ,=/w,>, ,option/en,[/w,s/en,]/w,（/w,4/m,）/w,用/p,这/r,两个/m,方法/n,实现/v,持续/vd,统计/v,单词/n,技术/n,：/w,`,`,`,scalaimport/en, ,org/en,./w,apache/en,./w,spark/en,./w,_,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,streaming/en,./w,_,object/en, ,testmain/en, ,{/w,def/en, ,main/en,(/w,args/en,:/w, ,array/en,[/w,string/en,]/w,)/w,:/w, ,unit/en, ,=/w, ,{/w,val/en, ,sparkconf/en, ,=/w, ,new/en, ,sparkconf/en,(/w,)/w,val/en, ,ssc/en, ,=/w, ,new/en, ,streamingcontext/en,(/w,sparkconf/en,,/w, ,seconds/en,(/w,5/m,)/w,)/w,ssc/en,./w,checkpoint/en,(/w,"/w,./w,"/w,)/w, ,//w,//w, ,设置/v,检查/vn,点/q,//w,//w, ,初始/b,消息/n,rdd/en, ,val/en, ,initialrdd/en, ,=/w, ,ssc/en,./w,sparkcontext/en,./w,parallelize/en,(/w,list/en,(/w,(/w,"/w,hello/en,"/w,,/w, ,1/m,)/w,,/w, ,(/w,"/w,world/en,"/w,,/w, ,1/m,)/w,)/w,)/w, ,//w,//w, ,创建/v,sparkstreaming/en,环境/n, ,val/en, ,lines/en, ,=/w, ,ssc/en,./w,sockettextstream/en,(/w,"/w,localhost/en,"/w,,/w,9999/m,)/w, ,val/en, ,words/en, ,=/w, ,lines/en,./w,flatmap/en,(/w,_,./w,split/en,(/w,"/w, ,"/w,)/w,)/w, ,val/en, ,worddstream/en, ,=/w, ,words/en,./w,map/en,(/w,x/en, ,=/w,>, ,(/w,x/en,,/w, ,1/m,)/w,)/w, ,//w,//w, ,pairrdd/en, ,//w,//w, ,定义/n,状态/n,更新/v,函数/n,：/w,输入/v,key/en,，/w,新/a,到/v,的/u,pairrdd/en,中/f,value/en,值/n,，/w,已经/d,保存/v,的/u,key/en,的/u,状态值/n,，/w,返回/v,一个/m,键值/nr,对/p,（/w,key/en,,/w,state/en,）/w, ,val/en, ,mappingfunc/en, ,=/w, ,(/w,word/en,:/w, ,string/en,,/w, ,one/en,:/w, ,option/en,[/w,int/en,]/w,,/w, ,state/en,:/w, ,state/en,[/w,int/en,]/w,)/w, ,=/w,>, ,{/w, ,val/en, ,sum/en, ,=/w, ,one/en,./w,getorelse/en,(/w,0/m,)/w, ,+/w, ,state/en,./w,getoption/en,./w,getorelse/en,(/w,0/m,)/w, ,val/en, ,output/en, ,=/w, ,(/w,word/en,,/w, ,sum/en,)/w, ,state/en,./w,update/en,(/w,sum/en,)/w, ,output/en, ,}/w, ,//w,//w, ,values/en,是/v,新/a,消息/n,pairrdd/en,的/u,value/en,值/n,，/w,state/en,是/v,以/p,保存/v,的/u,状态值/n, ,def/en, ,updatefunc/en, ,(/w,values/en,:/w,seq/en,[/w,int/en,]/w,,/w,state/en,:/w,option/en,[/w,int/en,]/w,)/w,:/w, ,option/en,[/w,int/en,]/w, ,=/w,{/w, ,val/en, ,newcount/en, ,=/w, ,state/en,./w,getorelse/en,(/w,0/m,)/w,+/w,values/en,./w,size/en, ,some/en,(/w,newcount/en,)/w, ,}/w, ,val/en, ,statedstream/en, ,=/w, ,worddstream/en,./w,mapwithstate/en,(/w,statespec/en,./w,function/en,(/w,mappingfunc/en,)/w,./w,initialstate/en,(/w,initialrdd/en,)/w,)/w, ,//w,//w, ,通过/p,mapping/en,方法/n,累积/vn,所有/b,消息/n,状态/n, ,val/en, ,statedstream/en, ,=/w, ,worddstream/en,./w,updatestatebykey/en,[/w,int/en,]/w,(/w,updatefunc/en, ,_,)/w, ,//w,//w, ,通过/p,update/en,方法/n,累积/vn,所有/b,消息/n,状态/n, ,statedstream/en,./w,print/en,(/w,)/w, ,ssc/en,./w,start/en,(/w,)/w, ,ssc/en,./w,awaittermination/en,(/w,)/w,}/w,}/w,`,`,`,四/m,./w, ,输出/v,操作/v,print/en,(/w,)/w,（/w,1/m,）/w,dstream/en,如果/c,没有/v,被/p,执行/v,输出/v,操作/v,，/w,则/d,这些/r,dstream/en,不/d,会/v,被/p,求值/nw,。/w,若/c,streamingcontext/en,中/f,没有/v,定义/n,输出/v,操作/v,，/w,整个/b,context/en,就/d,不/d,会/v,启动/v,保存/v,文件/n,（/w,1/m,）/w,saveastextfilescala/en, ,//w,//w, ,output/en,-/w,1497685765000/m,./w,txt/en,文件/n,，/w,根据/p,streamingcontext/en,设置/v,的/u,时间/n,间隔/n,执行/v,一次/mq, ,wordcounts/en,./w,saveastextfiles/en,(/w,"/w,output/en,"/w,,/w,"/w,txt/en,"/w,)/w,;/w,（/w,2/m,）/w,saveashadoopfile/en,该/r,函数/n,接受/v,一种/mq,hadoop/en,输出/v,格式/n,作为/v,参数/n,，/w,可以/v,用/p,这个/r,函数/n,将/d,dstream/en,保存/v,成/v,sequencefilescala/en, ,val/en, ,pairs/en, ,=/w, ,words/en,./w,map/en,(/w,x/en,=/w,>,(/w,new/en, ,text/en,(/w,x/en,)/w,,/w,new/en, ,longwritable/en,(/w,1/m,)/w,)/w,)/w, ,val/en, ,wordcounts/en, ,=/w, ,pairs/en,./w,reducebykey/en,(/w,(/w,x/en,:/w,longwritable/en,,/w,y/en,:/w,longwritable/en,)/w,=/w,>,new/en, ,longwritable/en,(/w,x/en,./w,get/en,(/w,)/w,+/w,y/en,./w,get/en,(/w,)/w,)/w,)/w, ,wordcounts/en,./w,saveashadoopfiles/en,[/w,sequencefileoutputformat/en,[/w,text/en,,/w,longwritable/en,]/w,]/w,(/w,"/w,outdir/en,"/w,,/w,"/w,txt/en,"/w,)/w,;/w,存入/v,外部/f,存储/vn,系统/n,，/w,如/v,mysql/en,中/f,scala/en, ,wordcounts/en,./w,foreachrdd/en,(/w,{/w, ,//w,//w, ,dstream/en,中/f,的/u,每个/r,rdd/en, ,rdd/en, ,=/w,>, ,rdd/en,./w,foreachpartition/en,(/w,{/w, ,//w,//w, ,每/r,台/q,机器/n,上/f,的/u,rdd/en,都/d,能/v,公用/vn,一个/m,分区/vn, ,item/en, ,=/w,>, ,pool/en,./w,getconn/en,./w,save/en,(/w,item/en,)/w, ,//w,//w, ,保存/v,每/r,一条/mq,数据/n, ,}/w,)/w, ,}/w,)/w,五/m,./w, ,输入源/nw,每个/r,dstream/en,与/p,一个/m,receiver/en,对象/n,相/d,关联/vn,，/w,该/r,对象/n,从/p,数据源/nz,接收/v,数据/n,并/c,将/d,其/r,存储/vn,到/v,spark/en,集群/nz,的/u,内存/n,中/f,。/w,核心/n,数据源/nz,（/w,1/m,）/w,文件/n,流/v,：/w,监听/vn,一个/m,hdfs/en,下/f,的/u,文件夹/n,，/w,一旦/d,有/v,新/a,文件/n,进入/v,，/w,就/d,将/d,其/r,作为/v,输入源/nw,处理/v,成/v,dstream/en,。/w,这种/r,方式/n,，/w,文件/n,一旦/d,进入/v,该/r,文件夹/n,，/w,就/d,不能/v,再/d,修改/v,。/w,ssc/en,./w,filestream/en,[/w,keyclass/en,,/w, ,valueclass/en,,/w, ,inputformatclass/en,]/w,(/w,dir/en,)/w,（/w,2/m,）/w,自/p,定义/n,一个/m,接收器/n,acceptor/en,，/w,接收/v,akka/en,数据源/nz,。/w,custom/en, ,receiver/en, ,guide/en,（/w,3/m,）/w,rdd/en,队列/n,模拟/b,输入源/nw,：/w,可以/v,把/p,一系列/mq,的/u,rdd/en,作为/v,dstream/en,的/u,一批/mq,数据/n,c/en, ,ssc/en,./w,queuestream/en,(/w,queueofrdds/en,)/w,附加/vn,数据源/nz,（/w,1/m,）/w,kafka/en,数据源/nz,（/w,2/m,）/w,flume/en,数据源/nz,多数/m,据源/nw,与/p,集群/nz,规模/n,（/w,1/m,）/w,当/p,使用/v,类似/v,union/en,(/w,)/w,将/d,多/a,个/q,dstream/en,合并/v,时/ng,，/w,使用/v,多/a,个/q,接收器/n,用/p,来/v,提高/v,聚合/v,操作/v,中/f,的/u,数据/n,获取/v,吞吐量/n,（/w,一个/m,接收器/n,会/v,成为/v,系统/n,的/u,性能/n,瓶颈/n,）/w,。/w,此外/c,，/w,有时/d,需要/v,用/p,不同/a,接收器/n,从/p,不同/a,数据源/nz,接受/v,各种/r,数据/n,。/w,此时/r,应用/vn,分配/vn,的/u,cpu/en,个数/n,至少/d,为/p,数据/n,源/ng,个/q,数/m,+/w,1/m,（/w,最后/f,一个/m,用/p,来/v,计算/v,这些/r,数据/n,）/w,六/m, ,24/m,//w,7/m,不/d,间断/v,运行/vn,配置/vn,检查点/n,机制/n,检查/vn,点/q,是/v,streaming/en,中容错性/nw,的/u,主要/b,机制/n,。/w,streaming/en,可/v,通过/p,转化/v,图/n,的/u,谱/ng,系/v,图/n,来/v,重算/nw,状态/n,，/w,检查点/n,机制/n,则/d,可以/v,控制/v,要/v,在/p,转化/v,图/n,中/f,回溯/vn,多/a,远/a,。/w,其次/c,，/w,如果/c,是/v,驱动器/n,程序/n,崩溃/v,，/w,用户/n,在/p,重启/v,驱动器/n,程序/n,并/c,让/v,驱动器/n,程序/n,从/p,检查点/n,回复/vn,，/w,则/d,streaming/en,可以/v,读/v,取/v,之前/f,运行/vn,的/u,程序/n,处理/v,数据/n,进度/n,，/w,并/c,从/p,这里/r,继续/v,。/w,驱动器/n,程序/n,容错/b,让/v,驱动器/n,程序/n,重/a,启/v,后/f,，/w,先/d,从/p,检查点/n,恢复/v,sparkstreamingcontext/en,，/w,再/d,重新/d,创建/v,streamingcontext/en,，/w,保证/v,错误/n,恢复/v,def/en, ,createstreamingcontext/en,(/w,)/w, ,=/w, ,{/w, ,val/en, ,sparkconf/en, ,=/w, ,new/en, ,sparkconf/en,(/w,)/w, ,val/en, ,ssc/en, ,=/w, ,new/en, ,streamingcontext/en,(/w,sparkconf/en,,/w, ,seconds/en,(/w,1/m,)/w,)/w, ,ssc/en,./w,checkpoint/en,(/w,"/w,./w,//w,checkpoints/en,"/w,)/w, ,//w,//w, ,设置/v,检查/vn,点/q, ,ssc/en, ,}/w, ,val/en, ,ssc/en, ,=/w, ,streamingcontext/en,./w,getorcreate/en,(/w,"/w,./w,//w,checkpoints/en,"/w,,/w,createstreamingcontext/en, ,_,)/w,工作/vn,节点/n,容错/b,（/w,1/m,）/w,streaming/en,使用/v,与/p,spark/en,相同/a,的/u,容错/b,机制/n,，/w,所有/b,从/p,外部/f,数据源/nz,中/f,收到/v,的/u,数据/n,都/d,会/v,在/p,多/a,个/q,工作/vn,节点/n,上/f,备份/n,，/w,所/u,偶/d,有/v,rdd/en,操作/v,，/w,都/d,能/v,容忍/v,一个/m,工作/vn,节点/n,的/u,失败/v,，/w,根据/p,rdd/en,谱系/n,图/n,，/w,系统/n,就/d,能/v,把/p,丢失/v,的/u,数据/n,从/p,输入/v,数据/n,备份/n,中/f,计算/v,出来/v,。/w,（/w,2/m,）/w,工作/vn,节点/n,上/f,的/u,接收器/n,容错/b,：/w,接受/v,其/r,提供/v,如下/v,保障/vn,：/w,a/en,./w, ,所有/b,从/p,hdfs/en,中/f,读取/v,的/u,数据/n,都/d,是/v,可靠/a,的/u,，/w,因为/c,底层/n,文件/n,系统/n,有/v,备份/n,，/w,strreaming/en,会/v,记住/v,那些/r,数据/n,放/v,到/v,了/u,检查点/n,中/f,，/w,并/c,在/p,应用/vn,崩溃/v,后/f,，/w,从/p,检查点/n,处/n,继续/v,执行/v,。/w,b/en,./w, ,对于/p,像/v,kafka/en,这种/r,不/d,可靠/a,数据源/nz,，/w,spark/en,会/v,把/p,数据/n,放/v,到/v,hdfs/en,中/f,，/w,仍然/d,确保/v,不/d,丢失/v,数据/n,。/w,七/m,./w, ,性能/n,批次/n,和/c,窗口/s,大小/n,（/w,1/m,）/w,streaming/en,可/v,使用/v,的/u,最小/a,批次/n,间隔/n,一般/a,为/p,500毫秒/t,（/w,2/m,）/w,这个/r,结果/n,是/v,从/p,一个/m,较/d,大/a,的/u,时间/n,窗口/s,(/w,10/m,s/en,)/w,逐步/d,缩小/v,实验/vn,而/c,来/v,。/w,当/p,减小/v,时间/n,窗口/s,后/f,，/w,如果/c,streaming/en,用户/n,界面/n,现实/n,的/u,处理/v,时间/n,保持/v,不/d,变/v,，/w,就/d,可以/v,进一步/d,减小/v,批次/n,大小/n,，/w,如果/c,处理/v,时间/n,增大/v,，/w,则/d,认为/v,达到/v,了/u,应用/vn,极限/n,。/w,此外/c,，/w,滑动/vn,步长/nz,也/d,对/p,性能/n,有/v,着/u,巨大/a,影响/vn,，/w,当/p,计算/v,代价/n,巨大/a,并/c,成为/v,系/v,瓶颈/n,，/w,就/d,应该/v,考虑/v,增加/v,滑动/vn,步长/nz,。/w,提高/v,并行度/nz,（/w,1/m,）/w,增加/v,接收器/n,数目/n,：/w,如果/c,记录/v,太/d,多/a,，/w,导致/v,单/d,台/q,机器/n,来不及/v,读入/v,并/c,分发/v,数据/n,，/w,接收器/n,就/d,会/v,成为/v,系统/n,瓶颈/n,。/w,此时/r,可以/v,通过/p,创建/v,多/a,个/q,输入/v,dstream/en,来/v,增加/v,接收器/n,的/u,数目/n,，/w,然后/c,使用/v,union/en,合并/v,为/p,一个/m,打/v,的/u,数据源/nz,。/w,（/w,2/m,）/w,将/d,收到/v,的/u,数据/n,显式/nw,的/u,重新/d,分区/vn,如果/c,接收器/n,数目/n,无法/v,增加/v,，/w,可以/v,通过/p,使用/v,dstream/en,。/w,repartition/en,来/v,重新/d,分区/vn,输入/v,流/v,，/w,从而/c,重新/d,分配/vn,收到/v,的/u,数据源/nz,。/w,（/w,3/m,）/w,提高/v,聚合/v,计算/v,的/u,并行度/nz,对于/p,像/v,reducebykeyy/en,这样/r,的/u,操作/v,，/w,可以/v,再/d,第二/m,个/q,参数/n,制定/v,并行度/nz,。/w,垃圾/n,回收/v,和/c,内存/n,使用/v,可以/v,通过/p,修改/v,gc/en,策略/n,,/w,使用/v,cms/en,策略/n,scala/en, ,spark/en,-/w,submit/en, ,--/nrf,conf/en, ,spark/en,./w,executor/en,./w,extrajavaoptions/en,=/w,-/w,xx/en,:/w,+/w,useconcmarksweepgc/en,第八/nw,章/q, ,spark/en, ,机器/n,学习/v,第九/nw,章/q, ,spark/en,调试/v,与/p,调/v,优/ag,一/m,./w, ,使用/v,sparkconf/en,配置/vn,sparkspark/en,每个/r,配置/vn,项/q,都/d,是/v,基于/p,字符/n,串/v,形式/n,的/u,键值/nr,对/p,。/w,eg/en,：/w,通过/p,setappname/en,(/w,)/w,设置/v,spark/en,./w,app/en,./w,namespark/en,允许/v,通过/p,spark/en,-/w,submit/en,脚本/n,动态/n,配置/vn,配置/vn,项/q,，/w,脚本/n,会/v,把/p,这些/r,配置/vn,项/q,这/r,知道/v,运行/vn,时/ng,环境/n,中/f,。/w,当/p,一个/m,新/a,的/u,sparkconf/en,被/p,创建/v,出来/v,时/ng,，/w,这些/r,环境/n,变量/n,会/v,被/p,检测/vn,出来/v,并/c,自动/d,配置/vn,好/a,。/w,因此/c,，/w,用户/n,只/d,需要/v,创建/v,一个/m,空/a,的/u,sparkconf/en,，/w,并/c,直接/ad,传/v,给/p,sparkcontext/en,即可/v,。/w,spark/en,-/w,submit/en, ,--/nrf,class/en, ,com/en,./w,example/en,./w,myapp/en, ,--/nrf,name/en, ,"/w,my/en, ,app/en,"/w, ,--/nrf,conf/en, ,spark/en,./w,ui/en,./w,port/en,=/w,36000/m, ,myapp/en,./w,jarspark/en,-/w,submit/en,脚本/n,会/v,查找/v,conf/en,//w,spark/en,-/w,defaults/en,./w,conf/en,文件/n,，/w,然后/c,尝试/vn,读/v,取/v,该/r,文件/n,中/f,以/p,空格/n,隔开/v,的/u,键值/nr,对/p,数据/n,。/w,也/d,可/v,通过/p,--/nrf,properties/en,-/w,file/en,自/p,定义/n,文件/n,路径/n,#, ,提交/v,脚/n,本/r, ,spark/en,-/w,subnmit/en, ,--/nrf,class/en, ,com/en,./w,example/en,./w,myapp/en, ,--/nrf,properties/en,-/w,file/en, ,myconfig/en,./w,conf/en, ,myapp/en,./w,jar/en, ,#, ,myconfig/en,./w,conf/en,内容/n, ,spark/en,./w,master/en, ,local/en,[/w,4/m,]/w, ,spark/en,./w,app/en,./w,name/en, ,"/w,my/en, ,app/en,"/w, ,spark/en,./w,ui/en,./w,port/en, ,36000/m,sparkconf/en,的/u,优先/v,级/q,选择/v,（/w,1/m,）/w,最高/a,：/w,用户/n,显示/v,调用/v,的/u,sparkconfig/en,的/u,set/en,(/w,)/w,方法/n,设置/v,的/u,选项/v,（/w,2/m,）/w,其次/c,：/w,spark/en,-/w,submit/en,传递/v,的/u,参数/n,（/w,3/m,）/w,写/v,在/p,配置/vn,文件/n,中/f,的/u,值/n,二/m,./w, ,rdd/en,依赖/v,关系/n,rdd/en,依赖/v,（/w,1/m,）/w, ,窄/a,依赖/v,：/w,父/ng,rdd/en,的/u,每个/r,partition/en,，/w,最/d,多/a,被子/n,rdd/en,的/u,1个/m,分区/vn,所/u,使用/v,a/en, ,)/w, ,窄/a,依赖/v,分为/v,两种/mq,：/w,一对一/l,依赖/v,onetoonedependcy/en,，/w,一对一/l,范围/n,依赖/v, ,rangedependency/en,（/w,2/m,）/w, ,宽/a,依赖/v,：/w,指/v,计算/v,中/f,会/v,产生/v,shuffle/en,操作/v,的/u,rdd/en,依赖/v,。/w,表示/v,一个/m,父/ng,rdd/en,的/u,partition/en,会/v,被/p,多个子/nw,rdd/en,的/u,partition/en,使用/v,a/en, ,)/w, ,groupbykey/en,就/d,是/v,常见/a,的/u,宽/a,依赖/v,算子/n,dag/en,生成/vn,机制/n,（/w,1/m,）/w,dag/en,生成/vn,过程/n,，/w,就是/d,对/p,计算/v,中/f,stage/en,的/u,划分/v,。/w,（/w,2/m,）/w,对于/p,窄/a,依赖/v,，/w,rdd/en,之间/f,的/u,数据/n,不/d,需要/v,进行/v,shuffle/en,，/w,这些/r,处理/v,操作/v,可以/v,在/p,同一/b,台/q,机器/n,的/u,内存/n,中/f,完成/v,，/w,所以/c,窄/a,依赖/v,在/p,划分/v,中/f,被/p,分成/v,一个/m,stage/en,（/w,3/m,）/w,对于/p,宽/a,依赖/v,，/w,由于/c,数据/n,之间/f,存在/v,shuffle/en,，/w,必须/d,等到/v,父/ng,rdd/en,所有/b,数据/n,shuffle/en,完成/v,之后/f,才/d,能/v,进行/v,后续/vn,操作/v,，/w,所以/c,在/p,此处/s,进行/v,stage/en,划分/v,rdd/en,检查点/n,（/w,1/m,）/w,checkpoint/en,也/d,是/v,存储/vn,rdd/en,结果/n,的/u,一种/mq,方式/n,，/w,它/r,不同/a,于/p,persist/en,将/d,数据/n,存储/vn,在/p,本地/r,磁盘/n,，/w,而是/c,把/p,结果/n,存储/vn,在/p,hdfs/en,中/f,shell/en, ,scala/en,>, ,val/en, ,wordcount/en, ,=/w, ,sc/en,./w,textfile/en,(/w,"/w,//w,root/en,//w,readme/en,./w,txt/en,"/w,)/w,./w,flatmap/en,(/w,_,./w,split/en,(/w,"/w, ,"/w,)/w,)/w,./w,map/en,(/w,word/en,=/w,>,(/w,word/en,,/w,1/m,)/w,)/w,./w,reducebykey/en,(/w,_,+/w,_,)/w, ,scala/en,>, ,wordcount/en,./w,checkpointrdd/en,容错/b,（/w,1/m,）/w,rdd/en,容错/b,分为/v,3个/m,层面/n,：/w,调度/vn,层/q,，/w,rdd/en,血统层/nw,，/w,checkpoint/en,层/q,（/w,2/m,）/w,调度/vn,层/q,容错/b,：/w,分别/d,在/p,stage/en,输出/v,时/ng,出错/v,与/p,计算/v,时/ng,出错/v,。/w,stage/en,输出/v,出错/v,，/w,上层/f,调度器/nw,dagscheduler/en,会/v,进行/v,重/a,试/v,。/w,stage/en,计算/v,出错/v,时/ng,，/w,该/r,task/en,会/v,自动/d,被/p,重新/d,计算/v,4次/mq,（/w,3/m,）/w,rdd/en, ,lineage/en,血统层/nw,容错/b,：/w,a/en, ,)/w, ,基于/p,各/r,rdd/en,各项/r,transaction/en,构成/v,了/u,compute/en, ,chain/en,，/w,在/p,部分/n,结果/n,丢失/v,的/u,时候/n,可以/v,根据/p,lineage/en,重新/d,计算/v,b/en, ,)/w, ,窄/a,依赖/v,中/f,，/w,数据/n,进行/v,的/u,