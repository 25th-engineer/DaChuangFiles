本人/r,看/v,过/u,的/u,关联/vn,规则/n,博文/nz,，/w,很少/ad,有/v,清晰/a,的/u,把/p,关联/vn,规则/n,的/u,算法/n,说/v,很/d,明白/v,的/u,，/w,希望/v,读者/n,读/v,完/v,本文/r,可以/v,有/v,新/a,的/u,收获/v,。/w,本文/r,是/v,在/p,默认/v,读者/n,有/v,相关/v,机器/n,学习/v,算法/n,基础/n,的/u,，/w,总结/v,和/c,提升/v,对/p,关联/vn,规则/n,代码/n,实现/v,的/u,理解/v,，/w,并/c,介绍/v,相关/v,案例/n,。/w,语言/n,：/w,python/en,一/m, ,引/v,言/vg,关联/vn,规则/n,起初/d,是/v,在/p,购物/v,篮/j,分析/vn,中/f,发现/v,的/u,，/w,沃尔玛超市/nt,在/p,美国/ns,某/r,地区/n,啤酒/n,和/c,尿布/n,放/v,在/p,一起/s,卖/v,，/w,这种/r,关联/vn,规则/n,有利于/v,市场/n,营销/vn,决策/n,的/u,制定/v,。/w,关联/vn,规则/n,是非/n,监督/vn,学习/v,的/u,一种/mq,。/w,二/m, ,两个/m,重要/a,的/u,概念/n,我们/r,认定/v,满足/v,支持/v,度/q,和/c,置信/v,度/q,的/u,规则/n,是/v,有趣/a,的/u,，/w,支持/v,度/q,：/w,p/en,(/w,a/en,)/w,，/w,及/c,项集/nr,a/en,出现/v,的/u,概率/n,（/w,频数/nw,）/w,；/w,置信/v,度/q,：/w,p/en,（/w,b/en, ,//w, ,a/en,）/w,,/w, ,条件/n,概率/n,;/w,　,p/en,（/w,b/en, ,//w, ,a/en,）/w,=/w, ,p/en,（/w,ab/en,）/w,//w,p/en,（/w,a/en,）/w,，/w,所以/c,支持/v,度/q,可以/v,用/p,来/v,计算置信度/nw,，/w,代码/n,是/v,学习/v,算法/n,最/d,好/a,的/u,途径/n,。/w,三/m, ,apriori/en,算法/n,网上/s,很多/m,文章/n,介绍/v,apriori/en,算法/n,都/d,是/v,云/n,里/f,雾/n,里/f,，/w,下面/f,梳理/v,一下/m,脉络/n,。/w,核心/n,是/v,apriori/en,原理/n,：/w,如果/c,某个/r,项集/nr,是/v,频繁/a,的/u,，/w,那么/r,它/r,是/v,所有/b,子集/n,也/d,是/v,频繁/a,的/u,。/w,apriori/en,原理/n,的/u,精妙/a,在于/v,他/r,的/u,逆否/nw,命题/n,，/w,若子集/nw,不/d,是/v,频繁/a,的/u,，/w,则/d,所有/b,包含/v,它/r,的/u,项集/nr,都/d,是/v,不/d,频繁/a,的/u,。/w,这样/r,剪/v,掉/v,不/d,频繁/a,项集/nr,时/ng,，/w,就/d,可以/v,同时/c,剪掉/v,很多/m,包含/v,这个/r,项集/nr,的/u,不/d,频繁/a,的/u,项集/nr,了/u,。/w,若/c,蛮力/nr,查找/v,大频/nw,项集/nr,，/w,时间/n,复杂度/nw,是/v,指数/n,型/k,，/w,例如/v,4个项/mq,集/vg,，/w,它/r,的/u,所有/b,组合/v,的/u,复杂度/nw,是/v,15/m,。/w,同理/v,，/w,可以/v,剪掉/v,后件/nw,不/d,满足/v,置/v,信度/nw,规则/n,时/ng,，/w,同时/c,剪掉/v,后件/nw,包含/v,这个/r,规则/n,后件/nw,的/u,规则/n,。/w,形象/n,的/u,说/v,，/w,看/v,下/f,图/n,：/w,eg/en,项集/nr,{/w,0/m,,/w,1/m,,/w,2/m,,/w,3/m,}/w,，/w,计算/v,所有/b,的/u,组合/v,情况/n,如下/v,图/n,，/w,好像/v,一个/m,格/j,，/w,时间/n,复杂度/nw,是/v,指数/n,型/k,的/u,，/w,按照/p,项集元/nr,素数/n,由小到大/l,计算/v,每个/r,组合/v,的/u,支持/v,度/q,，/w,{/w,2/m,，/w,3/m,}/w,黑色/n,圈/q,不/d,满足/v,最小/a,支持/v,度/q,，/w,由/p,apriori/en,定理/n,，/w,则/d,所有/b,以/p,它/r,为/p,子集/n,的/u,项集/nr,均/d,不/d,满足/v,最小/a,支持/v,度/q,，/w,需要/v,剪掉/v,。/w,下面/f,继续/v,考虑/v,置信/v,度/q,，/w,规则/n,{/w,012/m,}/w,-/w,>,{/w,3/m,}/w,不/d,满足/v,最小置信度/nw,，/w,由/p,apriori/en,定理/n,，/w,所有/b,后件/nw,包含/v,这/r,条/q,规则/n,后件/nw,的/u,规则/n,需要/v,剪掉/v,，/w,即/v,二/m,后件/nw,规则/n,：/w,{/w,01/m,}/w,-/w,>,{/w,23/m,}/w,,/w,{/w,02/m,}/w,-/w,>,{/w,1/m,,/w,3/m,}/w,,/w,{/w,12/m,}/w,-/w,>,{/w,03/m,}/w,和/c,三/m,后件/nw,规则/n,{/w,0/m,}/w,-/w,>,{/w,123/m,}/w,,/w,{/w,1/m,}/w,-/w,>,{/w,023/m,}/w,,/w,{/w,2/m,}/w,-/w,>,{/w,013/m,}/w,。/w,读/v,到/v,这里/r,有/v,关联/vn,规则/n,基础/n,的/u,人/n,应该/v,会/v,有/v,感悟/v,，/w,通过/p,下面/f,代码/n,介绍/v,可以/v,细致/a,的/u,明白/v,apriori/en,算法/n,的/u,机制/n,。/w,四/m, ,apriori/en,实现/v,1/m, ,加载/v,demo/en,数据集/nw,(/w,可以/v,改/v,成/v,真实/a,数据集/nw,，/w,读/v,文件/n,)/w,:/w,from/en, ,numpy/en, ,import/en, ,*/w, ,def/en, ,loaddataset/en,(/w,)/w,:/w, ,return/en, ,[/w,[/w,1/m,,/w, ,3/m,,/w, ,4/m,]/w,,/w, ,[/w,2/m,,/w, ,3/m,,/w, ,5/m,]/w,,/w, ,[/w,1/m,,/w, ,2/m,,/w, ,3/m,,/w, ,5/m,]/w,,/w, ,[/w,2/m,,/w, ,5/m,]/w,]/w,2/m, ,生成/vn,一/m,频繁/a,项集/nr,作为/v,起始点/nw,，/w,即/v,长度/n,为/p,1/m,的/u,频繁/a,集/vg,，/w,图/n,中/f,的/u,第一/m,层/q,：/w,使用/v,frozenset/en,结构/n,是/v,因为/c,set/en,不/d,可以/v,作为/v,dict/en,的/u,关键字/n,def/en, ,createc/en,1/m,(/w,dataset/en,)/w,:/w,#,create/en, ,one/en, ,item/en, ,c/en,1/m, ,=/w, ,[/w,]/w, ,for/en, ,transaction/en, ,in/en, ,dataset/en,:/w, ,for/en, ,item/en, ,in/en, ,transaction/en,:/w, ,if/en, ,not/en, ,[/w,item/en,]/w, ,in/en, ,c/en,1/m,:/w, ,c/en,1/m,./w,append/en,(/w,[/w,item/en,]/w,)/w, ,c/en,1/m,./w,sort/en,(/w,)/w, ,#, ,print/en, ,c/en,1/m, ,return/en, ,map/en,(/w,frozenset/en,,/w, ,c/en,1/m,)/w,#,use/en, ,frozen/en, ,set/en, ,so/en, ,we/en, ,#,can/en, ,use/en, ,it/en, ,as/en, ,a/en, ,key/en, ,in/en, ,a/en, ,dict/en,3/m, ,计算/v,ck/en,支持/v,度/q,，/w,并/c,剪/v,掉/v,不/d,满足/v,最小/a,指出/v,的/u,项集/nr,。/w,def/en, ,scand/en,(/w,d/en,,/w, ,ck/en,,/w, ,minsupport/en,)/w,:/w,#,create/en, ,one/en, ,or/en, ,more/en, ,big/en, ,frequence/en, ,item/en, ,sscnt/en, ,=/w, ,{/w,}/w, ,for/en, ,tid/en, ,in/en, ,d/en,:/w, ,for/en, ,can/en, ,in/en, ,ck/en,:/w, ,if/en, ,can/en,./w,issubset/en,(/w,tid/en,)/w,:/w, ,if/en, ,not/en, ,sscnt/en,./w,has/en,_,key/en,(/w,can/en,)/w,:/w, ,sscnt/en,[/w,can/en,]/w,=/w,1/m, ,else/en,:/w, ,sscnt/en,[/w,can/en,]/w, ,+/w,=/w, ,1/m, ,numitems/en, ,=/w, ,float/en,(/w,len/en,(/w,d/en,)/w,)/w, ,retlist/en, ,=/w, ,[/w,]/w, ,supportdata/en, ,=/w, ,{/w,}/w, ,for/en, ,key/en, ,in/en, ,sscnt/en,:/w, ,support/en, ,=/w, ,sscnt/en,[/w,key/en,]/w,//w,numitems/en, ,if/en, ,support/en, ,>,=/w, ,minsupport/en,:/w, ,retlist/en,./w,insert/en,(/w,0/m,,/w,key/en,)/w, ,supportdata/en,[/w,key/en,]/w, ,=/w, ,support/en, ,return/en, ,retlist/en,,/w, ,supportdata/en,4/m, ,由/p,m/en,频繁/a,项集/nr,生成/vn,m/en,+/w,1/m,频繁/a,项集/nr,：/w,举例/v,，/w,ck/en,为/p,1/m,频繁/a,项集/nr,{/w,01/m,}/w,{/w,12/m,}/w,{/w,02/m,}/w,,/w,生成/vn,{/w,012/m,}/w,，/w,有/v,个/q,技巧/n,，/w,只/d,合并/v,前/f,m/en,-/w,2项/mq,一样/u,的/u,项集/nr,，/w,这样/r,不/d,会/v,重复/v,操作/v,，/w,如/v,这个/r,例子/n,，/w,{/w,01/m,}/w,和/c,{/w,12/m,}/w,不/d,合并/v,，/w,{/w,12/m,}/w,{/w,02/m,}/w,也/d,不/d,合并/v,，/w,只有/c,{/w,01/m,}/w,{/w,02/m,}/w,合并/v,，/w,生成/vn,最后/f,的/u,{/w,012/m,}/w,；/w,否则/c,前/f,几/m,个/q,合并/v,都/d,是/v,重复/v,的/u,。/w,值得/v,注意/v,的/u,是/v,0/m,-/w,3项/mq,集/vg,要/v,排/v,好/a,序/n,，/w,否则/c,前/f,k/en,-/w,2个/m,没有/v,比较/d,的/u,必要/a,。/w,def/en, ,apriorigen/en,(/w,lk/en,,/w, ,k/en,)/w,:/w, ,#,creates/en, ,ck/en, ,retlist/en, ,=/w, ,[/w,]/w, ,lenlk/en, ,=/w, ,len/en,(/w,lk/en,)/w, ,#, ,print/en, ,lk/en, ,for/en, ,i/en, ,in/en, ,range/en,(/w,lenlk/en,)/w,:/w, ,for/en, ,j/en, ,in/en, ,range/en,(/w,i/en,+/w,1/m,,/w, ,lenlk/en,)/w,:/w, ,l/en,1/m, ,=/w, ,list/en,(/w,lk/en,[/w,i/en,]/w,)/w,[/w,:/w,k/en,-/w,2/m,]/w,;/w, ,l/en,2/m, ,=/w, ,list/en,(/w,lk/en,[/w,j/en,]/w,)/w,[/w,:/w,k/en,-/w,2/m,]/w, ,l/en,1/m,./w,sort/en,(/w,)/w,;/w, ,l/en,2/m,./w,sort/en,(/w,)/w, ,#, ,print/en, ,l/en,1/m,,/w,'/w,--/nrf,'/w,,/w,l/en,2/m, ,if/en, ,l/en,1/m,=/w,=/w,l/en,2/m,:/w, ,#,if/en, ,first/en, ,k/en,-/w,2/m, ,elements/en, ,are/en, ,equal/en, ,retlist/en,./w,append/en,(/w,lk/en,[/w,i/en,]/w, ,|/w, ,lk/en,[/w,j/en,]/w,)/w, ,#,set/en, ,union/en, ,#, ,print/en, ,retlist/en, ,return/en, ,retlist/en,5/m, ,生成/vn,打频/nw,项集/nr,的/u,算法/n,：/w,思路/n,，/w,生成/vn,1/m,频/ag,项集/nr,，/w,根据/p,最小/a,支持/v,度过/v,滤/v,；/w,依次/d,由/p,m/en,频/ag,项集/nr,生成/vn,m/en,+/w,1/m,频/ag,项集/nr,,/w,直到/v,m/en,+/w,1/m,频/ag,项集/nr,为/p,空/a,停止/v,迭代/vn,。/w,def/en, ,apriori/en,(/w,dataset/en,,/w, ,minsupport/en, ,=/w, ,0.5/m,)/w,:/w, ,c/en,1/m, ,=/w, ,createc/en,1/m,(/w,dataset/en,)/w, ,d/en, ,=/w, ,map/en,(/w,set/en,,/w, ,dataset/en,)/w, ,l/en,1/m,,/w, ,supportdata/en, ,=/w, ,scand/en,(/w,d/en,,/w, ,c/en,1/m,,/w, ,minsupport/en,)/w,#,create/en, ,one/en, ,big/en, ,frequence/en, ,item/en, ,l/en,1/m, ,#, ,print/en, ,l/en,1/m, ,l/en, ,=/w, ,[/w,l/en,1/m,]/w, ,k/en, ,=/w, ,2/m, ,#, ,print/en, ,l/en, ,while/en, ,(/w,len/en,(/w,l/en,[/w,k/en,-/w,2/m,]/w,)/w, ,>, ,0/m,)/w,:/w, ,#, ,print/en, ,'/w,l/en,[/w,k/en,-/w,2/m,]/w,'/w,,/w,l/en,[/w,k/en,-/w,2/m,]/w, ,#, ,print/en, ,l/en, ,ck/en, ,=/w, ,apriorigen/en,(/w,l/en,[/w,k/en,-/w,2/m,]/w,,/w, ,k/en,)/w, ,lk/en,,/w, ,supk/en, ,=/w, ,scand/en,(/w,d/en,,/w, ,ck/en,,/w, ,minsupport/en,)/w,#,scan/en, ,db/en, ,to/en, ,get/en, ,lk/en, ,supportdata/en,./w,update/en,(/w,supk/en,)/w, ,l/en,./w,append/en,(/w,lk/en,)/w, ,k/en, ,+/w,=/w, ,1/m, ,return/en, ,l/en,,/w, ,supportdata/en,以上/f,都/d,是/v,大频/nw,项集/nr,的/u,生成/vn,算法/n,，/w,下面/f,继续/v,有趣/a,的/u,关联/vn,规则/n,的/u,发现/v,算法/n,：/w,6/m, ,计算/v,后件/nw,为/p,h/en,的/u,规则/n,的/u,置信/v,度/q,，/w,代码/n,可以/v,看出/v,只是/d,一个/m,条件/n,概率/n,公式/n,而已/y,；/w,根据/p,最小置信度/nw,，/w,筛选/v,出/v,有趣/a,的/u,规则/n,；/w,def/en, ,calcconf/en,(/w,freqset/en,,/w, ,h/en,,/w, ,supportdata/en,,/w, ,brl/en,,/w, ,minconf/en,=/w,0.7/m,)/w,:/w, ,prunedh/en, ,=/w, ,[/w,]/w, ,#,create/en, ,new/en, ,list/en, ,to/en, ,return/en, ,for/en, ,conseq/en, ,in/en, ,h/en,:/w, ,conf/en, ,=/w, ,supportdata/en,[/w,freqset/en,]/w,//w,supportdata/en,[/w,freqset/en,-/w,conseq/en,]/w, ,#,calc/en, ,confidence/en, ,if/en, ,conf/en, ,>,=/w, ,minconf/en,:/w, ,brl/en,./w,append/en,(/w,(/w,freqset/en,-/w,conseq/en,,/w, ,conseq/en,,/w, ,conf/en,)/w,)/w, ,prunedh/en,./w,append/en,(/w,conseq/en,)/w, ,return/en, ,prunedh/en,7/m, ,由/p,后/f,件数/n,为/p,m/en,的/u,规则/n,集/vg,生成/vn,后件/nw,为/p,后/f,件数/n,为/p,m/en,+/w,1/m,的/u,规则/n,集/vg,，/w,并/c,计算置信度/nw,；/w,递归/nw,到/v,没有/v,可以/v,合并/v,的/u,规则/n,集/vg,停止/v,；/w,直观/a,的/u,过程/n,可以/v,查看/v,上图