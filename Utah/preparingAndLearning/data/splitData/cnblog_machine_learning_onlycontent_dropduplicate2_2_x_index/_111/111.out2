spark/en,提供/v,了/u,常用/a,机器/n,学习/v,算法/n,的/u,实现/v,，/w, ,封装/vn,于/p,spark/en,./w,ml/en,和/c,spark/en,./w,mllib/en,中/f,./w,spark/en,./w,mllib/en,是/v,基于/p,rdd/en,的/u,机器/n,学习库/nw,，/w, ,spark/en,./w,ml/en,是/v,基于/p,dataframe/en,的/u,机器/n,学习库/nw,./w,相对于/nw,rdd/en,，/w, ,dataframe/en,拥有/v,更/d,丰富/a,的/u,操作/v,api/en,,/w, ,可以/v,进行/v,更/d,灵活/a,的/u,操作/v,./w, ,目前/t,,/w, ,spark/en,./w,mllib/en,已经/d,进入/v,维护/v,状态/n,，/w, ,不再/d,添加/vn,新/a,特性/n,./w,本文/r,将/d,重点/n,介绍/v,pyspark/en,./w,ml/en,，/w, ,测试/vn,环境/n,为/p,spark/en, ,2.1/m,,/w, ,python/en, ,api/en,./w,首先/d,介绍/v,pyspark/en,./w,ml/en,中/f,的/u,几/m,个/q,基类/nr,:/w,ml/en, ,dataset/en,：/w, ,即/v,为/p,pyspark/en,./w,sql/en,./w,dataframe/en,作为/v,数据集/nw,使用/v,pyspark/en,./w,ml/en,./w,transformer/en,：/w, ,代表/n,将/d,数据集/nw,转换/v,到/v,另/r,一个/m,数据集/nw,的/u,算法/n,pyspark/en,./w,ml/en,./w,estimator/en,：/w, ,代表/n,根据/p,数据/n,和/c,参数/n,创建/v,模型/n,的/u,算法/n,，/w,包含/v,方法/n,fit/en,(/w,dataset/en,,/w, ,params/en,)/w,：/w, ,根据/p,训练/vn,数据集/nw,和/c,参数/n,进行/v,训练/vn,，/w, ,返回/v,训练/vn,好/a,的/u,模型/n,对象/n,pyspark/en,./w,ml/en,./w,model/en,:/w, ,代表/n,训练/vn,好/a,的/u,模型/n,的/u,基类/nr,，/w, ,通常/d,由/p,estimator/en,./w,fit/en,(/w,)/w,创建/v,./w, ,包含/v,的/u,方法/n,有/v,:/w,transform/en,(/w,df/en,)/w,:/w, ,将/d,输入/v,数据/n,集代/nw,入/v,模型/n,变换/v,为/p,输出/v,数据集/nw,save/en,(/w,path/en,)/w,:/w, ,保存/v,训练/vn,好/a,的/u,模型/n,load/en,(/w,path/en,)/w,:/w, ,从/p,文件/n,中/f,加/v,载/v,模型/n,pyspark/en,./w,ml/en,./w,pipeline/en,：/w, ,用于/v,将/d,多/a,个/q,步骤/n,组合/v,为/p,管道/n,进行/v,处理/v,，/w, ,可以/v,建立/v,线性/n,管道/n,和/c,有/v,向/p,无/v,环/v,图/n,管道/n,./w,pyspark/en,./w,ml/en,下/f,将/d,不同/a,算法/n,封装/vn,到/v,不同/a,的/u,包/v,中/f,:/w,pyspark/en,./w,ml/en,./w,linalg/en, ,线性/n,代数/n,工具/n,包/v,./w, ,包括/v,：/w,vectordensevectorsparsevectormatrixdensematrixsparsematrixpyspark/en,./w,ml/en,./w,feature/en,特征/n,和/c,预/d,处理/v,算法/n,包/v,./w, ,包括/v,:/w,tokenizernormalizerstopwordsremoverpcangramword/en,2/m,vecpyspark/en,./w,ml/en,./w,classification/en,分类/vn,算法/n,包/v,./w, ,包括/v,：/w,logisticregressiondecisiontreeclassifierrandomforestclassifiernaivebayesmultilayerperceptronclassifieronevsrestpyspark/en,./w,ml/en,./w,clustering/en, ,聚/v,类/q,算法/n,包/v,./w, ,包括/v,：/w,kmeansldapyspark/en,./w,ml/en,./w,regression/en,回归/v,算法/n,包/v,./w, ,包括/v,：/w,linearregressiongeneralizedlinearregressiondecisiontreeregressorrandomforestregressorpyspark/en,./w,ml/en,./w,recommendation/en,推荐/v,系统/n,算法/n,包/v,./w, ,包括/v,：/w,alspyspark/en,./w,ml/en,./w,tuning/en, ,校验/v,工具/n,包/v,pyspark/en,./w,ml/en,./w,evaluation/en, ,评估/vn,工具/n,包/v,pyspark/en,./w,ml/en,中/f,的/u,算法/n,大多数/m,为/p,estimator/en,的/u,派生/v,类/q,./w, ,大多数/m,算法/n,类/q,均/d,拥有/v,对应/v,的/u,model/en,类/q,./w,如/v,classification/en,./w,naivebayes/en,和/c,classification/en,./w,naivebayesmodel/en,./w, ,算法/n,类/q,的/u,fit/en,方法/n,可以/v,生成/vn,对应/v,的/u,model/en,类/q,./w,应用/vn,示例/n,pyspark/en,./w,ml/en,使用/v,了/u,统一/vn,风格/n,的/u,接口/n,，/w,这里/r,只/d,展示/v,部分/n,算法/n,./w,首先/d,用/p,naivebayes/en,分类器/nw,做/v,一个/m,二/m,分类/vn,：/w,>,>,>, ,from/en, ,pyspark/en,./w,sql/en, ,import/en, ,row/en, ,>,>,>, ,from/en, ,pyspark/en,./w,ml/en,./w,linalg/en, ,import/en, ,vectors/en, ,>,>,>, ,df/en, ,=/w, ,spark/en,./w,createdataframe/en,(/w,[/w, ,./w,./w,./w, ,row/en,(/w,label/en,=/w,0.0/m,,/w, ,weight/en,=/w,0.1/m,,/w, ,features/en,=/w,vectors/en,./w,dense/en,(/w,[/w,0.0/m,,/w, ,0.0/m,]/w,)/w,)/w,,/w, ,./w,./w,./w, ,row/en,(/w,label/en,=/w,0.0/m,,/w, ,weight/en,=/w,0.5/m,,/w, ,features/en,=/w,vectors/en,./w,dense/en,(/w,[/w,0.0/m,,/w, ,1.0/m,]/w,)/w,)/w,,/w, ,./w,./w,./w, ,row/en,(/w,label/en,=/w,1.0/m,,/w, ,weight/en,=/w,1.0/m,,/w, ,features/en,=/w,vectors/en,./w,dense/en,(/w,[/w,1.0/m,,/w, ,0.0/m,]/w,)/w,)/w,]/w,)/w, ,>,>,>, ,nb/en, ,=/w, ,naivebayes/en,(/w,smoothing/en,=/w,1.0/m,,/w, ,modeltype/en,=/w,"/w,multinomial/en,"/w,,/w, ,weightcol/en,=/w,"/w,weight/en,"/w,)/w, ,>,>,>, ,model/en, ,=/w, ,nb/en,./w,fit/en,(/w,df/en,)/w, ,#, ,构造/v,模型/n, ,>,>,>, ,test/en,0/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,[/w,row/en,(/w,features/en,=/w,vectors/en,./w,dense/en,(/w,[/w,1.0/m,,/w, ,0.0/m,]/w,)/w,)/w,]/w,)/w,./w,todf/en,(/w,)/w, ,>,>,>, ,result/en, ,=/w, ,model/en,./w,transform/en,(/w,test/en,0/m,)/w,./w,head/en,(/w,)/w, ,#, ,预测/v, ,>,>,>, ,result/en,./w,prediction/en, ,1.0/m, ,>,>,>, ,result/en,./w,probability/en, ,densevector/en,(/w,[/w,0/m,./w,32/m,./w,./w,./w,,/w, ,0/m,./w,67/m,./w,./w,./w,]/w,)/w, ,>,>,>, ,result/en,./w,rawprediction/en, ,densevector/en,(/w,[/w,-/w,1/m,./w,72/m,./w,./w,./w,,/w, ,-/w,0/m,./w,99/m,./w,./w,./w,]/w,)/w,model/en,./w,transform/en,将/d,输入/v,的/u,一行/n,(/w,row/en,)/w,作为/v,一个/m,样本/n,，/w,产生/v,一行/n,输出/v,./w, ,这里/r,我们/r,只/d,输入/v,了/u,一个/m,测试/vn,样本/n,，/w, ,所以/c,直接/ad,使用/v,head/en,(/w,)/w,取出/v,唯一/b,一行/n,输出/v,./w,使用/v,logisticregression/en,和/c,onevsrest/en,做/v,多/a,分类/vn,：/w,>,>,>, ,from/en, ,pyspark/en,./w,sql/en, ,import/en, ,row/en, ,>,>,>, ,from/en, ,pyspark/en,./w,ml/en,./w,linalg/en, ,import/en, ,vectors/en, ,>,>,>, ,df/en, ,=/w, ,sc/en,./w,parallelize/en,(/w,[/w, ,./w,./w,./w, ,row/en,(/w,label/en,=/w,0.0/m,,/w, ,features/en,=/w,vectors/en,./w,dense/en,(/w,1.0/m,,/w, ,0.8/m,)/w,)/w,,/w, ,./w,./w,./w, ,row/en,(/w,label/en,=/w,1.0/m,,/w, ,features/en,=/w,vectors/en,./w,sparse/en,(/w,2/m,,/w, ,[/w,]/w,,/w, ,[/w,]/w,)/w,)/w,,/w, ,./w,./w,./w, ,row/en,(/w,label/en,=/w,2.0/m,,/w, ,features/en,=/w,vectors/en,./w,dense/en,(/w,0.5/m,,/w, ,0.5/m,)/w,)/w,]/w,)/w,./w,todf/en,(/w,)/w, ,>,>,>, ,lr/en, ,=/w, ,logisticregression/en,(/w,maxiter/en,=/w,5/m,,/w, ,regparam/en,=/w,0.01/m,)/w, ,>,>,>, ,ovr/en, ,=/w, ,onevsrest/en,(/w,classifier/en,=/w,lr/en,)/w, ,>,>,>, ,model/en, ,=/w, ,ovr/en,./w,fit/en,(/w,df/en,)/w, ,>,>,>, ,#, ,进行/v,预测/v, ,>,>,>, ,test/en,0/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,[/w,row/en,(/w,features/en,=/w,vectors/en,./w,dense/en,(/w,-/w,1.0/m,,/w, ,0.0/m,)/w,)/w,]/w,)/w,./w,todf/en,(/w,)/w, ,>,>,>, ,model/en,./w,transform/en,(/w,test/en,0/m,)/w,./w,head/en,(/w,)/w,./w,prediction/en, ,1.0/m, ,>,>,>, ,test/en,1/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,[/w,row/en,(/w,features/en,=/w,vectors/en,./w,sparse/en,(/w,2/m,,/w, ,[/w,0/m,]/w,,/w, ,[/w,1.0/m,]/w,)/w,)/w,]/w,)/w,./w,todf/en,(/w,)/w, ,>,>,>, ,model/en,./w,transform/en,(/w,test/en,1/m,)/w,./w,head/en,(/w,)/w,./w,prediction/en, ,0.0/m, ,>,>,>, ,test/en,2/m, ,=/w, ,sc/en,./w,parallelize/en,(/w,[/w,row/en,(/w,features/en,=/w,vectors/en,./w,dense/en,(/w,0.5/m,,/w, ,0.4/m,)/w,)/w,]/w,)/w,./w,todf/en,(/w,)/w, ,>,>,>, ,model/en,./w,transform/en,(/w,test/en,2/m,)/w,./w,head/en,(/w,)/w,./w,prediction/en, ,2.0/m,使用/v,pca/en,进行/v,降维/nw,：/w,>,>,>, ,from/en, ,pyspark/en,./w,ml/en,./w,linalg/en, ,import/en, ,vectors/en, ,>,>,>, ,data/en, ,=/w, ,[/w,(/w,vectors/en,./w,sparse/en,(/w,5/m,,/w, ,[/w,(/w,1/m,,/w, ,1.0/m,)/w,,/w, ,(/w,3/m,,/w, ,7.0/m,)/w,]/w,)/w,,/w,)/w,,/w, ,./w,./w,./w, ,(/w,vectors/en,./w,dense/en,(/w,[/w,2.0/m,,/w, ,0.0/m,,/w, ,3.0/m,,/w, ,4.0/m,,/w, ,5.0/m,]/w,)/w,,/w,)/w,,/w, ,./w,./w,./w, ,(/w,vectors/en,./w,dense/en,(/w,[/w,4.0/m,,/w, ,0.0/m,,/w, ,0.0/m,,/w, ,6.0/m,,/w, ,7.0/m,]/w,)/w,,/w,)/w,]/w, ,>,>,>, ,df/en, ,=/w, ,spark/en,./w,createdataframe/en,(/w,data/en,,/w,[/w,"/w,features/en,"/w,]/w,)/w, ,>,>,>, ,pca/en, ,=/w, ,pca/en,(/w,k/en,=/w,2/m,,/w, ,inputcol/en,=/w,"/w,features/en,"/w,,/w, ,outputcol/en,=/w,"/w,pca/en,_,features/en,"/w,)/w, ,>,>,>, ,model/en, ,=/w, ,pca/en,./w,fit/en,(/w,df/en,)/w, ,>,>,>, ,model/en,./w,transform/en,(/w,df/en,)/w,./w,head/en,(/w,)/w,./w,pca/en,_,features/en, ,densevector/en,(/w,[/w,1/m,./w,648/m,./w,./w,./w,,/w, ,-/w,4/m,./w,013/m,./w,./w,./w,]/w,)/w,estimator/en,和/c,transformer/en,均/d,为/p,pipelinestage/en,的/u,派生/v,类/q,，/w,pipeline/en,由/p,一系列/mq,stage/en,组成/v,./w,调用/v,pipeline/en,对象/n,的/u,fit/en,方法/n,，/w, ,将/d,会/v,依次/d,执行/v,stage/en,并/c,生成/vn,一个/m,最终/d,模型/n,./w,>,>,>,from/en, ,pyspark/en,./w,ml/en, ,import/en, ,pipeline/en, ,>,>,>,from/en, ,pyspark/en,./w,ml/en,./w,classification/en, ,import/en, ,logisticregression/en, ,>,>,>,from/en, ,pyspark/en,./w,ml/en,./w,feature/en, ,import/en, ,hashingtf/en,,/w, ,tokenizer/en, ,>,>,>, ,data/en, ,=/w, ,[/w, ,(/w,0/m,,/w, ,"/w,a/en, ,b/en, ,c/en, ,d/en, ,e/en, ,spark/en,"/w,,/w, ,1.0/m,)/w,,/w, ,(/w,1/m,,/w, ,"/w,b/en, ,d/en,"/w,,/w, ,0.0/m,)/w,,/w, ,(/w,2/m,,/w, ,"/w,spark/en, ,f/en, ,g/en, ,h/en,"/w,,/w, ,1.0/m,)/w,,/w, ,(/w,3/m,,/w, ,"/w,hadoop/en, ,mapreduce/en,"/w,,/w, ,0.0/m,)/w, ,]/w, ,>,>,>, ,df/en, ,=/w, ,spark/en,./w