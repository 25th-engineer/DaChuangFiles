spark/en,机器/n,学习/v,库现/nw,支持/v,两种/mq,接口/n,的/u,api/en,:/w,rdd/en,-/w,based/en,和/c,dataframe/en,-/w,based/en,，/w,spark/en,官方/n,网站/n,上/f,说/v,，/w,rdd/en,-/w,based/en, ,apis/en,在/p,2.0/m,后/f,进入/v,维护/v,模式/n,，/w,主要/b,的/u,机器/n,学习/v,api/en,是/v,spark/en,-/w,ml/en,包/v,中/f,的/u,dataframe/en,-/w,based/en, ,api/en,，/w,并/c,将/d,在/p,3.0/m,后/f,完全/ad,移除/v,rdd/en,-/w,based/en, ,api/en,。/w,在/p,学习/v,了/u,两周/mq,spark/en, ,mllib/en,后/f,，/w,准备/v,转向/v,dataframe/en,-/w,based/en,接口/n,。/w,由于/c,现有/v,的/u,文档/n,资料/n,均/d,是/v,rdd/en,-/w,based/en,接口/n,，/w,于是/c,便/d,去/v,看/v,了/u,看/v,spark/en, ,mllib/en,的/u,源码/nw,。/w,dataframe/en,-/w,based/en, ,api/en, ,包含/v,在/p,org/en,./w,apache/en,./w,spark/en,./w,ml/en,包/v,中/f,，/w,其中/r,主要/b,的/u,类/q,结构/n,如下/v,：/w,咱/r,先/d,看/v,一个/m,线性/n,回归/v,的/u,例子/n,examples/en,//w,ml/en,//w,linearregressionexample/en,./w,scala/en,，/w,其/r,首先/d,定义/n,了/u,一个/m,linearregression/en,的/u,对象/n,:/w,val/en, ,lir/en, ,=/w, ,new/en, ,linearregression/en,(/w,)/w, ,./w,setfeaturescol/en,(/w,"/w,features/en,"/w,)/w, ,./w,setlabelcol/en,(/w,"/w,label/en,"/w,)/w, ,./w,setregparam/en,(/w,params/en,./w,regparam/en,)/w, ,./w,setelasticnetparam/en,(/w,params/en,./w,elasticnetparam/en,)/w, ,./w,setmaxiter/en,(/w,params/en,./w,maxiter/en,)/w, ,./w,settol/en,(/w,params/en,./w,tol/en,)/w,然后/c,，/w,调用/v,fit/en,方法/n,训练/vn,数据/n,，/w,得到/v,一个/m,训练/vn,好/a,的/u,模型/n,lirmodel/en,，/w,它/r,是/v,一个/m,linearregressionmodel/en,类/q,的/u,对象/n,。/w,val/en, ,lirmodel/en, ,=/w, ,lir/en,./w,fit/en,(/w,training/en,)/w,现在/t,，/w,我们/r,大概/d,可以/v,理清/v,mllib/en,机器/n,学习/v,的/u,流程/n,，/w,和/c,很多/m,单机/n,机器/n,学习/v,库/n,一样/u,，/w,先/d,定义/n,一个/m,模型/n,并/c,设置/v,好/a,参数/n,，/w,然后/c,训练/vn,数据/n,，/w,最后/f,返回/v,一个/m,训练/vn,好/a,了/u,的/u,模型/n,。/w,我们/r,现在/t,在/p,源码/nw,中/f,去/v,查看/v,linearregression/en,和/c,linearregressionmodel/en,，/w,其/r,类/q,的/u,依赖/v,关系/n,如下/v,：/w,linearregression/en,是/v,一个/m,predictor/en,，/w,linearregressionmodel/en,是/v,一个/m,model/en,，/w,那么/r,predictor/en,是/v,学习/v,算法/n,，/w,model/en,是/v,训练/vn,得到/v,的/u,模型/n,。/w,除此之外/c,，/w,还有/v,一类/b,继承/v,自/p,params/en,的/u,类/q,，/w,这/r,是/v,一个/m,表示/v,参数/n,的/u,类/q,。/w,predictor/en, ,和/c,model/en, ,共享/v,一套/mq,参数/n,。/w,现在/t,用/p,spark/en, ,mllib/en,来/v,完成/v,第一/m,个/q,机器/n,学习/v,例子/n,，/w,数据/n,是/v,我/r,之前/f,放在/v,txt/en,文件/n,里/f,的/u,回归/v,数据/n,，/w,一共/d,550多/mq,万条/mq,，/w,共/d,13列/mq,，/w,第一/m,列/v,是/v,label/en,，/w,后面/f,是/v,features/en,。/w,分别/d,演示/vn,两种/mq,接口/n,，/w,先/d,用/p,旧/a,的/u,接口/n,：/w,1/m,./w,读取/v,原始/a,数据/n,：/w,scala/en,>, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,linalg/en,./w,_, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,linalg/en,./w,_, ,scala/en,>, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,_, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,_, ,scala/en,>, ,val/en, ,raw/en,_,data/en, ,=/w, ,sc/en,./w,textfile/en,(/w,"/w,data/en,//w,my/en,//w,y/en,_,x/en,./w,txt/en,"/w,)/w, ,raw/en,_,data/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,string/en,]/w, ,=/w, ,data/en,//w,my/en,//w,y/en,_,x/en,./w,txt/en, ,mappartitionsrdd/en,[/w,1/m,]/w, ,at/en, ,textfile/en, ,at/en, ,</w,console/en,>,:/w,302/m,./w,转换/v,格式/n,，/w,rdd/en,-/w,based/en,接口/n,以/p,labeledpoint/en,为/p,输入/v,数据/n,的/u,格式/n,：/w,scala/en,>, ,val/en, ,data/en, ,=/w, ,raw/en,_,data/en,./w,map/en,{/w, ,line/en, ,=/w,>, ,|/w, ,val/en, ,arr/en, ,=/w, ,line/en,./w,split/en,(/w,'/w, ,'/w,)/w,./w,map/en,(/w,_,./w,todouble/en,)/w, ,|/w, ,val/en, ,label/en, ,=/w, ,arr/en,./w,head/en, ,|/w, ,val/en, ,features/en, ,=/w, ,vectors/en,./w,dense/en,(/w,arr/en,./w,tail/en,)/w,|/w, ,labeledpoint/en,(/w,label/en,,/w,features/en,)/w, ,|/w, ,}/w, ,data/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,labeledpoint/en,]/w, ,=/w, ,mappartitionsrdd/en,[/w,2/m,]/w, ,at/en, ,map/en, ,at/en, ,</w,console/en,>,:/w,323/m,./w,划分/v,train/en,、/w,test/en,数据集/nw,：/w,scala/en,>, ,val/en, ,splits/en, ,=/w, ,data/en,./w,randomsplit/en,(/w,array/en,(/w,0.8/m,,/w, ,0.2/m,)/w,)/w, ,splits/en,:/w, ,array/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,labeledpoint/en,]/w,]/w, ,=/w, ,array/en,(/w,mappartitionsrdd/en,[/w,3/m,]/w, ,at/en, ,randomsplit/en, ,at/en, ,</w,console/en,>,:/w,34/m,,/w, ,mappartitionsrdd/en,[/w,4/m,]/w, ,at/en, ,randomsplit/en, ,at/en, ,</w,console/en,>,:/w,34/m,)/w, ,scala/en,>, ,val/en, ,train/en,_,set/en, ,=/w, ,splits/en,(/w,0/m,)/w,./w,cache/en, ,train/en,_,set/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,labeledpoint/en,]/w, ,=/w, ,mappartitionsrdd/en,[/w,3/m,]/w, ,at/en, ,randomsplit/en, ,at/en, ,</w,console/en,>,:/w,34/m, ,scala/en,>, ,val/en, ,test/en,_,set/en, ,=/w, ,splits/en,(/w,1/m,)/w,./w,cache/en, ,test/en,_,set/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,labeledpoint/en,]/w, ,=/w, ,mappartitionsrdd/en,[/w,4/m,]/w, ,at/en, ,randomsplit/en, ,at/en, ,</w,console/en,>,:/w,344/m,./w,使用/v,linearregressionwithsgd/en,./w,train/en,训练/vn,模型/n,：/w,scala/en,>, ,val/en, ,lr/en, ,=/w, ,linearregressionwithsgd/en,./w,train/en,(/w,train/en,_,set/en,,/w,100/m,,/w,0.0001/m,)/w, ,warning/en,:/w, ,there/en, ,was/en, ,one/en, ,deprecation/en, ,warning/en,;/w, ,re/en,-/w,run/en, ,with/en, ,-/w,deprecation/en, ,for/en, ,details/en, ,16/m,//w,08/m,//w,26/m, ,09/m,:/w,20/m,:/w,44/m, ,warn/en, ,executor/en,:/w, ,1/m, ,block/en, ,locks/en, ,were/en, ,not/en, ,released/en, ,by/en, ,tid/en, ,=/w, ,0/m,:/w, ,[/w,rdd/en,_,3/m,_,0/m,]/w, ,lr/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,linearregressionmodel/en, ,=/w, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,regression/en,./w,linearregressionmodel/en,:/w, ,intercept/en, ,=/w, ,0.0/m,,/w, ,numfeatures/en, ,=/w, ,125/m,./w,模型/n,评估/vn,：/w,scala/en,>, ,val/en, ,pred/en,_,labels/en, ,=/w, ,test/en,_,set/en,./w,map/en,(/w,lp/en, ,=/w,>, ,(/w,lp/en,./w,label/en,,/w, ,lr/en,./w,predict/en,(/w,lp/en,./w,features/en,)/w,)/w,)/w, ,pred/en,_,labels/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,(/w,double/en,,/w, ,double/en,)/w,]/w, ,=/w, ,mappartitionsrdd/en,[/w,17/m,]/w, ,at/en, ,map/en, ,at/en, ,</w,console/en,>,:/w,42/m, ,scala/en,>, ,val/en, ,mse/en, ,=/w, ,pred/en,_,labels/en,./w,map/en,{/w,case/en, ,(/w,p/en,,/w,v/en,)/w, ,=/w,>, ,math/en,./w,pow/en,(/w,p/en,-/w,v/en,,/w,2/m,)/w,}/w,./w,mean/en, ,mse/en,:/w, ,double/en, ,=/w, ,0.05104150735910074/m,再/d,用/p,新/a,的/u,接口/n,：/w,1/m,./w,读取/v,原始/a,数据/n,：/w,scala/en,>, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,ml/en,./w,linalg/en,./w,_, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,ml/en,./w,linalg/en,./w,_, ,scala/en,>, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,ml/en,./w,regression/en,./w,_, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,ml/en,./w,regression/en,./w,_, ,scala/en,>, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,_, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,_, ,scala/en,>, ,val/en, ,raw/en,_,data/en, ,=/w, ,spark/en,./w,read/en,./w,text/en,(/w,"/w,data/en,//w,my/en,//w,y/en,_,x/en,./w,txt/en,"/w,)/w, ,raw/en,_,data/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,sql/en,./w,dataframe/en, ,=/w, ,[/w,value/en,:/w, ,string/en,]/w,2/m,./w,转换/v,数据/n,scala/en,>, ,val/en, ,data/en, ,=/w, ,raw/en,_,data/en,./w,rdd/en,./w,map/en, ,{/w, ,case/en, ,row/en,(/w,line/en,:/w,string/en,)/w, ,=/w,>, ,|/w, ,val/en, ,arr/en, ,=/w, ,line/en,./w,split/en,(/w,'/w, ,'/w,)/w,./w,map/en,(/w,_,./w,todouble/en,)/w, ,|/w, ,val/en, ,label/en, ,=/w, ,arr/en,./w,head/en, ,|/w, ,val/en, ,features/en, ,=/w, ,vectors/en,./w,dense/en,(/w,arr/en,./w,tail/en,)/w, ,|/w, ,(/w,label/en,,/w,features/en,)/w, ,|/w, ,}/w, ,data/en,:/w, ,org/en,./w,apache/en,./w,spark/en,./w,rdd/en,./w,rdd/en,[/w,(/w,double/en,,/w, ,org/en,./w,apache/en,./w,spark/en,./w,ml/en,./w,linalg/en,./w,vector/en,)/w,]/w, ,=/w, ,mappartitionsrdd/en,[/w,4/m,]/w, ,at/en, ,map/en, ,at/en, ,</w,console/en,>,:/w,343/m,./w,划分/v,数据集/nw,scala/en,>, ,val/e