5/m, ,neural/en, ,networks/en, ,(/w,part/en, ,two/en,)/w,content/en,:/w,5/m, ,neural/en, ,networks/en, ,(/w,part/en, ,two/en,)/w,5.1/m, ,cost/en, ,function/en,5.2/m, ,back/en, ,propagation/en,5.3/m, ,神经/n,网络/n,总结/v,接/v,上/f,一篇/mq,4/m,./w, ,neural/en, ,networks/en, ,(/w,part/en, ,one/en,)/w,./w, ,本文/r,将/d,先/d,定义/n,神经/n,网络/n,的/u,代价/n,函数/n,，/w,然后/c,介绍/v,逆向/d,传播/vn,(/w,back/en, ,propagation/en,:/w, ,bp/en,)/w,算法/n,，/w,它/r,能/v,有效/a,求解/v,代价/n,函数/n,对/p,连接/v,权重/nz,的/u,偏导/nw,，/w,最后/f,对/p,训练/vn,神经/n,网络/n,的/u,过程/n,进行/v,总结/v,。/w,5.1/m, ,cost/en, ,function/en,(/w,注/v,：/w,正则化/nw,相关/v,内容/n,参见/v,3/m,./w,bayesian/en, ,statistics/en, ,and/en, ,regularization/en,)/w,5.2/m, ,back/en, ,propagation/en,（/w,详细/ad,推导/vn,过程/n,参见/v,反向/f,传播/vn,算法/n,，/w,以及/c,李宏毅/nr,的/u,机器/n,学习/v,课程/n,：/w,youtube/en,,/w,b/en,站/v,）/w,。/w,-/w,1/m, ,bp/en,算法/n,步骤/n,在/p,实现/v,反向/f,传播/vn,算法/n,时/ng,，/w,有/v,如下/v,几/m,个/q,需要/v,注意/v,的/u,地方/n,。/w,需要/v,对/p,所有/b,的/u,连接/v,权/n,重/a,(/w,包括/v,偏/d,移/v,单元/n,)/w,初始化/v,为/p,接近/v,0/m,但/c,不/d,全/a,等于/v,0/m,的/u,随机数/n,。/w,如果/c,所有/b,参数/n,都/d,用/p,相同/a,的/u,值/n,作为/v,初始值/n,，/w,那么/r,所有/b,隐藏层/nw,单元/n,最终/d,会/v,得到/v,与/p,输入值/nw,有关/vn,的/u,、/w,相同/a,的/u,函数/n,（/w,也就是说/l,，/w,所有/b,神经元/n,的/u,激活/vn,值/n,都/d,会/v,取/v,相同/a,的/u,值/n,，/w,对于/p,任何/r,输入/v,x/en, ,都/d,会/v,有/v,：/w, , ,）/w,。/w,随机/d,初始化/v,的/u,目的/n,是/v,使/v,对称/ad,失效/v,。/w,具体/a,地/u,，/w,我们/r,可以/v,如/v,-/w,2/m,一样/u,随机/d,初始化/v,。/w,（/w,matlab/en,实现/v,见/v,后文/nw,代码/n,1/m,）/w,如果/c,实现/v,的/u,bp/en,算法/n,计算/v,出/v,的/u,梯度/n,（/w,偏导/nw,数/m,）/w,是/v,错误/n,的/u,，/w,那么/r,用/p,该/r,模型/n,来/v,预测/v,新/a,的/u,值/n,肯定/v,是/v,不/d,科学/n,的/u,。/w,所以/c,，/w,我们/r,应该/v,在/p,应用/vn,之前/f,就/d,判断/v,bp/en,算法/n,是否/v,正确/a,。/w,具体/a,的/u,，/w,可以/v,通过/p,数值/n,的/u,方法/n,(/w,如/v,-/w,3所/mq,示/vg,的/u,)/w,计算/v,出/v,较/d,精确/a,的/u,偏导/nw,，/w,然后/c,再/d,和/c,bp/en,算法/n,计算/v,出来/v,的/u,进行/v,比较/d,，/w,若/c,两者/r,相差/v,在/p,正常/a,的/u,误差/n,范围/n,内/f,，/w,则/d,bp/en,算法/n,计算/v,出/v,的/u,应该/v,是/v,比较/d,正确/a,的/u,，/w,否则/c,说明/v,算法/n,实现/v,有误/vn,。/w,注意/v,在/p,检查/vn,完/v,后/f,，/w,在/p,真正/d,训练/vn,模型/n,时/ng,不/d,应该/v,再/d,运行/vn,数值/n,计算/v,偏导/nw,的/u,方法/n,，/w,否则/c,将/d,会/v,运行/vn,很/d,慢/a,。/w,（/w,matlab/en,实现/v,见/v,后文/nw,代码/n,2/m,）/w,用/p,matlab/en,实现/v,时/ng,要/v,注意/v,matlab/en,的/u,函数/n,参数/n,不/d,能/v,为/p,矩阵/n,，/w,而/c,连接/v,权/n,重/a,为/p,矩阵/n,，/w,所以/c,在/p,传递/v,初始化/v,连接/v,权/n,重/a,前/f,先/d,将/d,其/r,向/p,量化/v,，/w,再/d,用/p,reshape/en,函数/n,恢复/v,。/w,(/w,见/v,后文/nw,代码/n,3/m,)/w,-/w,2/m, ,随机/d,初始化/v,连接/v,权/n,重/a,-/w,3/m, ,数值/n,方法/n,求/v,代价/n,函数/n,偏导/nw,的/u,近似值/n,5.3/m, ,神经/n,网络/n,总结/v,第一/m,步/q,，/w,设计神经网络结构/nw,。/w,隐藏层/nw,单元/n,个数/n,通常/d,都/d,是/v,不/d,确定/v,的/u,。/w,一般/a,选取/v,神经/n,网络/n,隐藏层/nw,单元/n,个数/n,的/u,几/m,个/q,经验/n,公式/n,如下/v,：/w,参考/v,https/en,:/w,//w,//w,www/en,./w,zhihu/en,./w,com/en,//w,question/en,//w,46530834/m,此外/c,，/w,mnist/en,手写/v,数字/n,识别/v,中/f,给/p,出/v,了/u,以/p,不同/a,的/u,神经/n,网络结构/l,训练/vn,的/u,结果/n,，/w,供/v,参考/v,第二/m,步/q,，/w,实现/v,正/d,向/p,传播/vn,(/w,fp/en,)/w,和/c,反向/f,传播/vn,算法/n,，/w,这/r,一步/mq,包括/v,如下/v,的/u,子/ng,步骤/n,。/w,第三/nw,步/q,，/w,用/p,数值/n,方法/n,检查/vn,求/v,偏导/nw,的/u,正确性/n,第四/nw,步/q,，/w,用/p,梯度/n,下降/v,法/j,或/c,更/d,先进/a,的/u,优化/v,算法/n,求/v,使得/v,代价/n,函数/n,最/d,小/a,的/u,连接/v,权重/nz,在/p,第四/nw,步/q,中/f,，/w,由于/c,代价/n,函数/n,是/v,非/h,凸/ag,(/w,non/en,-/w,convex/en,)/w,函数/n,，/w,所以/c,在/p,优化/v,过程/n,中/f,可能/v,陷入/v,局部/n,最/d,优值/nw,，/w,但/c,不/d,一定/d,比/p,全局/n,最/d,优差/nw,很多/m,（/w,如/v,-/w,4/m,）/w,，/w,在/p,实际/n,应用/vn,中/f,通常/d,不/d,是/v,大/a,问题/n,。/w,也/d,会/v,有/v,一些/m,启发式/nw,的/u,算法/n,（/w,如/v,模拟/b,退火算法/nw,，/w,遗传/vn,算法/n,等/u,）/w,来/v,帮助/v,跳出/v,局部/n,最/d,优/ag,。/w,-/w,4/m, ,陷入/v,局部/n,最/d,优/ag,(/w,不/d,一定/d,比/p,全局/n,最/d,优差/nw,很多/m,)/w,代码/n,1/m,：/w,随机/d,初始化/v,连接/v,权/n,重/a,function/en, ,w/en, ,=/w, ,randinitializeweights/en,(/w,l/en,_,in/en,,/w, ,l/en,_,out/en,)/w, ,%/w,randinitializeweights/en, ,randomly/en, ,initialize/en, ,the/en, ,weights/en, ,of/en, ,a/en, ,layer/en, ,with/en, ,l/en,_,in/en, ,%/w,incoming/en, ,connections/en, ,and/en, ,l/en,_,out/en, ,outgoing/en, ,connections/en, ,%/w, ,w/en, ,=/w, ,randinitializeweights/en,(/w,l/en,_,in/en,,/w, ,l/en,_,out/en,)/w, ,randomly/en, ,initializes/en, ,the/en, ,weights/en, ,%/w, ,of/en, ,a/en, ,layer/en, ,with/en, ,l/en,_,in/en, ,incoming/en, ,connections/en, ,and/en, ,l/en,_,out/en, ,outgoing/en, ,%/w, ,connections/en,./w, ,%/w, ,%/w, ,note/en, ,that/en, ,w/en, ,should/en, ,be/en, ,set/en, ,to/en, ,a/en, ,matrix/en, ,of/en, ,size/en,(/w,l/en,_,out/en,,/w, ,1/m, ,+/w, ,l/en,_,in/en,)/w, ,as/en, ,%/w, ,the/en, ,column/en, ,row/en, ,of/en, ,w/en, ,handles/en, ,the/en, ,"/w,bias/en,"/w, ,terms/en, ,%/w, ,w/en, ,=/w, ,zeros/en,(/w,l/en,_,out/en,,/w, ,1/m, ,+/w, ,l/en,_,in/en,)/w,;/w, ,%/w, ,instructions/en,:/w, ,initialize/en, ,w/en, ,randomly/en, ,so/en, ,that/en, ,we/en, ,break/en, ,the/en, ,symmetry/en, ,while/en, ,%/w, ,training/en, ,the/en, ,neural/en, ,network/en,./w, ,%/w, ,%/w, ,note/en,:/w, ,the/en, ,first/en, ,row/en, ,of/en, ,w/en, ,corresponds/en, ,to/en, ,the/en, ,parameters/en, ,for/en, ,the/en, ,bias/en, ,units/en, ,%/w, ,epsilon/en,_,init/en, ,=/w, ,sqrt/en,(/w,6/m,)/w, ,//w, ,(/w,sqrt/en,(/w,l/en,_,out/en,+/w,l/en,_,in/en,)/w,)/w,;/w, ,w/en, ,=/w, ,rand/en,(/w,l/en,_,out/en,,/w, ,1/m, ,+/w, ,l/en,_,in/en,)/w, ,*/w, ,2/m, ,*/w, ,epsilon/en,_,init/en, ,-/w, ,epsilon/en,_,init/en,;/w, ,endview/en, ,code/en,代码/n,2/m,：/w,用/p,数值/n,方法/n,求/v,代价/n,函数/n,对/p,连接/v,权重/nz,偏导/nw,的/u,近似值/n,function/en, ,numgrad/en, ,=/w, ,computenumericalgradient/en,(/w,j/en,,/w, ,theta/en,)/w, ,%/w,computenumericalgradient/en, ,computes/en, ,the/en, ,gradient/en, ,using/en, ,"/w,finite/en, ,differences/en,"/w, ,%/w,and/en, ,gives/en, ,us/en, ,a/en, ,numerical/en, ,estimate/en, ,of/en, ,the/en, ,gradient/en,./w, ,%/w, ,numgrad/en, ,=/w, ,computenumericalgradient/en,(/w,j/en,,/w, ,theta/en,)/w, ,computes/en, ,the/en, ,numerical/en, ,%/w, ,gradient/en, ,of/en, ,the/en, ,function/en, ,j/en, ,around/en, ,theta/en,./w, ,calling/en, ,y/en, ,=/w, ,j/en,(/w,theta/en,)/w, ,should/en, ,%/w, ,return/en, ,the/en, ,function/en, ,value/en, ,at/en, ,theta/en,./w, ,%/w, ,notes/en,:/w, ,the/en, ,following/en, ,code/en, ,implements/en, ,numerical/en, ,gradient/en, ,checking/en,,/w, ,and/en, ,%/w, ,returns/en, ,the/en, ,numerical/en, ,gradient/en,./w,it/en, ,sets/en, ,numgrad/en,(/w,i/en,)/w, ,to/en, ,(/w,a/en, ,numerical/en, ,%/w, ,approximation/en, ,of/en,)/w, ,the/en, ,partial/en, ,derivative/en, ,of/en, ,j/en, ,with/en, ,respect/en, ,to/en, ,the/en, ,%/w, ,i/en,-/w,th/en, ,input/en, ,argument/en,,/w, ,evaluated/en, ,at/en, ,theta/en,./w, ,(/w,i/en,./w,e/en,./w,,/w, ,numgrad/en,(/w,i/en,)/w, ,should/en, ,%/w, ,be/en, ,the/en, ,(/w,approximately/en,)/w, ,the/en, ,partial/en, ,derivative/en, ,of/en, ,j/en, ,with/en, ,respect/en, ,%/w, ,to/en, ,theta/en,(/w,i/en,)/w,./w,)/w, ,%/w, ,numgrad/en, ,=/w, ,zeros/en,(/w,size/en,(/w,theta/en,)/w,)/w,;/w, ,perturb/en, ,=/w, ,zeros/en,(/w,size/en,(/w,theta/en,)/w,)/w,;/w, ,e/en, ,=/w, ,1/m,e/en,-/w,4/m,;/w, ,for/en, ,p/en, ,=/w, ,1/m,:/w,numel/en,(/w,theta/en,)/w, ,%/w, ,set/en, ,perturbation/en, ,vector/en, ,perturb/en,(/w,p/en,)/w, ,=/w, ,e/en,;/w, ,%/w, ,compute/en, ,numerical/en, ,gradient/en, ,numgrad/en,(/w,p/en,)/w, ,=/w, ,(/w, ,j/en,(/w,theta/en, ,+/w, ,perturb/en,)/w, ,-/w, ,j/en,(/w,theta/en, ,-/w, ,perturb/en,)/w,)/w, ,//w, ,(/w,2/m,*/w,e/en,)/w,;/w, ,perturb/en,(/w,p/en,)/w, ,=/w, ,0/m,;/w, ,end/en, ,endview/en, ,code/en,代码/n,3/m,：/w,应用/vn,fp/en,和/c,bp/en,算法/n,实现/v,计算/v,隐藏层/nw,为/p,1层/mq,的/u,神经/n,网络/n,的/u,代价/n,函数/n,以及/c,其/r,对/p,连接/v,权重/nz,的/u,偏导/nw,数/m,function/en, ,[/w,j/en, ,grad/en,]/w, ,=/w, ,nncostfunction/en,(/w,nn/en,_,params/en,,/w, ,./w,./w,./w, ,input/en,_,layer/en,_,size/en,,/w, ,./w,./w,./w, ,hidden/en,_,layer/en,_,size/en,,/w, ,./w,./w,./w, ,num/en,_,labels/en,,/w, ,./w,./w,./w, ,x/en,,/w, ,y/en,,/w, ,lambda/en,)/w, ,%/w,nncostfunction/en, ,implements/en, ,the/en, ,neural/en, ,network/en, ,cost/en, ,function/en, ,for/en, ,a/en, ,two/en, ,layer/en, ,%/w,neural/en, ,network/en, ,which/en, ,performs/en, ,classification/en, ,%/w, ,[/w,j/en, ,grad/en,]/w, ,=/w, ,nncostfuncton/en,(/w,nn/en,_,params/en,,/w, ,hidden/en,_,layer/en,_,size/en,,/w, ,num/en,_,labels/en,,/w, ,./w,./w,./w, ,%/w, ,x/en,,/w, ,y/en,,/w, ,lambda/en,)/w, ,computes/en, ,the/en, ,cost/en, ,and/en, ,gradient/en, ,of/en, ,the/en, ,neural/en, ,network/en,./w, ,the/en, ,%/w, ,parameters/en, ,for/en, ,the/en, ,neural/en, ,network/en, ,are/en, ,"/w,unrolled/en,"/w, ,into/en, ,the/en