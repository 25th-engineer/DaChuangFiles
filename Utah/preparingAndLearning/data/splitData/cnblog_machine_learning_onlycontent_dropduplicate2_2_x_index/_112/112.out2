spark/en,机器/n,学习/v,之/u,协同/v,过滤算法/nw,一/m,）/w,、/w,协同/v,过滤/v,1.1/m, ,概念/n,协同/v,过滤/v,是/v,一种/mq,借助/v,"/w,集体/n,计算/v,"/w,的/u,途径/n,。/w,它/r,利用/v,大量/m,已/d,有/v,的/u,用户/n,偏/d,好/a,来/v,估计/v,用户/n,对/p,其/r,未/d,接触/v,过/u,的/u,物品/n,的/u,喜好/v,程度/n,。/w,其/r,内在/b,思想/n,是/v,相似/a,度/q,的/u,定义/n,1.2/m, ,分类/vn,1/m,./w,在/p,基于/p,用户/n,的/u,方法/n,的/u,中/f,，/w,如果/c,两个/m,用户/n,表现/v,出/v,相似/a,的/u,偏好/n,（/w,即/v,对/p,相同/a,物品/n,的/u,偏/d,好/a,大体/d,相同/a,）/w,，/w,那/r,就/d,认为/v,他们/r,的/u,兴趣/n,类似/v,。/w,要/v,对/p,他们/r,中/f,的/u,一个/m,用户/n,推荐/v,一个/m,未知/vn,物品/n,，/w,便/d,可/v,选取/v,若干/m,与/p,其/r,类似/v,的/u,用户/n,并/c,根据/p,他们/r,的/u,喜好/v,计算/v,出/v,对/p,各个/r,物品/n,的/u,综合/vn,得分/n,，/w,再/d,以/p,得分/n,来/v,推荐/v,物品/n,。/w,其/r,整体/n,的/u,逻辑/n,是/v,，/w,如果/c,其他/r,用户/n,也/d,偏/d,好/a,某些/r,物品/n,，/w,那/r,这些/r,物品/n,很/d,可能/v,值得/v,推荐/v,。/w,2/m,./w, ,同样/d,也/d,可以/v,借助/v,基于/p,物品/n,的/u,方法/n,来/v,做/v,推荐/v,。/w,这种/r,方法/n,通常/d,根据/p,现有/v,用户/n,对/p,物品/n,的/u,偏/d,好/a,或是/c,评级/vn,情况/n,，/w,来/v,计算/v,物品/n,之间/f,的/u,某种/r,相似/a,度/q,。/w,这时/r,，/w,相似/a,用户/n,评级/vn,相同/a,的/u,那些/r,物品/n,会/v,被/p,认为/v,更/d,相近/a,。/w,一旦/d,有/v,了/u,物品/n,之间/f,的/u,相似/a,度/q,，/w,便/d,可/v,用/p,用户/n,接触/v,过/u,的/u,物品/n,来/v,表示/v,这个/r,用户/n,，/w,然后/c,找/v,出/v,和/c,这些/r,已知/nz,物品/n,相似/a,的/u,那些/r,物品/n,，/w,并/c,将/d,这些/r,物品/n,推荐/v,给/p,用户/n,。/w,同样/d,，/w,与/p,已/d,有/v,物品/n,相似/a,的/u,物品/n,被/p,用/p,来/v,生成/vn,一个/m,综合/vn,得分/n,，/w,而/c,该/r,得分/n,用于/v,评估/vn,未知/vn,物品/n,的/u,相似/a,度/q,。/w,二/m,）/w,、/w,矩阵/n,分解/v,spark/en,推荐/v,模型库/nz,当前/t,只/d,包含/v,基于/p,矩阵/n,分解/v,（/w,matrix/en, ,factorization/en,）/w,的/u,实现/v,，/w,由此/d,我们/r,也/d,将/d,重点/n,关注/v,这/r,类/q,模型/n,。/w,它们/r,有/v,吸引/v,人/n,的/u,地方/n,。/w,首先/d,，/w,这些/r,模型/n,在/p,协同/v,过滤/v,中/f,的/u,表现/v,十分/d,出色/a,。/w,而/c,在/p,netflix/en, ,prize/en,等/u,知名/a,比赛/vn,中/f,的/u,表现/v,也/d,很/d,拔尖/a,1/m,，/w,显式/nw,矩阵/n,分解/v,要/v,找到/v,和/c,“/w,用户/n,,物品/n,”/w,矩阵/n,近似/a,的/u,k/en,维/q,（/w,低阶/nw,）/w,矩阵/n,，/w,最终/d,要求/v,出/v,如下/v,两个/m,矩阵/n,：/w,一个/m,用于/v,表示/v,用户/n,的/u,u/en, ,×/w, ,k/en,维/q,矩阵/n,，/w,以及/c,一个/m,表征/v,物品/n,的/u,i/en, ,×/w, ,k/en,维/q,矩阵/n,。/w,这/r,两个/m,矩阵/n,也/d,称作/v,因子/n,矩阵/n,。/w,它们/r,的/u,乘积/n,便/d,是/v,原始/a,评级/vn,矩阵/n,的/u,一个/m,近似/a,。/w,值得/v,注意/v,的/u,是/v,，/w,原始/a,评级/vn,矩阵/n,通常/d,很/d,稀疏/a,，/w,但/c,因子/n,矩阵/n,却/d,是/v,稠密/a,的/u,。/w,特点/n,：/w,因子/n,分解/v,类/q,模型/n,的/u,好处/n,在于/v,，/w,一旦/d,建立/v,了/u,模型/n,，/w,对/p,推荐/v,的/u,求解/v,便/d,相对/d,容易/a,。/w,但/c,也/d,有/v,弊端/n,，/w,即/v,当/p,用户/n,和/c,物品/n,的/u,数量/n,很多/m,时/ng,，/w,其/r,对应/v,的/u,物品/n,或是/c,用户/n,的/u,因子/n,向量/n,可能/v,达到/v,数以百万计/l,。/w,这/r,将/d,在/p,存储/vn,和/c,计算/v,能力/n,上/f,带来/v,挑战/vn,。/w,另/r,一个/m,好处/n,是/v,，/w,这/r,类/q,模型/n,的/u,表现/v,通常/d,都/d,很/d,出色/a,。/w,2/m,，/w,隐式/nw,矩阵/n,分解/v,（/w,关联/vn,因子/n,分/q,确定/v,，/w,可能/v,随时/d,会/v,变化/vn,）/w,隐式/nw,模型/n,仍然/d,会/v,创建/v,一个/m,用户/n,因子/n,矩阵/n,和/c,一个/m,物品/n,因子/n,矩阵/n,。/w,但是/c,，/w,模型/n,所/u,求解/v,的/u,是/v,偏/d,好/a,矩阵/n,而/c,非/h,评级/vn,矩阵/n,的/u,近似/a,。/w,类似/v,地/u,，/w,此时/r,用户/n,因子/n,向量/n,和/c,物品/n,因子/n,向量/n,的/u,点积/nw,所/u,得到/v,的/u,分数/n,也/d,不再/d,是/v,一个/m,对/p,评级/vn,的/u,估值/v,，/w,而是/c,对/p,某个/r,用户/n,对/p,某/r,一/m,物品/n,偏/d,好/a,的/u,估值/v,（/w,该值/nw,的/u,取值/v,虽/c,并/c,不/d,严格/ad,地/u,处于/v,0/m,到/v,1/m,之间/f,，/w,但/c,十分/d,趋/v,近/a,于/p,这个/r,区间/n,）/w,3/m,，/w,最小二乘法/nw,（/w,alternating/en, ,least/en, ,squares/en, , , , ,als/en,）/w,：/w,解决/v,矩阵/n,分解/v,的/u,最/d,优化/v,方法/n,als/en,的/u,实现/v,原理/n,是/v,迭代式/nw,求解/v,一系列/mq,最小/a,二/m,乘/v,回归/v,问题/n,。/w,在/p,每/r,一次/mq,迭代/vn,时/ng,，/w,固定/a,用户/n,因子/n,矩阵/n,或是/c,物品/n,因子/n,矩阵/n,中/f,的/u,一个/m,，/w,然后/c,用/p,固定/a,的/u,这个/r,矩阵/n,以及/c,评级/vn,数据/n,来/v,更新/v,另/r,一个/m,矩阵/n,。/w,之后/f,，/w,被/p,更新/v,的/u,矩阵/n,被/p,固定/a,住/v,，/w,再/d,更/d,新/a,另外/c,一个/m,矩阵/n,。/w,如此/r,迭代/vn,，/w,直到/v,模型/n,收敛/vn,（/w,或是/c,迭代/vn,了/u,预设/v,好/a,的/u,次数/n,）/w,。/w,三/m,）/w,、/w,spark/en,下/f,als/en,算法/n,的/u,应用/vn,1/m,，/w,数据/n,来源/n,电影/n,集/vg,ml/en,-/w,100/m,k/en,2/m,,/w,代码/n,实现/v,基于/p,用户/n,相似/a,度/q,片段/n,代码/n,：/w,val/en, ,moviefile/en,=/w,sc/en,./w,textfile/en,(/w,filename/en,)/w, ,val/en, ,ratingdatas/en,=/w,moviefile/en,./w,map/en,(/w,_,./w,split/en,(/w,"/w,\/w,t/en,"/w,)/w,./w,take/en,(/w,3/m,)/w,)/w, ,//w,//w,转为/v,ratings/en,数据/n, ,val/en, ,ratings/en,=/w,ratingdatas/en,./w,map/en,(/w,x/en, ,=/w,>,rating/en,(/w,x/en,(/w,0/m,)/w,./w,toint/en,,/w,x/en,(/w,1/m,)/w,./w,toint/en,,/w,x/en,(/w,2/m,)/w,./w,todouble/en,)/w,)/w, ,//w,//w,获取/v,用户/n,评价/v,模型/n,,/w,设置/v,k/en,因子/n,,/w,和/c,迭代/vn,次数/n,,/w,隐藏/v,因子/n,lambda/en,,/w,获取/v,模型/n, ,val/en, ,model/en,=/w,als/en,./w,train/en,(/w,ratings/en,,/w,50/m,,/w,10/m,,/w,0.01/m,)/w, ,//w,//w,基于/p,用户/n,相似/a,度/q,推荐/v, ,println/en,(/w,"/w,usernumber/en,:/w,"/w,+/w,model/en,./w,userfeatures/en,./w,count/en,(/w,)/w,+/w,"/w,\/w,t/en,"/w,+/w,"/w,productnum/en,:/w,"/w,+/w,model/en,./w,productfeatures/en,./w,count/en,(/w,)/w,)/w, ,//w,//w,指定/v,用户/n,及/c,商品/n,,/w,输出/v,预测值/n, ,println/en,(/w,model/en,./w,predict/en,(/w,789/m,,/w,123/m,)/w,)/w, ,//w,//w,为/p,指定/v,用户/n,推荐/v,的/u,前/f,n/en,商品/n, ,model/en,./w,recommendproducts/en,(/w,789/m,,/w,11/m,)/w,./w,foreach/en,(/w,println/en,(/w,_,)/w,)/w, ,//w,//w,为/p,每个/r,人/n,推荐/v,前/f,十个/m,商品/n, ,model/en,./w,recommendproductsforusers/en,(/w,10/m,)/w,./w,take/en,(/w,1/m,)/w,./w,foreach/en,{/w, ,case/en,(/w,x/en,,/w,rating/en,)/w, ,=/w,>,println/en,(/w,rating/en,(/w,0/m,)/w,)/w, ,}/w,基于/p,商品/n,相似/a,度/q,代码/n,：/w,计算/v,相似/a,度/q,的/u,方法/n,有/v,相似/a,度/q,是/v,通过/p,某种/r,方式/n,比较/d,表示/v,两个/m,物品/n,的/u,向量/n,而/c,得到/v,的/u,。/w,常见/a,的/u,相似/a,度/q,衡量/v,方法/n,包括/v,皮尔森/nr,相关/v,系数/n,（/w,pearson/en, ,correlation/en,）/w,、/w,针对/p,实数/n,向量/n,的/u,余弦/n,相似/a,度/q,（/w,cosine/en, ,similarity/en,）/w,和/c,针对/p,二元/b,向量/n,的/u,杰卡德/nr,相似/a,系数/n,（/w,jaccard/en, ,similarity/en,）/w,。/w,val/en, ,itemfactory/en,=/w,model/en,./w,productfeatures/en,./w,lookup/en,(/w,567/m,)/w,./w,head/en, ,val/en, ,itemvector/en,=/w,new/en, ,doublematrix/en,(/w,itemfactory/en,)/w, ,//w,//w,求/v,余弦/n,相似/a,度/q, ,val/en, ,sim/en,=/w,model/en,./w,productfeatures/en,./w,map/en,{/w, ,case/en,(/w,id/en,,/w,factory/en,)/w,=/w,>, ,val/en, ,factorvector/en,=/w,new/en, ,doublematrix/en,(/w,factory/en,)/w, ,val/en, ,sim/en,=/w,cosinesimilarity/en,(/w,factorvector/en,,/w,itemvector/en,)/w, ,(/w,id/en,,/w,sim/en,)/w, ,}/w, ,val/en, ,sortedsim/en,=/w,sim/en,./w,top/en,(/w,11/m,)/w,(/w,ordering/en,./w,by/en,[/w,(/w,int/en,,/w,double/en,)/w,,/w,double/en,]/w,{/w, ,case/en,(/w,id/en,,/w,sim/en,)/w,=/w,>,sim/en, ,}/w,)/w, ,println/en,(/w,sortedsim/en,./w,take/en,(/w,10/m,)/w,./w,mkstring/en,(/w,"/w,\/w,n/en,"/w,)/w,)/w, ,def/en, ,cosinesimilarity/en,(/w,vec/en,1/m,:/w,doublematrix/en,,/w,vec/en,2/m,:/w,doublematrix/en,)/w,:/w,double/en,=/w,{/w, ,vec/en,1/m,./w,dot/en,(/w,vec/en,2/m,)/w,//w,(/w,vec/en,1/m,./w,norm/en,2/m,(/w,)/w,*/w,vec/en,2/m,./w,norm/en,2/m,(/w,)/w,)/w, ,}/w,均/d,方差/nr,评估/vn,模型/n,代码/n,：/w,//w,//w,模型/n,评估/vn,,/w,通过/p,均/d,误差/n, ,//w,//w,实际/n,用户/n,评估/vn,值/n, ,val/en, ,actualratings/en,=/w,ratings/en,./w,map/en,{/w, ,case/en, ,rating/en,(/w,user/en,,/w,item/en,,/w,rats/en,)/w, ,=/w,>, ,(/w,(/w,user/en,,/w,item/en,)/w,,/w,rats/en,)/w, ,}/w, ,val/en, ,useritems/en,=/w,ratings/en,./w,map/en,{/w, ,case/en,(/w,rating/en,(/w,user/en,,/w,item/en,,/w,rats/en,)/w,)/w, ,=/w,>, ,(/w,user/en,,/w,item/en,)/w, ,}/w, ,//w,//w,模型/n,的/u,用户/n,对/p,商品/n,的/u,预测值/n, ,val/en, ,predictratings/en,=/w,model/en,./w,predict/en,(/w,useritems/en,)/w,./w,map/en,{/w, ,case/en,(/w,rating/en,(/w,user/en,,/w,item/en,,/w,rats/en,)/w,)/w, ,=/w,>,(/w,(/w,user/en,,/w,item/en,)/w,,/w,rats/en,)/w, ,}/w, ,//w,//w,联合/v,获取/v,rate/en,值/n, ,val/en, ,rates/en,=/w,actualratings/en,./w,join/en,(/w,predictratings/en,)/w,./w,map/en,{/w, ,case/en, ,x/en, ,=/w,>,(/w,x/en,./w,_,2/m,./w,_,1/m,,/w,x/en,./w,_,2/m,./w,_,2/m,)/w, ,}/w, ,//w,//w,求/v,均/d,方差/nr, ,val/en, ,regressionmetrics/en,=/w,new/en, ,regressionmetrics/en,(/w,rates/en,)/w, ,//w,//w,越/d,接近/v,0/m,越/d,佳/a, ,println/en,(/w,regressionmetrics/en,./w,meansquarederror/en,)/w,全局/n,准确率/n,评估/vn,（/w,map/en,）/w,：/w,使用/v,mllib/en,的/u, ,rankingmetrics/en, ,类/q,来/v,计算/v,基于/p,排名/v,的/u,评估/vn,指标/n,。/w,类似/v,地/u,，/w,需要/v,向/p,我们/r,之前/f,的/u,平均/a,准确率/n,函数/n,传入/v,一个/m,键值/nr,对/p,类型/n,的/u,rdd/en,。/w,其/r,键/nr,为/p,给/p,定/v,用户/n,预测/v,的/u,推荐/v,物品/n,的/u,id/en,数组/n,，/w,而/c,值/n,则/d,是/v,实际/n,的/u,物品/n,id/en,数组/n,。/w,//w,//w,全局/n,平均/a,准确率/n,(/w,map/en,)/w, ,val/en, ,itemfactors/en, ,=/w, ,model/en,./w,productfeatures/en,./w,map/en, ,{/w, ,case/en, ,(/w,id/en,,/w, ,factor/en,)/w, ,=/w,>, ,factor/en, ,}/w,./w,collect/en,(/w,)/w, ,val/en, ,itemmatrix/en, ,=/w, ,new/en, ,doublematrix/en,(/w,itemfactors/en,)/w, ,//w,//w,分布式/b,广播/vn,商品/n,的/u,特征/n,矩阵/n, ,val/en, ,imbroadcast/en, ,=/w, ,sc/en,./w,broadcast/en,(/w,itemmatrix/en,)/w, ,//w,//w,计算/v,每/r,一个/m,用户/n,的/u,推荐/v,,/w,在/p,这个/r,操作/v,里/f,，/w,会/v,对/p,用户/n,因子/n,矩阵/n,和/c,电影/n,因子/n,矩阵/n,做/v,乘积/n,，/w,其/r,结果/n,为/p,一个/m,表示/v,各个/r,电影/n,预计/v,评级/vn,的/u,向量/n,（/w,长度/n,为/p, ,//w,//w,1682/m,，/w,即/v,电影/n,的/u,总/b,数目/n,）/w, ,val/en, ,allrecs/en, ,=/w, ,model/en,./w,userfeatures/en,./w,map/en,{/w, ,case/en, ,(/w,userid/en,,/w, ,array/en,)/w, ,=/w,>, ,val/en, ,uservector/en, ,=/w, ,new/en, ,doublematrix/en,(/w,array/en,)/w, ,val/en, ,scores/en, ,=/w, ,imbroadcast/en,./w,value/en,./w,mmul/en,(/w,uservector/en,)/w, ,val/en, ,sortedwithid/en, ,=/w, ,scores/en,./w,data/en,./w,zipwithindex/en,./w,sortby/en,(/w,-/w,_,./w,_,1/m,)/w, ,val/en, ,recommendedids/en, ,=/w, ,sortedwithid/en,./w,map/en,(/w,_,./w,_,2/m, ,+/w, ,1/m,)/w,./w,toseq/en, ,//w,//w,+/w,1/m,,/w,矩阵/n,从/p,0/m,开始/v, ,(/w,userid/en,,/w, ,recommendedids/en,)/w, ,}/w, ,//w,//w,实际/n,评分/vn, ,val/en, ,usermovies/en, ,=/w, ,ratings/en,./w,map/en,{/w, ,case/en, ,rating/en,(/w,user/en,,/w, ,product/en,,/w, ,rating/en,)/w, ,=/w,>, ,(/w,user/en,,/w, ,product/en,)/w,}/w,./w,groupby/en,(/w,_,./w,_,1/m,)/w, ,val/en, ,predictedandtrueforranking/en, ,=/w, ,allrecs/en,./w,join/en,(/w,usermovies/en,)/w,./w,map/en,{/w, ,case/en, ,(/w,userid/en,,/w, ,(/w,predicted/en,,/w, ,actualwithids/en,)/w,)/w, ,=/w,>, ,val/en, ,actual/en, ,=/w, ,actualwithids/en,./w,map/en,(/w,_,./w,_,2/m,)/w, ,(/w,predicted/en,./w,toarray/en,,/w, ,actual/en,./w,toarray/en,)/w, ,}/w, ,//w,//w,求/v,map/en,,/w,越/d,大/a,越/d,好/a,吧/y, ,val/en, ,rankingmetrics/en, ,=/w, ,new/en, ,rankingmetrics/en,(/w,predictedandtrueforranking/en,)/w, ,println/en,(/w,"/w,mean/en, ,average/en, ,precision/en, ,=/w, ,"/w, ,+/w, ,rankingmetrics/en,./w,meanaverageprecision/en,)/w,详细/ad,代码/n,：/w,package/en, ,com/en,./w,spark/en,./w,milb/en,./w,study/en, ,import/en, ,org/en,./w,apache/en,./w,log/en,4/m,j/en,./w,{/w,level/en,,/w, ,logger/en,}/w, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,evaluation/en,./w,{/w,rankingmetrics/en,,/w, ,regressionmetrics/en,}/w, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,mllib/en,./w,recommendation/en,./w,{/w,als/en,,/w, ,rating/en,}/w, ,import/en, ,org/en,./w,apache/en,./w,spark/en,./w,{/w,sparkconf/en,,/w, ,sparkcontext/en,}/w, ,import/en, ,org/en,./w,jblas/en,./w,doublematrix/en, ,//w,*/w,*/w, ,*/w, ,created/en, ,by/en, ,hadoop/en, ,on/en, ,17/m,-/w,5/m,-/w,3/m,./w, ,*/w, ,协同/v,过滤/v,(/w,处理/v,对象/n,movie/en,,/w,使用/v,算法/n,als/en,:/w,最小二乘法/nw,(/w,实现/v,用户/n,推荐/v,)/w, ,*/w, ,余弦/n,相似/a,度/q,实现/v,商品/n,相似/a,度/q,推荐/v, ,*/w,//w, ,object/en, ,cftest/en, ,{/w, ,def/en, ,main/en,(/w,args/en,:/w, ,array/en,[/w,string/en,]/w,)/w,:/w, ,unit/en, ,=/w, ,{/w, ,logger/en,./w,getlogger/en,(/w,"/w,org/en,./w,apache/en,./w,spark/en,"/w,)/w,./w,setlevel/en,(/w,level/en,./w,warn/en,)/w, ,logger/en,./w,getlogger/en,(/w,"/w,org/en,./w,eclipse/en,./w,jetty/en,./w,server/en,"/w,)/w,./w,setlevel/en,(/w,level/en,./w,off/en,)/w, ,val/en, ,conf/en,=/w,new/en, ,sparkconf/en,(/w,)/w,./w,setmaster/en,(/w,"/w,local/en,"/w,)/w,./w,setappname/en,(/w,"/w,alstest/en,"/w,)/w, ,val/en, ,sc/en,=/w,new/en, ,sparkcontext/en,(/w,conf/en,)/w, ,cf/en,(/w,sc/en,,/w,"/w,ml/en,-/w,100/m,k/en,//w,u/en,./w,data/en,"/w,)/w, ,}/w, ,def/en, ,cf/en,(/w,sc/en,:/w,sparkcontext/en,,/w,filename/en,:/w,string/en,)/w,:/w, ,unit/en, ,=/w,{/w, ,val/en, ,moviefile/en,=/w,sc/en,./w,textfile/en,(/w,filename/en,)/w, ,val/en, ,ratingdatas/en,=/w,moviefile/en,./w,map/en,(/w,_,./w,split/en,(/w,"/w,\/w,t/en,"/w,)/w,./w,take/en,(/w,3/m,)/w,)/w, ,//w,//w,转为/v,ratings/en,数据/n, ,val/en, ,ratings/en,=/w,ratingdatas/en,./w,map/en,(/w,x/en, ,=/w,>,rating/en,(/w,x/en,(/w,0/m,)/w,./w,toint/en,,/w,x/en,(/w,1/m,)/w,./w,toint/en,,/w,x/en,(/w,2/m,)/w,./w,todouble/en,)/w,)/w, ,//w,//w,获取/v,用户/n,评价/v,模型/n,,/w,设置/v,k/en,因子/n,,/w,和/c,迭代/vn,次数/n,,/w,隐藏/v,因子/n,lambda/en,,/w,获取/v,模型/n, ,//w,*/w, ,*/w, ,, ,rank/en, ,：/w,对应/v,als/en,模型/n,中/f,的/u,因子/n,个数/n,，/w,也/d,就是/d,在/p,低阶/nw,近似/a,矩阵/n,中/f,的/u,隐含/v,特征/n,个数/n,。/w,因子/n,个/q, ,数/m,一般/a,越/d,多/a,越/d,好/a,。/w,但/c,它/r,也/d,会/v,直接/ad,影响/vn,模型/n,训练/vn,和/c,保存/v,时/ng,所/u,需/v,的/u,内存/n,开销/v,，/w,尤其/d,是/v,在/p,用户/n, ,和/c,物品/n,很多/m,的/u,时候/n,。/w,因此/c,实践/v,中/f,该/r,参数/n,常/d,作为/v,训练/vn,效果/n,与/p,系统/n,开销/v,之间/f,的/u,调节/vn,参数/n,。/w,通/v, ,常/d,，/w,其/r,合理/a,取值/v,为/p,10/m,到/v,200/m,。/w, ,iterations/en, ,：/w,对应/v,运行/vn,时/ng,的/u,迭代/vn,次数/n,。/w,als/en,能/v,确保/v,每次/r,迭代/vn,都/d,能/v,降低/v,评级/vn,矩阵/n,的/u,重建/v,误/v, ,差/a,，/w,但/c,一般/a,经/p,少数/m,次/q,迭代/vn,后/f,als/en,模型/n,便/d,已/d,能/v,收敛/vn,为/p,一个/m,比较/d,合理/a,的/u,好/a,模型/n,。/w,这样/r,，/w,大部分/m, ,情况/n,下/f,都/d,没/d,必要/a,迭代/vn,太/d,多次/nrf,（/w,10次/mq,左右/m,一般/a,就/d,挺/d,好/a,）/w,。/w, ,lambda/en, ,：/w,该/r,参数/n,控制/v,模型/n,的/u,正则化/nw,过程/n,，/w,从而/c,控制/v,模型/n,的/u,过/u,拟合/nz,情况/n,。/w,其/r,值/n,越/d,高/a,，/w,正/d,则/d, ,化/v,越/d,严厉/ad,。/w,该/r,参数/n,的/u,赋值/v,与/p,实际/n,数据/n,的/u,大小/n,、/w,特征/n,和/c,稀疏/a,程度/n,有关/vn,。/w,和/c,其他/r,的/u,机器/n,学习/v, ,模型/n,一样/u,，/w,正/d,则/d,参数/n,应该/v,通过/p,用/p,非/h,样本/n,的/u,测试/vn,数据/n,进行/v,交叉/vn,验证/vn,来/v,调整/vn,。/w, ,*/w, ,*/w,//w, ,val/en, ,model/en,=/w,als/en,./w,train/en,(/w,ratings/en,,/w,50/m,,/w,10/m,,/w,0.01/m,)/w, ,//w,//w,基于/p,用户/n,相似/a,度/q,推荐/v, ,println/en,(/w,"/w,usernumber/en,:/w,"/w,+/w,model/en,./w,userfeatures/en,./w,count/en,(/w,)/w,+/w,"/w,\/w,t/en,"/w,+/w,"/w,productnum/en,:/w,"/w,+/w,model/en,./w,productfeatures/en,./w,count/en,(/w,)/w,)/w, ,//w,//w,指定/v,用户/n,及/c,商品/n,,/w,输出/v,预测值/n, ,println/en,(/w,model/en,./w,predict/en,(/w,789/m,,/w,123/m,)/w,)/w, ,//w,//w,为/p,指定/v,用户/n,推荐/v,的/u,前/f,n/en,商品/n, ,model/en,./w,recommendproducts/en,(/w,789/m,,/w,11/m,)/w,./w,foreach/en,(/w,println/en,(/w,_,)/w,)/w, ,//w,//w,为/p,每个/r,人/n,推荐/v,前/f,十个/m,商品/n, ,model/en,./w,recommendproductsforusers/en,(/w,10/m,)/w,./w,take/en,(/w,1/m,)/w,./w,foreach/en,{/w, ,case/en,(/w,x/en,,/w,rating/en,)/w, ,=/w,>,println/en,(/w,rating/en,(/w,0/m,)/w,)/w, ,}/w, ,//w,//w,基于/p,商品/n,相似/a,度/q,(/w,使用/v,余弦/n,相似/a,度/q,)/w,进行/v,推荐/v,,/w,获取/v,某个/r,商品/n,的/u,特征值/n, ,val/en, ,itemfactory/en,=/w,model/en,./w,productfeatures/en,./w,lookup/en,(/w,567/m,)/w,./w,head/en, ,val/en, ,itemvector/en,=/w,new/en, ,doublematrix/en,(/w,itemfactory/en,)/w, ,//w,//w,求/v,余弦/n,相似/a,度/q, ,val/en, ,sim/en,=/w,model/en,./w,productfeatures/en,./w,map/en,{/w, ,case/en,(/w,id/en,,/w,factory/en,)/w,=/w,>, ,val/en, ,factorvector/en,=/w,new/en, ,doublematrix/en,(/w,factory/en,)/w, ,val/en, ,sim/en,=/w,cosinesimilarity/en,(/w,factorvector/en,,/w,itemvector/en,)/w, ,(/w,id/en,,/w,sim/en,)/w, ,}/w, ,val/en, ,sortedsim/en,=/w,sim/en,./w,top/en,(/w,11/m,)/w,(/w,ordering/en,./w,by/en,[/w,(/w,int/en,,/w,double/en,)/w,,/w,double/en,]/w,{/w, ,case/en,(/w,id/en,,/w,sim/en,)/w,=/w,>,sim/en, ,}/w,)/w, ,println/en,(/w,sortedsim/en,./w,take/en,(/w,10/m,)/w,./w,mkstring/en,(/w,"/w,\/w,n/en,"/w,)/w,)/w, ,//w,//w,模型/n,评估/vn,,/w,通过/p,均/d,误差/n, ,//w,//w,实际/n,用户/n,评估/vn,值/n, ,val/en, ,actualratings/en,=/w,ratings/en,./w,map/en,{/w, ,case/en, ,rating/en,(/w,user/en,,/w,item/en,,/w,rats/en,)/w, ,=/w,>, ,(/w,(/w,user/en,,/w,item/en,)/w,,/w,rats/en,)/w, ,}/w, ,val/en, ,useritems/en,=/w,ratings/en,./w,map/en,{/w, ,case/en,(/w,rating/en,(/w,user/en,,/w,item/en,,/w,rats/en,)/w,)/w, ,=/w,>, ,(/w,user/en,,/w,item/en,)/w, ,}/w, ,//w,//w,模型/n,的/u,用户/n,对/p,商品/n,的/u,预测值/n, ,val/en, ,predictratings/en,=/w,model/en,./w,predict/en,(/w,useritems/en,)/w,./w,map/en,{/w, ,case/en,(/w,rating/en,(/w,user/en,,/w,item/en,,/w,rats/en,)/w,)/w, ,=/w,>,(/w,(/w,user/en,,/w,item/en,)/w,,/w,rats/en,)/w, ,}/w, ,//w,//w,联合/v,获取/v,rate/en,值/n, ,val/en, ,rates/en,=/w,actualratings/en,./w,join/en,(/w,predictratings/en,)/w,./w,map/en,{/w, ,case/en, ,x/en, ,=/w,>,(/w,x/en,./w,_,2/m,./w,_,1/m,,/w,x/en,./w,_,2/m,./w,_,2/m,)/w, ,}/w, ,//w,//w,求/v,均/d,方差/nr, ,val/en, ,regressionmetrics/en,=/w,new/en, ,regressionmetrics/en,(/w,rates/en,)/w, ,//w,//w,越/d,接近/v,0/m,越/d,佳/a, ,println/en,(/w,regressionmetrics/en,./w,meansquarederror/en,)/w, ,//w,//w,全局/n,平均/a,准确率/n,(/w,map/en,)/w, ,val/en, ,itemfactors/en, ,=/w, ,model/en,./w,productfeatures/en,./w,map/en, ,{/w, ,case/en, ,(/w,id/en,,/w, ,factor/en,)/w, ,=/w,>, ,factor/en, ,}/w,./w,collect/en,(/w,)/w, ,val/en, ,itemmatrix/en, ,=/w, ,new/en, ,doublematrix/en,(/w,itemfactors/en,)/w, ,//w,//w,分布式/b,广播/vn,商品/n,的/u,特征/n,矩阵/n, ,val/en, ,imbroadcast/en, ,=/w, ,sc/en,./w,broadcast/en,(/w,it